import{a as Qs,b as M0,c as Ar,d as lx,e as ux,f as Zl,g as dx,h as hx,i as c$,k as l$}from"./chunk-RFOXOZ2C.js";import{A as QN,B as Ql,C as Yl,D as yg,E as wg,F as YN,G as JN,H as ZN,I as XN,J as ix,K as sx,L as ox,M as vg,N as ax,O as bg,P as cx,Q as or,W as ch,Y as a$,a as Ks,b as PN,c as MN,d as Wl,e as hg,f as kN,g as LN,h as FN,i as BN,j as UN,k as jN,l as S0,m as VN,n as _0,o as fg,oa as fx,p as pg,pa as px,q as gg,r as mg,s as HN,t as $N,u as qN,v as Cr,w as zN,x as GN,xa as u$,y as KN,z as WN}from"./chunk-C7WJRSMW.js";import{A as de,C as D0,E as N0,M as nx,O as Bo,Q as Jl,S as lc,U as bs,W as bt,Z as x0,a as st,aa as R0,b as ex,ca as Vt,d as cc,ga as rx,ia as qt,j as tx,ka as O0,oa as P0,qa as W,r as Qt,sa as Ws,t as Ut,v as sr}from"./chunk-ADXS2CDP.js";import{qb as o$}from"./chunk-4LGCJMV5.js";import"./chunk-Q2QAD6QF.js";import{xa as T0}from"./chunk-E7P2HYXN.js";import"./chunk-7ECBQATZ.js";import{a as H,b as fe,d as ON,e as $r,f as vs,g as ah,i as Kl,j as Pe}from"./chunk-SVM3HCG7.js";var nv=vs(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});var Bs={exports:{}};function yZ(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var wZ=vZ;function vZ(t,e,n){var r=n&&n.stringify||yZ,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=r(t);for(var a=1;a<s;a++)o[a]=r(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-i,d=-1,h=t&&t.length||0,f=0;f<h;){if(t.charCodeAt(f)===37&&f+1<h){switch(d=d>-1?d:0,t.charCodeAt(f+1)){case 100:case 102:if(u>=c||e[u]==null)break;d<f&&(l+=t.slice(d,f)),l+=Number(e[u]),d=f+2,f++;break;case 105:if(u>=c||e[u]==null)break;d<f&&(l+=t.slice(d,f)),l+=Math.floor(Number(e[u])),d=f+2,f++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;d<f&&(l+=t.slice(d,f));var p=typeof e[u];if(p==="string"){l+="'"+e[u]+"'",d=f+2,f++;break}if(p==="function"){l+=e[u].name||"<anonymous>",d=f+2,f++;break}l+=r(e[u]),d=f+2,f++;break;case 115:if(u>=c)break;d<f&&(l+=t.slice(d,f)),l+=String(e[u]),d=f+2,f++;break;case 37:d<f&&(l+=t.slice(d,f)),l+="%",d=f+2,f++,u--;break}++u}++f}return d===-1?t:(d<h&&(l+=t.slice(d)),l)}var SF=wZ;Bs.exports=bo;var ap=MZ().console||{},bZ={mapHttpRequest:Qw,mapHttpResponse:Qw,wrapRequestSerializer:iS,wrapResponseSerializer:iS,wrapErrorSerializer:iS,req:Qw,res:Qw,err:TF,errWithCause:TF};function Sa(t,e){return t==="silent"?1/0:e.levels.values[t]}var uS=Symbol("pino.logFuncs"),sS=Symbol("pino.hierarchy"),EZ={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function _F(t,e){let n={logger:e,parent:t[sS]};e[sS]=n}function IZ(t,e,n){let r={};e.forEach(i=>{r[i]=n[i]?n[i]:ap[i]||ap[EZ[i]||"log"]||md}),t[uS]=r}function CZ(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function bo(t){t=t||{},t.browser=t.browser||{};let e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");let n=t.browser.write||ap;t.browser.write&&(t.browser.asObject=!0);let r=t.serializers||{},i=CZ(t.browser.serialize,r),s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);let o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof n=="function"&&a.forEach(function(g){n[g]=n}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");let c=t.level||"info",l=Object.create(n);l.log||(l.log=md),IZ(l,a,n),_F({},l),Object.defineProperty(l,"levelVal",{get:d}),Object.defineProperty(l,"level",{get:h,set:f});let u={transmit:e,serialize:i,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:RZ(t),messageKey:t.messageKey||"msg",onChild:t.onChild||md};l.levels=AZ(t),l.level=c,l.isLevelEnabled=function(g){return this.levels.values[g]?this.levels.values[g]>=this.levels.values[this.level]:!1},l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=md,l.serializers=r,l._serialize=i,l._stdErrSerialize=s,l.child=function(...g){return p.call(this,u,...g)},e&&(l._logEvent=oS());function d(){return Sa(this.level,this)}function h(){return this._level}function f(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,ml(this,u,l,"error"),ml(this,u,l,"fatal"),ml(this,u,l,"warn"),ml(this,u,l,"info"),ml(this,u,l,"debug"),ml(this,u,l,"trace"),o.forEach(m=>{ml(this,u,l,m)})}function p(g,m,y){if(!m)throw new Error("missing bindings for child Pino");y=y||{},i&&m.serializers&&(y.serializers=m.serializers);let E=y.serializers;if(i&&E){var I=Object.assign({},r,E),L=t.browser.serialize===!0?Object.keys(I):i;delete m.serializers,dS([m],L,I,this._stdErrSerialize)}function k(B){this._childLevel=(B._childLevel|0)+1,this.bindings=m,I&&(this.serializers=I,this._serialize=L),e&&(this._logEvent=oS([].concat(B._logEvent.bindings,m)))}k.prototype=this;let N=new k(this);return _F(this,N),N.child=function(...B){return p.call(this,g,...B)},N.level=y.level||this.level,g.onChild(N),N}return l}function AZ(t){let e=t.customLevels||{},n=Object.assign({},bo.levels.values,e),r=Object.assign({},bo.levels.labels,SZ(e));return{values:n,labels:r}}function SZ(t){let e={};return Object.keys(t).forEach(function(n){e[t[n]]=n}),e}bo.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},bo.stdSerializers=bZ,bo.stdTimeFunctions=Object.assign({},{nullTime:RF,epochTime:OF,unixTime:OZ,isoTime:PZ});function _Z(t){let e=[];t.bindings&&e.push(t.bindings);let n=t[sS];for(;n.parent;)n=n.parent,n.logger.bindings&&e.push(n.logger.bindings);return e.reverse()}function ml(t,e,n,r){if(Object.defineProperty(t,r,{value:Sa(t.level,n)>Sa(r,n)?md:n[uS][r],writable:!0,enumerable:!0,configurable:!0}),t[r]===md){if(!e.transmit)return;let s=e.transmit.level||t.level,o=Sa(s,n);if(Sa(r,n)<o)return}t[r]=DZ(t,e,n,r);let i=_Z(t);i.length!==0&&(t[r]=TZ(i,t[r]))}function TZ(t,e){return function(){return e.apply(this,[...t,...arguments])}}function DZ(t,e,n,r){return(function(i){return function(){let s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ap?ap:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var l=!1;if(e.serialize&&(dS(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?i.call(a,...NZ(this,r,o,s,e)):i.apply(a,o),e.transmit){let u=e.transmit.level||t._level,d=Sa(u,n),h=Sa(r,n);if(h<d)return;xZ(this,{ts:s,methodLevel:r,methodValue:h,transmitLevel:u,transmitValue:n.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Sa(t._level,n)},o,l)}}})(t[uS][r])}function NZ(t,e,n,r,i){let{level:s,log:o=d=>d}=i.formatters||{},a=n.slice(),c=a[0],l={},u=(t._childLevel|0)+1;if(u<1&&(u=1),r&&(l.time=r),s){let d=s(e,t.levels.values[e]);Object.assign(l,d)}else l.level=t.levels.values[e];if(i.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());return[o(l),...a]}else{if(c!==null&&typeof c=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());c=a.length?SF(a.shift(),a):void 0}else typeof c=="string"&&(c=SF(a.shift(),a));return c!==void 0&&(l[i.messageKey]=c),[o(l)]}}function dS(t,e,n,r){for(let i in t)if(r&&t[i]instanceof Error)t[i]=bo.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(let s in t[i])e.indexOf(s)>-1&&s in n&&(t[i][s]=n[s](t[i][s]))}function xZ(t,e,n,r=!1){let i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,l=t._logEvent.bindings;r||dS(n,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=n.filter(function(u){return l.indexOf(u)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,c),t._logEvent=oS(l)}function oS(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function TF(t){let e={type:t.constructor.name,msg:t.message,stack:t.stack};for(let n in t)e[n]===void 0&&(e[n]=t[n]);return e}function RZ(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?RF:OF}function Qw(){return{}}function iS(t){return t}function md(){}function RF(){return!1}function OF(){return Date.now()}function OZ(){return Math.round(Date.now()/1e3)}function PZ(){return new Date(Date.now()).toISOString()}function MZ(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}Bs.exports.default=bo;var kZ=Bs.exports.pino=bo,PF={level:"info"},cp="custom_context",tv=1e3*1024,LZ=Object.defineProperty,FZ=(t,e,n)=>e in t?LZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Aa=(t,e,n)=>FZ(t,typeof e!="symbol"?e+"":e,n),aS=class{constructor(e){Aa(this,"nodeValue"),Aa(this,"sizeInBytes"),Aa(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Jw=class{constructor(e){Aa(this,"lengthInNodes"),Aa(this,"sizeInBytes"),Aa(this,"head"),Aa(this,"tail"),Aa(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let n=new aS(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let n=e.value;return e=e.next,{done:!1,value:n}}}}},BZ=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n);function DF(t){return typeof t=="string"?t:BZ(t)||""}var UZ=Object.defineProperty,jZ=(t,e,n)=>e in t?UZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yw=(t,e,n)=>jZ(t,typeof e!="symbol"?e+"":e,n),Zw=class{constructor(e,n=tv){Yw(this,"logs"),Yw(this,"level"),Yw(this,"levelValue"),Yw(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=Bs.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new Jw(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===Bs.exports.levels.values.error?console.error(e):n===Bs.exports.levels.values.warn?console.warn(e):n===Bs.exports.levels.values.debug?console.debug(e):n===Bs.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(DF({timestamp:new Date().toISOString(),log:e}));let n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new Jw(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let n=this.getLogArray();return n.push(DF({extraMetadata:e})),new Blob(n,{type:"application/json"})}},VZ=Object.defineProperty,HZ=(t,e,n)=>e in t?VZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$Z=(t,e,n)=>HZ(t,typeof e!="symbol"?e+"":e,n),cS=class{constructor(e,n=tv){$Z(this,"baseChunkLogger"),this.baseChunkLogger=new Zw(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}},qZ=Object.defineProperty,zZ=(t,e,n)=>e in t?qZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,GZ=(t,e,n)=>zZ(t,typeof e!="symbol"?e+"":e,n),lS=class{constructor(e,n=tv){GZ(this,"baseChunkLogger"),this.baseChunkLogger=new Zw(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}},KZ=Object.defineProperty,WZ=Object.defineProperties,QZ=Object.getOwnPropertyDescriptors,NF=Object.getOwnPropertySymbols,YZ=Object.prototype.hasOwnProperty,JZ=Object.prototype.propertyIsEnumerable,xF=(t,e,n)=>e in t?KZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xw=(t,e)=>{for(var n in e||(e={}))YZ.call(e,n)&&xF(t,n,e[n]);if(NF)for(var n of NF(e))JZ.call(e,n)&&xF(t,n,e[n]);return t},ev=(t,e)=>WZ(t,QZ(e));function ZZ(t){return ev(Xw({},t),{level:t?.level||PF.level})}function MF(t,e,n=cp){return t[n]=e,t}function kF(t,e=cp){return t[e]||""}function LF(t,e,n=cp){let r=kF(t,n);return r.trim()?`${r}/${e}`:e}function XZ(t,e,n=cp){let r=LF(t,e,n),i=t.child({context:r});return MF(i,r,n)}function FF(t){var e,n;let r=new cS((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bs.exports(ev(Xw({},t.opts),{level:"trace",browser:ev(Xw({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function BF(t){var e;let n=new lS((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Bs.exports(ev(Xw({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function eX(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?FF(t):BF(t)}Mr.MAX_LOG_SIZE_IN_BYTES_DEFAULT=tv,Mr.PINO_CUSTOM_CONTEXT_KEY=cp,Mr.PINO_LOGGER_DEFAULTS=PF,Mr.formatChildLoggerContext=LF,Mr.generateChildLogger=XZ,Mr.generateClientLogger=FF,Mr.generatePlatformLogger=eX,Mr.generateServerLogger=BF,Mr.getDefaultLoggerOptions=ZZ,Mr.getLoggerContext=kF,Mr.pino=kZ,Mr.setLoggerContext=MF});var Ap=vs(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});var tX=(MN(),Pe(PN)),bd=Wl(),_o=hg(),nX=kN(),UF=FN(),rX=BN(),jF=(jN(),Pe(UN)),iX=LN(),sX=(pg(),Pe(fg)),dt=(mg(),Pe(gg)),oX=($N(),Pe(HN)),aX=qN(),cX=nv();function lX(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var wp=lX(rX),gv=":";function WS(t){let[e,n]=t.split(gv);return{namespace:e,reference:n}}function vB(t){let{namespace:e,reference:n}=t;return[e,n].join(gv)}function QS(t){let[e,n,r]=t.split(gv);return{namespace:e,reference:n,address:r}}function bB(t){let{namespace:e,reference:n,address:r}=t;return[e,n,r].join(gv)}function YS(t,e){let n=[];return t.forEach(r=>{let i=e(r);n.includes(i)||n.push(i)}),n}function EB(t){let{address:e}=QS(t);return e}function IB(t){let{namespace:e,reference:n}=QS(t);return vB({namespace:e,reference:n})}function uX(t,e){let{namespace:n,reference:r}=WS(e);return bB({namespace:n,reference:r,address:t})}function dX(t){return YS(t,EB)}function CB(t){return YS(t,IB)}function hX(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(...i.accounts)}),n}function fX(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(...CB(i.accounts))}),n}function pX(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(...mv(r,i))}),n}function mv(t,e){return t.includes(":")?[t]:e.chains||[]}var gX=Object.defineProperty,mX=Object.defineProperties,yX=Object.getOwnPropertyDescriptors,VF=Object.getOwnPropertySymbols,wX=Object.prototype.hasOwnProperty,vX=Object.prototype.propertyIsEnumerable,AS=(t,e,n)=>e in t?gX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,HF=(t,e)=>{for(var n in e||(e={}))wX.call(e,n)&&AS(t,n,e[n]);if(VF)for(var n of VF(e))vX.call(e,n)&&AS(t,n,e[n]);return t},bX=(t,e)=>mX(t,yX(e)),$F=(t,e,n)=>AS(t,typeof e!="symbol"?e+"":e,n),AB="ReactNative",gr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},cv=" ",EX=":",SB="/",JS=2,IX=1e3,_B="js";function ZS(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Va(){return!_o.getDocument()&&!!_o.getNavigator()&&navigator.product===AB}function CX(){return Va()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function AX(){return Va()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Td(){return!ZS()&&!!_o.getNavigator()&&!!_o.getDocument()}function Il(){return Va()?gr.reactNative:ZS()?gr.node:Td()?gr.browser:gr.unknown}function SX(){var t;try{return Va()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function TB(t,e){let n=new URLSearchParams(t);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function _X(t){var e,n;let r=DB();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),bX(HF(HF({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(n=t?.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function DB(){return nX.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function TX(t,e){var n;let r=Il(),i={protocol:t,version:e,env:r};return r==="browser"&&(i.host=((n=_o.getLocation())==null?void 0:n.host)||"unknown"),i}function NB(){if(Il()===gr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:n,Version:r}=global.Platform;return[n,r].join("-")}let t=tX.detect();if(t===null)return"unknown";let e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function xB(){var t;let e=Il();return e===gr.browser?[e,((t=_o.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function RB(t,e,n){let r=NB(),i=xB();return[[t,e].join("-"),[_B,n].join("-"),r,i].join("/")}function DX({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){let l=n.split("?"),u=RB(t,e,r),d={auth:i,ua:u,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},h=TB(l[1]||"",d);return l[0]+"?"+h}function NX(t){let e=(t.match(/^[^:]+(?=:\/\/)/gi)||[])[0],n=typeof e<"u"?t.split("://")[1]:t;return e=e==="wss"?"https":"http",[e,n].join("://")}function xX(t,e,n){if(!t[e]||typeof t[e]!==n)throw new Error(`Missing or invalid "${e}" param`)}function OB(t,e=JS){return PB(t.split(SB),e)}function RX(t){return OB(t).join(cv)}function La(t,e){return t.filter(n=>e.includes(n)).length===t.length}function PB(t,e=JS){return t.slice(Math.max(t.length-e,0))}function OX(t){return Object.fromEntries(t.entries())}function PX(t){return new Map(Object.entries(t))}function MX(t,e){let n={};return Object.keys(t).forEach(r=>{n[r]=e(t[r])}),n}var kX=t=>t;function MB(t){return t.trim().replace(/^\w/,e=>e.toUpperCase())}function LX(t){return t.split(cv).map(e=>MB(e)).join(cv)}function FX(t=bd.FIVE_MINUTES,e){let n=bd.toMiliseconds(t||bd.FIVE_MINUTES),r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{let l=new Error(e);o=Promise.reject(l),c(l)},n),r=a,i=c})}}function BX(t,e,n){return new Promise(async(r,i)=>{let s=setTimeout(()=>i(new Error(n)),e);try{let o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function XS(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function UX(t){return XS("topic",t)}function jX(t){return XS("id",t)}function VX(t){let[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function HX(t,e){return bd.fromMiliseconds((e||Date.now())+bd.toMiliseconds(t))}function $X(t){return Date.now()>=bd.toMiliseconds(t)}function qX(t,e){return`${t}${e?`:${e}`:""}`}function vi(t=[],e=[]){return[...new Set([...t,...e])]}async function zX({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;let i=typeof n=="string"?JSON.parse(n):n,s=i?.href;if(typeof s!="string")return;let o=kB(s,t,e),a=Il();if(a===gr.browser){if(!((r=_o.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}LB(o)}else a===gr.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function kB(t,e,n){let r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){let s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${UB(r,!0)}`}else i=`${i}/wc?${r}`;return i}function LB(t){let e="_self";BB()?e="_top":(FB()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function GX(t,e){let n="";try{if(Td()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function SS(t,e){return t.filter(n=>e.includes(n))}function KX(t,e){if(!t.includes(e))return null;let n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function WX(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function QX(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function FB(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function BB(){try{return window.self!==window.top}catch{return!1}}function UB(t,e=!1){let n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function e_(t){return Buffer.from(t,"base64").toString("utf-8")}function YX(t){return new Promise(e=>setTimeout(e,t))}var _S=class{constructor({limit:e}){$F(this,"limit"),$F(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}},rv=BigInt(2**32-1),qF=BigInt(32);function jB(t,e=!1){return e?{h:Number(t&rv),l:Number(t>>qF&rv)}:{h:Number(t>>qF&rv)|0,l:Number(t&rv)|0}}function VB(t,e=!1){let n=t.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){let{h:o,l:a}=jB(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}var zF=(t,e,n)=>t>>>n,GF=(t,e,n)=>t<<32-n|e>>>n,Oa=(t,e,n)=>t>>>n|e<<32-n,Pa=(t,e,n)=>t<<32-n|e>>>n,dp=(t,e,n)=>t<<64-n|e>>>n-32,hp=(t,e,n)=>t>>>n-32|e<<64-n,JX=(t,e)=>e,ZX=(t,e)=>t,XX=(t,e,n)=>t<<n|e>>>32-n,eee=(t,e,n)=>e<<n|t>>>32-n,tee=(t,e,n)=>e<<n-32|t>>>64-n,nee=(t,e,n)=>t<<n-32|e>>>64-n;function os(t,e,n,r){let i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}var t_=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),n_=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,ree=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),iee=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,see=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),oee=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,yd=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function yv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function To(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function cs(t,...e){if(!yv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function wv(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");To(t.outputLen),To(t.blockLen)}function Ua(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function r_(t,e){cs(t);let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function pp(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function bi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function hS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Us(t,e){return t<<32-e|t>>>e}var HB=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function $B(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}var Io=HB?t=>t:t=>$B(t);function aee(t){for(let e=0;e<t.length;e++)t[e]=$B(t[e]);return t}var Ma=HB?t=>t:aee,qB=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",cee=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ed(t){if(cs(t),qB)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=cee[t[n]];return e}var Eo={_0:48,_9:57,A:65,F:70,a:97,f:102};function KF(t){if(t>=Eo._0&&t<=Eo._9)return t-Eo._0;if(t>=Eo.A&&t<=Eo.F)return t-(Eo.A-10);if(t>=Eo.a&&t<=Eo.f)return t-(Eo.a-10)}function lv(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(qB)return Uint8Array.fromHex(t);let e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){let o=KF(t.charCodeAt(s)),a=KF(t.charCodeAt(s+1));if(o===void 0||a===void 0){let c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function zB(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function as(t){return typeof t=="string"&&(t=zB(t)),cs(t),t}function ka(...t){let e=0;for(let r=0;r<t.length;r++){let i=t[r];cs(i),e+=i.length}let n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){let s=t[r];n.set(s,i),i+=s.length}return n}var Ad=class{};function vp(t){let e=r=>t().update(as(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function lee(t){let e=(r,i)=>t(i).update(as(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function Cl(t=32){if(yd&&typeof yd.getRandomValues=="function")return yd.getRandomValues(new Uint8Array(t));if(yd&&typeof yd.randomBytes=="function")return Uint8Array.from(yd.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var uee=BigInt(0),lp=BigInt(1),dee=BigInt(2),hee=BigInt(7),fee=BigInt(256),pee=BigInt(113),GB=[],KB=[],WB=[];for(let t=0,e=lp,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],GB.push(2*(5*r+n)),KB.push((t+1)*(t+2)/2%64);let i=uee;for(let s=0;s<7;s++)e=(e<<lp^(e>>hee)*pee)%fee,e&dee&&(i^=lp<<(lp<<BigInt(s))-lp);WB.push(i)}var QB=VB(WB,!0),gee=QB[0],mee=QB[1],WF=(t,e,n)=>n>32?tee(t,e,n):XX(t,e,n),QF=(t,e,n)=>n>32?nee(t,e,n):eee(t,e,n);function yee(t,e=24){let n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],d=WF(l,u,1)^n[a],h=QF(l,u,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=d,t[o+f+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){let a=KB[o],c=WF(i,s,a),l=QF(i,s,a),u=GB[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=gee[r],t[1]^=mee[r]}bi(n)}var TS=class t extends Ad{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,To(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=pp(this.state)}clone(){return this._cloneInto()}keccak(){Ma(this.state32),yee(this.state32,this.rounds),Ma(this.state32),this.posOut=0,this.pos=0}update(e){Ua(this),e=as(e),cs(e);let{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Ua(this,!1),cs(e),this.finish();let n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();let o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return To(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(r_(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,bi(this.state)}_cloneInto(e){let{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new t(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}},wee=(t,e,n)=>vp(()=>new TS(e,t,n)),vee=wee(1,136,256/8);function bee(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function Eee(t,e,n){return t&e^~t&n}function Iee(t,e,n){return t&e^t&n^e&n}var uv=class extends Ad{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=hS(this.buffer)}update(e){Ua(this),e=as(e),cs(e);let{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){let a=Math.min(i-this.pos,s-o);if(a===i){let c=hS(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ua(this),r_(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:i,isLE:s}=this,{pos:o}=this;n[o++]=128,bi(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;bee(r,i-8,BigInt(this.length*8),s),this.process(r,0);let a=hS(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}},_a=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wn=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Qn=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Cee=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ta=new Uint32Array(64),DS=class extends uv{constructor(e=32){super(64,e,8,!1),this.A=_a[0]|0,this.B=_a[1]|0,this.C=_a[2]|0,this.D=_a[3]|0,this.E=_a[4]|0,this.F=_a[5]|0,this.G=_a[6]|0,this.H=_a[7]|0}get(){let{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let d=0;d<16;d++,n+=4)Ta[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){let h=Ta[d-15],f=Ta[d-2],p=Us(h,7)^Us(h,18)^h>>>3,g=Us(f,17)^Us(f,19)^f>>>10;Ta[d]=g+Ta[d-7]+p+Ta[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){let h=Us(a,6)^Us(a,11)^Us(a,25),f=u+h+Eee(a,c,l)+Cee[d]+Ta[d]|0,p=(Us(r,2)^Us(r,13)^Us(r,22))+Iee(r,i,s)|0;u=l,l=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){bi(Ta)}destroy(){this.set(0,0,0,0,0,0,0,0),bi(this.buffer)}},YB=VB(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Aee=YB[0],See=YB[1],Da=new Uint32Array(80),Na=new Uint32Array(80),gp=class extends uv{constructor(e=64){super(128,e,16,!1),this.Ah=Qn[0]|0,this.Al=Qn[1]|0,this.Bh=Qn[2]|0,this.Bl=Qn[3]|0,this.Ch=Qn[4]|0,this.Cl=Qn[5]|0,this.Dh=Qn[6]|0,this.Dl=Qn[7]|0,this.Eh=Qn[8]|0,this.El=Qn[9]|0,this.Fh=Qn[10]|0,this.Fl=Qn[11]|0,this.Gh=Qn[12]|0,this.Gl=Qn[13]|0,this.Hh=Qn[14]|0,this.Hl=Qn[15]|0}get(){let{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:f,Gl:p,Hh:g,Hl:m}=this;return[e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m]}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,n){for(let I=0;I<16;I++,n+=4)Da[I]=e.getUint32(n),Na[I]=e.getUint32(n+=4);for(let I=16;I<80;I++){let L=Da[I-15]|0,k=Na[I-15]|0,N=Oa(L,k,1)^Oa(L,k,8)^zF(L,k,7),B=Pa(L,k,1)^Pa(L,k,8)^GF(L,k,7),U=Da[I-2]|0,T=Na[I-2]|0,$=Oa(U,T,19)^dp(U,T,61)^zF(U,T,6),K=Pa(U,T,19)^hp(U,T,61)^GF(U,T,6),M=ree(B,K,Na[I-7],Na[I-16]),v=iee(M,N,$,Da[I-7],Da[I-16]);Da[I]=v|0,Na[I]=M|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:f,Fl:p,Gh:g,Gl:m,Hh:y,Hl:E}=this;for(let I=0;I<80;I++){let L=Oa(d,h,14)^Oa(d,h,18)^dp(d,h,41),k=Pa(d,h,14)^Pa(d,h,18)^hp(d,h,41),N=d&f^~d&g,B=h&p^~h&m,U=see(E,k,B,See[I],Na[I]),T=oee(U,y,L,N,Aee[I],Da[I]),$=U|0,K=Oa(r,i,28)^dp(r,i,34)^dp(r,i,39),M=Pa(r,i,28)^hp(r,i,34)^hp(r,i,39),v=r&s^r&a^s&a,b=i&o^i&c^o&c;y=g|0,E=m|0,g=f|0,m=p|0,f=d|0,p=h|0,{h:d,l:h}=os(l|0,u|0,T|0,$|0),l=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;let w=t_($,M,b);r=n_(w,T,K,v),i=w|0}({h:r,l:i}=os(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=os(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=os(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=os(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=os(this.Eh|0,this.El|0,d|0,h|0),{h:f,l:p}=os(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:m}=os(this.Gh|0,this.Gl|0,g|0,m|0),{h:y,l:E}=os(this.Hh|0,this.Hl|0,y|0,E|0),this.set(r,i,s,o,a,c,l,u,d,h,f,p,g,m,y,E)}roundClean(){bi(Da,Na)}destroy(){bi(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},NS=class extends gp{constructor(){super(48),this.Ah=Wn[0]|0,this.Al=Wn[1]|0,this.Bh=Wn[2]|0,this.Bl=Wn[3]|0,this.Ch=Wn[4]|0,this.Cl=Wn[5]|0,this.Dh=Wn[6]|0,this.Dl=Wn[7]|0,this.Eh=Wn[8]|0,this.El=Wn[9]|0,this.Fh=Wn[10]|0,this.Fl=Wn[11]|0,this.Gh=Wn[12]|0,this.Gl=Wn[13]|0,this.Hh=Wn[14]|0,this.Hl=Wn[15]|0}},Yn=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),xS=class extends gp{constructor(){super(32),this.Ah=Yn[0]|0,this.Al=Yn[1]|0,this.Bh=Yn[2]|0,this.Bl=Yn[3]|0,this.Ch=Yn[4]|0,this.Cl=Yn[5]|0,this.Dh=Yn[6]|0,this.Dl=Yn[7]|0,this.Eh=Yn[8]|0,this.El=Yn[9]|0,this.Fh=Yn[10]|0,this.Fl=Yn[11]|0,this.Gh=Yn[12]|0,this.Gl=Yn[13]|0,this.Hh=Yn[14]|0,this.Hl=Yn[15]|0}},vv=vp(()=>new DS),_ee=vp(()=>new gp),Tee=vp(()=>new NS),Dee=vp(()=>new xS),Nee=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),hn=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),le=new Uint32Array(32);function xa(t,e,n,r,i,s){let o=i[s],a=i[s+1],c=le[2*t],l=le[2*t+1],u=le[2*e],d=le[2*e+1],h=le[2*n],f=le[2*n+1],p=le[2*r],g=le[2*r+1],m=t_(c,u,o);l=n_(m,l,d,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:JX(g,p),Dl:ZX(g)},{h:f,l:h}=os(f,h,g,p),{Bh:d,Bl:u}={Bh:d^f,Bl:u^h},{Bh:d,Bl:u}={Bh:Oa(d,u,24),Bl:Pa(d,u,24)},le[2*t]=c,le[2*t+1]=l,le[2*e]=u,le[2*e+1]=d,le[2*n]=h,le[2*n+1]=f,le[2*r]=p,le[2*r+1]=g}function Ra(t,e,n,r,i,s){let o=i[s],a=i[s+1],c=le[2*t],l=le[2*t+1],u=le[2*e],d=le[2*e+1],h=le[2*n],f=le[2*n+1],p=le[2*r],g=le[2*r+1],m=t_(c,u,o);l=n_(m,l,d,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:Oa(g,p,16),Dl:Pa(g,p,16)},{h:f,l:h}=os(f,h,g,p),{Bh:d,Bl:u}={Bh:d^f,Bl:u^h},{Bh:d,Bl:u}={Bh:dp(d,u,63),Bl:hp(d,u,63)},le[2*t]=c,le[2*t+1]=l,le[2*e]=u,le[2*e+1]=d,le[2*n]=h,le[2*n+1]=f,le[2*r]=p,le[2*r+1]=g}function xee(t,e={},n,r,i){if(To(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");let{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}var RS=class extends Ad{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,To(e),To(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=pp(this.buffer)}update(e){Ua(this),e=as(e),cs(e);let{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(Ma(i),this.compress(i,0,!1),Ma(i),this.pos=0);let l=Math.min(n-this.pos,s-c),u=o+c;if(l===n&&!(u%4)&&c+l<s){let d=new Uint32Array(a,u,Math.floor((s-c)/4));Ma(d);for(let h=0;c+n<s;h+=i.length,c+=n)this.length+=n,this.compress(d,h,!1);Ma(d);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Ua(this),r_(e,this);let{pos:n,buffer32:r}=this;this.finished=!0,bi(this.buffer.subarray(n)),Ma(r),this.compress(r,0,!0),Ma(r);let i=pp(e);this.get().forEach((s,o)=>i[o]=Io(s))}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){let{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},OS=class extends RS{constructor(e={}){let n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=hn[0]|0,this.v0h=hn[1]|0,this.v1l=hn[2]|0,this.v1h=hn[3]|0,this.v2l=hn[4]|0,this.v2h=hn[5]|0,this.v3l=hn[6]|0,this.v3h=hn[7]|0,this.v4l=hn[8]|0,this.v4h=hn[9]|0,this.v5l=hn[10]|0,this.v5h=hn[11]|0,this.v6l=hn[12]|0,this.v6h=hn[13]|0,this.v7l=hn[14]|0,this.v7h=hn[15]|0,xee(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=as(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=as(s);let a=pp(s);this.v4l^=Io(a[0]),this.v4h^=Io(a[1]),this.v5l^=Io(a[2]),this.v5h^=Io(a[3])}if(i!==void 0){i=as(i);let a=pp(i);this.v6l^=Io(a[0]),this.v6h^=Io(a[1]),this.v7l^=Io(a[2]),this.v7h^=Io(a[3])}if(r!==void 0){let a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:d,v5h:h,v6l:f,v6h:p,v7l:g,v7h:m}=this;return[e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m]}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=d|0,this.v5h=h|0,this.v6l=f|0,this.v6h=p|0,this.v7l=g|0,this.v7h=m|0}compress(e,n,r){this.get().forEach((c,l)=>le[l]=c),le.set(hn,16);let{h:i,l:s}=jB(BigInt(this.length));le[24]=hn[8]^s,le[25]=hn[9]^i,r&&(le[28]=~le[28],le[29]=~le[29]);let o=0,a=Nee;for(let c=0;c<12;c++)xa(0,4,8,12,e,n+2*a[o++]),Ra(0,4,8,12,e,n+2*a[o++]),xa(1,5,9,13,e,n+2*a[o++]),Ra(1,5,9,13,e,n+2*a[o++]),xa(2,6,10,14,e,n+2*a[o++]),Ra(2,6,10,14,e,n+2*a[o++]),xa(3,7,11,15,e,n+2*a[o++]),Ra(3,7,11,15,e,n+2*a[o++]),xa(0,5,10,15,e,n+2*a[o++]),Ra(0,5,10,15,e,n+2*a[o++]),xa(1,6,11,12,e,n+2*a[o++]),Ra(1,6,11,12,e,n+2*a[o++]),xa(2,7,8,13,e,n+2*a[o++]),Ra(2,7,8,13,e,n+2*a[o++]),xa(3,4,9,14,e,n+2*a[o++]),Ra(3,4,9,14,e,n+2*a[o++]);this.v0l^=le[0]^le[16],this.v0h^=le[1]^le[17],this.v1l^=le[2]^le[18],this.v1h^=le[3]^le[19],this.v2l^=le[4]^le[20],this.v2h^=le[5]^le[21],this.v3l^=le[6]^le[22],this.v3h^=le[7]^le[23],this.v4l^=le[8]^le[24],this.v4h^=le[9]^le[25],this.v5l^=le[10]^le[26],this.v5h^=le[11]^le[27],this.v6l^=le[12]^le[28],this.v6h^=le[13]^le[29],this.v7l^=le[14]^le[30],this.v7h^=le[15]^le[31],bi(le)}destroy(){this.destroyed=!0,bi(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Ree=lee(t=>new OS(t)),Oee="https://rpc.walletconnect.org/v1";function i_(t){let e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(vee(n)).toString("hex")}async function JB(t,e,n,r,i,s){switch(n.t){case"eip191":return await ZB(t,e,n.s);case"eip1271":return await XB(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function ZB(t,e,n){let r=UF.Signature.fromHex(n);return UF.Secp256k1.recoverAddress({payload:i_(e),signature:r}).toLowerCase()===t.toLowerCase()}async function XB(t,e,n,r,i,s){let o=WS(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=n.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),d=(e.startsWith("0x")?e:i_(e)).substring(2),h=a+d+c+u+l,f=await fetch(`${s||Oee}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Pee(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Pee(){return Date.now()+Math.floor(Math.random()*1e3)}function Mee(t){let e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);let r=n[0];if(r===0)throw new Error("No signatures found");let i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");let s=Buffer.from(t,"base64").slice(1,65);return wp.default.encode(s)}function kee(t){let e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);let i=Ree(r,{dkLen:32});return wp.default.encode(i)}function Lee(t){let e=new Uint8Array(vv(eU(t)));return wp.default.encode(e)}function eU(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Fee(t){let e=Buffer.from(t,"base64"),n=jF.decode(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");let r=jF.encode(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=Dee(s);return iX.base32.encode(o).replace(/=+$/,"")}function fS(t){let e=[],n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function Bee(t){let e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(fS(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(fS(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(fS(r.length)),i.push(r);let s=Buffer.concat(i),o=vv(s);return Buffer.from(o).toString("hex").toUpperCase()}function Uee(t){var e,n;let r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);let i=(n=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}var jee=Object.defineProperty,Vee=Object.defineProperties,Hee=Object.getOwnPropertyDescriptors,YF=Object.getOwnPropertySymbols,$ee=Object.prototype.hasOwnProperty,qee=Object.prototype.propertyIsEnumerable,JF=(t,e,n)=>e in t?jee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,s_=(t,e)=>{for(var n in e||(e={}))$ee.call(e,n)&&JF(t,n,e[n]);if(YF)for(var n of YF(e))qee.call(e,n)&&JF(t,n,e[n]);return t},tU=(t,e)=>Vee(t,Hee(e)),nU="did:pkh:",zee={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},Gee=t=>t?zee[t]||t:"",bp=t=>t?.split(":"),rU=t=>{let e=t&&bp(t);if(e)return t.includes(nU)?e[3]:e[1]},iU=t=>{let e=t&&bp(t);if(e)return t.includes(nU)?e[2]:e[0]},sU=t=>{let e=t&&bp(t);if(e)return e[2]+":"+e[3]},o_=t=>{let e=t&&bp(t);if(e)return e.pop()};async function Kee(t){let{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=oU(i,i.iss),o=o_(i.iss);return await JB(o,s,r,sU(i.iss),n)}var oU=(t,e)=>{let n=iU(e);if(!n)throw new Error("Invalid issuer: "+e);let r=`${t.domain} wants you to sign in with your ${Gee(n)} account:`,i=o_(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0,o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${rU(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,d=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,g=Ev(t.resources);if(g){let m=ja(g);s=l_(s,m)}return[r,i,"",s,"",o,a,c,l,u,d,h,f,p].filter(m=>m!=null).join(`
`)};function Wee(t,e,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:t.domain,aud:t.aud,version:t.version,nonce:t.nonce,iat:t.iat,statement:t.statement,requestId:t.requestId,resources:t.resources,nbf:t.nbf,exp:t.exp},s:e}}function Qee(t){var e;let{authPayload:n,chains:r,methods:i}=t,s=n.statement||"";if(!(r!=null&&r.length))return n;let o=n.chains,a=SS(o,r);if(!(a!=null&&a.length))throw new Error("No supported chains");let c=aU(n.resources);if(!c)return n;js(c);let l=cU(c,"eip155"),u=n?.resources||[];if(l!=null&&l.length){let d=lU(l),h=SS(d,i);if(!(h!=null&&h.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(d)}, supported: ${JSON.stringify(i)}`);let f=a_("request",h,{chains:a}),p=fU(c,"eip155",f);u=((e=n?.resources)==null?void 0:e.slice(0,-1))||[],u.push(bv(p))}return tU(s_({},n),{statement:gU(s,Ev(u)),chains:a,resources:n!=null&&n.resources||u.length>0?u:void 0})}function aU(t){let e=Ev(t);if(e&&c_(e))return ja(e)}function Yee(t,e){var n;return(n=t?.att)==null?void 0:n.hasOwnProperty(e)}function cU(t,e){var n,r;return(n=t?.att)!=null&&n[e]?Object.keys((r=t?.att)==null?void 0:r[e]):[]}function Jee(t){return t?.map(e=>Object.keys(e))||[]}function lU(t){return t?.map(e=>{var n;return(n=e.split("/"))==null?void 0:n[1]})||[]}function uU(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function dU(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function js(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");let e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{let r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{let s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function hU(t,e,n,r={}){return n?.sort((i,s)=>i.localeCompare(s)),{att:{[t]:a_(e,n,r)}}}function fU(t,e,n){var r;t.att[e]=s_({},n);let i=(r=Object.keys(t.att))==null?void 0:r.sort((o,a)=>o.localeCompare(a)),s={att:{}};return i.reduce((o,a)=>(o.att[a]=t.att[a],o),s)}function a_(t,e,n={}){e=e?.sort((i,s)=>i.localeCompare(s));let r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function bv(t){return js(t),`urn:recap:${uU(t).replace(/=/g,"")}`}function ja(t){let e=dU(t.replace("urn:recap:",""));return js(e),e}function Zee(t,e,n){let r=hU(t,e,n);return bv(r)}function c_(t){return t&&t.includes("urn:recap:")}function Xee(t,e){let n=ja(t),r=ja(e),i=pU(n,r);return bv(i)}function pU(t,e){js(t),js(e);let n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=tU(s_({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function l_(t="",e){js(e);let n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;let r=[],i=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(d=>({ability:d.split("/")[0],action:d.split("/")[1]}));c.sort((d,h)=>d.action.localeCompare(h.action));let l={};c.forEach(d=>{l[d.ability]||(l[d.ability]=[]),l[d.ability].push(d.action)});let u=Object.keys(l).map(d=>(i++,`(${i}) '${d}': '${l[d].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});let s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function ete(t){var e;let n=ja(t);js(n);let r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function tte(t){let e=ja(t);js(e);let n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i?.[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function gU(t,e){if(!e)return t;let n=ja(e);return js(n),l_(t,n)}function Ev(t){if(!t)return;let e=t?.[t.length-1];return c_(e)?e:void 0}function mU(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function PS(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function pS(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function kr(t,...e){if(!mU(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ZF(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function nte(t,e){kr(t);let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Fa(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Sd(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function rte(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var ite=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ste(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function MS(t){if(typeof t=="string")t=ste(t);else if(mU(t))t=kS(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function ote(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function ate(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var cte=(t,e)=>{function n(r,...i){if(kr(r),!ite)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?kr(l):kr(l,t.nonceLength)}let s=t.tagLength;s&&i[1]!==void 0&&kr(i[1]);let o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");kr(u)}},c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,kr(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(kr(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(n,t),n};function XF(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!ute(e))throw new Error("invalid output, must be aligned");return e}function eB(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function lte(t,e,n){PS(n);let r=new Uint8Array(16),i=rte(r);return eB(i,0,BigInt(e),n),eB(i,8,BigInt(t),n),r}function ute(t){return t.byteOffset%4===0}function kS(t){return Uint8Array.from(t)}var yU=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),dte=yU("expand 16-byte k"),hte=yU("expand 32-byte k"),fte=Fa(dte),pte=Fa(hte);function tt(t,e){return t<<e|t>>>32-e}function LS(t){return t.byteOffset%4===0}var iv=64,gte=16,wU=2**32-1,tB=new Uint32Array;function mte(t,e,n,r,i,s,o,a){let c=i.length,l=new Uint8Array(iv),u=Fa(l),d=LS(i)&&LS(s),h=d?Fa(i):tB,f=d?Fa(s):tB;for(let p=0;p<c;o++){if(t(e,n,r,u,o,a),o>=wU)throw new Error("arx: counter overflow");let g=Math.min(iv,c-p);if(d&&g===iv){let m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,E;y<gte;y++)E=m+y,f[E]=h[E]^u[y];p+=iv;continue}for(let m=0,y;m<g;m++)y=p+m,s[y]=i[y]^l[m];p+=g}}function yte(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=ote({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return pS(i),pS(o),PS(s),PS(n),(a,c,l,u,d=0)=>{kr(a),kr(c),kr(l);let h=l.length;if(u===void 0&&(u=new Uint8Array(h)),kr(u),pS(d),d<0||d>=wU)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);let f=[],p=a.length,g,m;if(p===32)f.push(g=kS(a)),m=pte;else if(p===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),m=fte,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);LS(c)||f.push(c=kS(c));let y=Fa(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,Fa(c.subarray(0,16)),y),c=c.subarray(16)}let E=16-i;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){let L=new Uint8Array(12);L.set(c,s?0:12-c.length),c=L,f.push(c)}let I=Fa(c);return mte(t,m,y,I,l,u,d,o),Sd(...f),u}}var On=(t,e)=>t[e++]&255|(t[e++]&255)<<8,FS=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=MS(e),kr(e,32);let n=On(e,0),r=On(e,2),i=On(e,4),s=On(e,6),o=On(e,8),a=On(e,10),c=On(e,12),l=On(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=On(e,16+2*u)}process(e,n,r=!1){let i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],d=o[4],h=o[5],f=o[6],p=o[7],g=o[8],m=o[9],y=On(e,n+0),E=On(e,n+2),I=On(e,n+4),L=On(e,n+6),k=On(e,n+8),N=On(e,n+10),B=On(e,n+12),U=On(e,n+14),T=s[0]+(y&8191),$=s[1]+((y>>>13|E<<3)&8191),K=s[2]+((E>>>10|I<<6)&8191),M=s[3]+((I>>>7|L<<9)&8191),v=s[4]+((L>>>4|k<<12)&8191),b=s[5]+(k>>>1&8191),w=s[6]+((k>>>14|N<<2)&8191),C=s[7]+((N>>>11|B<<5)&8191),x=s[8]+((B>>>8|U<<8)&8191),F=s[9]+(U>>>5|i),A=0,P=A+T*a+$*(5*m)+K*(5*g)+M*(5*p)+v*(5*f);A=P>>>13,P&=8191,P+=b*(5*h)+w*(5*d)+C*(5*u)+x*(5*l)+F*(5*c),A+=P>>>13,P&=8191;let V=A+T*c+$*a+K*(5*m)+M*(5*g)+v*(5*p);A=V>>>13,V&=8191,V+=b*(5*f)+w*(5*h)+C*(5*d)+x*(5*u)+F*(5*l),A+=V>>>13,V&=8191;let j=A+T*l+$*c+K*a+M*(5*m)+v*(5*g);A=j>>>13,j&=8191,j+=b*(5*p)+w*(5*f)+C*(5*h)+x*(5*d)+F*(5*u),A+=j>>>13,j&=8191;let oe=A+T*u+$*l+K*c+M*a+v*(5*m);A=oe>>>13,oe&=8191,oe+=b*(5*g)+w*(5*p)+C*(5*f)+x*(5*h)+F*(5*d),A+=oe>>>13,oe&=8191;let X=A+T*d+$*u+K*l+M*c+v*a;A=X>>>13,X&=8191,X+=b*(5*m)+w*(5*g)+C*(5*p)+x*(5*f)+F*(5*h),A+=X>>>13,X&=8191;let Q=A+T*h+$*d+K*u+M*l+v*c;A=Q>>>13,Q&=8191,Q+=b*a+w*(5*m)+C*(5*g)+x*(5*p)+F*(5*f),A+=Q>>>13,Q&=8191;let ae=A+T*f+$*h+K*d+M*u+v*l;A=ae>>>13,ae&=8191,ae+=b*c+w*a+C*(5*m)+x*(5*g)+F*(5*p),A+=ae>>>13,ae&=8191;let ee=A+T*p+$*f+K*h+M*d+v*u;A=ee>>>13,ee&=8191,ee+=b*l+w*c+C*a+x*(5*m)+F*(5*g),A+=ee>>>13,ee&=8191;let we=A+T*g+$*p+K*f+M*h+v*d;A=we>>>13,we&=8191,we+=b*u+w*l+C*c+x*a+F*(5*m),A+=we>>>13,we&=8191;let ne=A+T*m+$*g+K*p+M*f+v*h;A=ne>>>13,ne&=8191,ne+=b*d+w*u+C*l+x*c+F*a,A+=ne>>>13,ne&=8191,A=(A<<2)+A|0,A=A+P|0,P=A&8191,A=A>>>13,V+=A,s[0]=P,s[1]=V,s[2]=j,s[3]=oe,s[4]=X,s[5]=Q,s[6]=ae,s[7]=ee,s[8]=we,s[9]=ne}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;Sd(r)}update(e){ZF(this),e=MS(e),kr(e);let{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Sd(this.h,this.r,this.buffer,this.pad)}digestInto(e){ZF(this),nte(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function wte(t){let e=(r,i)=>t(i).update(MS(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var vte=wte(t=>new FS(t));function bte(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],d=e[1],h=e[2],f=e[3],p=e[4],g=e[5],m=e[6],y=e[7],E=i,I=n[0],L=n[1],k=n[2],N=o,B=a,U=c,T=l,$=u,K=d,M=h,v=f,b=p,w=g,C=m,x=y,F=E,A=I,P=L,V=k;for(let oe=0;oe<s;oe+=2)N=N+$|0,F=tt(F^N,16),b=b+F|0,$=tt($^b,12),N=N+$|0,F=tt(F^N,8),b=b+F|0,$=tt($^b,7),B=B+K|0,A=tt(A^B,16),w=w+A|0,K=tt(K^w,12),B=B+K|0,A=tt(A^B,8),w=w+A|0,K=tt(K^w,7),U=U+M|0,P=tt(P^U,16),C=C+P|0,M=tt(M^C,12),U=U+M|0,P=tt(P^U,8),C=C+P|0,M=tt(M^C,7),T=T+v|0,V=tt(V^T,16),x=x+V|0,v=tt(v^x,12),T=T+v|0,V=tt(V^T,8),x=x+V|0,v=tt(v^x,7),N=N+K|0,V=tt(V^N,16),C=C+V|0,K=tt(K^C,12),N=N+K|0,V=tt(V^N,8),C=C+V|0,K=tt(K^C,7),B=B+M|0,F=tt(F^B,16),x=x+F|0,M=tt(M^x,12),B=B+M|0,F=tt(F^B,8),x=x+F|0,M=tt(M^x,7),U=U+v|0,A=tt(A^U,16),b=b+A|0,v=tt(v^b,12),U=U+v|0,A=tt(A^U,8),b=b+A|0,v=tt(v^b,7),T=T+$|0,P=tt(P^T,16),w=w+P|0,$=tt($^w,12),T=T+$|0,P=tt(P^T,8),w=w+P|0,$=tt($^w,7);let j=0;r[j++]=o+N|0,r[j++]=a+B|0,r[j++]=c+U|0,r[j++]=l+T|0,r[j++]=u+$|0,r[j++]=d+K|0,r[j++]=h+M|0,r[j++]=f+v|0,r[j++]=p+b|0,r[j++]=g+w|0,r[j++]=m+C|0,r[j++]=y+x|0,r[j++]=E+F|0,r[j++]=I+A|0,r[j++]=L+P|0,r[j++]=k+V|0}var Ete=yte(bte,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Ite=new Uint8Array(16),nB=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(Ite.subarray(n))},Cte=new Uint8Array(32);function rB(t,e,n,r,i){let s=t(e,n,Cte),o=vte.create(s);i&&nB(o,i),nB(o,r);let a=lte(r.length,i?i.length:0,!0);o.update(a);let c=o.digest();return Sd(s,a),c}var Ate=t=>(e,n,r)=>({encrypt(i,s){let o=i.length;s=XF(o+16,s,!1),s.set(i);let a=s.subarray(0,-16);t(e,n,a,a,1);let c=rB(t,e,n,a,r);return s.set(c,o),Sd(c),s},decrypt(i,s){s=XF(i.length-16,s,!1);let o=i.subarray(0,-16),a=i.subarray(-16),c=rB(t,e,n,o,r);if(!ate(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),Sd(c),s}}),vU=cte({blockSize:64,nonceLength:12,tagLength:16},Ate(Ete)),dv=class extends Ad{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,wv(e);let r=as(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),bi(s)}update(e){return Ua(this),this.iHash.update(e),this}digestInto(e){Ua(this),cs(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Iv=(t,e,n)=>new dv(t,e).update(n).digest();Iv.create=(t,e)=>new dv(t,e);function Ste(t,e,n){return wv(t),n===void 0&&(n=new Uint8Array(t.outputLen)),Iv(t,as(n),as(e))}var gS=Uint8Array.from([0]),iB=Uint8Array.of();function _te(t,e,n,r=32){wv(t),To(r);let i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(r/i);n===void 0&&(n=iB);let o=new Uint8Array(s*i),a=Iv.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)gS[0]=u+1,c.update(u===0?iB:l).update(n).update(gS).digestInto(l),o.set(l,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),bi(l,gS),o.slice(0,r)}var Tte=(t,e,n,r,i)=>_te(t,Ste(t,e,n),r,i),Cv=vv,u_=BigInt(0),BS=BigInt(1);function hv(t,e=""){if(typeof t!="boolean"){let n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function yl(t,e,n=""){let r=yv(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){let o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function sv(t){let e=t.toString(16);return e.length&1?"0"+e:e}function bU(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?u_:BigInt("0x"+t)}function Av(t){return bU(Ed(t))}function fv(t){return cs(t),bU(Ed(Uint8Array.from(t).reverse()))}function d_(t,e){return lv(t.toString(16).padStart(e*2,"0"))}function h_(t,e){return d_(t,e).reverse()}function Jn(t,e,n){let r;if(typeof e=="string")try{r=lv(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(yv(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}var mS=t=>typeof t=="bigint"&&u_<=t;function Dte(t,e,n){return mS(t)&&mS(e)&&mS(n)&&e<=t&&t<n}function US(t,e,n,r){if(!Dte(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function EU(t){let e;for(e=0;t>u_;t>>=BS,e+=1);return e}var Ep=t=>(BS<<BigInt(t))-BS;function Nte(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=h=>new Uint8Array(h),i=h=>Uint8Array.of(h),s=r(t),o=r(t),a=0,c=()=>{s.fill(1),o.fill(0),a=0},l=(...h)=>n(o,s,...h),u=(h=r(0))=>{o=l(i(0),h),s=l(),h.length!==0&&(o=l(i(1),h),s=l())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<e;){s=l();let p=s.slice();f.push(p),h+=s.length}return ka(...f)};return(h,f)=>{c(),u(h);let p;for(;!(p=f(d()));)u();return c(),p}}function Sv(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){let a=t[i];if(o&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function sB(t){let e=new WeakMap;return(n,...r)=>{let i=e.get(n);if(i!==void 0)return i;let s=t(n,...r);return e.set(n,s),s}}var Lr=BigInt(0),mr=BigInt(1),wl=BigInt(2),IU=BigInt(3),CU=BigInt(4),AU=BigInt(5),xte=BigInt(7),SU=BigInt(8),Rte=BigInt(9),_U=BigInt(16);function ei(t,e){let n=t%e;return n>=Lr?n:e+n}function ss(t,e,n){let r=t;for(;e-- >Lr;)r*=r,r%=n;return r}function oB(t,e){if(t===Lr)throw new Error("invert: expected non-zero number");if(e<=Lr)throw new Error("invert: expected positive modulus, got "+e);let n=ei(t,e),r=e,i=Lr,s=mr;for(;n!==Lr;){let o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==mr)throw new Error("invert: does not exist");return ei(i,e)}function f_(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function TU(t,e){let n=(t.ORDER+mr)/CU,r=t.pow(e,n);return f_(t,r,e),r}function Ote(t,e){let n=(t.ORDER-AU)/SU,r=t.mul(e,wl),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,wl),i),a=t.mul(s,t.sub(o,t.ONE));return f_(t,a,e),a}function Pte(t){let e=Ha(t),n=DU(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+xte)/_U;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,r),d=a.mul(l,i),h=a.mul(l,s),f=a.eql(a.sqr(u),c),p=a.eql(a.sqr(d),c);l=a.cmov(l,u,f),u=a.cmov(h,d,p);let g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return f_(a,m,c),m}}function DU(t){if(t<IU)throw new Error("sqrt is not defined for small field");let e=t-mr,n=0;for(;e%wl===Lr;)e/=wl,n++;let r=wl,i=Ha(t);for(;aB(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return TU;let s=i.pow(r,e),o=(e+mr)/wl;return function(a,c){if(a.is0(c))return c;if(aB(a,c)!==1)throw new Error("Cannot find square root");let l=n,u=a.mul(a.ONE,s),d=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(d,a.ONE);){if(a.is0(d))return a.ZERO;let f=1,p=a.sqr(d);for(;!a.eql(p,a.ONE);)if(f++,p=a.sqr(p),f===l)throw new Error("Cannot find square root");let g=mr<<BigInt(l-f-1),m=a.pow(u,g);l=f,u=a.sqr(m),d=a.mul(d,u),h=a.mul(h,m)}return h}}function Mte(t){return t%CU===IU?TU:t%SU===AU?Ote:t%_U===Rte?Pte(t):DU(t)}var kte=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Lte(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=kte.reduce((r,i)=>(r[i]="function",r),e);return Sv(t,n),t}function Fte(t,e,n){if(n<Lr)throw new Error("invalid exponent, negatives unsupported");if(n===Lr)return t.ONE;if(n===mr)return e;let r=t.ONE,i=e;for(;n>Lr;)n&mr&&(r=t.mul(r,i)),i=t.sqr(i),n>>=mr;return r}function NU(t,e,n=!1){let r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function aB(t,e){let n=(t.ORDER-mr)/wl,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function xU(t,e){e!==void 0&&To(e);let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Ha(t,e,n=!1,r={}){if(t<=Lr)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");let h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);let{nBitLength:c,nByteLength:l}=xU(t,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u,d=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:l,MASK:Ep(c),ZERO:Lr,ONE:mr,allowedLengths:a,create:h=>ei(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Lr<=h&&h<t},is0:h=>h===Lr,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&mr)===mr,neg:h=>ei(-h,t),eql:(h,f)=>h===f,sqr:h=>ei(h*h,t),add:(h,f)=>ei(h+f,t),sub:(h,f)=>ei(h-f,t),mul:(h,f)=>ei(h*f,t),pow:(h,f)=>Fte(d,h,f),div:(h,f)=>ei(h*oB(f,t),t),sqrN:h=>h*h,addN:(h,f)=>h+f,subN:(h,f)=>h-f,mulN:(h,f)=>h*f,inv:h=>oB(h,t),sqrt:s||(h=>(u||(u=Mte(t)),u(d,h))),toBytes:h=>n?h_(h,l):d_(h,l),fromBytes:(h,f=!0)=>{if(a){if(!a.includes(h.length)||h.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);let g=new Uint8Array(l);g.set(h,n?0:g.length-h.length),h=g}if(h.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+h.length);let p=n?fv(h):Av(h);if(o&&(p=ei(p,t)),!f&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>NU(d,h),cmov:(h,f,p)=>p?f:h});return Object.freeze(d)}function RU(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function OU(t){let e=RU(t);return e+Math.ceil(e/2)}function Bte(t,e,n=!1){let r=t.length,i=RU(e),s=OU(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);let o=n?fv(t):Av(t),a=ei(o,e-mr)+mr;return n?h_(a,i):d_(a,i)}var _d=BigInt(0),vl=BigInt(1);function pv(t,e){let n=e.negate();return t?n:e}function yS(t,e){let n=NU(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function PU(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function wS(t,e){PU(t,e);let n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Ep(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function cB(t,e,n){let{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n,a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=vl);let l=e*r,u=l+Math.abs(a)-1,d=a===0,h=a<0,f=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:f,offsetF:l}}function Ute(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function jte(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}var vS=new WeakMap,MU=new WeakMap;function bS(t){return MU.get(t)||1}function lB(t){if(t!==_d)throw new Error("invalid wNAF")}var jS=class{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>_d;)n&vl&&(r=r.add(i)),i=i.double(),n>>=vl;return r}precomputeWindow(e,n){let{windows:r,windowSize:i}=wS(n,this.bits),s=[],o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let l=1;l<i;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE,o=wS(e,this.bits);for(let a=0;a<o.windows;a++){let{nextN:c,offset:l,isZero:u,isNeg:d,isNegF:h,offsetF:f}=cB(r,a,o);r=c,u?s=s.add(pv(h,n[f])):i=i.add(pv(d,n[l]))}return lB(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){let s=wS(e,this.bits);for(let o=0;o<s.windows&&r!==_d;o++){let{nextN:a,offset:c,isZero:l,isNeg:u}=cB(r,o,s);if(r=a,!l){let d=n[c];i=i.add(u?d.negate():d)}}return lB(r),i}getPrecomputes(e,n,r){let i=vS.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),vS.set(n,i))),i}cached(e,n,r){let i=bS(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){let s=bS(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){PU(n,this.bits),MU.set(e,n),vS.delete(e)}hasCache(e){return bS(e)!==1}};function Vte(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>_d||r>_d;)n&vl&&(s=s.add(i)),r&vl&&(o=o.add(i)),i=i.double(),n>>=vl,r>>=vl;return{p1:s,p2:o}}function Hte(t,e,n,r){Ute(n,t),jte(r,e);let i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=EU(BigInt(i)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Ep(c),u=new Array(Number(l)+1).fill(o),d=Math.floor((e.BITS-1)/c)*c,h=o;for(let f=d;f>=0;f-=c){u.fill(o);for(let g=0;g<s;g++){let m=r[g],y=Number(m>>BigInt(f)&l);u[y]=u[y].add(n[g])}let p=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),p=p.add(m);if(h=h.add(p),f!==0)for(let g=0;g<c;g++)h=h.double()}return h}function uB(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Lte(e),e}else return Ha(t,{isLE:n})}function $te(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>_d))throw new Error(`CURVE.${a} must be positive bigint`)}let i=uB(e.p,n.Fp,r),s=uB(e.n,n.Fn,r),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),zB("HashToScalar-");var up=BigInt(0),wd=BigInt(1),ov=BigInt(2);function qte(t){return Sv(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(H({},t))}function zte(t){let e=qte(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");let c=o||Cl,l=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),f=a?ov**BigInt(254):ov**BigInt(447),p=a?BigInt(8)*ov**BigInt(251)-wd:BigInt(4)*ov**BigInt(445)-wd,g=f+p+wd,m=M=>ei(M,n),y=E(d);function E(M){return h_(m(M),u)}function I(M){let v=Jn("u coordinate",M,u);return a&&(v[31]&=127),m(fv(v))}function L(M){return fv(i(Jn("scalar",M,u)))}function k(M,v){let b=U(I(v),L(M));if(b===up)throw new Error("invalid private or public key received");return E(b)}function N(M){return k(M,y)}function B(M,v,b){let w=m(M*(v-b));return v=m(v-w),b=m(b+w),{x_2:v,x_3:b}}function U(M,v){US("u",M,up,n),US("scalar",v,f,g);let b=v,w=M,C=wd,x=up,F=M,A=wd,P=up;for(let j=BigInt(l-1);j>=up;j--){let oe=b>>j&wd;P^=oe,{x_2:C,x_3:F}=B(P,C,F),{x_2:x,x_3:A}=B(P,x,A),P=oe;let X=C+x,Q=m(X*X),ae=C-x,ee=m(ae*ae),we=Q-ee,ne=F+A,be=F-A,Ot=m(be*X),vt=m(ne*ae),$t=Ot+vt,pn=Ot-vt;F=m($t*$t),A=m(w*m(pn*pn)),C=m(Q*ee),x=m(we*(Q+m(h*we)))}({x_2:C,x_3:F}=B(P,C,F)),{x_2:x,x_3:A}=B(P,x,A);let V=s(x);return m(C*V)}let T={secretKey:u,publicKey:u,seed:u},$=(M=c(u))=>(cs(M,T.seed),M);function K(M){let v=$(M);return{secretKey:v,publicKey:N(v)}}return{keygen:K,getSharedSecret:(M,v)=>k(M,v),getPublicKey:M=>N(M),scalarMult:k,scalarMultBase:N,utils:{randomSecretKey:$,randomPrivateKey:$},GuBytes:y.slice(),lengths:T}}var Gte=BigInt(1),dB=BigInt(2),Kte=BigInt(3),Wte=BigInt(5),Qte=BigInt(8),kU=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Yte={p:kU,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Qte,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Jte(t){let e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=kU,o=t*t%s*t%s,a=ss(o,dB,s)*o%s,c=ss(a,Gte,s)*t%s,l=ss(c,Wte,s)*c%s,u=ss(l,e,s)*l%s,d=ss(u,n,s)*u%s,h=ss(d,r,s)*d%s,f=ss(h,i,s)*h%s,p=ss(f,i,s)*h%s,g=ss(p,e,s)*l%s;return{pow_p_5_8:ss(g,dB,s)*t%s,b2:o}}function Zte(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var Xte=Ha(Yte.p,{isLE:!0}),VS=(()=>{let t=Xte.ORDER;return zte({P:t,type:"x25519",powPminus2:e=>{let{pow_p_5_8:n,b2:r}=Jte(e);return ei(ss(n,Kte,t)*r,t)},adjustScalarBytes:Zte})})(),hB=(t,e)=>(t+(t>=0?e:-e)/LU)/e;function ene(t,e,n){let[[r,i],[s,o]]=e,a=hB(o*t,n),c=hB(-i*t,n),l=t-a*r-c*s,u=-a*i-c*o,d=l<So,h=u<So;d&&(l=-l),h&&(u=-u);let f=Ep(Math.ceil(EU(n)/2))+Id;if(l<So||l>=f||u<So||u>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:l,k2neg:h,k2:u}}function HS(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function ES(t,e){let n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return hv(n.lowS,"lowS"),hv(n.prehash,"prehash"),n.format!==void 0&&HS(n.format),n}var $S=class extends Error{constructor(e=""){super(e)}},Co={Err:$S,_tlv:{encode:(t,e)=>{let{Err:n}=Co;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");let r=e.length/2,i=sv(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");let s=r>127?sv(i.length/2|128):"";return sv(t)+s+i+e},decode(t,e){let{Err:n}=Co,r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");let i=e[r++],s=!!(i&128),o=0;if(!s)o=i;else{let c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");let l=e.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(let u of l)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}let a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){let{Err:e}=Co;if(t<So)throw new e("integer: negative integers are not allowed");let n=sv(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){let{Err:e}=Co;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Av(t)}},toSig(t){let{Err:e,_int:n,_tlv:r}=Co,i=Jn("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,s),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){let{_tlv:e,_int:n}=Co,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},So=BigInt(0),Id=BigInt(1),LU=BigInt(2),av=BigInt(3),tne=BigInt(4);function vd(t,e){let{BYTES:n}=t,r;if(typeof e=="bigint")r=e;else{let i=Jn("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function nne(t,e={}){let n=$te("weierstrass",t,e),{Fp:r,Fn:i}=n,s=n.CURVE,{h:o,n:a}=s;Sv(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let l=BU(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(M,v,b){let{x:w,y:C}=v.toAffine(),x=r.toBytes(w);if(hv(b,"isCompressed"),b){u();let F=!r.isOdd(C);return ka(FU(F),x)}else return ka(Uint8Array.of(4),x,r.toBytes(C))}function h(M){yl(M,void 0,"Point");let{publicKey:v,publicKeyUncompressed:b}=l,w=M.length,C=M[0],x=M.subarray(1);if(w===v&&(C===2||C===3)){let F=r.fromBytes(x);if(!r.isValid(F))throw new Error("bad point: is not on curve, wrong x");let A=g(F),P;try{P=r.sqrt(A)}catch(j){let oe=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+oe)}u();let V=r.isOdd(P);return(C&1)===1!==V&&(P=r.neg(P)),{x:F,y:P}}else if(w===b&&C===4){let F=r.BYTES,A=r.fromBytes(x.subarray(0,F)),P=r.fromBytes(x.subarray(F,F*2));if(!m(A,P))throw new Error("bad point: is not on curve");return{x:A,y:P}}else throw new Error(`bad point: got length ${w}, expected compressed=${v} or uncompressed=${b}`)}let f=e.toBytes||d,p=e.fromBytes||h;function g(M){let v=r.sqr(M),b=r.mul(v,M);return r.add(r.add(b,r.mul(M,s.a)),s.b)}function m(M,v){let b=r.sqr(v),w=g(M);return r.eql(b,w)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=r.mul(r.pow(s.a,av),tne),E=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(y,E)))throw new Error("bad curve params: a or b");function I(M,v,b=!1){if(!r.isValid(v)||b&&r.is0(v))throw new Error(`bad point coordinate ${M}`);return v}function L(M){if(!(M instanceof T))throw new Error("ProjectivePoint expected")}function k(M){if(!c||!c.basises)throw new Error("no endo");return ene(M,c.basises,i.ORDER)}let N=sB((M,v)=>{let{X:b,Y:w,Z:C}=M;if(r.eql(C,r.ONE))return{x:b,y:w};let x=M.is0();v==null&&(v=x?r.ONE:r.inv(C));let F=r.mul(b,v),A=r.mul(w,v),P=r.mul(C,v);if(x)return{x:r.ZERO,y:r.ZERO};if(!r.eql(P,r.ONE))throw new Error("invZ was invalid");return{x:F,y:A}}),B=sB(M=>{if(M.is0()){if(e.allowInfinityPoint&&!r.is0(M.Y))return;throw new Error("bad point: ZERO")}let{x:v,y:b}=M.toAffine();if(!r.isValid(v)||!r.isValid(b))throw new Error("bad point: x or y not field elements");if(!m(v,b))throw new Error("bad point: equation left != right");if(!M.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(M,v,b,w,C){return b=new T(r.mul(b.X,M),b.Y,b.Z),v=pv(w,v),b=pv(C,b),v.add(b)}class T{constructor(v,b,w){this.X=I("x",v),this.Y=I("y",b,!0),this.Z=I("z",w),Object.freeze(this)}static CURVE(){return s}static fromAffine(v){let{x:b,y:w}=v||{};if(!v||!r.isValid(b)||!r.isValid(w))throw new Error("invalid affine point");if(v instanceof T)throw new Error("projective point not allowed");return r.is0(b)&&r.is0(w)?T.ZERO:new T(b,w,r.ONE)}static fromBytes(v){let b=T.fromAffine(p(yl(v,void 0,"point")));return b.assertValidity(),b}static fromHex(v){return T.fromBytes(Jn("pointHex",v))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,b=!0){return K.createCache(this,v),b||this.multiply(av),this}assertValidity(){B(this)}hasEvenY(){let{y:v}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(v)}equals(v){L(v);let{X:b,Y:w,Z:C}=this,{X:x,Y:F,Z:A}=v,P=r.eql(r.mul(b,A),r.mul(x,C)),V=r.eql(r.mul(w,A),r.mul(F,C));return P&&V}negate(){return new T(this.X,r.neg(this.Y),this.Z)}double(){let{a:v,b}=s,w=r.mul(b,av),{X:C,Y:x,Z:F}=this,A=r.ZERO,P=r.ZERO,V=r.ZERO,j=r.mul(C,C),oe=r.mul(x,x),X=r.mul(F,F),Q=r.mul(C,x);return Q=r.add(Q,Q),V=r.mul(C,F),V=r.add(V,V),A=r.mul(v,V),P=r.mul(w,X),P=r.add(A,P),A=r.sub(oe,P),P=r.add(oe,P),P=r.mul(A,P),A=r.mul(Q,A),V=r.mul(w,V),X=r.mul(v,X),Q=r.sub(j,X),Q=r.mul(v,Q),Q=r.add(Q,V),V=r.add(j,j),j=r.add(V,j),j=r.add(j,X),j=r.mul(j,Q),P=r.add(P,j),X=r.mul(x,F),X=r.add(X,X),j=r.mul(X,Q),A=r.sub(A,j),V=r.mul(X,oe),V=r.add(V,V),V=r.add(V,V),new T(A,P,V)}add(v){L(v);let{X:b,Y:w,Z:C}=this,{X:x,Y:F,Z:A}=v,P=r.ZERO,V=r.ZERO,j=r.ZERO,oe=s.a,X=r.mul(s.b,av),Q=r.mul(b,x),ae=r.mul(w,F),ee=r.mul(C,A),we=r.add(b,w),ne=r.add(x,F);we=r.mul(we,ne),ne=r.add(Q,ae),we=r.sub(we,ne),ne=r.add(b,C);let be=r.add(x,A);return ne=r.mul(ne,be),be=r.add(Q,ee),ne=r.sub(ne,be),be=r.add(w,C),P=r.add(F,A),be=r.mul(be,P),P=r.add(ae,ee),be=r.sub(be,P),j=r.mul(oe,ne),P=r.mul(X,ee),j=r.add(P,j),P=r.sub(ae,j),j=r.add(ae,j),V=r.mul(P,j),ae=r.add(Q,Q),ae=r.add(ae,Q),ee=r.mul(oe,ee),ne=r.mul(X,ne),ae=r.add(ae,ee),ee=r.sub(Q,ee),ee=r.mul(oe,ee),ne=r.add(ne,ee),Q=r.mul(ae,ne),V=r.add(V,Q),Q=r.mul(be,ne),P=r.mul(we,P),P=r.sub(P,Q),Q=r.mul(we,ae),j=r.mul(be,j),j=r.add(j,Q),new T(P,V,j)}subtract(v){return this.add(v.negate())}is0(){return this.equals(T.ZERO)}multiply(v){let{endo:b}=e;if(!i.isValidNot0(v))throw new Error("invalid scalar: out of range");let w,C,x=F=>K.cached(this,F,A=>yS(T,A));if(b){let{k1neg:F,k1:A,k2neg:P,k2:V}=k(v),{p:j,f:oe}=x(A),{p:X,f:Q}=x(V);C=oe.add(Q),w=U(b.beta,j,X,F,P)}else{let{p:F,f:A}=x(v);w=F,C=A}return yS(T,[w,C])[0]}multiplyUnsafe(v){let{endo:b}=e,w=this;if(!i.isValid(v))throw new Error("invalid scalar: out of range");if(v===So||w.is0())return T.ZERO;if(v===Id)return w;if(K.hasCache(this))return this.multiply(v);if(b){let{k1neg:C,k1:x,k2neg:F,k2:A}=k(v),{p1:P,p2:V}=Vte(T,w,x,A);return U(b.beta,P,V,C,F)}else return K.unsafe(w,v)}multiplyAndAddUnsafe(v,b,w){let C=this.multiplyUnsafe(b).add(v.multiplyUnsafe(w));return C.is0()?void 0:C}toAffine(v){return N(this,v)}isTorsionFree(){let{isTorsionFree:v}=e;return o===Id?!0:v?v(T,this):K.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:v}=e;return o===Id?this:v?v(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(v=!0){return hv(v,"isCompressed"),this.assertValidity(),f(T,this,v)}toHex(v=!0){return Ed(this.toBytes(v))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(v=!0){return this.toBytes(v)}_setWindowSize(v){this.precompute(v)}static normalizeZ(v){return yS(T,v)}static msm(v,b){return Hte(T,i,v,b)}static fromPrivateKey(v){return T.BASE.multiply(vd(i,v))}}T.BASE=new T(s.Gx,s.Gy,r.ONE),T.ZERO=new T(r.ZERO,r.ONE,r.ZERO),T.Fp=r,T.Fn=i;let $=i.BITS,K=new jS(T,e.endo?Math.ceil($/2):$);return T.BASE.precompute(8),T}function FU(t){return Uint8Array.of(t?2:3)}function BU(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function rne(t,e={}){let{Fn:n}=t,r=e.randomBytes||Cl,i=Object.assign(BU(t.Fp,n),{seed:OU(n.ORDER)});function s(h){try{return!!vd(n,h)}catch{return!1}}function o(h,f){let{publicKey:p,publicKeyUncompressed:g}=i;try{let m=h.length;return f===!0&&m!==p||f===!1&&m!==g?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=r(i.seed)){return Bte(yl(h,i.seed,"seed"),n.ORDER)}function c(h,f=!0){return t.BASE.multiply(vd(n,h)).toBytes(f)}function l(h){let f=a(h);return{secretKey:f,publicKey:c(f)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;let{secretKey:f,publicKey:p,publicKeyUncompressed:g}=i;if(n.allowedLengths||f===p)return;let m=Jn("key",h).length;return m===p||m===g}function d(h,f,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(f)===!1)throw new Error("second arg must be public key");let g=vd(n,h);return t.fromHex(f).multiply(g).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:d,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>vd(n,h),precompute(h=8,f=t.BASE){return f.precompute(h,!1)}},lengths:i})}function ine(t,e,n={}){wv(e),Sv(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let r=n.randomBytes||Cl,i=n.hmac||((b,...w)=>Iv(e,b,ka(...w))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:d,utils:h,lengths:f}=rne(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(b){let w=a>>Id;return b>w}function y(b,w){if(!o.isValidNot0(w))throw new Error(`invalid signature ${b}: out of range 1..Point.Fn.ORDER`);return w}function E(b,w){HS(w);let C=f.signature,x=w==="compact"?C:w==="recovered"?C+1:void 0;return yl(b,x,`${w} signature`)}class I{constructor(w,C,x){this.r=y("r",w),this.s=y("s",C),x!=null&&(this.recovery=x),Object.freeze(this)}static fromBytes(w,C=g){E(w,C);let x;if(C==="der"){let{r:V,s:j}=Co.toSig(yl(w));return new I(V,j)}C==="recovered"&&(x=w[0],C="compact",w=w.subarray(1));let F=o.BYTES,A=w.subarray(0,F),P=w.subarray(F,F*2);return new I(o.fromBytes(A),o.fromBytes(P),x)}static fromHex(w,C){return this.fromBytes(lv(w),C)}addRecoveryBit(w){return new I(this.r,this.s,w)}recoverPublicKey(w){let C=s.ORDER,{r:x,s:F,recovery:A}=this;if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");if(a*LU<C&&A>1)throw new Error("recovery id is ambiguous for h>1 curve");let P=A===2||A===3?x+a:x;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");let V=s.toBytes(P),j=t.fromBytes(ka(FU((A&1)===0),V)),oe=o.inv(P),X=k(Jn("msgHash",w)),Q=o.create(-X*oe),ae=o.create(F*oe),ee=t.BASE.multiplyUnsafe(Q).add(j.multiplyUnsafe(ae));if(ee.is0())throw new Error("point at infinify");return ee.assertValidity(),ee}hasHighS(){return m(this.s)}toBytes(w=g){if(HS(w),w==="der")return lv(Co.hexFromSig(this));let C=o.toBytes(this.r),x=o.toBytes(this.s);if(w==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return ka(Uint8Array.of(this.recovery),C,x)}return ka(C,x)}toHex(w){return Ed(this.toBytes(w))}assertValidity(){}static fromCompact(w){return I.fromBytes(Jn("sig",w),"compact")}static fromDER(w){return I.fromBytes(Jn("sig",w),"der")}normalizeS(){return this.hasHighS()?new I(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ed(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ed(this.toBytes("compact"))}}let L=n.bits2int||function(b){if(b.length>8192)throw new Error("input is too large");let w=Av(b),C=b.length*8-c;return C>0?w>>BigInt(C):w},k=n.bits2int_modN||function(b){return o.create(L(b))},N=Ep(c);function B(b){return US("num < 2^"+c,b,So,N),o.toBytes(b)}function U(b,w){return yl(b,void 0,"message"),w?yl(e(b),void 0,"prehashed message"):b}function T(b,w,C){if(["recovered","canonical"].some(ae=>ae in C))throw new Error("sign() legacy options not supported");let{lowS:x,prehash:F,extraEntropy:A}=ES(C,p);b=U(b,F);let P=k(b),V=vd(o,w),j=[B(V),B(P)];if(A!=null&&A!==!1){let ae=A===!0?r(f.secretKey):A;j.push(Jn("extraEntropy",ae))}let oe=ka(...j),X=P;function Q(ae){let ee=L(ae);if(!o.isValidNot0(ee))return;let we=o.inv(ee),ne=t.BASE.multiply(ee).toAffine(),be=o.create(ne.x);if(be===So)return;let Ot=o.create(we*o.create(X+be*V));if(Ot===So)return;let vt=(ne.x===be?0:2)|Number(ne.y&Id),$t=Ot;return x&&m(Ot)&&($t=o.neg(Ot),vt^=1),new I(be,$t,vt)}return{seed:oe,k2sig:Q}}function $(b,w,C={}){b=Jn("message",b);let{seed:x,k2sig:F}=T(b,w,C);return Nte(e.outputLen,o.BYTES,i)(x,F)}function K(b){let w,C=typeof b=="string"||yv(b),x=!C&&b!==null&&typeof b=="object"&&typeof b.r=="bigint"&&typeof b.s=="bigint";if(!C&&!x)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(x)w=new I(b.r,b.s);else if(C){try{w=I.fromBytes(Jn("sig",b),"der")}catch(F){if(!(F instanceof Co.Err))throw F}if(!w)try{w=I.fromBytes(Jn("sig",b),"compact")}catch{return!1}}return w||!1}function M(b,w,C,x={}){let{lowS:F,prehash:A,format:P}=ES(x,p);if(C=Jn("publicKey",C),w=U(Jn("message",w),A),"strict"in x)throw new Error("options.strict was renamed to lowS");let V=P===void 0?K(b):I.fromBytes(Jn("sig",b),P);if(V===!1)return!1;try{let j=t.fromBytes(C);if(F&&V.hasHighS())return!1;let{r:oe,s:X}=V,Q=k(w),ae=o.inv(X),ee=o.create(Q*ae),we=o.create(oe*ae),ne=t.BASE.multiplyUnsafe(ee).add(j.multiplyUnsafe(we));return ne.is0()?!1:o.create(ne.x)===oe}catch{return!1}}function v(b,w,C={}){let{prehash:x}=ES(C,p);return w=U(w,x),I.fromBytes(b,"recovered").recoverPublicKey(w).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:d,utils:h,lengths:f,Point:t,sign:$,verify:M,recoverPublicKey:v,Signature:I,hash:e})}function sne(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp,r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0,i=Ha(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function one(t){let{CURVE:e,curveOpts:n}=sne(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function ane(t,e){let n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,xU(n.Fn.ORDER,n.Fn.BITS))})}function cne(t){let{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=one(t),s=nne(e,n),o=ine(s,r,i);return ane(t,o)}function qS(t,e){let n=r=>cne(fe(H({},t),{hash:r}));return fe(H({},n(e)),{create:n})}var UU={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},jU={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},VU={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},lne=Ha(UU.p),une=Ha(jU.p),dne=Ha(VU.p),hne=qS(fe(H({},UU),{Fp:lne,lowS:!1}),vv);qS(fe(H({},jU),{Fp:une,lowS:!1}),Tee),qS(fe(H({},VU),{Fp:dne,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),_ee);var fne=hne,p_="base10",yr="base16",Cd="base64pad",_v="base64url",Dd="utf8",g_=0,Nd=1,Ip=2,pne=0,fB=1,fp=12,m_=32;function gne(){let t=VS.utils.randomPrivateKey(),e=VS.getPublicKey(t);return{privateKey:dt.toString(t,yr),publicKey:dt.toString(e,yr)}}function mne(){let t=Cl(m_);return dt.toString(t,yr)}function yne(t,e){let n=VS.getSharedSecret(dt.fromString(t,yr),dt.fromString(e,yr)),r=Tte(Cv,n,void 0,void 0,m_);return dt.toString(r,yr)}function wne(t){let e=Cv(dt.fromString(t,yr));return dt.toString(e,yr)}function vne(t){let e=Cv(dt.fromString(t,Dd));return dt.toString(e,yr)}function y_(t){return dt.fromString(`${t}`,p_)}function bl(t){return Number(dt.toString(t,p_))}function HU(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function $U(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function bne(t){let e=y_(typeof t.type<"u"?t.type:g_);if(bl(e)===Nd&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let n=typeof t.senderPublicKey<"u"?dt.fromString(t.senderPublicKey,yr):void 0,r=typeof t.iv<"u"?dt.fromString(t.iv,yr):Cl(fp),i=dt.fromString(t.symKey,yr),s=vU(i,r).encrypt(dt.fromString(t.message,Dd)),o=w_({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===_v?HU(o):o}function Ene(t){let e=dt.fromString(t.symKey,yr),{sealed:n,iv:r}=Tv({encoded:t.encoded,encoding:t.encoding}),i=vU(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return dt.toString(i,Dd)}function Ine(t,e){let n=y_(Ip),r=Cl(fp),i=dt.fromString(t,Dd),s=w_({type:n,sealed:i,iv:r});return e===_v?HU(s):s}function Cne(t,e){let{sealed:n}=Tv({encoded:t,encoding:e});return dt.toString(n,Dd)}function w_(t){if(bl(t.type)===Ip)return dt.toString(dt.concat([t.type,t.sealed]),Cd);if(bl(t.type)===Nd){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return dt.toString(dt.concat([t.type,t.senderPublicKey,t.iv,t.sealed]),Cd)}return dt.toString(dt.concat([t.type,t.iv,t.sealed]),Cd)}function Tv(t){let e=(t.encoding||Cd)===_v?$U(t.encoded):t.encoded,n=dt.fromString(e,Cd),r=n.slice(pne,fB),i=fB;if(bl(r)===Nd){let c=i+m_,l=c+fp,u=n.slice(i,c),d=n.slice(c,l),h=n.slice(l);return{type:r,sealed:h,iv:d,senderPublicKey:u}}if(bl(r)===Ip){let c=n.slice(i),l=Cl(fp);return{type:r,sealed:c,iv:l}}let s=i+fp,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function Ane(t,e){let n=Tv({encoded:t,encoding:e?.encoding});return qU({type:bl(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?dt.toString(n.senderPublicKey,yr):void 0,receiverPublicKey:e?.receiverPublicKey})}function qU(t){let e=t?.type||g_;if(e===Nd){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Sne(t){return t.type===Nd&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function _ne(t){return t.type===Ip}function zU(t){let e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return dt.concat([new Uint8Array([4]),e,n])}function Tne(t,e){let[n,r,i]=t.split("."),s=Buffer.from($U(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");let o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,l=Cv(c),u=zU(e);if(!fne.verify(dt.concat([o,a]),l,u))throw new Error("Invalid signature");return sX.decodeJWT(t).payload}var GU="irn";function Dne(t){return t?.relay||{protocol:GU}}function Nne(t){let e=oX.RELAY_JSONRPC[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var xne=Object.defineProperty,Rne=Object.defineProperties,One=Object.getOwnPropertyDescriptors,pB=Object.getOwnPropertySymbols,Pne=Object.prototype.hasOwnProperty,Mne=Object.prototype.propertyIsEnumerable,gB=(t,e,n)=>e in t?xne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,IS=(t,e)=>{for(var n in e||(e={}))Pne.call(e,n)&&gB(t,n,e[n]);if(pB)for(var n of pB(e))Mne.call(e,n)&&gB(t,n,e[n]);return t},kne=(t,e)=>Rne(t,One(e));function KU(t,e="-"){let n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){let s=i.replace(r,""),o=t[i];n[s]=o}}),n}function Lne(t){if(!t.includes("wc:")){let l=e_(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;let e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:WU(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:KU(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function WU(t){return t.startsWith("//")?t.substring(2):t}function QU(t,e="-"){let n="relay",r={};return Object.keys(t).forEach(i=>{let s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function Fne(t){let e=new URLSearchParams,n=IS(IS(kne(IS({},QU(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&e.append(r,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Bne(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var Une=Object.defineProperty,jne=Object.defineProperties,Vne=Object.getOwnPropertyDescriptors,mB=Object.getOwnPropertySymbols,Hne=Object.prototype.hasOwnProperty,$ne=Object.prototype.propertyIsEnumerable,yB=(t,e,n)=>e in t?Une(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qne=(t,e)=>{for(var n in e||(e={}))Hne.call(e,n)&&yB(t,n,e[n]);if(mB)for(var n of mB(e))$ne.call(e,n)&&yB(t,n,e[n]);return t},zne=(t,e)=>jne(t,Vne(e));function Al(t){let e=[];return t.forEach(n=>{let[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function YU(t){let e=[];return Object.values(t).forEach(n=>{e.push(...Al(n.accounts))}),[...new Set(e)]}function Gne(t){let e=[];return Object.values(t).forEach(n=>{e.push(...n.methods)}),[...new Set(e)]}function Kne(t){let e=[];return Object.values(t).forEach(n=>{e.push(...n.events)}),[...new Set(e)]}function JU(t,e){let n=[];return Object.values(t).forEach(r=>{Al(r.accounts).includes(e)&&n.push(...r.methods)}),n}function ZU(t,e){let n=[];return Object.values(t).forEach(r=>{Al(r.accounts).includes(e)&&n.push(...r.events)}),n}function Wne(t,e){let n=l3(t,e);if(n)throw new Error(n.message);let r={};for(let[i,s]of Object.entries(t))r[i]={methods:s.methods,events:s.events,chains:s.accounts.map(o=>`${o.split(":")[0]}:${o.split(":")[1]}`)};return r}function Qne(t){var e;let{proposal:{requiredNamespaces:n,optionalNamespaces:r={}},supportedNamespaces:i}=t,s=mp(n),o=mp(r),a={};Object.keys(i).forEach(u=>{let d=i[u].chains,h=i[u].methods,f=i[u].events,p=i[u].accounts;d.forEach(g=>{if(!p.some(m=>m.includes(g)))throw new Error(`No accounts provided for chain ${g} in namespace ${u}`)}),a[u]={chains:d,methods:h,events:f,accounts:p}});let c=d3(n,a,"approve()");if(c)throw new Error(c.message);let l={};if(!Object.keys(n).length&&!Object.keys(r).length)return a;Object.keys(s).forEach(u=>{let d=i[u].chains.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.chains)==null?void 0:y.includes(g)}),h=i[u].methods.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.methods)==null?void 0:y.includes(g)}),f=i[u].events.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.events)==null?void 0:y.includes(g)}),p=d.map(g=>i[u].accounts.filter(m=>m.includes(`${g}:`))).flat();l[u]={chains:d,methods:h,events:f,accounts:p}}),Object.keys(o).forEach(u=>{var d,h,f,p,g,m;if(!i[u])return;let y=(h=(d=o[u])==null?void 0:d.chains)==null?void 0:h.filter(k=>i[u].chains.includes(k)),E=i[u].methods.filter(k=>{var N,B;return(B=(N=o[u])==null?void 0:N.methods)==null?void 0:B.includes(k)}),I=i[u].events.filter(k=>{var N,B;return(B=(N=o[u])==null?void 0:N.events)==null?void 0:B.includes(k)}),L=y?.map(k=>i[u].accounts.filter(N=>N.includes(`${k}:`))).flat();l[u]={chains:vi((f=l[u])==null?void 0:f.chains,y),methods:vi((p=l[u])==null?void 0:p.methods,E),events:vi((g=l[u])==null?void 0:g.events,I),accounts:vi((m=l[u])==null?void 0:m.accounts,L)}});for(let[u,d]of Object.entries(l))(d.accounts.length===0||((e=d?.chains)==null?void 0:e.length)===0)&&delete l[u];return l}function v_(t){return t.includes(":")}function XU(t){return v_(t)?t.split(":")[0]:t}function mp(t){var e,n,r;let i={};if(!Dv(t))return i;for(let[s,o]of Object.entries(t)){let a=v_(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=XU(s);i[u]=zne(qne({},i[u]),{chains:vi(a,(e=i[u])==null?void 0:e.chains),methods:vi(c,(n=i[u])==null?void 0:n.methods),events:vi(l,(r=i[u])==null?void 0:r.events)})}return i}function e3(t){let e={};return t?.forEach(n=>{var r;let[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function Yne(t,e){e=e.map(r=>r.replace("did:pkh:",""));let n=e3(e);for(let[r,i]of Object.entries(n))i.methods?i.methods=vi(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function Jne(t,e){var n,r,i,s,o,a;let c=mp(t),l=mp(e),u={},d=Object.keys(c).concat(Object.keys(l));for(let h of d)u[h]={chains:vi((n=c[h])==null?void 0:n.chains,(r=l[h])==null?void 0:r.chains),methods:vi((i=c[h])==null?void 0:i.methods,(s=l[h])==null?void 0:s.methods),events:vi((o=c[h])==null?void 0:o.events,(a=l[h])==null?void 0:a.events)};return u}var t3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},n3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Ao(t,e){let{message:n,code:r}=n3[t];return{message:e?`${n} ${e}`:n,code:r}}function El(t,e){let{message:n,code:r}=t3[t];return{message:e?`${n} ${e}`:n,code:r}}function Cp(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Dv(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ba(t){return typeof t>"u"}function ti(t,e){return e&&Ba(t)?!0:typeof t=="string"&&!!t.trim().length}function Nv(t,e){return e&&Ba(t)?!0:typeof t=="number"&&!isNaN(t)}function Zne(t,e){let{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n),s=!0;return La(i,r)?(r.forEach(o=>{let{accounts:a,methods:c,events:l}=t.namespaces[o],u=Al(a),d=n[o];(!La(mv(o,d),u)||!La(d.methods,c)||!La(d.events,l))&&(s=!1)}),s):!1}function yp(t){return ti(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function r3(t){if(ti(t,!1)&&t.includes(":")){let e=t.split(":");if(e.length===3){let n=e[0]+":"+e[1];return!!e[2]&&yp(n)}}return!1}function Xne(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(ti(t,!1)){if(e(t))return!0;let n=e_(t);return e(n)}}catch{}return!1}function ere(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function tre(t){return t?.topic}function nre(t,e){let n=null;return ti(t?.publicKey,!1)||(n=Ao("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function zS(t){let e=!0;return Cp(t)?t.length&&(e=t.every(n=>ti(n,!1))):e=!1,e}function i3(t,e,n){let r=null;return Cp(e)&&e.length?e.forEach(i=>{r||yp(i)||(r=El("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):yp(t)||(r=El("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function s3(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;let o=i3(i,mv(i,s),`${e} ${n}`);o&&(r=o)}),r}function o3(t,e){let n=null;return Cp(t)?t.forEach(r=>{n||r3(r)||(n=El("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=El("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function a3(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;let i=o3(r?.accounts,`${e} namespace`);i&&(n=i)}),n}function c3(t,e){let n=null;return zS(t?.methods)?zS(t?.events)||(n=El("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=El("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function b_(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;let i=c3(r,`${e}, namespace`);i&&(n=i)}),n}function rre(t,e,n){let r=null;if(t&&Dv(t)){let i=b_(t,e);i&&(r=i);let s=s3(t,e,n);s&&(r=s)}else r=Ao("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function l3(t,e){let n=null;if(t&&Dv(t)){let r=b_(t,e);r&&(n=r);let i=a3(t,e);i&&(n=i)}else n=Ao("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function u3(t){return ti(t.protocol,!0)}function ire(t,e){let n=!1;return e&&!t?n=!0:t&&Cp(t)&&t.length&&t.forEach(r=>{n=u3(r)}),n}function sre(t){return typeof t=="number"}function ore(t){return typeof t<"u"&&typeof t!==null}function are(t){return!(!t||typeof t!="object"||!t.code||!Nv(t.code,!1)||!t.message||!ti(t.message,!1))}function cre(t){return!(Ba(t)||!ti(t.method,!1))}function lre(t){return!(Ba(t)||Ba(t.result)&&Ba(t.error)||!Nv(t.id,!1)||!ti(t.jsonrpc,!1))}function ure(t){return!(Ba(t)||!ti(t.name,!1))}function dre(t,e){return!(!yp(e)||!YU(t).includes(e))}function hre(t,e,n){return ti(n,!1)?JU(t,e).includes(n):!1}function fre(t,e,n){return ti(n,!1)?ZU(t,e).includes(n):!1}function d3(t,e,n){let r=null,i=pre(t),s=gre(e),o=Object.keys(i),a=Object.keys(s),c=wB(Object.keys(t)),l=wB(Object.keys(e)),u=c.filter(d=>!l.includes(d));return u.length&&(r=Ao("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),La(o,a)||(r=Ao("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(d=>{if(!d.includes(":")||r)return;let h=Al(e[d].accounts);h.includes(d)||(r=Ao("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${d}
        Required: ${d}
        Approved: ${h.toString()}`))}),o.forEach(d=>{r||(La(i[d].methods,s[d].methods)?La(i[d].events,s[d].events)||(r=Ao("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${d}`)):r=Ao("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${d}`))}),r}function pre(t){let e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function wB(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function gre(t){let e={};return Object.keys(t).forEach(n=>{n.includes(":")?e[n]=t[n]:Al(t[n].accounts)?.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}),e}function mre(t,e){return Nv(t,!1)&&t<=e.max&&t>=e.min}function yre(){let t=Il();return new Promise(e=>{switch(t){case gr.browser:e(h3());break;case gr.reactNative:e(f3());break;case gr.node:e(p3());break;default:e(!0)}})}function h3(){return Td()&&navigator?.onLine}async function f3(){return Va()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function p3(){return!0}function wre(t){switch(Il()){case gr.browser:g3(t);break;case gr.reactNative:m3(t);break;case gr.node:break}}function g3(t){!Va()&&Td()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function m3(t){Va()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function vre(){var t;return Td()&&_o.getDocument()?((t=_o.getDocument())==null?void 0:t.visibilityState)==="visible":!0}var CS={},GS=class{static get(e){return CS[e]}static set(e,n){CS[e]=n}static delete(e){delete CS[e]}};function y3(t){let e=wp.default.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function w3({publicKey:t,signature:e,payload:n}){var r;let i=KS(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=Ere(n.address),a=n.era==="00"?new Uint8Array([0]):KS(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(n.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${bre(n.tip)}`),d=Cre(u),h=new Uint8Array([0,...t,o,...e,...a,...l,...d,...i]),f=Ire(h.length+1);return new Uint8Array([...f,s,...h])}function v3(t){let e=KS(t),n=aX.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function KS(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function bre(t){return t.startsWith("0x")?t.slice(2):t}function Ere(t){let e=wp.default.decode(t)[0];return e===42?0:e===60?2:1}function Ire(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){let e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){let e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function Cre(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){let e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){let e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Are(t){let e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=y3(t.transaction.address),r=w3({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return v3(i)}function Sre({logger:t,name:e}){let n=typeof t=="string"?cX.generatePlatformLogger({opts:{level:t,name:e}}).logger:t;return n.level=typeof t=="string"?t:t.level,n}R.BASE10=p_,R.BASE16=yr,R.BASE64=Cd,R.BASE64URL=_v,R.COLON=EX,R.DEFAULT_DEPTH=JS,R.EMPTY_SPACE=cv,R.ENV_MAP=gr,R.INTERNAL_ERRORS=n3,R.LimitedSet=_S,R.MemoryStore=GS,R.ONE_THOUSAND=IX,R.REACT_NATIVE_PRODUCT=AB,R.RELAYER_DEFAULT_PROTOCOL=GU,R.SDK_ERRORS=t3,R.SDK_TYPE=_B,R.SLASH=SB,R.TYPE_0=g_,R.TYPE_1=Nd,R.TYPE_2=Ip,R.UTF8=Dd,R.addResourceToRecap=fU,R.addSignatureToExtrinsic=w3,R.appendToQueryString=TB,R.assertType=xX,R.assignAbilityToActions=a_,R.base64Decode=dU,R.base64Encode=uU,R.buildApprovedNamespaces=Qne,R.buildAuthObject=Wee,R.buildNamespacesFromAuth=Yne,R.buildRecapStatement=gU,R.buildSignedExtrinsicHash=Are,R.calcExpiry=HX,R.capitalize=LX,R.capitalizeWord=MB,R.createDelayedPromise=FX,R.createEncodedRecap=Zee,R.createExpiringPromise=BX,R.createLogger=Sre,R.createRecap=hU,R.decodeRecap=ja,R.decodeTypeByte=bl,R.decodeTypeTwoEnvelope=Cne,R.decrypt=Ene,R.deriveExtrinsicHash=v3,R.deriveSymKey=yne,R.deserialize=Tv,R.encodeRecap=bv,R.encodeTypeByte=y_,R.encodeTypeTwoEnvelope=Ine,R.encrypt=bne,R.engineEvent=qX,R.enumify=kX,R.extractSolanaTransactionId=Mee,R.formatAccountId=bB,R.formatAccountWithChain=uX,R.formatChainId=vB,R.formatDeeplinkUrl=kB,R.formatExpirerTarget=XS,R.formatIdTarget=jX,R.formatMessage=oU,R.formatMessageContext=RX,R.formatRelayParams=QU,R.formatRelayRpcUrl=DX,R.formatStatementFromRecap=l_,R.formatTopicTarget=UX,R.formatUA=RB,R.formatUri=Fne,R.fromBase64=e_,R.generateKeyPair=gne,R.generateRandomBytes32=mne,R.getAccountsChains=Al,R.getAccountsFromNamespaces=hX,R.getAddressFromAccount=EB,R.getAddressesFromAccounts=dX,R.getAlgorandTransactionId=Fee,R.getAppId=SX,R.getAppMetadata=DB,R.getBrowserOnlineStatus=h3,R.getChainFromAccount=IB,R.getChainsFromAccounts=CB,R.getChainsFromNamespace=mv,R.getChainsFromNamespaces=fX,R.getChainsFromRecap=tte,R.getChainsFromRequiredNamespaces=pX,R.getCommonValuesInArrays=SS,R.getCryptoKeyFromKeyData=zU,R.getDecodedRecapFromResources=aU,R.getDeepLink=GX,R.getDidAddress=o_,R.getDidAddressNamespace=iU,R.getDidAddressSegments=bp,R.getDidChainId=rU,R.getEnvironment=Il,R.getHttpUrl=NX,R.getInternalError=Ao,R.getJavascriptID=xB,R.getJavascriptOS=NB,R.getLastItems=PB,R.getLinkModeURL=Bne,R.getMethodsFromRecap=ete,R.getNamespacedDidChainId=sU,R.getNamespacesChains=YU,R.getNamespacesEvents=Kne,R.getNamespacesEventsForChainId=ZU,R.getNamespacesFromAccounts=e3,R.getNamespacesMethods=Gne,R.getNamespacesMethodsForChainId=JU,R.getNearTransactionIdFromSignedTransaction=Lee,R.getNearUint8ArrayFromBytes=eU,R.getNodeOnlineStatus=p3,R.getReCapActions=lU,R.getReactNativeOnlineStatus=f3,R.getRecapAbilitiesFromResource=Jee,R.getRecapFromResources=Ev,R.getRecapResource=cU,R.getRelayClientMetadata=TX,R.getRelayProtocolApi=Nne,R.getRelayProtocolName=Dne,R.getRequiredNamespacesFromNamespaces=Wne,R.getSdkError=El,R.getSearchParamFromURL=KX,R.getSignDirectHash=Bee,R.getSuiDigest=kee,R.getUniqueValues=YS,R.getWalletSendCallsHashes=Uee,R.handleDeeplinkRedirect=zX,R.hasOverlap=La,R.hashEthereumMessage=i_,R.hashKey=wne,R.hashMessage=vne,R.isAndroid=CX,R.isAppVisible=vre,R.isBrowser=Td,R.isCaipNamespace=v_,R.isConformingNamespaces=d3,R.isExpired=$X,R.isIframe=BB,R.isIos=AX,R.isNode=ZS,R.isOnline=yre,R.isProposalStruct=ere,R.isReactNative=Va,R.isRecap=c_,R.isSessionCompatible=Zne,R.isSessionStruct=tre,R.isTelegram=FB,R.isTestRun=QX,R.isTypeOneEnvelope=Sne,R.isTypeTwoEnvelope=_ne,R.isUndefined=Ba,R.isValidAccountId=r3,R.isValidAccounts=o3,R.isValidActions=c3,R.isValidArray=Cp,R.isValidChainId=yp,R.isValidChains=i3,R.isValidController=nre,R.isValidEip1271Signature=XB,R.isValidEip191Signature=ZB,R.isValidErrorReason=are,R.isValidEvent=ure,R.isValidId=sre,R.isValidNamespaceAccounts=a3,R.isValidNamespaceActions=b_,R.isValidNamespaceChains=s3,R.isValidNamespaceMethodsOrEvents=zS,R.isValidNamespaces=l3,R.isValidNamespacesChainId=dre,R.isValidNamespacesEvent=fre,R.isValidNamespacesRequest=hre,R.isValidNumber=Nv,R.isValidObject=Dv,R.isValidParams=ore,R.isValidRecap=js,R.isValidRelay=u3,R.isValidRelays=ire,R.isValidRequest=cre,R.isValidRequestExpiry=mre,R.isValidRequiredNamespaces=rre,R.isValidResponse=lre,R.isValidString=ti,R.isValidUrl=Xne,R.mapEntries=MX,R.mapToObj=OX,R.mergeArrays=vi,R.mergeEncodedRecaps=Xee,R.mergeRecaps=pU,R.mergeRequiredAndOptionalNamespaces=Jne,R.normalizeNamespaces=mp,R.objToMap=PX,R.openDeeplink=LB,R.parseAccountId=QS,R.parseChainId=WS,R.parseContextNames=OB,R.parseExpirerTarget=VX,R.parseNamespaceKey=XU,R.parseRelayParams=KU,R.parseTopic=WU,R.parseUri=Lne,R.populateAppMetadata=_X,R.populateAuthPayload=Qee,R.recapHasResource=Yee,R.serialize=w_,R.sleep=YX,R.ss58AddressToPublicKey=y3,R.subscribeToBrowserNetworkChange=g3,R.subscribeToNetworkChange=wre,R.subscribeToReactNativeNetworkChange=m3,R.toBase64=UB,R.uuidv4=WX,R.validateDecoding=Ane,R.validateEncoding=qU,R.validateSignedCacao=Kee,R.verifyP256Jwt=Tne,R.verifySignature=JB});var j_={};ah(j_,{ICore:()=>E_,ICrypto:()=>I_,IEchoClient:()=>M_,IEngine:()=>U_,IEngineEvents:()=>B_,IEventClient:()=>k_,IExpirer:()=>R_,IJsonRpcHistory:()=>C_,IKeyChain:()=>x_,IMessageTracker:()=>A_,IPairing:()=>O_,IPublisher:()=>S_,IRelayer:()=>__,ISignClient:()=>F_,ISignClientEvents:()=>L_,IStore:()=>T_,ISubscriber:()=>N_,ISubscriberTopicMap:()=>D_,IVerify:()=>P_});var xv,_re,Tre,b3,E_,I_,Dre,Nre,xre,C_,A_,S_,__,T_,Rre,Ore,Pre,D_,N_,x_,R_,O_,P_,M_,k_,Mre,kre,E3,L_,F_,B_,U_,V_=$r(()=>{"use strict";zN();xv=Kl(Ks()),_re=Object.defineProperty,Tre=(t,e,n)=>e in t?_re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,b3=(t,e,n)=>Tre(t,typeof e!="symbol"?e+"":e,n),E_=class extends Cr{constructor(e){super(),this.opts=e,b3(this,"protocol","wc"),b3(this,"version",2)}},I_=class{constructor(e,n,r){this.core=e,this.logger=n}},Dre=Object.defineProperty,Nre=(t,e,n)=>e in t?Dre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xre=(t,e,n)=>Nre(t,typeof e!="symbol"?e+"":e,n),C_=class extends Cr{constructor(e,n){super(),this.core=e,this.logger=n,xre(this,"records",new Map)}},A_=class{constructor(e,n){this.logger=e,this.core=n}},S_=class extends Cr{constructor(e,n){super(),this.relayer=e,this.logger=n}},__=class extends Cr{constructor(e){super()}},T_=class{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}},Rre=Object.defineProperty,Ore=(t,e,n)=>e in t?Rre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pre=(t,e,n)=>Ore(t,typeof e!="symbol"?e+"":e,n),D_=class{constructor(){Pre(this,"map",new Map)}},N_=class extends Cr{constructor(e,n){super(),this.relayer=e,this.logger=n}},x_=class{constructor(e,n){this.core=e,this.logger=n}},R_=class extends Cr{constructor(e,n){super(),this.core=e,this.logger=n}},O_=class{constructor(e,n){this.logger=e,this.core=n}},P_=class{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}},M_=class{constructor(e,n){this.projectId=e,this.logger=n}},k_=class{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}},Mre=Object.defineProperty,kre=(t,e,n)=>e in t?Mre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E3=(t,e,n)=>kre(t,typeof e!="symbol"?e+"":e,n),L_=class extends xv.default{constructor(){super()}},F_=class{constructor(e){this.opts=e,E3(this,"protocol","wc"),E3(this,"version",2)}},B_=class extends xv.EventEmitter{constructor(){super()}},U_=class{constructor(e){this.client=e}}});var Lj=vs(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});var _l=Ks(),Tl=(KN(),Pe(GN)),Lre=(QN(),Pe(WN)),Dt=nv(),us=(V_(),Pe(j_)),Se=Wl(),H_=(_0(),Pe(VN)),G_=(pg(),Pe(fg)),q=Ap(),Fre=(mg(),Pe(gg)),Bre=(wg(),Pe(yg)),wr=(Yl(),Pe(Ql)),Ure=(JN(),Pe(YN)),jre=hg();function h1(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}function Vre(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var Hre=h1(_l),$re=h1(Lre),Rv=Vre(G_),qre=h1(Ure),f1="wc",p1=2,Rp="core",ls=`${f1}@2:${Rp}:`,q3={name:Rp,logger:"error"},z3={database:":memory:"},G3="crypto",K_="client_ed25519_seed",K3=Se.ONE_DAY,W3="keychain",Q3="0.3",Y3="messages",J3="0.3",Z3=Se.SIX_HOURS,X3="publisher",ej="irn",tj="error",g1="wss://relay.walletconnect.org",nj="relayer",rn={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},rj="_subscription",ri={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ij=.1,zre={database:":memory:"},Ov="2.23.1",Gre=1e4,Sl={link_mode:"link_mode",relay:"relay"},Dp={inbound:"inbound",outbound:"outbound"},sj="0.3",oj="WALLETCONNECT_CLIENT_ID",W_="WALLETCONNECT_LINK_MODE_APPS",Br={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Kre=Se.THIRTY_DAYS,aj="subscription",cj="0.3",Wre=Se.FIVE_SECONDS*1e3,lj="pairing",uj="0.3",Qre=Se.THIRTY_DAYS,Od={wc_pairingDelete:{req:{ttl:Se.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Se.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Se.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Se.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Se.ONE_DAY,prompt:!1,tag:0},res:{ttl:Se.ONE_DAY,prompt:!1,tag:0}}},Pd={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ii={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},dj="history",hj="0.3",fj="expirer",Ci={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},pj="0.3",Yre=Se.ONE_DAY,gj="verify-api",Jre="https://verify.walletconnect.com",mj="https://verify.walletconnect.org",Np=mj,yj=`${Np}/v3`,wj=[Jre,mj],vj="echo",bj="https://echo.walletconnect.com",Zre="event-client",Hs={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Do={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Xre={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},eie={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},tie={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},nie={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Ej=.1,Ij="event-client",Cj=86400,Aj="https://pulse.walletconnect.org/batch";function rie(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,y=0,E=p.length;y!==E&&p[y]===0;)y++,g++;for(var I=(E-y)*u+1>>>0,L=new Uint8Array(I);y!==E;){for(var k=p[y],N=0,B=I-1;(k!==0||N<m)&&B!==-1;B--,N++)k+=256*L[B]>>>0,L[B]=k%a>>>0,k=k/a>>>0;if(k!==0)throw new Error("Non-zero carry");m=N,y++}for(var U=I-m;U!==I&&L[U]===0;)U++;for(var T=c.repeat(g);U<I;++U)T+=t.charAt(L[U]);return T}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,y=0;p[g]===c;)m++,g++;for(var E=(p.length-g)*l+1>>>0,I=new Uint8Array(E);p[g];){var L=n[p.charCodeAt(g)];if(L===255)return;for(var k=0,N=E-1;(L!==0||k<y)&&N!==-1;N--,k++)L+=a*I[N]>>>0,I[N]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");y=k,g++}if(p[g]!==" "){for(var B=E-y;B!==E&&I[B]===0;)B++;for(var U=new Uint8Array(m+(E-B)),T=m;B!==E;)U[T++]=I[B++];return U}}}function f(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:h,decode:f}}var iie=rie,sie=iie,Sj=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},oie=t=>new TextEncoder().encode(t),aie=t=>new TextDecoder().decode(t),Q_=class{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Y_=class{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _j(this,e)}},J_=class{constructor(e){this.decoders=e}or(e){return _j(this,e)}decode(e){let n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},_j=(t,e)=>new J_(H(H({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),Z_=class{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new Q_(e,n,r),this.decoder=new Y_(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Gv=({name:t,prefix:e,encode:n,decode:r})=>new Z_(t,e,n,r),Op=({prefix:t,name:e,alphabet:n})=>{let{encode:r,decode:i}=sie(n,e);return Gv({prefix:t,name:e,encode:r,decode:s=>Sj(i(s))})},cie=(t,e,n,r)=>{let i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;let o=new Uint8Array(s*n/8|0),a=0,c=0,l=0;for(let u=0;u<s;++u){let d=i[t[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|d,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lie=(t,e,n)=>{let r=e[e.length-1]==="=",i=(1<<n)-1,s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Mn=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Gv({prefix:e,name:t,encode(i){return lie(i,r,n)},decode(i){return cie(i,r,n,t)}}),uie=Gv({prefix:"\0",name:"identity",encode:t=>aie(t),decode:t=>oie(t)}),die=Object.freeze({__proto__:null,identity:uie}),hie=Mn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),fie=Object.freeze({__proto__:null,base2:hie}),pie=Mn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),gie=Object.freeze({__proto__:null,base8:pie}),mie=Op({prefix:"9",name:"base10",alphabet:"0123456789"}),yie=Object.freeze({__proto__:null,base10:mie}),wie=Mn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vie=Mn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),bie=Object.freeze({__proto__:null,base16:wie,base16upper:vie}),Eie=Mn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Iie=Mn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cie=Mn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Aie=Mn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Sie=Mn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_ie=Mn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Tie=Mn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Die=Mn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Nie=Mn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),xie=Object.freeze({__proto__:null,base32:Eie,base32upper:Iie,base32pad:Cie,base32padupper:Aie,base32hex:Sie,base32hexupper:_ie,base32hexpad:Tie,base32hexpadupper:Die,base32z:Nie}),Rie=Op({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Oie=Op({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Pie=Object.freeze({__proto__:null,base36:Rie,base36upper:Oie}),Mie=Op({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kie=Op({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Lie=Object.freeze({__proto__:null,base58btc:Mie,base58flickr:kie}),Fie=Mn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bie=Mn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Uie=Mn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),jie=Mn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Vie=Object.freeze({__proto__:null,base64:Fie,base64pad:Bie,base64url:Uie,base64urlpad:jie}),Tj=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Hie=Tj.reduce((t,e,n)=>(t[n]=e,t),[]),$ie=Tj.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function qie(t){return t.reduce((e,n)=>(e+=Hie[n],e),"")}function zie(t){let e=[];for(let n of t){let r=$ie[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}var Gie=Gv({prefix:"\u{1F680}",name:"base256emoji",encode:qie,decode:zie}),Kie=Object.freeze({__proto__:null,base256emoji:Gie}),Wie=Dj,I3=128,Qie=127,Yie=~Qie,Jie=Math.pow(2,31);function Dj(t,e,n){e=e||[],n=n||0;for(var r=n;t>=Jie;)e[n++]=t&255|I3,t/=128;for(;t&Yie;)e[n++]=t&255|I3,t>>>=7;return e[n]=t|0,Dj.bytes=n-r+1,e}var Zie=X_,Xie=128,C3=127;function X_(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw X_.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&C3)<<i:(o&C3)*Math.pow(2,i),i+=7}while(o>=Xie);return X_.bytes=s-r,n}var ese=Math.pow(2,7),tse=Math.pow(2,14),nse=Math.pow(2,21),rse=Math.pow(2,28),ise=Math.pow(2,35),sse=Math.pow(2,42),ose=Math.pow(2,49),ase=Math.pow(2,56),cse=Math.pow(2,63),lse=function(t){return t<ese?1:t<tse?2:t<nse?3:t<rse?4:t<ise?5:t<sse?6:t<ose?7:t<ase?8:t<cse?9:10},use={encode:Wie,decode:Zie,encodingLength:lse},Nj=use,A3=(t,e,n=0)=>(Nj.encode(t,e,n),e),S3=t=>Nj.encodingLength(t),e1=(t,e)=>{let n=e.byteLength,r=S3(t),i=r+S3(n),s=new Uint8Array(i+n);return A3(t,s,0),A3(n,s,r),s.set(e,i),new t1(t,n,e,s)},t1=class{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}},xj=({name:t,code:e,encode:n})=>new n1(t,e,n),n1=class{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){let n=this.encode(e);return n instanceof Uint8Array?e1(this.code,n):n.then(r=>e1(this.code,r))}else throw Error("Unknown type, must be binary type")}},Rj=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),dse=xj({name:"sha2-256",code:18,encode:Rj("SHA-256")}),hse=xj({name:"sha2-512",code:19,encode:Rj("SHA-512")}),fse=Object.freeze({__proto__:null,sha256:dse,sha512:hse}),Oj=0,pse="identity",Pj=Sj,gse=t=>e1(Oj,Pj(t)),mse={code:Oj,name:pse,encode:Pj,digest:gse},yse=Object.freeze({__proto__:null,identity:mse});new TextEncoder,new TextDecoder;var _3=H(H(H(H(H(H(H(H(H(H({},die),fie),gie),yie),bie),xie),Pie),Lie),Vie),Kie);H(H({},fse),yse);function Mj(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function wse(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Mj(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function kj(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}var T3=kj("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),$_=kj("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);let e=wse(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),vse=H({utf8:T3,"utf-8":T3,hex:_3.base16,latin1:$_,ascii:$_,binary:$_},_3);function bse(t,e="utf8"){let n=vse[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Mj(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var Ese=Object.defineProperty,Ise=(t,e,n)=>e in t?Ese(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Vs=(t,e,n)=>Ise(t,typeof e!="symbol"?e+"":e,n),Pv=class{constructor(e,n){this.core=e,this.logger=n,Vs(this,"keychain",new Map),Vs(this,"name",W3),Vs(this,"version",Q3),Vs(this,"initialized",!1),Vs(this,"storagePrefix",ls),Vs(this,"init",async()=>{if(!this.initialized){let r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),Vs(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),Vs(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),Vs(this,"get",r=>{this.isInitialized();let i=this.keychain.get(r);if(typeof i>"u"){let{message:s}=q.getInternalError("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),Vs(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=Dt.generateChildLogger(n,this.name)}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,q.mapToObj(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?q.objToMap(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Cse=Object.defineProperty,Ase=(t,e,n)=>e in t?Cse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,In=(t,e,n)=>Ase(t,typeof e!="symbol"?e+"":e,n),Mv=class{constructor(e,n,r){this.core=e,this.logger=n,In(this,"name",G3),In(this,"keychain"),In(this,"randomSessionIdentifier",q.generateRandomBytes32()),In(this,"initialized",!1),In(this,"clientId"),In(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),In(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),In(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let i=await this.getClientSeed(),s=Rv.generateKeyPair(i),o=Rv.encodeIss(s.publicKey);return this.clientId=o,o}),In(this,"generateKeyPair",()=>{this.isInitialized();let i=q.generateKeyPair();return this.setPrivateKey(i.publicKey,i.privateKey)}),In(this,"signJWT",async i=>{this.isInitialized();let s=await this.getClientSeed(),o=Rv.generateKeyPair(s),a=this.randomSessionIdentifier,c=K3;return await Rv.signJWT(a,i,c,o)}),In(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();let a=this.getPrivateKey(i),c=q.deriveSymKey(a,s);return this.setSymKey(c,o)}),In(this,"setSymKey",async(i,s)=>{this.isInitialized();let o=s||q.hashKey(i);return await this.keychain.set(o,i),o}),In(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),In(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),In(this,"encode",async(i,s,o)=>{this.isInitialized();let a=q.validateEncoding(o),c=H_.safeJsonStringify(s);if(q.isTypeTwoEnvelope(a))return q.encodeTypeTwoEnvelope(c,o?.encoding);if(q.isTypeOneEnvelope(a)){let h=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(h,f)}let l=this.getSymKey(i),{type:u,senderPublicKey:d}=a;return q.encrypt({type:u,symKey:l,message:c,senderPublicKey:d,encoding:o?.encoding})}),In(this,"decode",async(i,s,o)=>{this.isInitialized();let a=q.validateDecoding(s,o);if(q.isTypeTwoEnvelope(a)){let c=q.decodeTypeTwoEnvelope(s,o?.encoding);return H_.safeJsonParse(c)}if(q.isTypeOneEnvelope(a)){let c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{let c=this.getSymKey(i),l=q.decrypt({symKey:c,encoded:s,encoding:o?.encoding});return H_.safeJsonParse(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),In(this,"getPayloadType",(i,s=q.BASE64)=>{let o=q.deserialize({encoded:i,encoding:s});return q.decodeTypeByte(o.type)}),In(this,"getPayloadSenderPublicKey",(i,s=q.BASE64)=>{let o=q.deserialize({encoded:i,encoding:s});return o.senderPublicKey?Fre.toString(o.senderPublicKey,q.BASE16):void 0}),this.core=e,this.logger=Dt.generateChildLogger(n,this.name),this.keychain=r||new Pv(this.core,this.logger)}get context(){return Dt.getLoggerContext(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(K_)}catch{e=q.generateRandomBytes32(),await this.keychain.set(K_,e)}return bse(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Sse=Object.defineProperty,_se=Object.defineProperties,Tse=Object.getOwnPropertyDescriptors,D3=Object.getOwnPropertySymbols,Dse=Object.prototype.hasOwnProperty,Nse=Object.prototype.propertyIsEnumerable,r1=(t,e,n)=>e in t?Sse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xse=(t,e)=>{for(var n in e||(e={}))Dse.call(e,n)&&r1(t,n,e[n]);if(D3)for(var n of D3(e))Nse.call(e,n)&&r1(t,n,e[n]);return t},Rse=(t,e)=>_se(t,Tse(e)),ni=(t,e,n)=>r1(t,typeof e!="symbol"?e+"":e,n),kv=class extends us.IMessageTracker{constructor(e,n){super(e,n),this.logger=e,this.core=n,ni(this,"messages",new Map),ni(this,"messagesWithoutClientAck",new Map),ni(this,"name",Y3),ni(this,"version",J3),ni(this,"initialized",!1),ni(this,"storagePrefix",ls),ni(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);let i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ni(this,"set",async(r,i,s)=>{this.isInitialized();let o=q.hashMessage(i),a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===Dp.inbound){let c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,Rse(xse({},c),{[o]:i}))}return await this.persist(),o}),ni(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),ni(this,"getWithoutAck",r=>{this.isInitialized();let i={};for(let s of r){let o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),ni(this,"has",(r,i)=>{this.isInitialized();let s=this.get(r),o=q.hashMessage(i);return typeof s[o]<"u"}),ni(this,"ack",async(r,i)=>{this.isInitialized();let s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;let o=q.hashMessage(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ni(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=Dt.generateChildLogger(e,this.name),this.core=n}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,q.mapToObj(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,q.mapToObj(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?q.objToMap(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?q.objToMap(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Ose=Object.defineProperty,Pse=Object.defineProperties,Mse=Object.getOwnPropertyDescriptors,N3=Object.getOwnPropertySymbols,kse=Object.prototype.hasOwnProperty,Lse=Object.prototype.propertyIsEnumerable,i1=(t,e,n)=>e in t?Ose(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xd=(t,e)=>{for(var n in e||(e={}))kse.call(e,n)&&i1(t,n,e[n]);if(N3)for(var n of N3(e))Lse.call(e,n)&&i1(t,n,e[n]);return t},x3=(t,e)=>Pse(t,Mse(e)),Ei=(t,e,n)=>i1(t,typeof e!="symbol"?e+"":e,n),s1=class extends us.IPublisher{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Ei(this,"events",new _l.EventEmitter),Ei(this,"name",X3),Ei(this,"queue",new Map),Ei(this,"publishTimeout",Se.toMiliseconds(Se.ONE_MINUTE)),Ei(this,"initialPublishTimeout",Se.toMiliseconds(Se.ONE_SECOND*15)),Ei(this,"needsTransportRestart",!1),Ei(this,"publish",async(r,i,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});let d=s?.ttl||Z3,h=s?.prompt||!1,f=s?.tag||0,p=s?.id||wr.getBigIntRpcId().toString(),g=q.getRelayProtocolApi(q.getRelayProtocolName().protocol),m={id:p,method:s?.publishMethod||g.publish,params:xd({topic:r,message:i,ttl:d,prompt:h,tag:f,attestation:s?.attestation},s?.tvf)},y=`Failed to publish payload, please try again. id:${p} tag:${f}`;try{q.isUndefined((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),q.isUndefined((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);let E=new Promise(async I=>{let L=({id:N})=>{var B;((B=m.id)==null?void 0:B.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(rn.publish,L),I())};this.relayer.events.on(rn.publish,L);let k=q.createExpiringPromise(new Promise((N,B)=>{this.rpcPublish(m,s).then(N).catch(U=>{this.logger.warn(U,U?.message),B(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${f}`);try{await k,this.events.removeListener(rn.publish,L)}catch(N){this.queue.set(p,{request:m,opts:s,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:r,message:i,opts:s}}),await q.createExpiringPromise(E,this.publishTimeout,y)}catch(E){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(E),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw E}finally{this.queue.delete(p)}}),Ei(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});let{payload:l,opts:u={}}=r,{attestation:d,tvf:h,publishMethod:f,prompt:p,tag:g,ttl:m=Se.FIVE_MINUTES}=u,y=u.id||wr.getBigIntRpcId().toString(),E=q.getRelayProtocolApi(q.getRelayProtocolName().protocol),I=f||E.publish,L={id:y,method:I,params:xd(x3(xd({},l),{ttl:m,prompt:p,tag:g,attestation:d}),h)},k=`Failed to publish custom payload, please try again. id:${y} tag:${g}`;try{q.isUndefined((i=L.params)==null?void 0:i.prompt)&&((s=L.params)==null||delete s.prompt),q.isUndefined((o=L.params)==null?void 0:o.tag)&&((a=L.params)==null||delete a.tag);let N=new Promise(async B=>{let U=({id:$})=>{var K;((K=L.id)==null?void 0:K.toString())===$.toString()&&(this.removeRequestFromQueue($),this.relayer.events.removeListener(rn.publish,U),B())};this.relayer.events.on(rn.publish,U);let T=q.createExpiringPromise(new Promise(($,K)=>{this.rpcPublish(L,u).then($).catch(M=>{this.logger.warn(M,M?.message),K(M)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${I} id:${y} tag:${g}`);try{await T,this.events.removeListener(rn.publish,U)}catch($){this.queue.set(y,{request:L,opts:u,attempt:1}),this.logger.warn($,$?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:y,payload:l,opts:u}}),await q.createExpiringPromise(N,this.publishTimeout,k)}catch(N){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(N),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw N}finally{this.queue.delete(y)}}),Ei(this,"on",(r,i)=>{this.events.on(r,i)}),Ei(this,"once",(r,i)=>{this.events.once(r,i)}),Ei(this,"off",(r,i)=>{this.events.off(r,i)}),Ei(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=Dt.generateChildLogger(n,this.name),this.registerEventListeners()}get context(){return Dt.getLoggerContext(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=await this.relayer.request(e);return this.relayer.events.emit(rn.publish,xd(xd({},e),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var r;let i=e.attempt+1;this.queue.set(n,x3(xd({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(rn.connection_stalled);return}this.checkQueue()}),this.relayer.on(rn.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},Fse=Object.defineProperty,Bse=(t,e,n)=>e in t?Fse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rd=(t,e,n)=>Bse(t,typeof e!="symbol"?e+"":e,n),o1=class{constructor(){Rd(this,"map",new Map),Rd(this,"set",(e,n)=>{let r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),Rd(this,"get",e=>this.map.get(e)||[]),Rd(this,"exists",(e,n)=>this.get(e).includes(n)),Rd(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,n))return;let i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Rd(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},Use=Object.defineProperty,jse=Object.defineProperties,Vse=Object.getOwnPropertyDescriptors,R3=Object.getOwnPropertySymbols,Hse=Object.prototype.hasOwnProperty,$se=Object.prototype.propertyIsEnumerable,a1=(t,e,n)=>e in t?Use(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sp=(t,e)=>{for(var n in e||(e={}))Hse.call(e,n)&&a1(t,n,e[n]);if(R3)for(var n of R3(e))$se.call(e,n)&&a1(t,n,e[n]);return t},q_=(t,e)=>jse(t,Vse(e)),Tt=(t,e,n)=>a1(t,typeof e!="symbol"?e+"":e,n),Lv=class extends us.ISubscriber{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Tt(this,"subscriptions",new Map),Tt(this,"topicMap",new o1),Tt(this,"events",new _l.EventEmitter),Tt(this,"name",aj),Tt(this,"version",cj),Tt(this,"pending",new Map),Tt(this,"cached",[]),Tt(this,"initialized",!1),Tt(this,"storagePrefix",ls),Tt(this,"subscribeTimeout",Se.toMiliseconds(Se.ONE_MINUTE)),Tt(this,"initialSubscribeTimeout",Se.toMiliseconds(Se.ONE_SECOND*15)),Tt(this,"clientId"),Tt(this,"batchSubscribeTopicsLimit",500),Tt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Tt(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{let o=q.getRelayProtocolName(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);let c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Tt(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Tt(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Tt(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),Tt(this,"on",(r,i)=>{this.events.on(r,i)}),Tt(this,"once",(r,i)=>{this.events.once(r,i)}),Tt(this,"off",(r,i)=>{this.events.off(r,i)}),Tt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Tt(this,"start",async()=>{await this.onConnect()}),Tt(this,"stop",async()=>{await this.onDisconnect()}),Tt(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Tt(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Tt(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(Br.created,async r=>{let i=Br.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Br.deleted,async r=>{let i=Br.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=Dt.generateChildLogger(n,this.name),this.clientId=""}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){let r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{let i=q.getRelayProtocolName(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);let s=q.getSdkError("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i,s;let o=await this.getSubscriptionId(e);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===Sl.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});let a={method:q.getRelayProtocolApi(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===Sl.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(d=>this.logger.warn(d))},Se.toMiliseconds(Se.ONE_SECOND)),o;let l=new Promise(async d=>{let h=f=>{f.topic===e&&(this.events.removeListener(Br.created,h),d(f.id))};this.events.on(Br.created,h);try{let f=await q.createExpiringPromise(new Promise((p,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Br.created,h),d(f)}catch{}}),u=await q.createExpiringPromise(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(rn.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;let n=e[0].relay,r={method:q.getRelayProtocolApi(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await q.createExpiringPromise(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(rn.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let n=e[0].relay,r={method:q.getRelayProtocolApi(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await q.createExpiringPromise(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(rn.connection_stalled)}return i}rpcUnsubscribe(e,n,r){let i={method:q.getRelayProtocolApi(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,q_(Sp({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Sp({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Sp({},n)),this.topicMap.set(n.topic,e),this.events.emit(Br.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let n=this.subscriptions.get(e);if(!n){let{message:r}=q.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Br.deleted,q_(Sp({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Br.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){let i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Br.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){let{message:n}=q.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>q_(Sp({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await q.sleep(Se.toMiliseconds(Se.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return q.hashMessage(e+await this.getClientId())}},qse=Object.defineProperty,O3=Object.getOwnPropertySymbols,zse=Object.prototype.hasOwnProperty,Gse=Object.prototype.propertyIsEnumerable,c1=(t,e,n)=>e in t?qse(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,P3=(t,e)=>{for(var n in e||(e={}))zse.call(e,n)&&c1(t,n,e[n]);if(O3)for(var n of O3(e))Gse.call(e,n)&&c1(t,n,e[n]);return t},nt=(t,e,n)=>c1(t,typeof e!="symbol"?e+"":e,n),Fv=class extends us.IRelayer{constructor(e){var n;super(e),nt(this,"protocol","wc"),nt(this,"version",2),nt(this,"core"),nt(this,"logger"),nt(this,"events",new _l.EventEmitter),nt(this,"provider"),nt(this,"messages"),nt(this,"subscriber"),nt(this,"publisher"),nt(this,"name",nj),nt(this,"transportExplicitlyClosed",!1),nt(this,"initialized",!1),nt(this,"connectionAttemptInProgress",!1),nt(this,"relayUrl"),nt(this,"projectId"),nt(this,"packageName"),nt(this,"bundleId"),nt(this,"hasExperiencedNetworkDisruption",!1),nt(this,"pingTimeout"),nt(this,"heartBeatTimeout",Se.toMiliseconds(Se.THIRTY_SECONDS+Se.FIVE_SECONDS)),nt(this,"reconnectTimeout"),nt(this,"connectPromise"),nt(this,"reconnectInProgress",!1),nt(this,"requestsInFlight",[]),nt(this,"connectTimeout",Se.toMiliseconds(Se.ONE_SECOND*15)),nt(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");let o=r.id||wr.getBigIntRpcId().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");let a=`${o}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);let c=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),nt(this,"resetPingTimeout",()=>{q.isNode()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),nt(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),nt(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(rn.connect)}),nt(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),nt(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(rn.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),nt(this,"registerProviderListeners",()=>{this.provider.on(ri.payload,this.onPayloadHandler),this.provider.on(ri.connect,this.onConnectHandler),this.provider.on(ri.disconnect,this.onDisconnectHandler),this.provider.on(ri.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=q.createLogger({logger:(n=e.logger)!=null?n:tj,name:this.name}),this.messages=new kv(this.logger,e.core),this.subscriber=new Lv(this,this.logger),this.publisher=new s1(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||g1,q.isAndroid()?this.packageName=q.getAppId():q.isIos()&&(this.bundleId=q.getAppId()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Dt.getLoggerContext(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:Sl.relay},Dp.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish,a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c,l=u=>{u.topic===e&&(this.subscriber.off(Br.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Br.created,l)}),new Promise(async(u,d)=>{a=await this.subscriber.subscribe(e,P3({internal:{throwOnFailedPublish:o}},n)).catch(h=>{o&&d(h)})||a,u()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await q.createExpiringPromise(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await q.isOnline())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(let r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){let{topic:r}=e;if(!n.sessionExists){let i=q.calcExpiry(Se.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(rn.message,e),await this.recordMessageEvent(e,Dp.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{let s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(ri.disconnect,s),await q.createExpiringPromise(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(ri.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ri.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ri.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();let i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,Se.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(q.isNode())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Bre.JsonRpcProvider(new qre.default(q.formatRelayRpcUrl({sdkVersion:Ov,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){let{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){let{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;let i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),wr.isJsonRpcRequest(e)){if(!e.method.endsWith(rj))return;let n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:Sl.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(P3({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else wr.isJsonRpcResponse(e)&&this.events.emit(rn.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Dp.inbound),this.events.emit(rn.message,e))}async acknowledgePayload(e){let n=wr.formatJsonRpcResult(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(ri.payload,this.onPayloadHandler),this.provider.off(ri.connect,this.onConnectHandler),this.provider.off(ri.disconnect,this.onDisconnectHandler),this.provider.off(ri.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await q.isOnline();q.subscribeToNetworkChange(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&q.isAppVisible())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(rn.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},Se.toMiliseconds(ij)))))}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function Kse(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function M3(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function k3(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var Wse="[object RegExp]",Qse="[object String]",Yse="[object Number]",Jse="[object Boolean]",L3="[object Arguments]",Zse="[object Symbol]",Xse="[object Date]",eoe="[object Map]",toe="[object Set]",noe="[object Array]",roe="[object Function]",ioe="[object ArrayBuffer]",z_="[object Object]",soe="[object Error]",ooe="[object DataView]",aoe="[object Uint8Array]",coe="[object Uint8ClampedArray]",loe="[object Uint16Array]",uoe="[object Uint32Array]",doe="[object BigUint64Array]",hoe="[object Int8Array]",foe="[object Int16Array]",poe="[object Int32Array]",goe="[object BigInt64Array]",moe="[object Float32Array]",yoe="[object Float64Array]";function woe(){}function F3(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function voe(t,e,n){return Tp(t,e,void 0,void 0,void 0,void 0,n)}function Tp(t,e,n,r,i,s,o){let a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return xp(t,e,s,o)}return xp(t,e,s,o)}function xp(t,e,n,r){if(Object.is(t,e))return!0;let i=k3(t),s=k3(e);if(i===L3&&(i=z_),s===L3&&(s=z_),i!==s)return!1;switch(i){case Qse:return t.toString()===e.toString();case Yse:{let c=t.valueOf(),l=e.valueOf();return Kse(c,l)}case Jse:case Xse:case Zse:return Object.is(t.valueOf(),e.valueOf());case Wse:return t.source===e.source&&t.flags===e.flags;case roe:return t===e}n=n??new Map;let o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case eoe:{if(t.size!==e.size)return!1;for(let[c,l]of t.entries())if(!e.has(c)||!Tp(l,e.get(c),c,t,e,n,r))return!1;return!0}case toe:{if(t.size!==e.size)return!1;let c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){let d=c[u],h=l.findIndex(f=>Tp(d,f,void 0,t,e,n,r));if(h===-1)return!1;l.splice(h,1)}return!0}case noe:case aoe:case coe:case loe:case uoe:case doe:case hoe:case foe:case poe:case goe:case moe:case yoe:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Tp(t[c],e[c],c,t,e,n,r))return!1;return!0}case ioe:return t.byteLength!==e.byteLength?!1:xp(new Uint8Array(t),new Uint8Array(e),n,r);case ooe:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:xp(new Uint8Array(t),new Uint8Array(e),n,r);case soe:return t.name===e.name&&t.message===e.message;case z_:{if(!(xp(t.constructor,e.constructor,n,r)||F3(t)&&F3(e)))return!1;let c=[...Object.keys(t),...M3(t)],l=[...Object.keys(e),...M3(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){let d=c[u],h=t[d];if(!Object.hasOwn(e,d))return!1;let f=e[d];if(!Tp(h,f,d,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function boe(t,e){return voe(t,e,woe)}var Eoe=Object.defineProperty,B3=Object.getOwnPropertySymbols,Ioe=Object.prototype.hasOwnProperty,Coe=Object.prototype.propertyIsEnumerable,l1=(t,e,n)=>e in t?Eoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,U3=(t,e)=>{for(var n in e||(e={}))Ioe.call(e,n)&&l1(t,n,e[n]);if(B3)for(var n of B3(e))Coe.call(e,n)&&l1(t,n,e[n]);return t},Fr=(t,e,n)=>l1(t,typeof e!="symbol"?e+"":e,n),Bv=class extends us.IStore{constructor(e,n,r,i=ls,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,Fr(this,"map",new Map),Fr(this,"version",sj),Fr(this,"cached",[]),Fr(this,"initialized",!1),Fr(this,"getKey"),Fr(this,"storagePrefix",ls),Fr(this,"recentlyDeleted",[]),Fr(this,"recentlyDeletedLimit",200),Fr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!q.isUndefined(o)?this.map.set(this.getKey(o),o):q.isProposalStruct(o)?this.map.set(o.id,o):q.isSessionStruct(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Fr(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Fr(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Fr(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>boe(a[c],o[c]))):this.values)),Fr(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=U3(U3({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Fr(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Dt.generateChildLogger(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){let{message:i}=q.getInternalError("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}let{message:r}=q.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:n}=q.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Aoe=Object.defineProperty,Soe=(t,e,n)=>e in t?Aoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ge=(t,e,n)=>Soe(t,typeof e!="symbol"?e+"":e,n),Uv=class{constructor(e,n){this.core=e,this.logger=n,Ge(this,"name",lj),Ge(this,"version",uj),Ge(this,"events",new Hre.default),Ge(this,"pairings"),Ge(this,"initialized",!1),Ge(this,"storagePrefix",ls),Ge(this,"ignoredPayloadTypes",[q.TYPE_1]),Ge(this,"registeredMethods",[]),Ge(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Ge(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),Ge(this,"create",async r=>{this.isInitialized();let i=q.generateRandomBytes32(),s=await this.core.crypto.setSymKey(i),o=q.calcExpiry(Se.FIVE_MINUTES),a={protocol:ej},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},l=q.formatUri({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Pd.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:l}}),Ge(this,"pair",async r=>{this.isInitialized();let i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[Hs.pairing_started]}});this.isValidPair(r,i);let{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=q.parseUri(r.uri);i.props.properties.topic=s,i.addTrace(Hs.pairing_uri_validation_success),i.addTrace(Hs.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Hs.existing_pairing),u.active)throw i.setError(Do.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Hs.pairing_not_expired)}let d=c||q.calcExpiry(Se.FIVE_MINUTES),h={topic:s,relay:a,expiry:d,active:!1,methods:l};this.core.expirer.set(s,d),await this.pairings.set(s,h),i.addTrace(Hs.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Pd.create,h),i.addTrace(Hs.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Hs.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Do.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(f){throw i.setError(Do.subscribe_pairing_topic_failure),f}return i.addTrace(Hs.subscribe_pairing_topic_success),h}),Ge(this,"activate",async({topic:r})=>{this.isInitialized();let i=q.calcExpiry(Se.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),Ge(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:i}=r;if(this.pairings.keys.includes(i)){let s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=q.createDelayedPromise();this.events.once(q.engineEvent("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),Ge(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),Ge(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),Ge(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Ge(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);let{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",q.getSdkError("USER_DISCONNECTED")),await this.deletePairing(i))}),Ge(this,"formatUriFromPairing",r=>{this.isInitialized();let{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return q.formatUri({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),Ge(this,"sendRequest",async(r,i,s)=>{let o=wr.formatJsonRpcRequest(i,s),a=await this.core.crypto.encode(r,o),c=Od[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),Ge(this,"sendResult",async(r,i,s)=>{let o=wr.formatJsonRpcResult(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Od[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),Ge(this,"sendError",async(r,i,s)=>{let o=wr.formatJsonRpcError(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Od[c]?Od[c].res:Od.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),Ge(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,q.getSdkError("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),Ge(this,"cleanup",async()=>{let r=this.pairings.getAll().filter(i=>q.isExpired(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),Ge(this,"onRelayEventRequest",async r=>{let{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),Ge(this,"onRelayEventResponse",async r=>{let{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),Ge(this,"onPairingPingRequest",async(r,i)=>{let{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(Pd.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),Ge(this,"onPairingPingResponse",(r,i)=>{let{id:s}=i;setTimeout(()=>{wr.isJsonRpcResult(i)?this.events.emit(q.engineEvent("pairing_ping",s),{}):wr.isJsonRpcError(i)&&this.events.emit(q.engineEvent("pairing_ping",s),{error:i.error})},500)}),Ge(this,"onPairingDeleteRequest",async(r,i)=>{let{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Pd.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),Ge(this,"onUnknownRpcMethodRequest",async(r,i)=>{let{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;let a=q.getSdkError("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),Ge(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(q.getSdkError("WC_METHOD_UNSUPPORTED",r))}),Ge(this,"isValidPair",(r,i)=>{var s;if(!q.isValidParams(r)){let{message:a}=q.getInternalError("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(Do.malformed_pairing_uri),new Error(a)}if(!q.isValidUrl(r.uri)){let{message:a}=q.getInternalError("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(Do.malformed_pairing_uri),new Error(a)}let o=q.parseUri(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){let{message:a}=q.getInternalError("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Do.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=q.getInternalError("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Do.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&Se.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(Do.pairing_expired);let{message:a}=q.getInternalError("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Ge(this,"isValidPing",async r=>{if(!q.isValidParams(r)){let{message:s}=q.getInternalError("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}let{topic:i}=r;await this.isValidPairingTopic(i)}),Ge(this,"isValidDisconnect",async r=>{if(!q.isValidParams(r)){let{message:s}=q.getInternalError("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}let{topic:i}=r;await this.isValidPairingTopic(i)}),Ge(this,"isValidPairingTopic",async r=>{if(!q.isValidString(r,!1)){let{message:i}=q.getInternalError("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){let{message:i}=q.getInternalError("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(q.isExpired(this.pairings.get(r).expiry)){await this.deletePairing(r);let{message:i}=q.getInternalError("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=Dt.generateChildLogger(n,this.name),this.pairings=new Bv(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Dt.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(rn.message,async e=>{let{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==Sl.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let s=await this.core.crypto.decode(n,r);wr.isJsonRpcRequest(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):wr.isJsonRpcResponse(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ci.expired,async e=>{let{topic:n}=q.parseExpirerTarget(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(Pd.expire,{topic:n}))})}},_oe=Object.defineProperty,Toe=(t,e,n)=>e in t?_oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pn=(t,e,n)=>Toe(t,typeof e!="symbol"?e+"":e,n),jv=class extends us.IJsonRpcHistory{constructor(e,n){super(e,n),this.core=e,this.logger=n,Pn(this,"records",new Map),Pn(this,"events",new _l.EventEmitter),Pn(this,"name",dj),Pn(this,"version",hj),Pn(this,"cached",[]),Pn(this,"initialized",!1),Pn(this,"storagePrefix",ls),Pn(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Pn(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;let o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:q.calcExpiry(Se.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ii.created,o)}),Pn(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;let i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=wr.isJsonRpcError(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Ii.updated,i))}),Pn(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Pn(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Ii.deleted,s)}}),this.persist()}),Pn(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Pn(this,"on",(r,i)=>{this.events.on(r,i)}),Pn(this,"once",(r,i)=>{this.events.once(r,i)}),Pn(this,"off",(r,i)=>{this.events.off(r,i)}),Pn(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=Dt.generateChildLogger(n,this.name)}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;let r={topic:n.topic,request:wr.formatJsonRpcRequest(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let n=this.records.get(e);if(!n){let{message:r}=q.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ii.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:n}=q.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ii.created,e=>{let n=Ii.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Ii.updated,e=>{let n=Ii.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Ii.deleted,e=>{let n=Ii.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{Se.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Ii.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Doe=Object.defineProperty,Noe=(t,e,n)=>e in t?Doe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zn=(t,e,n)=>Noe(t,typeof e!="symbol"?e+"":e,n),Vv=class extends us.IExpirer{constructor(e,n){super(e,n),this.core=e,this.logger=n,Zn(this,"expirations",new Map),Zn(this,"events",new _l.EventEmitter),Zn(this,"name",fj),Zn(this,"version",pj),Zn(this,"cached",[]),Zn(this,"initialized",!1),Zn(this,"storagePrefix",ls),Zn(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Zn(this,"has",r=>{try{let i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Zn(this,"set",(r,i)=>{this.isInitialized();let s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ci.created,{target:s,expiration:o})}),Zn(this,"get",r=>{this.isInitialized();let i=this.formatTarget(r);return this.getExpiration(i)}),Zn(this,"del",r=>{if(this.isInitialized(),this.has(r)){let i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Ci.deleted,{target:i,expiration:s})}}),Zn(this,"on",(r,i)=>{this.events.on(r,i)}),Zn(this,"once",(r,i)=>{this.events.once(r,i)}),Zn(this,"off",(r,i)=>{this.events.off(r,i)}),Zn(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=Dt.generateChildLogger(n,this.name)}get context(){return Dt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return q.formatTopicTarget(e);if(typeof e=="number")return q.formatIdTarget(e);let{message:n}=q.getInternalError("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ci.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:n}=q.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let n=this.expirations.get(e);if(!n){let{message:r}=q.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){let{expiry:r}=n;Se.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Ci.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ci.created,e=>{let n=Ci.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Ci.expired,e=>{let n=Ci.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Ci.deleted,e=>{let n=Ci.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=q.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},xoe=Object.defineProperty,Roe=(t,e,n)=>e in t?xoe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,nn=(t,e,n)=>Roe(t,typeof e!="symbol"?e+"":e,n),Hv=class extends us.IVerify{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,nn(this,"name",gj),nn(this,"abortController"),nn(this,"isDevEnv"),nn(this,"verifyUrlV3",yj),nn(this,"storagePrefix",ls),nn(this,"version",p1),nn(this,"publicKey"),nn(this,"fetchPromise"),nn(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&Se.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),nn(this,"register",async i=>{if(!q.isBrowser()||this.isDevEnv)return;let s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{let l=jre.getDocument(),u=this.startAbortTimer(Se.ONE_SECOND*5),d=await new Promise((h,f)=>{let p=()=>{window.removeEventListener("message",m),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);let g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});let m=y=>{if(y.data&&typeof y.data=="string")try{let E=JSON.parse(y.data);if(E.type==="verify_attestation"){if(G_.decodeJWT(E.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),h(E.attestation===null?"":E.attestation)}}catch(E){this.logger.warn(E)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(l){this.logger.warn(l)}return""}),nn(this,"resolve",async i=>{if(this.isDevEnv)return"";let{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(G_.decodeJWT(s).payload.id!==a)return;let l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;let c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),nn(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);let o=this.startAbortTimer(Se.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),nn(this,"getVerifyUrl",i=>{let s=i||Np;return wj.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Np}`),s=Np),s}),nn(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let i=this.startAbortTimer(Se.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),nn(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),nn(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),nn(this,"isValidJwtAttestation",async i=>{let s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),nn(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),nn(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});let i=await this.fetchPromise;return this.fetchPromise=void 0,i}),nn(this,"validateAttestation",(i,s)=>{let o=q.verifyP256Jwt(i,s.publicKey),a={hasExpired:Se.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Dt.generateChildLogger(n,this.name),this.abortController=new AbortController,this.isDevEnv=q.isTestRun(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Dt.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Se.toMiliseconds(e))}},Ooe=Object.defineProperty,Poe=(t,e,n)=>e in t?Ooe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j3=(t,e,n)=>Poe(t,typeof e!="symbol"?e+"":e,n),$v=class extends us.IEchoClient{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,j3(this,"context",vj),j3(this,"registerDeviceToken",async r=>{let{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${bj}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Dt.generateChildLogger(n,this.context)}},Moe=Object.defineProperty,V3=Object.getOwnPropertySymbols,koe=Object.prototype.hasOwnProperty,Loe=Object.prototype.propertyIsEnumerable,u1=(t,e,n)=>e in t?Moe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_p=(t,e)=>{for(var n in e||(e={}))koe.call(e,n)&&u1(t,n,e[n]);if(V3)for(var n of V3(e))Loe.call(e,n)&&u1(t,n,e[n]);return t},Cn=(t,e,n)=>u1(t,typeof e!="symbol"?e+"":e,n),qv=class extends us.IEventClient{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,Cn(this,"context",Ij),Cn(this,"storagePrefix",ls),Cn(this,"storageVersion",Ej),Cn(this,"events",new Map),Cn(this,"shouldPersist",!1),Cn(this,"init",async()=>{if(!q.isTestRun())try{let i={eventId:q.uuidv4(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:q.formatUA(this.core.relayer.protocol,this.core.relayer.version,Ov)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Cn(this,"createEvent",i=>{let{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=q.uuidv4(),u=this.core.projectId||"",d=Date.now(),h=_p({eventId:l,timestamp:d,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,h),this.shouldPersist=!0),h}),Cn(this,"getEvent",i=>{let{eventId:s,topic:o}=i;if(s)return this.events.get(s);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return _p(_p({},a),this.setMethods(a.eventId))}),Cn(this,"deleteEvent",i=>{let{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Cn(this,"setEventListeners",()=>{this.core.heartbeat.on(Tl.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{Se.fromMiliseconds(Date.now())-Se.fromMiliseconds(i.timestamp)>Cj&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Cn(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Cn(this,"addTrace",(i,s)=>{let o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Cn(this,"setError",(i,s)=>{let o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Cn(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Cn(this,"restore",async()=>{try{let i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,_p(_p({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Cn(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let i=[];for(let[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(let s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Cn(this,"sendEvent",async i=>{let s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Aj}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ov}${s}`,{method:"POST",body:JSON.stringify(i)})}),Cn(this,"getAppDomain",()=>q.getAppMetadata().url),this.logger=Dt.generateChildLogger(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},Foe=Object.defineProperty,H3=Object.getOwnPropertySymbols,Boe=Object.prototype.hasOwnProperty,Uoe=Object.prototype.propertyIsEnumerable,d1=(t,e,n)=>e in t?Foe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$3=(t,e)=>{for(var n in e||(e={}))Boe.call(e,n)&&d1(t,n,e[n]);if(H3)for(var n of H3(e))Uoe.call(e,n)&&d1(t,n,e[n]);return t},Lt=(t,e,n)=>d1(t,typeof e!="symbol"?e+"":e,n),zv=class t extends us.ICore{constructor(e){var n;super(e),Lt(this,"protocol",f1),Lt(this,"version",p1),Lt(this,"name",Rp),Lt(this,"relayUrl"),Lt(this,"projectId"),Lt(this,"customStoragePrefix"),Lt(this,"events",new _l.EventEmitter),Lt(this,"logger"),Lt(this,"heartbeat"),Lt(this,"relayer"),Lt(this,"crypto"),Lt(this,"storage"),Lt(this,"history"),Lt(this,"expirer"),Lt(this,"pairing"),Lt(this,"verify"),Lt(this,"echoClient"),Lt(this,"linkModeSupportedApps"),Lt(this,"eventClient"),Lt(this,"initialized",!1),Lt(this,"logChunkController"),Lt(this,"on",(a,c)=>this.events.on(a,c)),Lt(this,"once",(a,c)=>this.events.once(a,c)),Lt(this,"off",(a,c)=>this.events.off(a,c)),Lt(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Lt(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;let u={topic:a,message:c,publishedAt:Date.now(),transportType:Sl.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});let r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||g1,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let i=Dt.getDefaultLoggerOptions({level:typeof e?.logger=="string"&&e.logger?e.logger:q3.logger,name:Rp}),{logger:s,chunkLoggerController:o}=Dt.generatePlatformLogger({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Dt.generateChildLogger(s,this.name),this.heartbeat=new Tl.HeartBeat,this.crypto=new Mv(this,this.logger,e?.keychain),this.history=new jv(this,this.logger),this.expirer=new Vv(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new $re.default($3($3({},z3),e?.storageOptions)),this.relayer=new Fv({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Uv(this,this.logger),this.verify=new Hv(this,this.logger,this.storage),this.echoClient=new $v(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new qv(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let n=new t(e);await n.initialize();let r=await n.crypto.getClientId();return await n.storage.setItem(oj,r),n}get context(){return Dt.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(W_,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(W_)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},joe=zv;ie.CORE_CONTEXT=Rp,ie.CORE_DEFAULT=q3,ie.CORE_PROTOCOL=f1,ie.CORE_STORAGE_OPTIONS=z3,ie.CORE_STORAGE_PREFIX=ls,ie.CORE_VERSION=p1,ie.CRYPTO_CLIENT_SEED=K_,ie.CRYPTO_CONTEXT=G3,ie.CRYPTO_JWT_TTL=K3,ie.Core=joe,ie.Crypto=Mv,ie.ECHO_CONTEXT=vj,ie.ECHO_URL=bj,ie.EVENTS_CLIENT_API_URL=Aj,ie.EVENTS_STORAGE_CLEANUP_INTERVAL=Cj,ie.EVENTS_STORAGE_CONTEXT=Ij,ie.EVENTS_STORAGE_VERSION=Ej,ie.EVENT_CLIENT_AUTHENTICATE_ERRORS=nie,ie.EVENT_CLIENT_AUTHENTICATE_TRACES=tie,ie.EVENT_CLIENT_CONTEXT=Zre,ie.EVENT_CLIENT_PAIRING_ERRORS=Do,ie.EVENT_CLIENT_PAIRING_TRACES=Hs,ie.EVENT_CLIENT_SESSION_ERRORS=eie,ie.EVENT_CLIENT_SESSION_TRACES=Xre,ie.EXPIRER_CONTEXT=fj,ie.EXPIRER_DEFAULT_TTL=Yre,ie.EXPIRER_EVENTS=Ci,ie.EXPIRER_STORAGE_VERSION=pj,ie.EchoClient=$v,ie.EventClient=qv,ie.Expirer=Vv,ie.HISTORY_CONTEXT=dj,ie.HISTORY_EVENTS=Ii,ie.HISTORY_STORAGE_VERSION=hj,ie.JsonRpcHistory=jv,ie.KEYCHAIN_CONTEXT=W3,ie.KEYCHAIN_STORAGE_VERSION=Q3,ie.KeyChain=Pv,ie.MESSAGES_CONTEXT=Y3,ie.MESSAGES_STORAGE_VERSION=J3,ie.MESSAGE_DIRECTION=Dp,ie.MessageTracker=kv,ie.PAIRING_CONTEXT=lj,ie.PAIRING_DEFAULT_TTL=Qre,ie.PAIRING_EVENTS=Pd,ie.PAIRING_RPC_OPTS=Od,ie.PAIRING_STORAGE_VERSION=uj,ie.PENDING_SUB_RESOLUTION_TIMEOUT=Wre,ie.PUBLISHER_CONTEXT=X3,ie.PUBLISHER_DEFAULT_TTL=Z3,ie.Pairing=Uv,ie.RELAYER_CONTEXT=nj,ie.RELAYER_DEFAULT_LOGGER=tj,ie.RELAYER_DEFAULT_PROTOCOL=ej,ie.RELAYER_DEFAULT_RELAY_URL=g1,ie.RELAYER_EVENTS=rn,ie.RELAYER_PROVIDER_EVENTS=ri,ie.RELAYER_RECONNECT_TIMEOUT=ij,ie.RELAYER_SDK_VERSION=Ov,ie.RELAYER_STORAGE_OPTIONS=zre,ie.RELAYER_SUBSCRIBER_SUFFIX=rj,ie.RELAYER_TRANSPORT_CUTOFF=Gre,ie.Relayer=Fv,ie.STORE_STORAGE_VERSION=sj,ie.SUBSCRIBER_CONTEXT=aj,ie.SUBSCRIBER_DEFAULT_TTL=Kre,ie.SUBSCRIBER_EVENTS=Br,ie.SUBSCRIBER_STORAGE_VERSION=cj,ie.Store=Bv,ie.Subscriber=Lv,ie.TRANSPORT_TYPES=Sl,ie.TRUSTED_VERIFY_URLS=wj,ie.VERIFY_CONTEXT=gj,ie.VERIFY_SERVER=Np,ie.VERIFY_SERVER_V3=yj,ie.Verify=Hv,ie.WALLETCONNECT_CLIENT_ID=oj,ie.WALLETCONNECT_LINK_MODE_APPS=W_,ie.default=zv});var Jj=vs(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});var Bj=Ks(),ge=Lj(),Uj=(V_(),Pe(j_)),S=Ap(),Voe=nv(),Xe=Wl(),Fe=(Yl(),Pe(Ql));function Hoe(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var $oe=Hoe(Bj),T1="wc",D1=2,N1="client",Jv=`${T1}@${D1}:${N1}:`,Kv={name:N1,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},qoe={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},zoe={database:":memory:"},y1="WALLETCONNECT_DEEPLINK_CHOICE",Goe={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Koe="history",Woe="0.3",jj="proposal",Qoe=Xe.THIRTY_DAYS,w1="Proposal expired",Vj="session",Dl=Xe.SEVEN_DAYS,Hj="engine",An={wc_sessionPropose:{req:{ttl:Xe.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Xe.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Xe.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Xe.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Xe.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Xe.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Xe.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Xe.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Xe.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Xe.ONE_DAY,prompt:!1,tag:1114},res:{ttl:Xe.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:Xe.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:Xe.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:Xe.FIVE_MINUTES,prompt:!1,tag:1119}}},Wv={min:Xe.FIVE_MINUTES,max:Xe.SEVEN_DAYS},ds={idle:"IDLE",active:"ACTIVE"},$j={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},qj="request",zj=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Gj="wc",Yoe=1.5,Kj="auth",Wj="authKeys",Qj="pairingTopics",Yj="requests",Mp=`${Gj}@${1.5}:${Kj}:`,Pp=`${Mp}:PUB_KEY`,Joe=Object.defineProperty,Zoe=Object.defineProperties,Xoe=Object.getOwnPropertyDescriptors,Fj=Object.getOwnPropertySymbols,eae=Object.prototype.hasOwnProperty,tae=Object.prototype.propertyIsEnumerable,v1=(t,e,n)=>e in t?Joe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ct=(t,e)=>{for(var n in e||(e={}))eae.call(e,n)&&v1(t,n,e[n]);if(Fj)for(var n of Fj(e))tae.call(e,n)&&v1(t,n,e[n]);return t},kn=(t,e)=>Zoe(t,Xoe(e)),Y=(t,e,n)=>v1(t,typeof e!="symbol"?e+"":e,n),b1=class extends Uj.IEngine{constructor(e){super(e),Y(this,"name",Hj),Y(this,"events",new $oe.default),Y(this,"initialized",!1),Y(this,"requestQueue",{state:ds.idle,queue:[]}),Y(this,"sessionRequestQueue",{state:ds.idle,queue:[]}),Y(this,"emittedSessionRequests",new S.LimitedSet({limit:500})),Y(this,"requestQueueDelay",Xe.ONE_SECOND),Y(this,"expectedPairingMethodMap",new Map),Y(this,"recentlyDeletedMap",new Map),Y(this,"recentlyDeletedLimit",200),Y(this,"relayMessageCache",[]),Y(this,"pendingSessions",new Map),Y(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(An)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Xe.toMiliseconds(this.requestQueueDelay)))}),Y(this,"connect",async n=>{var r;this.isInitialized(),await this.confirmOnlineStateOrThrow();let i=kn(ct({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=S.mergeRequiredAndOptionalNamespaces(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};let{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:d,walletPay:h}=i,f=((r=d?.[0])==null?void 0:r.ttl)||An.wc_sessionPropose.req.ttl||Xe.FIVE_MINUTES;this.validateRequestExpiry(f);let p=s,g,m=!1;try{if(p){let T=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),m=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),T}if(!p||!m){let{topic:T,uri:$}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});p=T,g=$}if(!p){let{message:T}=S.getInternalError("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(T)}let y=await this.client.core.crypto.generateKeyPair(),E=S.calcExpiry(f),I=ct(kn(ct(ct({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:ge.RELAYER_DEFAULT_PROTOCOL}],proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:E,pairingTopic:p},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Fe.payloadId()}),(d||h)&&{requests:{authentication:d?.map(T=>{let{domain:$,chains:K,nonce:M,uri:v,exp:b,nbf:w,type:C,statement:x,requestId:F,resources:A,signatureTypes:P}=T;return{domain:$,chains:K,nonce:M,type:C??"caip122",aud:v,version:"1",iat:new Date().toISOString(),exp:b,nbf:w,statement:x,requestId:F,resources:A,signatureTypes:P}}),walletPay:h}}),L=S.engineEvent("session_connect",I.id),{reject:k,resolve:N,done:B}=S.createDelayedPromise(f,w1),U=({id:T})=>{T===I.id&&(this.client.events.off("proposal_expire",U),this.pendingSessions.delete(I.id),this.events.emit(L,{error:{message:w1,code:0}}))};return this.client.events.on("proposal_expire",U),this.events.once(L,({error:T,session:$})=>{this.client.events.off("proposal_expire",U),T?k(T):$&&N($)}),await this.setProposal(I.id,I),await this.sendProposeSession({proposal:I,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:I.id}}}).catch(T=>{throw this.deleteProposal(I.id),T}),{uri:g,approval:B}}),Y(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),Y(this,"approve",async n=>{var r,i,s;let o=this.client.core.eventClient.createEvent({properties:{topic:(r=n?.id)==null?void 0:r.toString(),trace:[ge.EVENT_CLIENT_SESSION_TRACES.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch($){throw o.setError(ge.EVENT_CLIENT_SESSION_ERRORS.no_internet_connection),$}try{await this.isValidProposalId(n?.id)}catch($){throw this.client.logger.error(`approve() -> proposal.get(${n?.id}) failed`),o.setError(ge.EVENT_CLIENT_SESSION_ERRORS.proposal_not_found),$}try{await this.isValidApprove(n)}catch($){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(ge.EVENT_CLIENT_SESSION_ERRORS.session_approve_namespace_validation_failure),$}let{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:d,sessionConfig:h,proposalRequestsResponses:f}=n,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:g,proposer:m,requiredNamespaces:y,optionalNamespaces:E}=p,I=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});I||(I=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:ge.EVENT_CLIENT_SESSION_TRACES.session_approve_started,properties:{topic:g,trace:[ge.EVENT_CLIENT_SESSION_TRACES.session_approve_started,ge.EVENT_CLIENT_SESSION_TRACES.session_namespaces_validation_success]}}));let L=await this.client.core.crypto.generateKeyPair(),k=m.publicKey,N=await this.client.core.crypto.generateSharedKey(L,k),B=kn(ct(ct(ct({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:L,metadata:this.client.metadata},expiry:S.calcExpiry(Dl)},u&&{sessionProperties:u}),d&&{scopedProperties:d}),h&&{sessionConfig:h}),{proposalRequestsResponses:f}),U=ge.TRANSPORT_TYPES.relay;I.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.subscribing_session_topic);try{await this.client.core.relayer.subscribe(N,{transportType:U,internal:{skipSubscribe:!0}})}catch($){throw I.setError(ge.EVENT_CLIENT_SESSION_ERRORS.subscribe_session_topic_failure),$}I.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.subscribe_session_topic_success);let T=kn(ct({},B),{topic:N,requiredNamespaces:y,optionalNamespaces:E,pairingTopic:g,acknowledged:!1,self:B.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:L,transportType:ge.TRANSPORT_TYPES.relay,authentication:f?.authentication,walletPayResult:f?.walletPay});await this.client.session.set(N,T),I.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.store_session);try{await this.sendApproveSession({sessionTopic:N,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:L},sessionSettleRequest:B,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ct({correlationId:a},this.getTVFApproveParams(T))}}),I.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.session_approve_publish_success)}catch($){throw this.client.logger.error($),this.client.session.delete(N,S.getSdkError("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(N),$}return this.client.core.eventClient.deleteEvent({eventId:I.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(N,S.calcExpiry(Dl)),{topic:N,acknowledged:()=>Promise.resolve(this.client.session.get(N))}}),Y(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:r,reason:i}=n,s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:An.wc_sessionPropose.reject}),await this.deleteProposal(r)}),Y(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(d){throw this.client.logger.error("update() -> isValidUpdate() failed"),d}let{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=S.createDelayedPromise(Xe.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Fe.payloadId(),l=Fe.getBigIntRpcId().toString(),u=this.client.session.get(r).namespaces;return this.events.once(S.engineEvent("session_update",c),({error:d})=>{d?a(d):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(d=>{this.client.logger.error(d),this.client.session.update(r,{namespaces:u}),a(d)}),{acknowledged:s}}),Y(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:r}=n,i=Fe.payloadId(),{done:s,resolve:o,reject:a}=S.createDelayedPromise(Xe.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(S.engineEvent("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,S.calcExpiry(Dl)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),Y(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}let{chainId:r,request:i,topic:s,expiry:o=An.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);a?.transportType===ge.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let c=Fe.payloadId(),l=Fe.getBigIntRpcId().toString(),{done:u,resolve:d,reject:h}=S.createDelayedPromise(o,"Request expired. Please try again.");this.events.once(S.engineEvent("session_request",c),({error:m,result:y})=>{m?h(m):d(y)});let f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:f,params:{request:kn(ct({},i),{expiryTimestamp:S.calcExpiry(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>h(m)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await u();let g={request:kn(ct({},i),{expiryTimestamp:S.calcExpiry(o)}),chainId:r};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:f,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(y=>h(y)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),m()}),new Promise(async m=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){let E=await S.getDeepLink(this.client.core.storage,y1);await S.handleDeeplinkRedirect({id:c,topic:s,wcDeepLink:E})}m()}),u()]).then(m=>m[2])}),Y(this,"respond",async n=>{var r,i;this.isInitialized();let s=this.client.core.eventClient.createEvent({properties:{topic:n?.topic||((i=(r=n?.response)==null?void 0:r.id)==null?void 0:i.toString()),trace:[ge.EVENT_CLIENT_SESSION_TRACES.session_request_response_started]}});try{await this.isValidRespond(n)}catch(d){throw s.addTrace(d?.message),s.setError(ge.EVENT_CLIENT_SESSION_ERRORS.session_request_response_validation_failure),d}s.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.session_request_response_validation_success);let{topic:o,response:a}=n,{id:c}=a,l=this.client.session.get(o);l.transportType===ge.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(ge.EVENT_CLIENT_SESSION_TRACES.session_request_response_publish_started),Fe.isJsonRpcResult(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):Fe.isJsonRpcError(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(n)}catch(d){throw s.addTrace(d?.message),s.setError(ge.EVENT_CLIENT_SESSION_ERRORS.session_request_response_publish_failure),d}}),Y(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}let{topic:r}=n;if(this.client.session.keys.includes(r)){let i=Fe.payloadId(),s=Fe.getBigIntRpcId().toString(),{done:o,resolve:a,reject:c}=S.createDelayedPromise(Xe.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(S.engineEvent("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),Y(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);let{topic:r,event:i,chainId:s}=n,o=Fe.getBigIntRpcId().toString(),a=Fe.payloadId();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),Y(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);let{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:S.getSdkError("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{let{message:i}=S.getInternalError("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),Y(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>S.isSessionCompatible(r,n)))),Y(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),Y(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);let s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?ge.TRANSPORT_TYPES.link_mode:ge.TRANSPORT_TYPES.relay;o===ge.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:l,domain:u,nonce:d,type:h,exp:f,nbf:p,methods:g=[],expiry:m}=n,y=[...n.resources||[]],{topic:E,uri:I}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:I}});let L=await this.client.core.crypto.generateKeyPair(),k=S.hashKey(L);if(await Promise.all([this.client.auth.authKeys.set(Pp,{responseTopic:k,publicKey:L}),this.client.auth.pairingTopics.set(k,{topic:k,pairingTopic:E})]),await this.client.core.relayer.subscribe(k,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${E}`),g.length>0){let{namespace:A}=S.parseChainId(a[0]),P=S.createEncodedRecap(A,"request",g);S.getRecapFromResources(y)&&(P=S.mergeEncodedRecaps(P,y.pop())),y.push(P)}let N=m&&m>An.wc_sessionAuthenticate.req.ttl?m:An.wc_sessionAuthenticate.req.ttl,B={authPayload:{type:h??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:d,iat:new Date().toISOString(),exp:f,nbf:p,resources:y},requester:{publicKey:L,metadata:this.client.metadata},expiryTimestamp:S.calcExpiry(N)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},T={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:L,metadata:this.client.metadata},expiryTimestamp:S.calcExpiry(An.wc_sessionPropose.req.ttl),id:Fe.payloadId()},{done:$,resolve:K,reject:M}=S.createDelayedPromise(N,"Request expired"),v=Fe.payloadId(),b=S.engineEvent("session_connect",T.id),w=S.engineEvent("session_request",v),C=async({error:A,session:P})=>{this.events.off(w,x),A?M(A):P&&K({session:P})},x=async A=>{var P,V,j;if(await this.deletePendingAuthRequest(v,{message:"fulfilled",code:0}),A.error){let ne=S.getSdkError("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===ne.code?void 0:(this.events.off(b,C),M(A.error.message))}await this.deleteProposal(T.id),this.events.off(b,C);let{cacaos:oe,responder:X}=A.result,Q=[],ae=[];for(let ne of oe){await S.validateSignedCacao({cacao:ne,projectId:this.client.core.projectId})||(this.client.logger.error(ne,"Signature verification failed"),M(S.getSdkError("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:be}=ne,Ot=S.getRecapFromResources(be.resources),vt=[S.getNamespacedDidChainId(be.iss)],$t=S.getDidAddress(be.iss);if(Ot){let pn=S.getMethodsFromRecap(Ot),Gl=S.getChainsFromRecap(Ot);Q.push(...pn),vt.push(...Gl)}for(let pn of vt)ae.push(`${pn}:${$t}`)}let ee=await this.client.core.crypto.generateSharedKey(L,X.publicKey),we;Q.length>0&&(we={topic:ee,acknowledged:!0,self:{publicKey:L,metadata:this.client.metadata},peer:X,controller:X.publicKey,expiry:S.calcExpiry(Dl),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:S.buildNamespacesFromAuth([...new Set(Q)],[...new Set(ae)]),transportType:o},await this.client.core.relayer.subscribe(ee,{transportType:o}),await this.client.session.set(ee,we),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:X.metadata}),we=this.client.session.get(ee)),(P=this.client.metadata.redirect)!=null&&P.linkMode&&(V=X.metadata.redirect)!=null&&V.linkMode&&(j=X.metadata.redirect)!=null&&j.universal&&r&&(this.client.core.addLinkModeSupportedApp(X.metadata.redirect.universal),this.client.session.update(ee,{transportType:ge.TRANSPORT_TYPES.link_mode})),K({auths:oe,session:we})};this.events.once(b,C),this.events.once(w,x);let F;try{if(s){let A=Fe.formatJsonRpcRequest("wc_sessionAuthenticate",B,v);this.client.core.history.set(E,A);let P=await this.client.core.crypto.encode("",A,{type:S.TYPE_2,encoding:S.BASE64URL});F=S.getLinkModeURL(r,E,P)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:B,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:v}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:T,expiry:An.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(A){throw this.events.off(b,C),this.events.off(w,x),A}return await this.setProposal(T.id,T),await this.setAuthRequest(v,{request:kn(ct({},B),{verifyContext:{}}),pairingTopic:E,transportType:o}),{uri:F??I,response:$}}),Y(this,"approveSessionAuthenticate",async n=>{let{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[ge.EVENT_CLIENT_AUTHENTICATE_TRACES.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(ge.EVENT_CLIENT_AUTHENTICATE_ERRORS.no_internet_connection),m}let o=this.getPendingAuthRequest(r);if(!o)throw s.setError(ge.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);let a=o.transportType||ge.TRANSPORT_TYPES.relay;a===ge.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=S.hashKey(c),d={type:S.TYPE_1,receiverPublicKey:c,senderPublicKey:l},h=[],f=[];for(let m of i){if(!await S.validateSignedCacao({cacao:m,projectId:this.client.core.projectId})){s.setError(ge.EVENT_CLIENT_AUTHENTICATE_ERRORS.invalid_cacao);let k=S.getSdkError("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:k,encodeOpts:d}),new Error(k.message)}s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.cacaos_verified);let{p:y}=m,E=S.getRecapFromResources(y.resources),I=[S.getNamespacedDidChainId(y.iss)],L=S.getDidAddress(y.iss);if(E){let k=S.getMethodsFromRecap(E),N=S.getChainsFromRecap(E);h.push(...k),I.push(...N)}for(let k of I)f.push(`${k}:${L}`)}let p=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.create_authenticated_session_topic);let g;if(h?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:S.calcExpiry(Dl),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:S.buildNamespacesFromAuth([...new Set(h)],[...new Set(f)]),transportType:a},s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw s.setError(ge.EVENT_CLIENT_AUTHENTICATE_ERRORS.subscribe_authenticated_session_topic_failure),m}s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(ge.EVENT_CLIENT_AUTHENTICATE_TRACES.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(ge.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),Y(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();let{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===ge.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=S.hashKey(o),l={type:S.TYPE_1,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:An.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),Y(this,"formatAuthMessage",n=>{this.isInitialized();let{request:r,iss:i}=n;return S.formatMessage(r,i)}),Y(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),Y(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{let r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),Y(this,"deleteSession",async n=>{var r;let{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,S.getSdkError("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(y1).catch(l=>this.client.logger.warn(l)),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=ds.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===i).map(l=>this.deletePendingSessionRequest(l.id,S.getSdkError("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),Y(this,"deleteProposal",async(n,r)=>{if(r)try{let i=this.client.proposal.get(n);this.client.core.eventClient.getEvent({topic:i.pairingTopic})?.setError(ge.EVENT_CLIENT_SESSION_ERRORS.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,S.getSdkError("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),Y(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=ds.idle,this.client.events.emit("session_request_expire",{id:n}))}),Y(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),Y(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),Y(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,S.calcExpiry(An.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),Y(this,"setAuthRequest",async(n,r)=>{let{request:i,pairingTopic:s,transportType:o=ge.TRANSPORT_TYPES.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),Y(this,"setPendingSessionRequest",async n=>{let{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||S.calcExpiry(An.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),Y(this,"sendRequest",async n=>{let{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:d,publishOpts:h={}}=n,f=Fe.formatJsonRpcRequest(i,s,c),p,g=!!u;try{let E=g?S.BASE64URL:S.BASE64;p=await this.client.core.crypto.encode(r,f,{encoding:E})}catch(E){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),E}let m;if(zj.includes(i)){let E=S.hashMessage(JSON.stringify(f)),I=S.hashMessage(p);m=await this.client.core.verify.register({id:I,decryptedId:E})}let y=ct(ct({},An[i].req),h);if(y.attestation=m,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(r,f),g){let E=S.getLinkModeURL(u,r,p);await global.Linking.openURL(E,this.client.name)}else y.tvf=kn(ct({},d),{correlationId:f.id}),l?(y.internal=kn(ct({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,p,y)):this.client.core.relayer.publish(r,p,y).catch(E=>this.client.logger.error(E));return f.id}),Y(this,"sendProposeSession",async n=>{let{proposal:r,publishOpts:i}=n,s=Fe.formatJsonRpcRequest("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,s);let o=await this.client.core.crypto.encode(r.pairingTopic,s,{encoding:S.BASE64}),a=S.hashMessage(JSON.stringify(s)),c=S.hashMessage(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:kn(ct({},i),{publishMethod:"wc_proposeSession",attestation:l})})}),Y(this,"sendApproveSession",async n=>{let{sessionTopic:r,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=n,c=Fe.formatJsonRpcResult(s.id,i),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:S.BASE64}),u=Fe.formatJsonRpcRequest("wc_sessionSettle",o,a?.id),d=await this.client.core.crypto.encode(r,u,{encoding:S.BASE64});this.client.core.history.set(r,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:d},opts:kn(ct({},a),{publishMethod:"wc_approveSession"})})}),Y(this,"sendResult",async n=>{let{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,l=Fe.formatJsonRpcResult(r,s),u,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=d?S.BASE64URL:S.BASE64;u=await this.client.core.crypto.encode(i,l,kn(ct({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),p}let h,f;try{h=await this.client.core.history.get(i,r);let p=h.request;try{f=this.getTVFParams(r,p.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),p}if(d){let p=S.getLinkModeURL(c,i,u);await global.Linking.openURL(p,this.client.name)}else{let p=h.request.method,g=An[p].res;g.tvf=kn(ct({},f),{correlationId:r}),o?(g.internal=kn(ct({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,g)):this.client.core.relayer.publish(i,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),Y(this,"sendError",async n=>{let{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,l=Fe.formatJsonRpcError(r,s),u,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let f=d?S.BASE64URL:S.BASE64;u=await this.client.core.crypto.encode(i,l,kn(ct({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let h;try{h=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(d){let f=S.getLinkModeURL(c,i,u);await global.Linking.openURL(f,this.client.name)}else{let f=h.request.method,p=a||An[f].res;this.client.core.relayer.publish(i,u,p)}await this.client.core.history.resolve(l)}),Y(this,"cleanup",async()=>{let n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;S.isExpired(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{S.isExpired(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),Y(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),Y(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),Y(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ds.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ds.active;let n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=ds.idle}),Y(this,"processRequest",async n=>{let{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),Y(this,"onRelayEventResponse",async n=>{let{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),Y(this,"onRelayEventUnknownPayload",n=>{let{topic:r}=n,{message:i}=S.getInternalError("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),Y(this,"shouldIgnorePairingRequest",n=>{let{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),Y(this,"onSessionProposeRequest",async n=>{let{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{let l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(ge.EVENT_CLIENT_PAIRING_ERRORS.proposal_listener_not_found)),this.isValidConnect(ct({},i.params));let u=a.expiryTimestamp||S.calcExpiry(An.wc_sessionPropose.req.ttl),d=ct({id:c,pairingTopic:r,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,d);let h=await this.getVerifyContext({attestationId:s,hash:S.hashMessage(JSON.stringify(i)),encryptedId:o,metadata:d.proposer.metadata});l?.addTrace(ge.EVENT_CLIENT_PAIRING_TRACES.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:h})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:An.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),Y(this,"onSessionProposeResponse",async(n,r,i)=>{let{id:s}=r;if(Fe.isJsonRpcResult(r)){let{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});let u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:n,proposalId:s,publicKey:c});let d=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:n})}else if(Fe.isJsonRpcError(r)){await this.deleteProposal(s);let o=S.engineEvent("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),Y(this,"onSessionSettleRequest",async(n,r)=>{let{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);let{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:d,sessionConfig:h,proposalRequestsResponses:f}=r.params,p=[...this.pendingSessions.values()].find(y=>y.sessionTopic===n);if(!p)return this.client.logger.error(`Pending session not found for topic ${n}`);let g=this.client.proposal.get(p.proposalId),m=kn(ct(ct(ct({topic:n,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),d&&{scopedProperties:d}),h&&{sessionConfig:h}),{transportType:ge.TRANSPORT_TYPES.relay,authentication:f?.authentication,walletPayResult:f?.walletPay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:m.peer.metadata}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:r.id,topic:n,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:m}),this.events.emit(S.engineEvent("session_connect",p.proposalId),{session:m})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),Y(this,"onSessionSettleResponse",async(n,r)=>{let{id:i}=r;Fe.isJsonRpcResult(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(S.engineEvent("session_approve",i),{})):Fe.isJsonRpcError(r)&&(await this.client.session.delete(n,S.getSdkError("USER_DISCONNECTED")),this.events.emit(S.engineEvent("session_approve",i),{error:r.error}))}),Y(this,"onSessionUpdateRequest",async(n,r)=>{let{params:i,id:s}=r;try{let o=`${n}_session_update`,a=S.MemoryStore.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:S.getSdkError("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ct({topic:n},i));try{S.MemoryStore.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw S.MemoryStore.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),Y(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),Y(this,"onSessionUpdateResponse",(n,r)=>{let{id:i}=r,s=S.engineEvent("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Fe.isJsonRpcResult(r)?this.events.emit(S.engineEvent("session_update",i),{}):Fe.isJsonRpcError(r)&&this.events.emit(S.engineEvent("session_update",i),{error:r.error})}),Y(this,"onSessionExtendRequest",async(n,r)=>{let{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,S.calcExpiry(Dl)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),Y(this,"onSessionExtendResponse",(n,r)=>{let{id:i}=r,s=S.engineEvent("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Fe.isJsonRpcResult(r)?this.events.emit(S.engineEvent("session_extend",i),{}):Fe.isJsonRpcError(r)&&this.events.emit(S.engineEvent("session_extend",i),{error:r.error})}),Y(this,"onSessionPingRequest",async(n,r)=>{let{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),Y(this,"onSessionPingResponse",(n,r)=>{let{id:i}=r,s=S.engineEvent("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Fe.isJsonRpcResult(r)?this.events.emit(S.engineEvent("session_ping",i),{}):Fe.isJsonRpcError(r)&&this.events.emit(S.engineEvent("session_ping",i),{error:r.error})},500)}),Y(this,"onSessionDeleteRequest",async(n,r)=>{let{id:i}=r;try{await this.isValidDisconnect({topic:n,reason:r.params}),this.cleanupPendingSentRequestsForTopic({topic:n,error:S.getSdkError("USER_DISCONNECTED")}),await this.deleteSession({topic:n,id:i})}catch(s){this.client.logger.error(s)}}),Y(this,"onSessionRequest",async n=>{var r,i,s;let{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=n,{id:d,params:h}=a;try{await this.isValidRequest(ct({topic:o},h));let f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:S.hashMessage(JSON.stringify(Fe.formatJsonRpcRequest("wc_sessionRequest",h,d))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),g={id:d,topic:o,params:h,verifyContext:p};await this.setPendingSessionRequest(g),u===ge.TRANSPORT_TYPES.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:d,topic:o,error:f}),this.client.logger.error(f)}}),Y(this,"onSessionRequestResponse",(n,r)=>{let{id:i}=r,s=S.engineEvent("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Fe.isJsonRpcResult(r)?this.events.emit(S.engineEvent("session_request",i),{result:r.result}):Fe.isJsonRpcError(r)&&this.events.emit(S.engineEvent("session_request",i),{error:r.error})}),Y(this,"onSessionEventRequest",async(n,r)=>{let{id:i,params:s}=r;try{let o=`${n}_session_event_${s.event.name}`,a=S.MemoryStore.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(ct({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),S.MemoryStore.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),Y(this,"onSessionAuthenticateResponse",(n,r)=>{let{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),Fe.isJsonRpcResult(r)?this.events.emit(S.engineEvent("session_request",i),{result:r.result}):Fe.isJsonRpcError(r)&&this.events.emit(S.engineEvent("session_request",i),{error:r.error})}),Y(this,"onSessionAuthenticateRequest",async n=>{var r;let{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{let{requester:l,authPayload:u,expiryTimestamp:d}=s.params,h=await this.getVerifyContext({attestationId:o,hash:S.hashMessage(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:i,id:s.id,authPayload:u,verifyContext:h,expiryTimestamp:d};await this.setAuthRequest(s.id,{request:f,pairingTopic:i,transportType:c}),c===ge.TRANSPORT_TYPES.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:h})}catch(l){this.client.logger.error(l);let u=s.params.requester.publicKey,d=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(s.params.requester.metadata,c),f={type:S.TYPE_1,receiverPublicKey:u,senderPublicKey:d};await this.sendError({id:s.id,topic:i,error:l,encodeOpts:f,rpcOpts:An.wc_sessionAuthenticate.autoReject,appLink:h})}}),Y(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),Y(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ds.idle,this.processSessionRequestQueue()},Xe.toMiliseconds(this.requestQueueDelay))}),Y(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{let i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(S.engineEvent("session_request",s.request.id),{error:r})})}),Y(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ds.active){this.client.logger.info("session request queue is already active.");return}let n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),Y(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=ds.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),Y(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;let r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:Fe.formatJsonRpcRequest("wc_sessionPropose",kn(ct({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),Y(this,"isValidConnect",async n=>{if(!S.isValidParams(n)){let{message:l}=S.getInternalError("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(l)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(S.isUndefined(r)||await this.isValidPairingTopic(r),!S.isValidRelays(c,!0)){let{message:l}=S.getInternalError("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(i&&!S.isUndefined(i)&&S.isValidObject(i)!==0){let l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!S.isUndefined(s)&&S.isValidObject(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!S.isUndefined(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!S.isUndefined(a)){this.validateSessionProps(a,"scopedProperties");let l=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),Y(this,"validateNamespaces",(n,r)=>{let i=S.isValidRequiredNamespaces(n,"connect()",r);if(i)throw new Error(i.message)}),Y(this,"isValidApprove",async n=>{if(!S.isValidParams(n))throw new Error(S.getInternalError("MISSING_OR_INVALID",`approve() params: ${n}`).message);let{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);let c=this.client.proposal.get(r),l=S.isValidNamespaces(i,"approve()");if(l)throw new Error(l.message);let u=S.isConformingNamespaces(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!S.isValidString(s,!0)){let{message:d}=S.getInternalError("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(d)}if(o&&!S.isUndefined(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!S.isUndefined(a)){this.validateSessionProps(a,"scopedProperties");let d=new Set(Object.keys(i));if(!Object.keys(a).every(h=>d.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(d).join(", ")}`)}}),Y(this,"isValidReject",async n=>{if(!S.isValidParams(n)){let{message:s}=S.getInternalError("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}let{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!S.isValidErrorReason(i)){let{message:s}=S.getInternalError("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),Y(this,"isValidSessionSettleRequest",n=>{if(!S.isValidParams(n)){let{message:l}=S.getInternalError("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(l)}let{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!S.isValidRelay(r)){let{message:l}=S.getInternalError("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}let a=S.isValidController(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=S.isValidNamespaces(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(S.isExpired(o)){let{message:l}=S.getInternalError("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),Y(this,"isValidUpdate",async n=>{if(!S.isValidParams(n)){let{message:c}=S.getInternalError("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}let{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);let s=this.client.session.get(r),o=S.isValidNamespaces(i,"update()");if(o)throw new Error(o.message);let a=S.isConformingNamespaces(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),Y(this,"isValidExtend",async n=>{if(!S.isValidParams(n)){let{message:i}=S.getInternalError("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}let{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),Y(this,"isValidRequest",async n=>{if(!S.isValidParams(n)){let{message:c}=S.getInternalError("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}let{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);let{namespaces:a}=this.client.session.get(r);if(!S.isValidNamespacesChainId(a,s)){let{message:c}=S.getInternalError("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!S.isValidRequest(i)){let{message:c}=S.getInternalError("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!S.isValidNamespacesRequest(a,s,i.method)){let{message:c}=S.getInternalError("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),Y(this,"isValidRespond",async n=>{var r;if(!S.isValidParams(n)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(a)}let{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(a){throw(r=n?.response)!=null&&r.id&&this.cleanupAfterResponse(n),a}if(!S.isValidResponse(s)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}let o=this.client.pendingRequest.get(s.id);if(o.topic!==i){let{message:a}=S.getInternalError("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),Y(this,"isValidPing",async n=>{if(!S.isValidParams(n)){let{message:i}=S.getInternalError("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}let{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),Y(this,"isValidEmit",async n=>{if(!S.isValidParams(n)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}let{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);let{namespaces:o}=this.client.session.get(r);if(!S.isValidNamespacesChainId(o,s)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!S.isValidEvent(i)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!S.isValidNamespacesEvent(o,s,i.name)){let{message:a}=S.getInternalError("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),Y(this,"isValidDisconnect",async n=>{if(!S.isValidParams(n)){let{message:i}=S.getInternalError("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}let{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),Y(this,"isValidAuthenticate",n=>{let{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!S.isValidString(i,!1))throw new Error("uri is required parameter");if(!S.isValidString(s,!1))throw new Error("domain is required parameter");if(!S.isValidString(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>S.parseChainId(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=S.parseChainId(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),Y(this,"getVerifyContext",async n=>{let{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||ge.VERIFY_SERVER,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ge.TRANSPORT_TYPES.link_mode){let u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}let l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),Y(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){let{message:o}=S.getInternalError("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),Y(this,"getPendingAuthRequest",n=>{let r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),Y(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0,s=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),Y(this,"checkRecentlyDeleted",n=>{let r=this.recentlyDeletedMap.get(n);if(r){let{message:i}=S.getInternalError("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),Y(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,l,u,d,h;return!n||r!==ge.TRANSPORT_TYPES.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=n?.redirect)==null?void 0:u.universal)!==void 0&&((d=n?.redirect)==null?void 0:d.universal)!==""&&((h=n?.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),Y(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n?.redirect)==null?void 0:i.universal:void 0}),Y(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;let r=S.getSearchParamFromURL(n,"topic")||"",i=decodeURIComponent(S.getSearchParamFromURL(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:ge.TRANSPORT_TYPES.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),Y(this,"registerLinkModeListeners",async()=>{var n;if(S.isTestRun()||S.isReactNative()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){let r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);let i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),Y(this,"getTVFApproveParams",n=>{try{let r=S.getNamespacesChains(n.namespaces),i=S.getNamespacesMethods(n.namespaces),s=S.getNamespacesEvents(n.namespaces),o=n.sessionProperties,a=n.scopedProperties;return{approvedChains:r,approvedMethods:i,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(r){return this.client.logger.warn(r,"Error getting TVF approve params"),{}}}),Y(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};let c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{let l=this.extractTxHashesFromResult(r.request,i);c.txHashes=l,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),Y(this,"isValidContractData",n=>{var r;if(!n)return!1;try{let i=n?.data||((r=n?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;let s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),Y(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];let s=n.method,o=$j[s];if(s==="sui_signTransaction")return[S.getSuiDigest(r.transactionBytes)];if(s==="near_signTransaction")return[S.getNearTransactionIdFromSignedTransaction(r)];if(s==="near_signTransactions")return r.map(c=>S.getNearTransactionIdFromSignedTransaction(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[S.buildSignedExtrinsicHash({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return S.isValidArray(r)?r.map(c=>S.getAlgorandTransactionId(c)):[S.getAlgorandTransactionId(r)];if(s==="cosmos_signDirect")return[S.getSignDirectHash(r)];if(s==="wallet_sendCalls")return S.getWalletSendCallsHashes(r);if(typeof r=="string")return[r];let a=r[o.key];if(S.isValidArray(a))return s==="solana_signAllTransactions"?a.map(c=>S.extractSolanaTransactionId(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(let[r,i]of Object.entries(n))for(let s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=S.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ge.RELAYER_EVENTS.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Pp)?this.client.auth.authKeys.get(Pp):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===ge.TRANSPORT_TYPES.link_mode?S.BASE64URL:S.BASE64});Fe.isJsonRpcRequest(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:S.hashMessage(r)})):Fe.isJsonRpcResponse(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${r}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ge.EXPIRER_EVENTS.expired,async e=>{let{topic:n,id:r}=S.parseExpirerTarget(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,S.getInternalError("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,S.getInternalError("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(ge.PAIRING_EVENTS.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ge.PAIRING_EVENTS.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!S.isValidString(e,!1)){let{message:n}=S.getInternalError("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:n}=S.getInternalError("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(S.isExpired(this.client.core.pairing.pairings.get(e).expiry)){let{message:n}=S.getInternalError("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!S.isValidString(e,!1)){let{message:n}=S.getInternalError("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:n}=S.getInternalError("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(S.isExpired(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:n}=S.getInternalError("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){let{message:n}=S.getInternalError("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(S.isValidString(e,!1)){let{message:n}=S.getInternalError("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{let{message:n}=S.getInternalError("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!S.isValidId(e)){let{message:n}=S.getInternalError("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){let{message:n}=S.getInternalError("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(S.isExpired(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:n}=S.getInternalError("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}validateRequestExpiry(e){if(e&&!S.isValidRequestExpiry(e,Wv)){let{message:n}=S.getInternalError("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Wv.min} and ${Wv.max}`);throw new Error(n)}}},E1=class extends ge.Store{constructor(e,n){super(e,n,jj,Jv),this.core=e,this.logger=n}},Qv=class extends ge.Store{constructor(e,n){super(e,n,Vj,Jv),this.core=e,this.logger=n}},I1=class extends ge.Store{constructor(e,n){super(e,n,qj,Jv,r=>r.id),this.core=e,this.logger=n}},C1=class extends ge.Store{constructor(e,n){super(e,n,Wj,Mp,()=>Pp),this.core=e,this.logger=n}},A1=class extends ge.Store{constructor(e,n){super(e,n,Qj,Mp),this.core=e,this.logger=n}},S1=class extends ge.Store{constructor(e,n){super(e,n,Yj,Mp,r=>r.id),this.core=e,this.logger=n}},nae=Object.defineProperty,rae=(t,e,n)=>e in t?nae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m1=(t,e,n)=>rae(t,typeof e!="symbol"?e+"":e,n),_1=class{constructor(e,n){this.core=e,this.logger=n,m1(this,"authKeys"),m1(this,"pairingTopics"),m1(this,"requests"),this.authKeys=new C1(this.core,this.logger),this.pairingTopics=new A1(this.core,this.logger),this.requests=new S1(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},iae=Object.defineProperty,sae=(t,e,n)=>e in t?iae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ke=(t,e,n)=>sae(t,typeof e!="symbol"?e+"":e,n),Yv=class t extends Uj.ISignClient{constructor(e){super(e),Ke(this,"protocol",T1),Ke(this,"version",D1),Ke(this,"name",Kv.name),Ke(this,"metadata"),Ke(this,"core"),Ke(this,"logger"),Ke(this,"events",new Bj.EventEmitter),Ke(this,"engine"),Ke(this,"session"),Ke(this,"proposal"),Ke(this,"pendingRequest"),Ke(this,"auth"),Ke(this,"signConfig"),Ke(this,"on",(r,i)=>this.events.on(r,i)),Ke(this,"once",(r,i)=>this.events.once(r,i)),Ke(this,"off",(r,i)=>this.events.off(r,i)),Ke(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),Ke(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),Ke(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),Ke(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),Ke(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),Ke(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||Kv.name,this.metadata=S.populateAppMetadata(e?.metadata),this.signConfig=e?.signConfig;let n=S.createLogger({logger:e?.logger||Kv.logger,name:this.name});this.logger=n,this.core=e?.core||new ge.Core(e),this.session=new Qv(this.core,this.logger),this.proposal=new E1(this.core,this.logger),this.pendingRequest=new I1(this.core,this.logger),this.engine=new b1(this),this.auth=new _1(this.core,this.logger)}static async init(e){let n=new t(e);return await n.initialize(),n}get context(){return Voe.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}},oae=Qv,aae=Yv;Ve.AUTH_CONTEXT=Kj,Ve.AUTH_KEYS_CONTEXT=Wj,Ve.AUTH_PAIRING_TOPIC_CONTEXT=Qj,Ve.AUTH_PROTOCOL=Gj,Ve.AUTH_PUBLIC_KEY_NAME=Pp,Ve.AUTH_REQUEST_CONTEXT=Yj,Ve.AUTH_STORAGE_PREFIX=Mp,Ve.AUTH_VERSION=Yoe,Ve.ENGINE_CONTEXT=Hj,Ve.ENGINE_QUEUE_STATES=ds,Ve.ENGINE_RPC_OPTS=An,Ve.HISTORY_CONTEXT=Koe,Ve.HISTORY_EVENTS=Goe,Ve.HISTORY_STORAGE_VERSION=Woe,Ve.METHODS_TO_VERIFY=zj,Ve.PROPOSAL_CONTEXT=jj,Ve.PROPOSAL_EXPIRY=Qoe,Ve.PROPOSAL_EXPIRY_MESSAGE=w1,Ve.REQUEST_CONTEXT=qj,Ve.SESSION_CONTEXT=Vj,Ve.SESSION_EXPIRY=Dl,Ve.SESSION_REQUEST_EXPIRY_BOUNDARIES=Wv,Ve.SIGN_CLIENT_CONTEXT=N1,Ve.SIGN_CLIENT_DEFAULT=Kv,Ve.SIGN_CLIENT_EVENTS=qoe,Ve.SIGN_CLIENT_PROTOCOL=T1,Ve.SIGN_CLIENT_STORAGE_OPTIONS=zoe,Ve.SIGN_CLIENT_STORAGE_PREFIX=Jv,Ve.SIGN_CLIENT_VERSION=D1,Ve.SessionStore=oae,Ve.SignClient=aae,Ve.TVF_METHODS=$j,Ve.WALLETCONNECT_DEEPLINK_CHOICE=y1,Ve.default=Yv});var O8=vs(rb=>{"use strict";Object.defineProperty(rb,"__esModule",{value:!0});var cae=Jj(),mt=Ap(),H1=(Yl(),Pe(Ql)),y8=(wg(),Pe(yg)),w8=(XN(),Pe(ZN)),lae=Ks();function v8(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var uae=v8(w8),dae=v8(lae);function $1(t){return t==null||typeof t!="object"&&typeof t!="function"}function b8(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function E8(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var hae="[object RegExp]",I8="[object String]",C8="[object Number]",A8="[object Boolean]",S8="[object Arguments]",fae="[object Symbol]",pae="[object Date]",gae="[object Map]",mae="[object Set]",yae="[object Array]",wae="[object ArrayBuffer]",vae="[object Object]",bae="[object DataView]",Eae="[object Uint8Array]",Iae="[object Uint8ClampedArray]",Cae="[object Uint16Array]",Aae="[object Uint32Array]",Sae="[object Int8Array]",_ae="[object Int16Array]",Tae="[object Int32Array]",Dae="[object Float32Array]",Nae="[object Float64Array]";function q1(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function xae(t,e){return kd(t,void 0,t,new Map,e)}function kd(t,e,n,r=new Map,i=void 0){let s=i?.(t,e,n,r);if(s!=null)return s;if($1(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){let o=new Array(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=kd(t[a],a,n,r,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){let o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){let o=new Map;r.set(t,o);for(let[a,c]of t)o.set(a,kd(c,a,n,r,i));return o}if(t instanceof Set){let o=new Set;r.set(t,o);for(let a of t)o.add(kd(a,void 0,n,r,i));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(q1(t)){let o=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=kd(t[a],a,n,r,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){let o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,o),xl(o,t,n,r,i),o}if(typeof File<"u"&&t instanceof File){let o=new File([t],t.name,{type:t.type});return r.set(t,o),xl(o,t,n,r,i),o}if(t instanceof Blob){let o=new Blob([t],{type:t.type});return r.set(t,o),xl(o,t,n,r,i),o}if(t instanceof Error){let o=new t.constructor;return r.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,xl(o,t,n,r,i),o}if(typeof t=="object"&&Rae(t)){let o=Object.create(Object.getPrototypeOf(t));return r.set(t,o),xl(o,t,n,r,i),o}return t}function xl(t,e,n=t,r,i){let s=[...Object.keys(e),...b8(e)];for(let o=0;o<s.length;o++){let a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=kd(e[a],a,n,r,i))}}function Rae(t){switch(E8(t)){case S8:case yae:case wae:case bae:case A8:case pae:case Dae:case Nae:case Sae:case _ae:case Tae:case gae:case C8:case vae:case hae:case mae:case I8:case fae:case Eae:case Iae:case Cae:case Aae:return!0;default:return!1}}function Oae(t,e){return xae(t,(n,r,i,s)=>{let o=e?.(n,r,i,s);if(o!=null)return o;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case C8:case I8:case A8:{let a=new t.constructor(t?.valueOf());return xl(a,t),a}case S8:{let a={};return xl(a,t),a.length=t.length,a[Symbol.iterator]=t[Symbol.iterator],a}default:return}})}function Zj(t){return Oae(t)}function Xj(t){return t!==null&&typeof t=="object"&&E8(t)==="[object Arguments]"}function e8(t){return typeof t=="object"&&t!==null}function Pae(){}function Mae(t){return q1(t)}function kae(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){let n=t[Symbol.toStringTag];return n==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function Lae(t){if($1(t))return t;if(Array.isArray(t)||q1(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);let e=Object.getPrototypeOf(t),n=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new n(t);if(t instanceof RegExp){let r=new n(t);return r.lastIndex=t.lastIndex,r}if(t instanceof DataView)return new n(t.buffer.slice(0));if(t instanceof Error){let r=new n(t.message);return r.stack=t.stack,r.name=t.name,r.cause=t.cause,r}if(typeof File<"u"&&t instanceof File)return new n([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){let r=Object.create(e);return Object.assign(r,t)}return t}function Fae(t,...e){let n=e.slice(0,-1),r=e[e.length-1],i=t;for(let s=0;s<n.length;s++){let o=n[s];i=L1(i,o,r,new Map)}return i}function L1(t,e,n,r){if($1(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(r.has(e))return Lae(r.get(e));if(r.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}let i=[...Object.keys(e),...b8(e)];for(let s=0;s<i.length;s++){let o=i[s],a=e[o],c=t[o];if(Xj(a)&&(a=H({},a)),Xj(c)&&(c=H({},c)),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Zj(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let u=[],d=Reflect.ownKeys(c);for(let h=0;h<d.length;h++){let f=d[h];u[f]=c[f]}c=u}else c=[];let l=n(c,a,o,t,e,r);l!=null?t[o]=l:Array.isArray(a)||e8(c)&&e8(a)?t[o]=L1(c,a,n,r):c==null&&kae(a)?t[o]=L1({},a,n,r):c==null&&Mae(a)?t[o]=Zj(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function Bae(t,...e){return Fae(t,...e,Pae)}var t8="error",Uae="wss://relay.walletconnect.org",jae="wc",_8="universal_provider",Zv=`${jae}@2:${_8}:`,T8="https://rpc.walletconnect.org/v1/",D8="generic",Vae=`${T8}bundler`,Ld="call_status",Hae=86400,z1={DEFAULT_CHAIN_CHANGED:"default_chain_changed"},$ae=Object.defineProperty,qae=Object.defineProperties,zae=Object.getOwnPropertyDescriptors,n8=Object.getOwnPropertySymbols,Gae=Object.prototype.hasOwnProperty,Kae=Object.prototype.propertyIsEnumerable,r8=(t,e,n)=>e in t?$ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xv=(t,e)=>{for(var n in e||(e={}))Gae.call(e,n)&&r8(t,n,e[n]);if(n8)for(var n of n8(e))Kae.call(e,n)&&r8(t,n,e[n]);return t},Wae=(t,e)=>qae(t,zae(e));function N8(t,e,n){var r;let i=mt.parseChainId(t);return((r=e.rpcMap)==null?void 0:r[i.reference])||`${T8}?chainId=${i.namespace}:${i.reference}&projectId=${n}`}function Qae(t){return t.includes(":")?t.split(":")[1]:t}function x8(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Yae(t,e){let n=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!n.length)return[];let r=[];return n.forEach(i=>{let s=e.namespaces[i].accounts;r.push(...s)}),r}function i8(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>{var r,i;return((r=n?.chains)==null?void 0:r.length)&&((i=n?.chains)==null?void 0:i.length)>0}))}function eb(t={},e={}){let n=i8(s8(t)),r=i8(s8(e));return Bae(n,r)}function s8(t){var e,n,r,i,s;let o={};if(!mt.isValidObject(t))return o;for(let[a,c]of Object.entries(t)){let l=mt.isCaipNamespace(a)?[a]:c.chains,u=c.methods||[],d=c.events||[],h=c.rpcMap||{},f=mt.parseNamespaceKey(a);o[f]=Wae(Xv(Xv({},o[f]),c),{chains:mt.mergeArrays(l,(e=o[f])==null?void 0:e.chains),methods:mt.mergeArrays(u,(n=o[f])==null?void 0:n.methods),events:mt.mergeArrays(d,(r=o[f])==null?void 0:r.events)}),(mt.isValidObject(h)||mt.isValidObject(((i=o[f])==null?void 0:i.rpcMap)||{}))&&(o[f].rpcMap=Xv(Xv({},h),(s=o[f])==null?void 0:s.rpcMap))}return o}function o8(t){return t.includes(":")?t.split(":")[2]:t}function a8(t){let e={};for(let[n,r]of Object.entries(t)){let i=r.methods||[],s=r.events||[],o=r.accounts||[],a=mt.isCaipNamespace(n)?[n]:r.chains?r.chains:x8(r.accounts);e[n]={chains:a,methods:i,events:s,accounts:o}}return e}function x1(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function Jae(t){try{let e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}var R8={},Fd=t=>R8[t],R1=(t,e)=>{R8[t]=e},Zae=Object.defineProperty,c8=Object.getOwnPropertySymbols,Xae=Object.prototype.hasOwnProperty,ece=Object.prototype.propertyIsEnumerable,l8=(t,e,n)=>e in t?Zae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u8=(t,e)=>{for(var n in e||(e={}))Xae.call(e,n)&&l8(t,n,e[n]);if(c8)for(var n of c8(e))ece.call(e,n)&&l8(t,n,e[n]);return t},d8="eip155",tce=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],nce=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,O1=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,h8=t=>Object.keys(t).filter(e=>tce.includes(e)).reduce((e,n)=>(e[n]=rce(t[n]),e),{}),rce=t=>typeof t=="string"&&Jae(t)?JSON.parse(t):t,ice=(t,e,n)=>{let{sessionProperties:r={},scopedProperties:i={}}=t,s={};if(!mt.isValidObject(i)&&!mt.isValidObject(r))return;let o=h8(r);for(let a of n){let c=nce(a);if(!c)continue;s[O1(c)]=o;let l=i?.[`${d8}:${c}`];if(l){let u=l?.[`${d8}:${c}:${e}`];s[O1(c)]=u8(u8({},s[O1(c)]),h8(u||l))}}for(let[a,c]of Object.entries(s))Object.keys(c).length===0&&delete s[a];return Object.keys(s).length>0?s:void 0},sce=Object.defineProperty,oce=(t,e,n)=>e in t?sce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ace=(t,e,n)=>oce(t,typeof e!="symbol"?e+"":e,n),P1,F1=class t{constructor(e){ace(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,n){return await this.storage.setItem(e,n)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return P1||(P1=new t(e)),P1}},cce=Object.defineProperty,lce=Object.defineProperties,uce=Object.getOwnPropertyDescriptors,f8=Object.getOwnPropertySymbols,dce=Object.prototype.hasOwnProperty,hce=Object.prototype.propertyIsEnumerable,p8=(t,e,n)=>e in t?cce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fce=(t,e)=>{for(var n in e||(e={}))dce.call(e,n)&&p8(t,n,e[n]);if(f8)for(var n of f8(e))hce.call(e,n)&&p8(t,n,e[n]);return t},pce=(t,e)=>lce(t,uce(e));async function gce(t,e){let n=mt.parseChainId(t.result.capabilities.caip345.caip2),r=t.result.capabilities.caip345.transactionHashes,i=await Promise.allSettled(r.map(d=>mce(n.reference,d,e))),s=i.filter(d=>d.status==="fulfilled").map(d=>d.value).filter(d=>d);i.filter(d=>d.status==="rejected").forEach(d=>console.warn("Failed to fetch transaction receipt:",d.reason));let o=!s.length||s.some(d=>!d),a=s.every(d=>d?.status==="0x1"),c=s.every(d=>d?.status==="0x0"),l=s.some(d=>d?.status==="0x0"),u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:s,status:u}}async function mce(t,e,n){return await n(parseInt(t)).request(H1.formatJsonRpcRequest("eth_getTransactionReceipt",[e]))}async function yce({sendCalls:t,storage:e}){let n=await e.getItem(Ld);await e.setItem(Ld,pce(fce({},n),{[t.result.id]:{request:t.request,result:t.result,expiry:mt.calcExpiry(Hae)}}))}async function wce({resultId:t,storage:e}){let n=await e.getItem(Ld);if(n){delete n[t],await e.setItem(Ld,n);for(let r in n)mt.isExpired(n[r].expiry)&&delete n[r];await e.setItem(Ld,n)}}async function vce({resultId:t,storage:e}){let n=await e.getItem(Ld),r=n?.[t];if(r&&!mt.isExpired(r.expiry))return r;await wce({resultId:t,storage:e})}var bce=Object.defineProperty,Ece=Object.defineProperties,Ice=Object.getOwnPropertyDescriptors,g8=Object.getOwnPropertySymbols,Cce=Object.prototype.hasOwnProperty,Ace=Object.prototype.propertyIsEnumerable,B1=(t,e,n)=>e in t?bce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M1=(t,e)=>{for(var n in e||(e={}))Cce.call(e,n)&&B1(t,n,e[n]);if(g8)for(var n of g8(e))Ace.call(e,n)&&B1(t,n,e[n]);return t},k1=(t,e)=>Ece(t,Ice(e)),Nl=(t,e,n)=>B1(t,typeof e!="symbol"?e+"":e,n),U1=class{constructor(e){Nl(this,"name","eip155"),Nl(this,"client"),Nl(this,"chainId"),Nl(this,"namespace"),Nl(this,"httpProviders"),Nl(this,"events"),Nl(this,"storage"),this.namespace=e.namespace,this.events=Fd("events"),this.client=Fd("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=F1.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(parseInt(e),n);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(z1.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,n){let r=n||N8(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new y8.JsonRpcProvider(new w8.HttpConnection(r,Fd("disableProviderPing")))}setHttpProvider(e,n){let r=this.createHttpProvider(e,n);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(n=>{var r;let i=parseInt(Qae(n));e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[n])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}getHttpProvider(e){let n=e||this.chainId;return this.httpProviders[n]||(this.httpProviders=k1(M1({},this.httpProviders),{[n]:this.createHttpProvider(n)}),this.httpProviders[n])}async handleSwitchChain(e){var n,r;let i=e.request.params?(n=e.request.params[0])==null?void 0:n.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;let s=parseInt(i,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var n,r,i,s,o;let a=(r=(n=e.request)==null?void 0:n.params)==null?void 0:r[0],c=((s=(i=e.request)==null?void 0:i.params)==null?void 0:s[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},d=`${a}${c.join(",")}`,h=u?.[d];if(h)return h;let f;try{f=ice(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(f)return f;let p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:k1(M1({},l.sessionProperties||{}),{capabilities:k1(M1({},u||{}),{[d]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var n,r,i;let s=this.client.session.get(e.topic),o=(n=s.sessionProperties)==null?void 0:n.bundler_name;if(o){let l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}let a=(r=s.sessionProperties)==null?void 0:r.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}let c=await vce({resultId:(i=e.request.params)==null?void 0:i[0],storage:this.storage});if(c)try{return await gce(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,n){var r;let i=new URL(e),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H1.formatJsonRpcRequest("eth_getUserOperationReceipt",[(r=n.request.params)==null?void 0:r[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,n){return`${Vae}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${n}`}async sendCalls(e){var n,r,i;let s=await this.client.request(e),o=(n=e.request.params)==null?void 0:n[0],a=s?.id,c=s?.capabilities||{},l=(r=c?.caip345)==null?void 0:r.caip2,u=(i=c?.caip345)==null?void 0:i.transactionHashes;return!a||!l||!(u!=null&&u.length)||await yce({sendCalls:{request:o,result:s},storage:this.storage}),s}},Sce=Object.defineProperty,_ce=(t,e,n)=>e in t?Sce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Md=(t,e,n)=>_ce(t,typeof e!="symbol"?e+"":e,n),j1=class{constructor(e){Md(this,"name",D8),Md(this,"client"),Md(this,"httpProviders"),Md(this,"events"),Md(this,"namespace"),Md(this,"chainId"),this.namespace=e.namespace,this.events=Fd("events"),this.client=Fd("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(e,n);let r=this.chainId;this.chainId=e,this.events.emit(z1.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return mt.parseChainId(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){var e,n;let r={};return(n=(e=this.namespace)==null?void 0:e.accounts)==null||n.forEach(i=>{var s,o;let a=mt.parseChainId(i),c=(o=(s=this.namespace)==null?void 0:s.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];r[a.reference]=this.createHttpProvider(i,c)}),r}getHttpProvider(e){let n=mt.parseChainId(e).reference,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,n){let r=this.createHttpProvider(e,n);r&&(this.httpProviders[e]=r)}createHttpProvider(e,n){let r=n||N8(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new y8.JsonRpcProvider(new uae.default(r,Fd("disableProviderPing")))}},Tce=Object.defineProperty,Dce=Object.defineProperties,Nce=Object.getOwnPropertyDescriptors,m8=Object.getOwnPropertySymbols,xce=Object.prototype.hasOwnProperty,Rce=Object.prototype.propertyIsEnumerable,V1=(t,e,n)=>e in t?Tce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kp=(t,e)=>{for(var n in e||(e={}))xce.call(e,n)&&V1(t,n,e[n]);if(m8)for(var n of m8(e))Rce.call(e,n)&&V1(t,n,e[n]);return t},tb=(t,e)=>Dce(t,Nce(e)),ii=(t,e,n)=>V1(t,typeof e!="symbol"?e+"":e,n),nb=class t{constructor(e){ii(this,"client"),ii(this,"namespaces"),ii(this,"optionalNamespaces"),ii(this,"sessionProperties"),ii(this,"scopedProperties"),ii(this,"events",new dae.default),ii(this,"rpcProviders",{}),ii(this,"session"),ii(this,"providerOpts"),ii(this,"logger"),ii(this,"uri"),ii(this,"disableProviderPing",!1),ii(this,"connectParams");var n,r;this.providerOpts=e,this.logger=mt.createLogger({logger:(n=e.logger)!=null?n:t8,name:(r=this.providerOpts.name)!=null?r:_8}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let n=new t(e);return await n.initialize(),n}async request(e,n,r){let[i,s]=this.validateChain(n);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:kp({},e),chainId:`${i}:${s}`,topic:this.session.topic,expiry:r})}sendAsync(e,n,r,i){let s=new Date().getTime();this.request(e,r,i).then(o=>n(null,H1.formatJsonRpcResult(s,o))).catch(o=>n(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:mt.getSdkError("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,n){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,n);r&&(this.uri=r,this.events.emit("display_uri",r));let s=await i();if(this.session=s.session,this.session){let o=a8(this.session.namespaces);this.namespaces=eb(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}removeListener(e,n){this.events.removeListener(e,n)}off(e,n){this.events.off(e,n)}get isWalletConnect(){return!0}async pair(e){var n,r;let{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(n=this.connectParams)==null?void 0:n.authentication,walletPay:(r=this.connectParams)==null?void 0:r.walletPay});i&&(this.uri=i,this.events.emit("display_uri",i));let o=await s();this.session=o;let a=a8(o.namespaces);return this.namespaces=eb(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,n){try{if(!this.session)return;let[r,i]=this.validateChain(e);this.getProvider(r).setDefaultChain(i,n)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let n=this.client.pairing.getAll();if(!mt.isValidArray(n))return;for(let r of n)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${n.length}`)}catch(n){this.logger.warn(n,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,n;if(this.client=this.providerOpts.client||await cae.SignClient.init({core:this.providerOpts.core,logger:this.providerOpts.logger||t8,relayUrl:this.providerOpts.relayUrl||Uae,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),new Error(`The provided session: ${(n=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:n.topic} doesn't exist in the Sign client`)}else{let r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(n=>mt.parseNamespaceKey(n)))];R1("client",this.client),R1("events",this.events),R1("disableProviderPing",this.disableProviderPing),e.forEach(n=>{if(!this.session)return;let r=Yae(n,this.session);if(r?.length===0)return;let i=x8(r),s=eb(this.namespaces,this.optionalNamespaces),o=tb(kp({},s[n]),{accounts:r,chains:i});switch(n){case"eip155":this.rpcProviders[n]=new U1({namespace:o});break;default:this.rpcProviders[n]=new j1({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var n;let{topic:r}=e;r===((n=this.session)==null?void 0:n.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var n;let{params:r,topic:i}=e;if(i!==((n=this.session)==null?void 0:n.topic))return;let{event:s}=r;if(s.name==="accountsChanged"){let o=s.data;o&&mt.isValidArray(o)&&this.events.emit("accountsChanged",o.map(o8))}else if(s.name==="chainChanged"){let o=r.chainId,a=r.event.data,c=mt.parseNamespaceKey(o),l=x1(o)!==x1(a)?`${c}:${x1(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:n})=>{var r,i;if(e!==((r=this.session)==null?void 0:r.topic))return;let{namespaces:s}=n,o=(i=this.client)==null?void 0:i.session.get(e);this.session=tb(kp({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:n})}),this.client.on("session_delete",async e=>{var n;e.topic===((n=this.session)==null?void 0:n.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",tb(kp({},mt.getSdkError("USER_DISCONNECTED")),{data:e.topic})))}),this.on(z1.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(tb(kp({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[D8]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var n;this.getProvider(e).updateNamespace((n=this.session)==null?void 0:n.namespaces[e])})}setNamespaces(e){let{namespaces:n={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:s}=e;this.optionalNamespaces=eb(n,r),this.sessionProperties=i,this.scopedProperties=s}validateChain(e){let[n,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[n,r];if(n&&!Object.keys(this.namespaces||{}).map(o=>mt.parseNamespaceKey(o)).includes(n))throw new Error(`Namespace '${n}' is not configured. Please call connect() first with namespace config.`);if(n&&r)return[n,r];let i=mt.parseNamespaceKey(Object.keys(this.namespaces)[0]),s=this.rpcProviders[i].getDefaultChain();return[i,s]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:n,internal:r=!1}){if(!this.namespaces)return;let[i,s]=this.validateChain(e);s&&(this.updateNamespaceChain(i,s),r?(this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:n})):this.getProvider(i).setDefaultChain(s),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:n,previousCaipChainId:r}){var i,s;try{if(r===n)return;let o=(s=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:s.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${n}:`)).map(o8);if(!mt.isValidArray(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,n){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${n}`,i={chains:[],methods:[],events:[],defaultChain:n};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=n):this.namespaces[r]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,n){var r;let i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${Zv}/${e}${i}`,n)}async getFromStore(e){var n;let r=((n=this.session)==null?void 0:n.topic)||"";return await this.client.core.storage.getItem(`${Zv}/${e}${r}`)}async deleteFromStore(e){var n;let r=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.removeItem(`${Zv}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let n=await this.client.core.storage.getKeys();for(let r of n)r.startsWith(Zv)&&await this.client.core.storage.removeItem(r)}catch(n){this.logger.warn(n,"Failed to cleanup storage")}}},Oce=nb;rb.UniversalProvider=Oce,rb.default=nb});var ub={};ah(ub,{MAX_LOG_SIZE_IN_BYTES_DEFAULT:()=>lb,PINO_CUSTOM_CONTEXT_KEY:()=>Lp,PINO_LOGGER_DEFAULTS:()=>L8,formatChildLoggerContext:()=>U8,generateChildLogger:()=>Qce,generateClientLogger:()=>j8,generatePlatformLogger:()=>Yce,generateServerLogger:()=>V8,getDefaultLoggerOptions:()=>Wce,getLoggerContext:()=>B8,pino:()=>k8.pino,setLoggerContext:()=>F8});function Wce(t){return cb(ab({},t),{level:t?.level||L8.level})}function F8(t,e,n=Lp){return t[n]=e,t}function B8(t,e=Lp){return t[e]||""}function U8(t,e,n=Lp){let r=B8(t,n);return r.trim()?`${r}/${e}`:e}function Qce(t,e,n=Lp){let r=U8(t,e,n),i=t.child({context:r});return F8(i,r,n)}function j8(t){var e,n;let r=new K1((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:(0,No.default)(cb(ab({},t.opts),{level:"trace",browser:cb(ab({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function V8(t){var e;let n=new W1((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:(0,No.default)(cb(ab({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function Yce(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?j8(t):V8(t)}var No,k8,L8,Lp,lb,Pce,Mce,$a,G1,sb,kce,Lce,ib,ob,Fce,Bce,Uce,K1,jce,Vce,Hce,W1,$ce,qce,zce,P8,Gce,Kce,M8,ab,cb,db=$r(()=>{"use strict";No=Kl(sx()),k8=Kl(sx());_0();L8={level:"info"},Lp="custom_context",lb=1e3*1024,Pce=Object.defineProperty,Mce=(t,e,n)=>e in t?Pce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$a=(t,e,n)=>Mce(t,typeof e!="symbol"?e+"":e,n),G1=class{constructor(e){$a(this,"nodeValue"),$a(this,"sizeInBytes"),$a(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},sb=class{constructor(e){$a(this,"lengthInNodes"),$a(this,"sizeInBytes"),$a(this,"head"),$a(this,"tail"),$a(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let n=new G1(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let n=e.value;return e=e.next,{done:!1,value:n}}}}},kce=Object.defineProperty,Lce=(t,e,n)=>e in t?kce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ib=(t,e,n)=>Lce(t,typeof e!="symbol"?e+"":e,n),ob=class{constructor(e,n=lb){ib(this,"logs"),ib(this,"level"),ib(this,"levelValue"),ib(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=No.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new sb(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===No.levels.values.error?console.error(e):n===No.levels.values.warn?console.warn(e):n===No.levels.values.debug?console.debug(e):n===No.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(S0({timestamp:new Date().toISOString(),log:e}));let n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new sb(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let n=this.getLogArray();return n.push(S0({extraMetadata:e})),new Blob(n,{type:"application/json"})}},Fce=Object.defineProperty,Bce=(t,e,n)=>e in t?Fce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Uce=(t,e,n)=>Bce(t,typeof e!="symbol"?e+"":e,n),K1=class{constructor(e,n=lb){Uce(this,"baseChunkLogger"),this.baseChunkLogger=new ob(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}},jce=Object.defineProperty,Vce=(t,e,n)=>e in t?jce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Hce=(t,e,n)=>Vce(t,typeof e!="symbol"?e+"":e,n),W1=class{constructor(e,n=lb){Hce(this,"baseChunkLogger"),this.baseChunkLogger=new ob(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}},$ce=Object.defineProperty,qce=Object.defineProperties,zce=Object.getOwnPropertyDescriptors,P8=Object.getOwnPropertySymbols,Gce=Object.prototype.hasOwnProperty,Kce=Object.prototype.propertyIsEnumerable,M8=(t,e,n)=>e in t?$ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ab=(t,e)=>{for(var n in e||(e={}))Gce.call(e,n)&&M8(t,n,e[n]);if(P8)for(var n of P8(e))Kce.call(e,n)&&M8(t,n,e[n]);return t},cb=(t,e)=>qce(t,zce(e))});var pT={};ah(pT,{ICore:()=>Q1,ICrypto:()=>Y1,IEchoClient:()=>cT,IEngine:()=>fT,IEngineEvents:()=>hT,IEventClient:()=>lT,IExpirer:()=>sT,IJsonRpcHistory:()=>J1,IKeyChain:()=>iT,IMessageTracker:()=>Z1,IPairing:()=>oT,IPublisher:()=>X1,IRelayer:()=>eT,ISignClient:()=>dT,ISignClientEvents:()=>uT,IStore:()=>tT,ISubscriber:()=>rT,ISubscriberTopicMap:()=>nT,IVerify:()=>aT});var hb,Jce,Zce,H8,Q1,Y1,Xce,ele,tle,J1,Z1,X1,eT,tT,nle,rle,ile,nT,rT,iT,sT,oT,aT,cT,lT,sle,ole,$8,uT,dT,hT,fT,gT=$r(()=>{"use strict";zN();hb=Kl(Ks()),Jce=Object.defineProperty,Zce=(t,e,n)=>e in t?Jce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,H8=(t,e,n)=>Zce(t,typeof e!="symbol"?e+"":e,n),Q1=class extends Cr{constructor(e){super(),this.opts=e,H8(this,"protocol","wc"),H8(this,"version",2)}},Y1=class{constructor(e,n,r){this.core=e,this.logger=n}},Xce=Object.defineProperty,ele=(t,e,n)=>e in t?Xce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tle=(t,e,n)=>ele(t,typeof e!="symbol"?e+"":e,n),J1=class extends Cr{constructor(e,n){super(),this.core=e,this.logger=n,tle(this,"records",new Map)}},Z1=class{constructor(e,n){this.logger=e,this.core=n}},X1=class extends Cr{constructor(e,n){super(),this.relayer=e,this.logger=n}},eT=class extends Cr{constructor(e){super()}},tT=class{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}},nle=Object.defineProperty,rle=(t,e,n)=>e in t?nle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ile=(t,e,n)=>rle(t,typeof e!="symbol"?e+"":e,n),nT=class{constructor(){ile(this,"map",new Map)}},rT=class extends Cr{constructor(e,n){super(),this.relayer=e,this.logger=n}},iT=class{constructor(e,n){this.core=e,this.logger=n}},sT=class extends Cr{constructor(e,n){super(),this.core=e,this.logger=n}},oT=class{constructor(e,n){this.logger=e,this.core=n}},aT=class{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}},cT=class{constructor(e,n){this.projectId=e,this.logger=n}},lT=class{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}},sle=Object.defineProperty,ole=(t,e,n)=>e in t?sle(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$8=(t,e,n)=>ole(t,typeof e!="symbol"?e+"":e,n),uT=class extends hb.default{constructor(){super()}},dT=class{constructor(e){this.opts=e,$8(this,"protocol","wc"),$8(this,"version",2)}},hT=class extends hb.EventEmitter{constructor(){super()}},fT=class{constructor(e){this.client=e}}});var Vb=vs(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});var ale=(MN(),Pe(PN)),Vd=Wl(),ko=hg(),cle=kN(),q8=FN(),lle=BN(),z8=(jN(),Pe(UN)),ule=LN(),dle=(pg(),Pe(fg)),ht=(mg(),Pe(gg)),hle=($N(),Pe(HN)),fle=qN(),ple=(db(),Pe(ub));function gle(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var Gp=gle(lle),Sb=":";function ZT(t){let[e,n]=t.split(Sb);return{namespace:e,reference:n}}function A4(t){let{namespace:e,reference:n}=t;return[e,n].join(Sb)}function XT(t){let[e,n,r]=t.split(Sb);return{namespace:e,reference:n,address:r}}function S4(t){let{namespace:e,reference:n,address:r}=t;return[e,n,r].join(Sb)}function eD(t,e){let n=[];return t.forEach(r=>{let i=e(r);n.includes(i)||n.push(i)}),n}function _4(t){let{address:e}=XT(t);return e}function T4(t){let{namespace:e,reference:n}=XT(t);return A4({namespace:e,reference:n})}function mle(t,e){let{namespace:n,reference:r}=ZT(e);return S4({namespace:n,reference:r,address:t})}function yle(t){return eD(t,_4)}function D4(t){return eD(t,T4)}function wle(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(...i.accounts)}),n}function vle(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(...D4(i.accounts))}),n}function ble(t,e=[]){let n=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;let i=t[r];n.push(..._b(r,i))}),n}function _b(t,e){return t.includes(":")?[t]:e.chains||[]}var Ele=Object.defineProperty,Ile=Object.defineProperties,Cle=Object.getOwnPropertyDescriptors,G8=Object.getOwnPropertySymbols,Ale=Object.prototype.hasOwnProperty,Sle=Object.prototype.propertyIsEnumerable,DT=(t,e,n)=>e in t?Ele(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,K8=(t,e)=>{for(var n in e||(e={}))Ale.call(e,n)&&DT(t,n,e[n]);if(G8)for(var n of G8(e))Sle.call(e,n)&&DT(t,n,e[n]);return t},_le=(t,e)=>Ile(t,Cle(e)),W8=(t,e,n)=>DT(t,typeof e!="symbol"?e+"":e,n),N4="ReactNative",vr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},wb=" ",Tle=":",x4="/",tD=2,Dle=1e3,R4="js";function nD(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function sc(){return!ko.getDocument()&&!!ko.getNavigator()&&navigator.product===N4}function Nle(){return sc()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function xle(){return sc()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Wd(){return!nD()&&!!ko.getNavigator()&&!!ko.getDocument()}function Ll(){return sc()?vr.reactNative:nD()?vr.node:Wd()?vr.browser:vr.unknown}function Rle(){var t;try{return sc()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function O4(t,e){let n=new URLSearchParams(t);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function Ole(t){var e,n;let r=P4();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),_le(K8(K8({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(n=t?.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function P4(){return cle.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Ple(t,e){var n;let r=Ll(),i={protocol:t,version:e,env:r};return r==="browser"&&(i.host=((n=ko.getLocation())==null?void 0:n.host)||"unknown"),i}function M4(){if(Ll()===vr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:n,Version:r}=global.Platform;return[n,r].join("-")}let t=ale.detect();if(t===null)return"unknown";let e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function k4(){var t;let e=Ll();return e===vr.browser?[e,((t=ko.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function L4(t,e,n){let r=M4(),i=k4();return[[t,e].join("-"),[R4,n].join("-"),r,i].join("/")}function Mle({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){let l=n.split("?"),u=L4(t,e,r),d={auth:i,ua:u,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},h=O4(l[1]||"",d);return l[0]+"?"+h}function kle(t){let e=(t.match(/^[^:]+(?=:\/\/)/gi)||[])[0],n=typeof e<"u"?t.split("://")[1]:t;return e=e==="wss"?"https":"http",[e,n].join("://")}function Lle(t,e,n){if(!t[e]||typeof t[e]!==n)throw new Error(`Missing or invalid "${e}" param`)}function F4(t,e=tD){return B4(t.split(x4),e)}function Fle(t){return F4(t).join(wb)}function ec(t,e){return t.filter(n=>e.includes(n)).length===t.length}function B4(t,e=tD){return t.slice(Math.max(t.length-e,0))}function Ble(t){return Object.fromEntries(t.entries())}function Ule(t){return new Map(Object.entries(t))}function jle(t,e){let n={};return Object.keys(t).forEach(r=>{n[r]=e(t[r])}),n}var Vle=t=>t;function U4(t){return t.trim().replace(/^\w/,e=>e.toUpperCase())}function Hle(t){return t.split(wb).map(e=>U4(e)).join(wb)}function $le(t=Vd.FIVE_MINUTES,e){let n=Vd.toMiliseconds(t||Vd.FIVE_MINUTES),r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{let l=new Error(e);o=Promise.reject(l),c(l)},n),r=a,i=c})}}function qle(t,e,n){return new Promise(async(r,i)=>{let s=setTimeout(()=>i(new Error(n)),e);try{let o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function rD(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function zle(t){return rD("topic",t)}function Gle(t){return rD("id",t)}function Kle(t){let[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function Wle(t,e){return Vd.fromMiliseconds((e||Date.now())+Vd.toMiliseconds(t))}function Qle(t){return Date.now()>=Vd.toMiliseconds(t)}function Yle(t,e){return`${t}${e?`:${e}`:""}`}function Ai(t=[],e=[]){return[...new Set([...t,...e])]}async function Jle({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;let i=typeof n=="string"?JSON.parse(n):n,s=i?.href;if(typeof s!="string")return;let o=j4(s,t,e),a=Ll();if(a===vr.browser){if(!((r=ko.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}V4(o)}else a===vr.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function j4(t,e,n){let r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){let s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${q4(r,!0)}`}else i=`${i}/wc?${r}`;return i}function V4(t){let e="_self";$4()?e="_top":(H4()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Zle(t,e){let n="";try{if(Wd()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function NT(t,e){return t.filter(n=>e.includes(n))}function Xle(t,e){if(!t.includes(e))return null;let n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function eue(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function tue(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function H4(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function $4(){try{return window.self!==window.top}catch{return!1}}function q4(t,e=!1){let n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function iD(t){return Buffer.from(t,"base64").toString("utf-8")}function nue(t){return new Promise(e=>setTimeout(e,t))}var xT=class{constructor({limit:e}){W8(this,"limit"),W8(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}},fb=BigInt(2**32-1),Q8=BigInt(32);function z4(t,e=!1){return e?{h:Number(t&fb),l:Number(t>>Q8&fb)}:{h:Number(t>>Q8&fb)|0,l:Number(t&fb)|0}}function G4(t,e=!1){let n=t.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){let{h:o,l:a}=z4(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}var Y8=(t,e,n)=>t>>>n,J8=(t,e,n)=>t<<32-n|e>>>n,Ya=(t,e,n)=>t>>>n|e<<32-n,Ja=(t,e,n)=>t<<32-n|e>>>n,Up=(t,e,n)=>t<<64-n|e>>>n-32,jp=(t,e,n)=>t>>>n-32|e<<64-n,rue=(t,e)=>e,iue=(t,e)=>t,sue=(t,e,n)=>t<<n|e>>>32-n,oue=(t,e,n)=>e<<n|t>>>32-n,aue=(t,e,n)=>e<<n-32|t>>>64-n,cue=(t,e,n)=>t<<n-32|e>>>64-n;function fs(t,e,n,r){let i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}var sD=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),oD=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,lue=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),uue=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,due=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),hue=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,Bd=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Tb(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Lo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gs(t,...e){if(!Tb(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Db(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Lo(t.outputLen),Lo(t.blockLen)}function rc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function aD(t,e){gs(t);let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Hp(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Si(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function mT(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function $s(t,e){return t<<32-e|t>>>e}var K4=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function W4(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}var Ro=K4?t=>t:t=>W4(t);function fue(t){for(let e=0;e<t.length;e++)t[e]=W4(t[e]);return t}var Za=K4?t=>t:fue,Q4=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",pue=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Hd(t){if(gs(t),Q4)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=pue[t[n]];return e}var xo={_0:48,_9:57,A:65,F:70,a:97,f:102};function Z8(t){if(t>=xo._0&&t<=xo._9)return t-xo._0;if(t>=xo.A&&t<=xo.F)return t-(xo.A-10);if(t>=xo.a&&t<=xo.f)return t-(xo.a-10)}function vb(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Q4)return Uint8Array.fromHex(t);let e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){let o=Z8(t.charCodeAt(s)),a=Z8(t.charCodeAt(s+1));if(o===void 0||a===void 0){let c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Y4(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ps(t){return typeof t=="string"&&(t=Y4(t)),gs(t),t}function Xa(...t){let e=0;for(let r=0;r<t.length;r++){let i=t[r];gs(i),e+=i.length}let n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){let s=t[r];n.set(s,i),i+=s.length}return n}var zd=class{};function Kp(t){let e=r=>t().update(ps(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function gue(t){let e=(r,i)=>t(i).update(ps(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function Fl(t=32){if(Bd&&typeof Bd.getRandomValues=="function")return Bd.getRandomValues(new Uint8Array(t));if(Bd&&typeof Bd.randomBytes=="function")return Uint8Array.from(Bd.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var mue=BigInt(0),Fp=BigInt(1),yue=BigInt(2),wue=BigInt(7),vue=BigInt(256),bue=BigInt(113),J4=[],Z4=[],X4=[];for(let t=0,e=Fp,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],J4.push(2*(5*r+n)),Z4.push((t+1)*(t+2)/2%64);let i=mue;for(let s=0;s<7;s++)e=(e<<Fp^(e>>wue)*bue)%vue,e&yue&&(i^=Fp<<(Fp<<BigInt(s))-Fp);X4.push(i)}var e6=G4(X4,!0),Eue=e6[0],Iue=e6[1],X8=(t,e,n)=>n>32?aue(t,e,n):sue(t,e,n),e4=(t,e,n)=>n>32?cue(t,e,n):oue(t,e,n);function Cue(t,e=24){let n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],d=X8(l,u,1)^n[a],h=e4(l,u,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=d,t[o+f+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){let a=Z4[o],c=X8(i,s,a),l=e4(i,s,a),u=J4[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=Eue[r],t[1]^=Iue[r]}Si(n)}var RT=class t extends zd{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,Lo(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Hp(this.state)}clone(){return this._cloneInto()}keccak(){Za(this.state32),Cue(this.state32,this.rounds),Za(this.state32),this.posOut=0,this.pos=0}update(e){rc(this),e=ps(e),gs(e);let{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){rc(this,!1),gs(e),this.finish();let n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();let o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Lo(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(aD(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Si(this.state)}_cloneInto(e){let{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new t(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}},Aue=(t,e,n)=>Kp(()=>new RT(e,t,n)),Sue=Aue(1,136,256/8);function _ue(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function Tue(t,e,n){return t&e^~t&n}function Due(t,e,n){return t&e^t&n^e&n}var bb=class extends zd{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=mT(this.buffer)}update(e){rc(this),e=ps(e),gs(e);let{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){let a=Math.min(i-this.pos,s-o);if(a===i){let c=mT(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){rc(this),aD(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:i,isLE:s}=this,{pos:o}=this;n[o++]=128,Si(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;_ue(r,i-8,BigInt(this.length*8),s),this.process(r,0);let a=mT(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}},qa=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xn=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),er=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Nue=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),za=new Uint32Array(64),OT=class extends bb{constructor(e=32){super(64,e,8,!1),this.A=qa[0]|0,this.B=qa[1]|0,this.C=qa[2]|0,this.D=qa[3]|0,this.E=qa[4]|0,this.F=qa[5]|0,this.G=qa[6]|0,this.H=qa[7]|0}get(){let{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let d=0;d<16;d++,n+=4)za[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){let h=za[d-15],f=za[d-2],p=$s(h,7)^$s(h,18)^h>>>3,g=$s(f,17)^$s(f,19)^f>>>10;za[d]=g+za[d-7]+p+za[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){let h=$s(a,6)^$s(a,11)^$s(a,25),f=u+h+Tue(a,c,l)+Nue[d]+za[d]|0,p=($s(r,2)^$s(r,13)^$s(r,22))+Due(r,i,s)|0;u=l,l=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){Si(za)}destroy(){this.set(0,0,0,0,0,0,0,0),Si(this.buffer)}},t6=G4(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),xue=t6[0],Rue=t6[1],Ga=new Uint32Array(80),Ka=new Uint32Array(80),$p=class extends bb{constructor(e=64){super(128,e,16,!1),this.Ah=er[0]|0,this.Al=er[1]|0,this.Bh=er[2]|0,this.Bl=er[3]|0,this.Ch=er[4]|0,this.Cl=er[5]|0,this.Dh=er[6]|0,this.Dl=er[7]|0,this.Eh=er[8]|0,this.El=er[9]|0,this.Fh=er[10]|0,this.Fl=er[11]|0,this.Gh=er[12]|0,this.Gl=er[13]|0,this.Hh=er[14]|0,this.Hl=er[15]|0}get(){let{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:f,Gl:p,Hh:g,Hl:m}=this;return[e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m]}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,n){for(let I=0;I<16;I++,n+=4)Ga[I]=e.getUint32(n),Ka[I]=e.getUint32(n+=4);for(let I=16;I<80;I++){let L=Ga[I-15]|0,k=Ka[I-15]|0,N=Ya(L,k,1)^Ya(L,k,8)^Y8(L,k,7),B=Ja(L,k,1)^Ja(L,k,8)^J8(L,k,7),U=Ga[I-2]|0,T=Ka[I-2]|0,$=Ya(U,T,19)^Up(U,T,61)^Y8(U,T,6),K=Ja(U,T,19)^jp(U,T,61)^J8(U,T,6),M=lue(B,K,Ka[I-7],Ka[I-16]),v=uue(M,N,$,Ga[I-7],Ga[I-16]);Ga[I]=v|0,Ka[I]=M|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:f,Fl:p,Gh:g,Gl:m,Hh:y,Hl:E}=this;for(let I=0;I<80;I++){let L=Ya(d,h,14)^Ya(d,h,18)^Up(d,h,41),k=Ja(d,h,14)^Ja(d,h,18)^jp(d,h,41),N=d&f^~d&g,B=h&p^~h&m,U=due(E,k,B,Rue[I],Ka[I]),T=hue(U,y,L,N,xue[I],Ga[I]),$=U|0,K=Ya(r,i,28)^Up(r,i,34)^Up(r,i,39),M=Ja(r,i,28)^jp(r,i,34)^jp(r,i,39),v=r&s^r&a^s&a,b=i&o^i&c^o&c;y=g|0,E=m|0,g=f|0,m=p|0,f=d|0,p=h|0,{h:d,l:h}=fs(l|0,u|0,T|0,$|0),l=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;let w=sD($,M,b);r=oD(w,T,K,v),i=w|0}({h:r,l:i}=fs(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=fs(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=fs(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=fs(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=fs(this.Eh|0,this.El|0,d|0,h|0),{h:f,l:p}=fs(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:m}=fs(this.Gh|0,this.Gl|0,g|0,m|0),{h:y,l:E}=fs(this.Hh|0,this.Hl|0,y|0,E|0),this.set(r,i,s,o,a,c,l,u,d,h,f,p,g,m,y,E)}roundClean(){Si(Ga,Ka)}destroy(){Si(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},PT=class extends $p{constructor(){super(48),this.Ah=Xn[0]|0,this.Al=Xn[1]|0,this.Bh=Xn[2]|0,this.Bl=Xn[3]|0,this.Ch=Xn[4]|0,this.Cl=Xn[5]|0,this.Dh=Xn[6]|0,this.Dl=Xn[7]|0,this.Eh=Xn[8]|0,this.El=Xn[9]|0,this.Fh=Xn[10]|0,this.Fl=Xn[11]|0,this.Gh=Xn[12]|0,this.Gl=Xn[13]|0,this.Hh=Xn[14]|0,this.Hl=Xn[15]|0}},tr=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),MT=class extends $p{constructor(){super(32),this.Ah=tr[0]|0,this.Al=tr[1]|0,this.Bh=tr[2]|0,this.Bl=tr[3]|0,this.Ch=tr[4]|0,this.Cl=tr[5]|0,this.Dh=tr[6]|0,this.Dl=tr[7]|0,this.Eh=tr[8]|0,this.El=tr[9]|0,this.Fh=tr[10]|0,this.Fl=tr[11]|0,this.Gh=tr[12]|0,this.Gl=tr[13]|0,this.Hh=tr[14]|0,this.Hl=tr[15]|0}},Nb=Kp(()=>new OT),Oue=Kp(()=>new $p),Pue=Kp(()=>new PT),Mue=Kp(()=>new MT),kue=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),fn=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),ue=new Uint32Array(32);function Wa(t,e,n,r,i,s){let o=i[s],a=i[s+1],c=ue[2*t],l=ue[2*t+1],u=ue[2*e],d=ue[2*e+1],h=ue[2*n],f=ue[2*n+1],p=ue[2*r],g=ue[2*r+1],m=sD(c,u,o);l=oD(m,l,d,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:rue(g,p),Dl:iue(g)},{h:f,l:h}=fs(f,h,g,p),{Bh:d,Bl:u}={Bh:d^f,Bl:u^h},{Bh:d,Bl:u}={Bh:Ya(d,u,24),Bl:Ja(d,u,24)},ue[2*t]=c,ue[2*t+1]=l,ue[2*e]=u,ue[2*e+1]=d,ue[2*n]=h,ue[2*n+1]=f,ue[2*r]=p,ue[2*r+1]=g}function Qa(t,e,n,r,i,s){let o=i[s],a=i[s+1],c=ue[2*t],l=ue[2*t+1],u=ue[2*e],d=ue[2*e+1],h=ue[2*n],f=ue[2*n+1],p=ue[2*r],g=ue[2*r+1],m=sD(c,u,o);l=oD(m,l,d,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:Ya(g,p,16),Dl:Ja(g,p,16)},{h:f,l:h}=fs(f,h,g,p),{Bh:d,Bl:u}={Bh:d^f,Bl:u^h},{Bh:d,Bl:u}={Bh:Up(d,u,63),Bl:jp(d,u,63)},ue[2*t]=c,ue[2*t+1]=l,ue[2*e]=u,ue[2*e+1]=d,ue[2*n]=h,ue[2*n+1]=f,ue[2*r]=p,ue[2*r+1]=g}function Lue(t,e={},n,r,i){if(Lo(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");let{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}var kT=class extends zd{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Lo(e),Lo(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Hp(this.buffer)}update(e){rc(this),e=ps(e),gs(e);let{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(Za(i),this.compress(i,0,!1),Za(i),this.pos=0);let l=Math.min(n-this.pos,s-c),u=o+c;if(l===n&&!(u%4)&&c+l<s){let d=new Uint32Array(a,u,Math.floor((s-c)/4));Za(d);for(let h=0;c+n<s;h+=i.length,c+=n)this.length+=n,this.compress(d,h,!1);Za(d);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){rc(this),aD(e,this);let{pos:n,buffer32:r}=this;this.finished=!0,Si(this.buffer.subarray(n)),Za(r),this.compress(r,0,!0),Za(r);let i=Hp(e);this.get().forEach((s,o)=>i[o]=Ro(s))}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){let{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},LT=class extends kT{constructor(e={}){let n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=fn[0]|0,this.v0h=fn[1]|0,this.v1l=fn[2]|0,this.v1h=fn[3]|0,this.v2l=fn[4]|0,this.v2h=fn[5]|0,this.v3l=fn[6]|0,this.v3h=fn[7]|0,this.v4l=fn[8]|0,this.v4h=fn[9]|0,this.v5l=fn[10]|0,this.v5h=fn[11]|0,this.v6l=fn[12]|0,this.v6h=fn[13]|0,this.v7l=fn[14]|0,this.v7h=fn[15]|0,Lue(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=ps(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=ps(s);let a=Hp(s);this.v4l^=Ro(a[0]),this.v4h^=Ro(a[1]),this.v5l^=Ro(a[2]),this.v5h^=Ro(a[3])}if(i!==void 0){i=ps(i);let a=Hp(i);this.v6l^=Ro(a[0]),this.v6h^=Ro(a[1]),this.v7l^=Ro(a[2]),this.v7h^=Ro(a[3])}if(r!==void 0){let a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:d,v5h:h,v6l:f,v6h:p,v7l:g,v7h:m}=this;return[e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m]}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=d|0,this.v5h=h|0,this.v6l=f|0,this.v6h=p|0,this.v7l=g|0,this.v7h=m|0}compress(e,n,r){this.get().forEach((c,l)=>ue[l]=c),ue.set(fn,16);let{h:i,l:s}=z4(BigInt(this.length));ue[24]=fn[8]^s,ue[25]=fn[9]^i,r&&(ue[28]=~ue[28],ue[29]=~ue[29]);let o=0,a=kue;for(let c=0;c<12;c++)Wa(0,4,8,12,e,n+2*a[o++]),Qa(0,4,8,12,e,n+2*a[o++]),Wa(1,5,9,13,e,n+2*a[o++]),Qa(1,5,9,13,e,n+2*a[o++]),Wa(2,6,10,14,e,n+2*a[o++]),Qa(2,6,10,14,e,n+2*a[o++]),Wa(3,7,11,15,e,n+2*a[o++]),Qa(3,7,11,15,e,n+2*a[o++]),Wa(0,5,10,15,e,n+2*a[o++]),Qa(0,5,10,15,e,n+2*a[o++]),Wa(1,6,11,12,e,n+2*a[o++]),Qa(1,6,11,12,e,n+2*a[o++]),Wa(2,7,8,13,e,n+2*a[o++]),Qa(2,7,8,13,e,n+2*a[o++]),Wa(3,4,9,14,e,n+2*a[o++]),Qa(3,4,9,14,e,n+2*a[o++]);this.v0l^=ue[0]^ue[16],this.v0h^=ue[1]^ue[17],this.v1l^=ue[2]^ue[18],this.v1h^=ue[3]^ue[19],this.v2l^=ue[4]^ue[20],this.v2h^=ue[5]^ue[21],this.v3l^=ue[6]^ue[22],this.v3h^=ue[7]^ue[23],this.v4l^=ue[8]^ue[24],this.v4h^=ue[9]^ue[25],this.v5l^=ue[10]^ue[26],this.v5h^=ue[11]^ue[27],this.v6l^=ue[12]^ue[28],this.v6h^=ue[13]^ue[29],this.v7l^=ue[14]^ue[30],this.v7h^=ue[15]^ue[31],Si(ue)}destroy(){this.destroyed=!0,Si(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Fue=gue(t=>new LT(t)),Bue="https://rpc.walletconnect.org/v1";function cD(t){let e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(Sue(n)).toString("hex")}async function n6(t,e,n,r,i,s){switch(n.t){case"eip191":return await r6(t,e,n.s);case"eip1271":return await i6(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function r6(t,e,n){let r=q8.Signature.fromHex(n);return q8.Secp256k1.recoverAddress({payload:cD(e),signature:r}).toLowerCase()===t.toLowerCase()}async function i6(t,e,n,r,i,s){let o=ZT(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=n.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),d=(e.startsWith("0x")?e:cD(e)).substring(2),h=a+d+c+u+l,f=await fetch(`${s||Bue}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Uue(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Uue(){return Date.now()+Math.floor(Math.random()*1e3)}function jue(t){let e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);let r=n[0];if(r===0)throw new Error("No signatures found");let i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");let s=Buffer.from(t,"base64").slice(1,65);return Gp.default.encode(s)}function Vue(t){let e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);let i=Fue(r,{dkLen:32});return Gp.default.encode(i)}function Hue(t){let e=new Uint8Array(Nb(s6(t)));return Gp.default.encode(e)}function s6(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function $ue(t){let e=Buffer.from(t,"base64"),n=z8.decode(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");let r=z8.encode(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=Mue(s);return ule.base32.encode(o).replace(/=+$/,"")}function yT(t){let e=[],n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function que(t){let e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(yT(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(yT(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(yT(r.length)),i.push(r);let s=Buffer.concat(i),o=Nb(s);return Buffer.from(o).toString("hex").toUpperCase()}function zue(t){var e,n;let r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);let i=(n=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}var Gue=Object.defineProperty,Kue=Object.defineProperties,Wue=Object.getOwnPropertyDescriptors,t4=Object.getOwnPropertySymbols,Que=Object.prototype.hasOwnProperty,Yue=Object.prototype.propertyIsEnumerable,n4=(t,e,n)=>e in t?Gue(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lD=(t,e)=>{for(var n in e||(e={}))Que.call(e,n)&&n4(t,n,e[n]);if(t4)for(var n of t4(e))Yue.call(e,n)&&n4(t,n,e[n]);return t},o6=(t,e)=>Kue(t,Wue(e)),Jue="did:pkh:",xb=t=>t?.split(":"),a6=t=>{let e=t&&xb(t);if(e)return t.includes(Jue)?e[3]:e[1]},c6=t=>{let e=t&&xb(t);if(e)return e[2]+":"+e[3]},uD=t=>{let e=t&&xb(t);if(e)return e.pop()};async function Zue(t){let{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=l6(i,i.iss),o=uD(i.iss);return await n6(o,s,r,c6(i.iss),n)}var l6=(t,e)=>{let n=`${t.domain} wants you to sign in with your Ethereum account:`,r=uD(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0,s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${a6(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,d=t.nbf?`Not Before: ${t.nbf}`:void 0,h=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=Ob(t.resources);if(p){let g=ic(p);i=fD(i,g)}return[n,r,"",i,"",s,o,a,c,l,u,d,h,f].filter(g=>g!=null).join(`
`)};function Xue(t,e,n){return n.includes("did:pkh:")||(n=`did:pkh:${n}`),{h:{t:"caip122"},p:{iss:n,domain:t.domain,aud:t.aud,version:t.version,nonce:t.nonce,iat:t.iat,statement:t.statement,requestId:t.requestId,resources:t.resources,nbf:t.nbf,exp:t.exp},s:e}}function ede(t){var e;let{authPayload:n,chains:r,methods:i}=t,s=n.statement||"";if(!(r!=null&&r.length))return n;let o=n.chains,a=NT(o,r);if(!(a!=null&&a.length))throw new Error("No supported chains");let c=u6(n.resources);if(!c)return n;qs(c);let l=d6(c,"eip155"),u=n?.resources||[];if(l!=null&&l.length){let d=h6(l),h=NT(d,i);if(!(h!=null&&h.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(d)}, supported: ${JSON.stringify(i)}`);let f=dD("request",h,{chains:a}),p=m6(c,"eip155",f);u=((e=n?.resources)==null?void 0:e.slice(0,-1))||[],u.push(Rb(p))}return o6(lD({},n),{statement:w6(s,Ob(u)),chains:a,resources:n!=null&&n.resources||u.length>0?u:void 0})}function u6(t){let e=Ob(t);if(e&&hD(e))return ic(e)}function tde(t,e){var n;return(n=t?.att)==null?void 0:n.hasOwnProperty(e)}function d6(t,e){var n,r;return(n=t?.att)!=null&&n[e]?Object.keys((r=t?.att)==null?void 0:r[e]):[]}function nde(t){return t?.map(e=>Object.keys(e))||[]}function h6(t){return t?.map(e=>{var n;return(n=e.split("/"))==null?void 0:n[1]})||[]}function f6(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function p6(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function qs(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");let e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{let r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{let s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function g6(t,e,n,r={}){return n?.sort((i,s)=>i.localeCompare(s)),{att:{[t]:dD(e,n,r)}}}function m6(t,e,n){var r;t.att[e]=lD({},n);let i=(r=Object.keys(t.att))==null?void 0:r.sort((o,a)=>o.localeCompare(a)),s={att:{}};return i.reduce((o,a)=>(o.att[a]=t.att[a],o),s)}function dD(t,e,n={}){e=e?.sort((i,s)=>i.localeCompare(s));let r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function Rb(t){return qs(t),`urn:recap:${f6(t).replace(/=/g,"")}`}function ic(t){let e=p6(t.replace("urn:recap:",""));return qs(e),e}function rde(t,e,n){let r=g6(t,e,n);return Rb(r)}function hD(t){return t&&t.includes("urn:recap:")}function ide(t,e){let n=ic(t),r=ic(e),i=y6(n,r);return Rb(i)}function y6(t,e){qs(t),qs(e);let n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=o6(lD({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function fD(t="",e){qs(e);let n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;let r=[],i=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(d=>({ability:d.split("/")[0],action:d.split("/")[1]}));c.sort((d,h)=>d.action.localeCompare(h.action));let l={};c.forEach(d=>{l[d.ability]||(l[d.ability]=[]),l[d.ability].push(d.action)});let u=Object.keys(l).map(d=>(i++,`(${i}) '${d}': '${l[d].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});let s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function sde(t){var e;let n=ic(t);qs(n);let r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function ode(t){let e=ic(t);qs(e);let n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i?.[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function w6(t,e){if(!e)return t;let n=ic(e);return qs(n),fD(t,n)}function Ob(t){if(!t)return;let e=t?.[t.length-1];return hD(e)?e:void 0}function v6(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function FT(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function wT(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ur(t,...e){if(!v6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function r4(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ade(t,e){Ur(t);let n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function tc(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Gd(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function cde(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var lde=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ude(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function BT(t){if(typeof t=="string")t=ude(t);else if(v6(t))t=UT(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function dde(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function hde(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}var fde=(t,e)=>{function n(r,...i){if(Ur(r),!lde)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ur(l):Ur(l,t.nonceLength)}let s=t.tagLength;s&&i[1]!==void 0&&Ur(i[1]);let o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ur(u)}},c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ur(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ur(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(n,t),n};function i4(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!gde(e))throw new Error("invalid output, must be aligned");return e}function s4(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function pde(t,e,n){FT(n);let r=new Uint8Array(16),i=cde(r);return s4(i,0,BigInt(e),n),s4(i,8,BigInt(t),n),r}function gde(t){return t.byteOffset%4===0}function UT(t){return Uint8Array.from(t)}var b6=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),mde=b6("expand 16-byte k"),yde=b6("expand 32-byte k"),wde=tc(mde),vde=tc(yde);function rt(t,e){return t<<e|t>>>32-e}function jT(t){return t.byteOffset%4===0}var pb=64,bde=16,E6=2**32-1,o4=new Uint32Array;function Ede(t,e,n,r,i,s,o,a){let c=i.length,l=new Uint8Array(pb),u=tc(l),d=jT(i)&&jT(s),h=d?tc(i):o4,f=d?tc(s):o4;for(let p=0;p<c;o++){if(t(e,n,r,u,o,a),o>=E6)throw new Error("arx: counter overflow");let g=Math.min(pb,c-p);if(d&&g===pb){let m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,E;y<bde;y++)E=m+y,f[E]=h[E]^u[y];p+=pb;continue}for(let m=0,y;m<g;m++)y=p+m,s[y]=i[y]^l[m];p+=g}}function Ide(t,e){let{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=dde({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return wT(i),wT(o),FT(s),FT(n),(a,c,l,u,d=0)=>{Ur(a),Ur(c),Ur(l);let h=l.length;if(u===void 0&&(u=new Uint8Array(h)),Ur(u),wT(d),d<0||d>=E6)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);let f=[],p=a.length,g,m;if(p===32)f.push(g=UT(a)),m=vde;else if(p===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),m=wde,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);jT(c)||f.push(c=UT(c));let y=tc(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,tc(c.subarray(0,16)),y),c=c.subarray(16)}let E=16-i;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){let L=new Uint8Array(12);L.set(c,s?0:12-c.length),c=L,f.push(c)}let I=tc(c);return Ede(t,m,y,I,l,u,d,o),Gd(...f),u}}var Ln=(t,e)=>t[e++]&255|(t[e++]&255)<<8,VT=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=BT(e),Ur(e,32);let n=Ln(e,0),r=Ln(e,2),i=Ln(e,4),s=Ln(e,6),o=Ln(e,8),a=Ln(e,10),c=Ln(e,12),l=Ln(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ln(e,16+2*u)}process(e,n,r=!1){let i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],d=o[4],h=o[5],f=o[6],p=o[7],g=o[8],m=o[9],y=Ln(e,n+0),E=Ln(e,n+2),I=Ln(e,n+4),L=Ln(e,n+6),k=Ln(e,n+8),N=Ln(e,n+10),B=Ln(e,n+12),U=Ln(e,n+14),T=s[0]+(y&8191),$=s[1]+((y>>>13|E<<3)&8191),K=s[2]+((E>>>10|I<<6)&8191),M=s[3]+((I>>>7|L<<9)&8191),v=s[4]+((L>>>4|k<<12)&8191),b=s[5]+(k>>>1&8191),w=s[6]+((k>>>14|N<<2)&8191),C=s[7]+((N>>>11|B<<5)&8191),x=s[8]+((B>>>8|U<<8)&8191),F=s[9]+(U>>>5|i),A=0,P=A+T*a+$*(5*m)+K*(5*g)+M*(5*p)+v*(5*f);A=P>>>13,P&=8191,P+=b*(5*h)+w*(5*d)+C*(5*u)+x*(5*l)+F*(5*c),A+=P>>>13,P&=8191;let V=A+T*c+$*a+K*(5*m)+M*(5*g)+v*(5*p);A=V>>>13,V&=8191,V+=b*(5*f)+w*(5*h)+C*(5*d)+x*(5*u)+F*(5*l),A+=V>>>13,V&=8191;let j=A+T*l+$*c+K*a+M*(5*m)+v*(5*g);A=j>>>13,j&=8191,j+=b*(5*p)+w*(5*f)+C*(5*h)+x*(5*d)+F*(5*u),A+=j>>>13,j&=8191;let oe=A+T*u+$*l+K*c+M*a+v*(5*m);A=oe>>>13,oe&=8191,oe+=b*(5*g)+w*(5*p)+C*(5*f)+x*(5*h)+F*(5*d),A+=oe>>>13,oe&=8191;let X=A+T*d+$*u+K*l+M*c+v*a;A=X>>>13,X&=8191,X+=b*(5*m)+w*(5*g)+C*(5*p)+x*(5*f)+F*(5*h),A+=X>>>13,X&=8191;let Q=A+T*h+$*d+K*u+M*l+v*c;A=Q>>>13,Q&=8191,Q+=b*a+w*(5*m)+C*(5*g)+x*(5*p)+F*(5*f),A+=Q>>>13,Q&=8191;let ae=A+T*f+$*h+K*d+M*u+v*l;A=ae>>>13,ae&=8191,ae+=b*c+w*a+C*(5*m)+x*(5*g)+F*(5*p),A+=ae>>>13,ae&=8191;let ee=A+T*p+$*f+K*h+M*d+v*u;A=ee>>>13,ee&=8191,ee+=b*l+w*c+C*a+x*(5*m)+F*(5*g),A+=ee>>>13,ee&=8191;let we=A+T*g+$*p+K*f+M*h+v*d;A=we>>>13,we&=8191,we+=b*u+w*l+C*c+x*a+F*(5*m),A+=we>>>13,we&=8191;let ne=A+T*m+$*g+K*p+M*f+v*h;A=ne>>>13,ne&=8191,ne+=b*d+w*u+C*l+x*c+F*a,A+=ne>>>13,ne&=8191,A=(A<<2)+A|0,A=A+P|0,P=A&8191,A=A>>>13,V+=A,s[0]=P,s[1]=V,s[2]=j,s[3]=oe,s[4]=X,s[5]=Q,s[6]=ae,s[7]=ee,s[8]=we,s[9]=ne}finalize(){let{h:e,pad:n}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;Gd(r)}update(e){r4(this),e=BT(e),Ur(e);let{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){let o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Gd(this.h,this.r,this.buffer,this.pad)}digestInto(e){r4(this),ade(e,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}};function Cde(t){let e=(r,i)=>t(i).update(BT(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}var Ade=Cde(t=>new VT(t));function Sde(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],d=e[1],h=e[2],f=e[3],p=e[4],g=e[5],m=e[6],y=e[7],E=i,I=n[0],L=n[1],k=n[2],N=o,B=a,U=c,T=l,$=u,K=d,M=h,v=f,b=p,w=g,C=m,x=y,F=E,A=I,P=L,V=k;for(let oe=0;oe<s;oe+=2)N=N+$|0,F=rt(F^N,16),b=b+F|0,$=rt($^b,12),N=N+$|0,F=rt(F^N,8),b=b+F|0,$=rt($^b,7),B=B+K|0,A=rt(A^B,16),w=w+A|0,K=rt(K^w,12),B=B+K|0,A=rt(A^B,8),w=w+A|0,K=rt(K^w,7),U=U+M|0,P=rt(P^U,16),C=C+P|0,M=rt(M^C,12),U=U+M|0,P=rt(P^U,8),C=C+P|0,M=rt(M^C,7),T=T+v|0,V=rt(V^T,16),x=x+V|0,v=rt(v^x,12),T=T+v|0,V=rt(V^T,8),x=x+V|0,v=rt(v^x,7),N=N+K|0,V=rt(V^N,16),C=C+V|0,K=rt(K^C,12),N=N+K|0,V=rt(V^N,8),C=C+V|0,K=rt(K^C,7),B=B+M|0,F=rt(F^B,16),x=x+F|0,M=rt(M^x,12),B=B+M|0,F=rt(F^B,8),x=x+F|0,M=rt(M^x,7),U=U+v|0,A=rt(A^U,16),b=b+A|0,v=rt(v^b,12),U=U+v|0,A=rt(A^U,8),b=b+A|0,v=rt(v^b,7),T=T+$|0,P=rt(P^T,16),w=w+P|0,$=rt($^w,12),T=T+$|0,P=rt(P^T,8),w=w+P|0,$=rt($^w,7);let j=0;r[j++]=o+N|0,r[j++]=a+B|0,r[j++]=c+U|0,r[j++]=l+T|0,r[j++]=u+$|0,r[j++]=d+K|0,r[j++]=h+M|0,r[j++]=f+v|0,r[j++]=p+b|0,r[j++]=g+w|0,r[j++]=m+C|0,r[j++]=y+x|0,r[j++]=E+F|0,r[j++]=I+A|0,r[j++]=L+P|0,r[j++]=k+V|0}var _de=Ide(Sde,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Tde=new Uint8Array(16),a4=(t,e)=>{t.update(e);let n=e.length%16;n&&t.update(Tde.subarray(n))},Dde=new Uint8Array(32);function c4(t,e,n,r,i){let s=t(e,n,Dde),o=Ade.create(s);i&&a4(o,i),a4(o,r);let a=pde(r.length,i?i.length:0,!0);o.update(a);let c=o.digest();return Gd(s,a),c}var Nde=t=>(e,n,r)=>({encrypt(i,s){let o=i.length;s=i4(o+16,s,!1),s.set(i);let a=s.subarray(0,-16);t(e,n,a,a,1);let c=c4(t,e,n,a,r);return s.set(c,o),Gd(c),s},decrypt(i,s){s=i4(i.length-16,s,!1);let o=i.subarray(0,-16),a=i.subarray(-16),c=c4(t,e,n,o,r);if(!hde(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),Gd(c),s}}),I6=fde({blockSize:64,nonceLength:12,tagLength:16},Nde(_de)),Eb=class extends zd{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Db(e);let r=ps(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Si(s)}update(e){return rc(this),this.iHash.update(e),this}digestInto(e){rc(this),gs(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Pb=(t,e,n)=>new Eb(t,e).update(n).digest();Pb.create=(t,e)=>new Eb(t,e);function xde(t,e,n){return Db(t),n===void 0&&(n=new Uint8Array(t.outputLen)),Pb(t,ps(n),ps(e))}var vT=Uint8Array.from([0]),l4=Uint8Array.of();function Rde(t,e,n,r=32){Db(t),Lo(r);let i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(r/i);n===void 0&&(n=l4);let o=new Uint8Array(s*i),a=Pb.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)vT[0]=u+1,c.update(u===0?l4:l).update(n).update(vT).digestInto(l),o.set(l,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),Si(l,vT),o.slice(0,r)}var Ode=(t,e,n,r,i)=>Rde(t,xde(t,e,n),r,i),Mb=Nb,pD=BigInt(0),HT=BigInt(1);function Ib(t,e=""){if(typeof t!="boolean"){let n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function Rl(t,e,n=""){let r=Tb(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){let o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function gb(t){let e=t.toString(16);return e.length&1?"0"+e:e}function C6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?pD:BigInt("0x"+t)}function kb(t){return C6(Hd(t))}function Cb(t){return gs(t),C6(Hd(Uint8Array.from(t).reverse()))}function gD(t,e){return vb(t.toString(16).padStart(e*2,"0"))}function mD(t,e){return gD(t,e).reverse()}function nr(t,e,n){let r;if(typeof e=="string")try{r=vb(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Tb(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}var bT=t=>typeof t=="bigint"&&pD<=t;function Pde(t,e,n){return bT(t)&&bT(e)&&bT(n)&&e<=t&&t<n}function $T(t,e,n,r){if(!Pde(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function A6(t){let e;for(e=0;t>pD;t>>=HT,e+=1);return e}var Wp=t=>(HT<<BigInt(t))-HT;function Mde(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=h=>new Uint8Array(h),i=h=>Uint8Array.of(h),s=r(t),o=r(t),a=0,c=()=>{s.fill(1),o.fill(0),a=0},l=(...h)=>n(o,s,...h),u=(h=r(0))=>{o=l(i(0),h),s=l(),h.length!==0&&(o=l(i(1),h),s=l())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,f=[];for(;h<e;){s=l();let p=s.slice();f.push(p),h+=s.length}return Xa(...f)};return(h,f)=>{c(),u(h);let p;for(;!(p=f(d()));)u();return c(),p}}function Lb(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){let a=t[i];if(o&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function u4(t){let e=new WeakMap;return(n,...r)=>{let i=e.get(n);if(i!==void 0)return i;let s=t(n,...r);return e.set(n,s),s}}var jr=BigInt(0),br=BigInt(1),Ol=BigInt(2),S6=BigInt(3),_6=BigInt(4),T6=BigInt(5),kde=BigInt(7),D6=BigInt(8),Lde=BigInt(9),N6=BigInt(16);function si(t,e){let n=t%e;return n>=jr?n:e+n}function hs(t,e,n){let r=t;for(;e-- >jr;)r*=r,r%=n;return r}function d4(t,e){if(t===jr)throw new Error("invert: expected non-zero number");if(e<=jr)throw new Error("invert: expected positive modulus, got "+e);let n=si(t,e),r=e,i=jr,s=br;for(;n!==jr;){let o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==br)throw new Error("invert: does not exist");return si(i,e)}function yD(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function x6(t,e){let n=(t.ORDER+br)/_6,r=t.pow(e,n);return yD(t,r,e),r}function Fde(t,e){let n=(t.ORDER-T6)/D6,r=t.mul(e,Ol),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Ol),i),a=t.mul(s,t.sub(o,t.ONE));return yD(t,a,e),a}function Bde(t){let e=oc(t),n=R6(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+kde)/N6;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,r),d=a.mul(l,i),h=a.mul(l,s),f=a.eql(a.sqr(u),c),p=a.eql(a.sqr(d),c);l=a.cmov(l,u,f),u=a.cmov(h,d,p);let g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return yD(a,m,c),m}}function R6(t){if(t<S6)throw new Error("sqrt is not defined for small field");let e=t-br,n=0;for(;e%Ol===jr;)e/=Ol,n++;let r=Ol,i=oc(t);for(;h4(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return x6;let s=i.pow(r,e),o=(e+br)/Ol;return function(a,c){if(a.is0(c))return c;if(h4(a,c)!==1)throw new Error("Cannot find square root");let l=n,u=a.mul(a.ONE,s),d=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(d,a.ONE);){if(a.is0(d))return a.ZERO;let f=1,p=a.sqr(d);for(;!a.eql(p,a.ONE);)if(f++,p=a.sqr(p),f===l)throw new Error("Cannot find square root");let g=br<<BigInt(l-f-1),m=a.pow(u,g);l=f,u=a.sqr(m),d=a.mul(d,u),h=a.mul(h,m)}return h}}function Ude(t){return t%_6===S6?x6:t%D6===T6?Fde:t%N6===Lde?Bde(t):R6(t)}var jde=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Vde(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=jde.reduce((r,i)=>(r[i]="function",r),e);return Lb(t,n),t}function Hde(t,e,n){if(n<jr)throw new Error("invalid exponent, negatives unsupported");if(n===jr)return t.ONE;if(n===br)return e;let r=t.ONE,i=e;for(;n>jr;)n&br&&(r=t.mul(r,i)),i=t.sqr(i),n>>=br;return r}function O6(t,e,n=!1){let r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function h4(t,e){let n=(t.ORDER-br)/Ol,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function P6(t,e){e!==void 0&&Lo(e);let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function oc(t,e,n=!1,r={}){if(t<=jr)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");let h=e;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);let{nBitLength:c,nByteLength:l}=P6(t,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u,d=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:l,MASK:Wp(c),ZERO:jr,ONE:br,allowedLengths:a,create:h=>si(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return jr<=h&&h<t},is0:h=>h===jr,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&br)===br,neg:h=>si(-h,t),eql:(h,f)=>h===f,sqr:h=>si(h*h,t),add:(h,f)=>si(h+f,t),sub:(h,f)=>si(h-f,t),mul:(h,f)=>si(h*f,t),pow:(h,f)=>Hde(d,h,f),div:(h,f)=>si(h*d4(f,t),t),sqrN:h=>h*h,addN:(h,f)=>h+f,subN:(h,f)=>h-f,mulN:(h,f)=>h*f,inv:h=>d4(h,t),sqrt:s||(h=>(u||(u=Ude(t)),u(d,h))),toBytes:h=>n?mD(h,l):gD(h,l),fromBytes:(h,f=!0)=>{if(a){if(!a.includes(h.length)||h.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);let g=new Uint8Array(l);g.set(h,n?0:g.length-h.length),h=g}if(h.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+h.length);let p=n?Cb(h):kb(h);if(o&&(p=si(p,t)),!f&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:h=>O6(d,h),cmov:(h,f,p)=>p?f:h});return Object.freeze(d)}function M6(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function k6(t){let e=M6(t);return e+Math.ceil(e/2)}function $de(t,e,n=!1){let r=t.length,i=M6(e),s=k6(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);let o=n?Cb(t):kb(t),a=si(o,e-br)+br;return n?mD(a,i):gD(a,i)}var Kd=BigInt(0),Pl=BigInt(1);function Ab(t,e){let n=e.negate();return t?n:e}function ET(t,e){let n=O6(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function L6(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function IT(t,e){L6(t,e);let n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Wp(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function f4(t,e,n){let{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n,a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Pl);let l=e*r,u=l+Math.abs(a)-1,d=a===0,h=a<0,f=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:f,offsetF:l}}function qde(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function zde(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}var CT=new WeakMap,F6=new WeakMap;function AT(t){return F6.get(t)||1}function p4(t){if(t!==Kd)throw new Error("invalid wNAF")}var qT=class{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>Kd;)n&Pl&&(r=r.add(i)),i=i.double(),n>>=Pl;return r}precomputeWindow(e,n){let{windows:r,windowSize:i}=IT(n,this.bits),s=[],o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let l=1;l<i;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE,o=IT(e,this.bits);for(let a=0;a<o.windows;a++){let{nextN:c,offset:l,isZero:u,isNeg:d,isNegF:h,offsetF:f}=f4(r,a,o);r=c,u?s=s.add(Ab(h,n[f])):i=i.add(Ab(d,n[l]))}return p4(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){let s=IT(e,this.bits);for(let o=0;o<s.windows&&r!==Kd;o++){let{nextN:a,offset:c,isZero:l,isNeg:u}=f4(r,o,s);if(r=a,!l){let d=n[c];i=i.add(u?d.negate():d)}}return p4(r),i}getPrecomputes(e,n,r){let i=CT.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),CT.set(n,i))),i}cached(e,n,r){let i=AT(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){let s=AT(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){L6(n,this.bits),F6.set(e,n),CT.delete(e)}hasCache(e){return AT(e)!==1}};function Gde(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>Kd||r>Kd;)n&Pl&&(s=s.add(i)),r&Pl&&(o=o.add(i)),i=i.double(),n>>=Pl,r>>=Pl;return{p1:s,p2:o}}function Kde(t,e,n,r){qde(n,t),zde(r,e);let i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=A6(BigInt(i)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Wp(c),u=new Array(Number(l)+1).fill(o),d=Math.floor((e.BITS-1)/c)*c,h=o;for(let f=d;f>=0;f-=c){u.fill(o);for(let g=0;g<s;g++){let m=r[g],y=Number(m>>BigInt(f)&l);u[y]=u[y].add(n[g])}let p=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),p=p.add(m);if(h=h.add(p),f!==0)for(let g=0;g<c;g++)h=h.double()}return h}function g4(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Vde(e),e}else return oc(t,{isLE:n})}function Wde(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>Kd))throw new Error(`CURVE.${a} must be positive bigint`)}let i=g4(e.p,n.Fp,r),s=g4(e.n,n.Fn,r),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Y4("HashToScalar-");var Bp=BigInt(0),Ud=BigInt(1),mb=BigInt(2);function Qde(t){return Lb(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(H({},t))}function Yde(t){let e=Qde(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");let c=o||Fl,l=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),f=a?mb**BigInt(254):mb**BigInt(447),p=a?BigInt(8)*mb**BigInt(251)-Ud:BigInt(4)*mb**BigInt(445)-Ud,g=f+p+Ud,m=M=>si(M,n),y=E(d);function E(M){return mD(m(M),u)}function I(M){let v=nr("u coordinate",M,u);return a&&(v[31]&=127),m(Cb(v))}function L(M){return Cb(i(nr("scalar",M,u)))}function k(M,v){let b=U(I(v),L(M));if(b===Bp)throw new Error("invalid private or public key received");return E(b)}function N(M){return k(M,y)}function B(M,v,b){let w=m(M*(v-b));return v=m(v-w),b=m(b+w),{x_2:v,x_3:b}}function U(M,v){$T("u",M,Bp,n),$T("scalar",v,f,g);let b=v,w=M,C=Ud,x=Bp,F=M,A=Ud,P=Bp;for(let j=BigInt(l-1);j>=Bp;j--){let oe=b>>j&Ud;P^=oe,{x_2:C,x_3:F}=B(P,C,F),{x_2:x,x_3:A}=B(P,x,A),P=oe;let X=C+x,Q=m(X*X),ae=C-x,ee=m(ae*ae),we=Q-ee,ne=F+A,be=F-A,Ot=m(be*X),vt=m(ne*ae),$t=Ot+vt,pn=Ot-vt;F=m($t*$t),A=m(w*m(pn*pn)),C=m(Q*ee),x=m(we*(Q+m(h*we)))}({x_2:C,x_3:F}=B(P,C,F)),{x_2:x,x_3:A}=B(P,x,A);let V=s(x);return m(C*V)}let T={secretKey:u,publicKey:u,seed:u},$=(M=c(u))=>(gs(M,T.seed),M);function K(M){let v=$(M);return{secretKey:v,publicKey:N(v)}}return{keygen:K,getSharedSecret:(M,v)=>k(M,v),getPublicKey:M=>N(M),scalarMult:k,scalarMultBase:N,utils:{randomSecretKey:$,randomPrivateKey:$},GuBytes:y.slice(),lengths:T}}var Jde=BigInt(1),m4=BigInt(2),Zde=BigInt(3),Xde=BigInt(5),ehe=BigInt(8),B6=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),the={p:B6,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:ehe,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function nhe(t){let e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=B6,o=t*t%s*t%s,a=hs(o,m4,s)*o%s,c=hs(a,Jde,s)*t%s,l=hs(c,Xde,s)*c%s,u=hs(l,e,s)*l%s,d=hs(u,n,s)*u%s,h=hs(d,r,s)*d%s,f=hs(h,i,s)*h%s,p=hs(f,i,s)*h%s,g=hs(p,e,s)*l%s;return{pow_p_5_8:hs(g,m4,s)*t%s,b2:o}}function rhe(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var ihe=oc(the.p,{isLE:!0}),zT=(()=>{let t=ihe.ORDER;return Yde({P:t,type:"x25519",powPminus2:e=>{let{pow_p_5_8:n,b2:r}=nhe(e);return si(hs(n,Zde,t)*r,t)},adjustScalarBytes:rhe})})(),y4=(t,e)=>(t+(t>=0?e:-e)/U6)/e;function she(t,e,n){let[[r,i],[s,o]]=e,a=y4(o*t,n),c=y4(-i*t,n),l=t-a*r-c*s,u=-a*i-c*o,d=l<Mo,h=u<Mo;d&&(l=-l),h&&(u=-u);let f=Wp(Math.ceil(A6(n)/2))+$d;if(l<Mo||l>=f||u<Mo||u>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:l,k2neg:h,k2:u}}function GT(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function ST(t,e){let n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return Ib(n.lowS,"lowS"),Ib(n.prehash,"prehash"),n.format!==void 0&&GT(n.format),n}var KT=class extends Error{constructor(e=""){super(e)}},Oo={Err:KT,_tlv:{encode:(t,e)=>{let{Err:n}=Oo;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");let r=e.length/2,i=gb(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");let s=r>127?gb(i.length/2|128):"";return gb(t)+s+i+e},decode(t,e){let{Err:n}=Oo,r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");let i=e[r++],s=!!(i&128),o=0;if(!s)o=i;else{let c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");let l=e.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(let u of l)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}let a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){let{Err:e}=Oo;if(t<Mo)throw new e("integer: negative integers are not allowed");let n=gb(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){let{Err:e}=Oo;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return kb(t)}},toSig(t){let{Err:e,_int:n,_tlv:r}=Oo,i=nr("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,s),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){let{_tlv:e,_int:n}=Oo,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},Mo=BigInt(0),$d=BigInt(1),U6=BigInt(2),yb=BigInt(3),ohe=BigInt(4);function jd(t,e){let{BYTES:n}=t,r;if(typeof e=="bigint")r=e;else{let i=nr("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function ahe(t,e={}){let n=Wde("weierstrass",t,e),{Fp:r,Fn:i}=n,s=n.CURVE,{h:o,n:a}=s;Lb(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let l=V6(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(M,v,b){let{x:w,y:C}=v.toAffine(),x=r.toBytes(w);if(Ib(b,"isCompressed"),b){u();let F=!r.isOdd(C);return Xa(j6(F),x)}else return Xa(Uint8Array.of(4),x,r.toBytes(C))}function h(M){Rl(M,void 0,"Point");let{publicKey:v,publicKeyUncompressed:b}=l,w=M.length,C=M[0],x=M.subarray(1);if(w===v&&(C===2||C===3)){let F=r.fromBytes(x);if(!r.isValid(F))throw new Error("bad point: is not on curve, wrong x");let A=g(F),P;try{P=r.sqrt(A)}catch(j){let oe=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+oe)}u();let V=r.isOdd(P);return(C&1)===1!==V&&(P=r.neg(P)),{x:F,y:P}}else if(w===b&&C===4){let F=r.BYTES,A=r.fromBytes(x.subarray(0,F)),P=r.fromBytes(x.subarray(F,F*2));if(!m(A,P))throw new Error("bad point: is not on curve");return{x:A,y:P}}else throw new Error(`bad point: got length ${w}, expected compressed=${v} or uncompressed=${b}`)}let f=e.toBytes||d,p=e.fromBytes||h;function g(M){let v=r.sqr(M),b=r.mul(v,M);return r.add(r.add(b,r.mul(M,s.a)),s.b)}function m(M,v){let b=r.sqr(v),w=g(M);return r.eql(b,w)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=r.mul(r.pow(s.a,yb),ohe),E=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(y,E)))throw new Error("bad curve params: a or b");function I(M,v,b=!1){if(!r.isValid(v)||b&&r.is0(v))throw new Error(`bad point coordinate ${M}`);return v}function L(M){if(!(M instanceof T))throw new Error("ProjectivePoint expected")}function k(M){if(!c||!c.basises)throw new Error("no endo");return she(M,c.basises,i.ORDER)}let N=u4((M,v)=>{let{X:b,Y:w,Z:C}=M;if(r.eql(C,r.ONE))return{x:b,y:w};let x=M.is0();v==null&&(v=x?r.ONE:r.inv(C));let F=r.mul(b,v),A=r.mul(w,v),P=r.mul(C,v);if(x)return{x:r.ZERO,y:r.ZERO};if(!r.eql(P,r.ONE))throw new Error("invZ was invalid");return{x:F,y:A}}),B=u4(M=>{if(M.is0()){if(e.allowInfinityPoint&&!r.is0(M.Y))return;throw new Error("bad point: ZERO")}let{x:v,y:b}=M.toAffine();if(!r.isValid(v)||!r.isValid(b))throw new Error("bad point: x or y not field elements");if(!m(v,b))throw new Error("bad point: equation left != right");if(!M.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(M,v,b,w,C){return b=new T(r.mul(b.X,M),b.Y,b.Z),v=Ab(w,v),b=Ab(C,b),v.add(b)}class T{constructor(v,b,w){this.X=I("x",v),this.Y=I("y",b,!0),this.Z=I("z",w),Object.freeze(this)}static CURVE(){return s}static fromAffine(v){let{x:b,y:w}=v||{};if(!v||!r.isValid(b)||!r.isValid(w))throw new Error("invalid affine point");if(v instanceof T)throw new Error("projective point not allowed");return r.is0(b)&&r.is0(w)?T.ZERO:new T(b,w,r.ONE)}static fromBytes(v){let b=T.fromAffine(p(Rl(v,void 0,"point")));return b.assertValidity(),b}static fromHex(v){return T.fromBytes(nr("pointHex",v))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,b=!0){return K.createCache(this,v),b||this.multiply(yb),this}assertValidity(){B(this)}hasEvenY(){let{y:v}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(v)}equals(v){L(v);let{X:b,Y:w,Z:C}=this,{X:x,Y:F,Z:A}=v,P=r.eql(r.mul(b,A),r.mul(x,C)),V=r.eql(r.mul(w,A),r.mul(F,C));return P&&V}negate(){return new T(this.X,r.neg(this.Y),this.Z)}double(){let{a:v,b}=s,w=r.mul(b,yb),{X:C,Y:x,Z:F}=this,A=r.ZERO,P=r.ZERO,V=r.ZERO,j=r.mul(C,C),oe=r.mul(x,x),X=r.mul(F,F),Q=r.mul(C,x);return Q=r.add(Q,Q),V=r.mul(C,F),V=r.add(V,V),A=r.mul(v,V),P=r.mul(w,X),P=r.add(A,P),A=r.sub(oe,P),P=r.add(oe,P),P=r.mul(A,P),A=r.mul(Q,A),V=r.mul(w,V),X=r.mul(v,X),Q=r.sub(j,X),Q=r.mul(v,Q),Q=r.add(Q,V),V=r.add(j,j),j=r.add(V,j),j=r.add(j,X),j=r.mul(j,Q),P=r.add(P,j),X=r.mul(x,F),X=r.add(X,X),j=r.mul(X,Q),A=r.sub(A,j),V=r.mul(X,oe),V=r.add(V,V),V=r.add(V,V),new T(A,P,V)}add(v){L(v);let{X:b,Y:w,Z:C}=this,{X:x,Y:F,Z:A}=v,P=r.ZERO,V=r.ZERO,j=r.ZERO,oe=s.a,X=r.mul(s.b,yb),Q=r.mul(b,x),ae=r.mul(w,F),ee=r.mul(C,A),we=r.add(b,w),ne=r.add(x,F);we=r.mul(we,ne),ne=r.add(Q,ae),we=r.sub(we,ne),ne=r.add(b,C);let be=r.add(x,A);return ne=r.mul(ne,be),be=r.add(Q,ee),ne=r.sub(ne,be),be=r.add(w,C),P=r.add(F,A),be=r.mul(be,P),P=r.add(ae,ee),be=r.sub(be,P),j=r.mul(oe,ne),P=r.mul(X,ee),j=r.add(P,j),P=r.sub(ae,j),j=r.add(ae,j),V=r.mul(P,j),ae=r.add(Q,Q),ae=r.add(ae,Q),ee=r.mul(oe,ee),ne=r.mul(X,ne),ae=r.add(ae,ee),ee=r.sub(Q,ee),ee=r.mul(oe,ee),ne=r.add(ne,ee),Q=r.mul(ae,ne),V=r.add(V,Q),Q=r.mul(be,ne),P=r.mul(we,P),P=r.sub(P,Q),Q=r.mul(we,ae),j=r.mul(be,j),j=r.add(j,Q),new T(P,V,j)}subtract(v){return this.add(v.negate())}is0(){return this.equals(T.ZERO)}multiply(v){let{endo:b}=e;if(!i.isValidNot0(v))throw new Error("invalid scalar: out of range");let w,C,x=F=>K.cached(this,F,A=>ET(T,A));if(b){let{k1neg:F,k1:A,k2neg:P,k2:V}=k(v),{p:j,f:oe}=x(A),{p:X,f:Q}=x(V);C=oe.add(Q),w=U(b.beta,j,X,F,P)}else{let{p:F,f:A}=x(v);w=F,C=A}return ET(T,[w,C])[0]}multiplyUnsafe(v){let{endo:b}=e,w=this;if(!i.isValid(v))throw new Error("invalid scalar: out of range");if(v===Mo||w.is0())return T.ZERO;if(v===$d)return w;if(K.hasCache(this))return this.multiply(v);if(b){let{k1neg:C,k1:x,k2neg:F,k2:A}=k(v),{p1:P,p2:V}=Gde(T,w,x,A);return U(b.beta,P,V,C,F)}else return K.unsafe(w,v)}multiplyAndAddUnsafe(v,b,w){let C=this.multiplyUnsafe(b).add(v.multiplyUnsafe(w));return C.is0()?void 0:C}toAffine(v){return N(this,v)}isTorsionFree(){let{isTorsionFree:v}=e;return o===$d?!0:v?v(T,this):K.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:v}=e;return o===$d?this:v?v(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(v=!0){return Ib(v,"isCompressed"),this.assertValidity(),f(T,this,v)}toHex(v=!0){return Hd(this.toBytes(v))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(v=!0){return this.toBytes(v)}_setWindowSize(v){this.precompute(v)}static normalizeZ(v){return ET(T,v)}static msm(v,b){return Kde(T,i,v,b)}static fromPrivateKey(v){return T.BASE.multiply(jd(i,v))}}T.BASE=new T(s.Gx,s.Gy,r.ONE),T.ZERO=new T(r.ZERO,r.ONE,r.ZERO),T.Fp=r,T.Fn=i;let $=i.BITS,K=new qT(T,e.endo?Math.ceil($/2):$);return T.BASE.precompute(8),T}function j6(t){return Uint8Array.of(t?2:3)}function V6(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function che(t,e={}){let{Fn:n}=t,r=e.randomBytes||Fl,i=Object.assign(V6(t.Fp,n),{seed:k6(n.ORDER)});function s(h){try{return!!jd(n,h)}catch{return!1}}function o(h,f){let{publicKey:p,publicKeyUncompressed:g}=i;try{let m=h.length;return f===!0&&m!==p||f===!1&&m!==g?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=r(i.seed)){return $de(Rl(h,i.seed,"seed"),n.ORDER)}function c(h,f=!0){return t.BASE.multiply(jd(n,h)).toBytes(f)}function l(h){let f=a(h);return{secretKey:f,publicKey:c(f)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;let{secretKey:f,publicKey:p,publicKeyUncompressed:g}=i;if(n.allowedLengths||f===p)return;let m=nr("key",h).length;return m===p||m===g}function d(h,f,p=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(f)===!1)throw new Error("second arg must be public key");let g=jd(n,h);return t.fromHex(f).multiply(g).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:d,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>jd(n,h),precompute(h=8,f=t.BASE){return f.precompute(h,!1)}},lengths:i})}function lhe(t,e,n={}){Db(e),Lb(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let r=n.randomBytes||Fl,i=n.hmac||((b,...w)=>Pb(e,b,Xa(...w))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:d,utils:h,lengths:f}=che(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(b){let w=a>>$d;return b>w}function y(b,w){if(!o.isValidNot0(w))throw new Error(`invalid signature ${b}: out of range 1..Point.Fn.ORDER`);return w}function E(b,w){GT(w);let C=f.signature,x=w==="compact"?C:w==="recovered"?C+1:void 0;return Rl(b,x,`${w} signature`)}class I{constructor(w,C,x){this.r=y("r",w),this.s=y("s",C),x!=null&&(this.recovery=x),Object.freeze(this)}static fromBytes(w,C=g){E(w,C);let x;if(C==="der"){let{r:V,s:j}=Oo.toSig(Rl(w));return new I(V,j)}C==="recovered"&&(x=w[0],C="compact",w=w.subarray(1));let F=o.BYTES,A=w.subarray(0,F),P=w.subarray(F,F*2);return new I(o.fromBytes(A),o.fromBytes(P),x)}static fromHex(w,C){return this.fromBytes(vb(w),C)}addRecoveryBit(w){return new I(this.r,this.s,w)}recoverPublicKey(w){let C=s.ORDER,{r:x,s:F,recovery:A}=this;if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");if(a*U6<C&&A>1)throw new Error("recovery id is ambiguous for h>1 curve");let P=A===2||A===3?x+a:x;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");let V=s.toBytes(P),j=t.fromBytes(Xa(j6((A&1)===0),V)),oe=o.inv(P),X=k(nr("msgHash",w)),Q=o.create(-X*oe),ae=o.create(F*oe),ee=t.BASE.multiplyUnsafe(Q).add(j.multiplyUnsafe(ae));if(ee.is0())throw new Error("point at infinify");return ee.assertValidity(),ee}hasHighS(){return m(this.s)}toBytes(w=g){if(GT(w),w==="der")return vb(Oo.hexFromSig(this));let C=o.toBytes(this.r),x=o.toBytes(this.s);if(w==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Xa(Uint8Array.of(this.recovery),C,x)}return Xa(C,x)}toHex(w){return Hd(this.toBytes(w))}assertValidity(){}static fromCompact(w){return I.fromBytes(nr("sig",w),"compact")}static fromDER(w){return I.fromBytes(nr("sig",w),"der")}normalizeS(){return this.hasHighS()?new I(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Hd(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Hd(this.toBytes("compact"))}}let L=n.bits2int||function(b){if(b.length>8192)throw new Error("input is too large");let w=kb(b),C=b.length*8-c;return C>0?w>>BigInt(C):w},k=n.bits2int_modN||function(b){return o.create(L(b))},N=Wp(c);function B(b){return $T("num < 2^"+c,b,Mo,N),o.toBytes(b)}function U(b,w){return Rl(b,void 0,"message"),w?Rl(e(b),void 0,"prehashed message"):b}function T(b,w,C){if(["recovered","canonical"].some(ae=>ae in C))throw new Error("sign() legacy options not supported");let{lowS:x,prehash:F,extraEntropy:A}=ST(C,p);b=U(b,F);let P=k(b),V=jd(o,w),j=[B(V),B(P)];if(A!=null&&A!==!1){let ae=A===!0?r(f.secretKey):A;j.push(nr("extraEntropy",ae))}let oe=Xa(...j),X=P;function Q(ae){let ee=L(ae);if(!o.isValidNot0(ee))return;let we=o.inv(ee),ne=t.BASE.multiply(ee).toAffine(),be=o.create(ne.x);if(be===Mo)return;let Ot=o.create(we*o.create(X+be*V));if(Ot===Mo)return;let vt=(ne.x===be?0:2)|Number(ne.y&$d),$t=Ot;return x&&m(Ot)&&($t=o.neg(Ot),vt^=1),new I(be,$t,vt)}return{seed:oe,k2sig:Q}}function $(b,w,C={}){b=nr("message",b);let{seed:x,k2sig:F}=T(b,w,C);return Mde(e.outputLen,o.BYTES,i)(x,F)}function K(b){let w,C=typeof b=="string"||Tb(b),x=!C&&b!==null&&typeof b=="object"&&typeof b.r=="bigint"&&typeof b.s=="bigint";if(!C&&!x)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(x)w=new I(b.r,b.s);else if(C){try{w=I.fromBytes(nr("sig",b),"der")}catch(F){if(!(F instanceof Oo.Err))throw F}if(!w)try{w=I.fromBytes(nr("sig",b),"compact")}catch{return!1}}return w||!1}function M(b,w,C,x={}){let{lowS:F,prehash:A,format:P}=ST(x,p);if(C=nr("publicKey",C),w=U(nr("message",w),A),"strict"in x)throw new Error("options.strict was renamed to lowS");let V=P===void 0?K(b):I.fromBytes(nr("sig",b),P);if(V===!1)return!1;try{let j=t.fromBytes(C);if(F&&V.hasHighS())return!1;let{r:oe,s:X}=V,Q=k(w),ae=o.inv(X),ee=o.create(Q*ae),we=o.create(oe*ae),ne=t.BASE.multiplyUnsafe(ee).add(j.multiplyUnsafe(we));return ne.is0()?!1:o.create(ne.x)===oe}catch{return!1}}function v(b,w,C={}){let{prehash:x}=ST(C,p);return w=U(w,x),I.fromBytes(b,"recovered").recoverPublicKey(w).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:d,utils:h,lengths:f,Point:t,sign:$,verify:M,recoverPublicKey:v,Signature:I,hash:e})}function uhe(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp,r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0,i=oc(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function dhe(t){let{CURVE:e,curveOpts:n}=uhe(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function hhe(t,e){let n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,P6(n.Fn.ORDER,n.Fn.BITS))})}function fhe(t){let{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=dhe(t),s=ahe(e,n),o=lhe(s,r,i);return hhe(t,o)}function WT(t,e){let n=r=>fhe(fe(H({},t),{hash:r}));return fe(H({},n(e)),{create:n})}var H6={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},$6={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},q6={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},phe=oc(H6.p),ghe=oc($6.p),mhe=oc(q6.p),yhe=WT(fe(H({},H6),{Fp:phe,lowS:!1}),Nb);WT(fe(H({},$6),{Fp:ghe,lowS:!1}),Pue),WT(fe(H({},q6),{Fp:mhe,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),Oue);var whe=yhe,wD="base10",Er="base16",qd="base64pad",Fb="base64url",Qd="utf8",vD=0,Yd=1,Qp=2,vhe=0,w4=1,Vp=12,bD=32;function bhe(){let t=zT.utils.randomPrivateKey(),e=zT.getPublicKey(t);return{privateKey:ht.toString(t,Er),publicKey:ht.toString(e,Er)}}function Ehe(){let t=Fl(bD);return ht.toString(t,Er)}function Ihe(t,e){let n=zT.getSharedSecret(ht.fromString(t,Er),ht.fromString(e,Er)),r=Ode(Mb,n,void 0,void 0,bD);return ht.toString(r,Er)}function Che(t){let e=Mb(ht.fromString(t,Er));return ht.toString(e,Er)}function Ahe(t){let e=Mb(ht.fromString(t,Qd));return ht.toString(e,Er)}function ED(t){return ht.fromString(`${t}`,wD)}function Ml(t){return Number(ht.toString(t,wD))}function z6(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function G6(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function She(t){let e=ED(typeof t.type<"u"?t.type:vD);if(Ml(e)===Yd&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let n=typeof t.senderPublicKey<"u"?ht.fromString(t.senderPublicKey,Er):void 0,r=typeof t.iv<"u"?ht.fromString(t.iv,Er):Fl(Vp),i=ht.fromString(t.symKey,Er),s=I6(i,r).encrypt(ht.fromString(t.message,Qd)),o=ID({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===Fb?z6(o):o}function _he(t){let e=ht.fromString(t.symKey,Er),{sealed:n,iv:r}=Bb({encoded:t.encoded,encoding:t.encoding}),i=I6(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return ht.toString(i,Qd)}function The(t,e){let n=ED(Qp),r=Fl(Vp),i=ht.fromString(t,Qd),s=ID({type:n,sealed:i,iv:r});return e===Fb?z6(s):s}function Dhe(t,e){let{sealed:n}=Bb({encoded:t,encoding:e});return ht.toString(n,Qd)}function ID(t){if(Ml(t.type)===Qp)return ht.toString(ht.concat([t.type,t.sealed]),qd);if(Ml(t.type)===Yd){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ht.toString(ht.concat([t.type,t.senderPublicKey,t.iv,t.sealed]),qd)}return ht.toString(ht.concat([t.type,t.iv,t.sealed]),qd)}function Bb(t){let e=(t.encoding||qd)===Fb?G6(t.encoded):t.encoded,n=ht.fromString(e,qd),r=n.slice(vhe,w4),i=w4;if(Ml(r)===Yd){let c=i+bD,l=c+Vp,u=n.slice(i,c),d=n.slice(c,l),h=n.slice(l);return{type:r,sealed:h,iv:d,senderPublicKey:u}}if(Ml(r)===Qp){let c=n.slice(i),l=Fl(Vp);return{type:r,sealed:c,iv:l}}let s=i+Vp,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function Nhe(t,e){let n=Bb({encoded:t,encoding:e?.encoding});return K6({type:Ml(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?ht.toString(n.senderPublicKey,Er):void 0,receiverPublicKey:e?.receiverPublicKey})}function K6(t){let e=t?.type||vD;if(e===Yd){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function xhe(t){return t.type===Yd&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Rhe(t){return t.type===Qp}function W6(t){let e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return ht.concat([new Uint8Array([4]),e,n])}function Ohe(t,e){let[n,r,i]=t.split("."),s=Buffer.from(G6(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");let o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,l=Mb(c),u=W6(e);if(!whe.verify(ht.concat([o,a]),l,u))throw new Error("Invalid signature");return dle.decodeJWT(t).payload}var Q6="irn";function Phe(t){return t?.relay||{protocol:Q6}}function Mhe(t){let e=hle.RELAY_JSONRPC[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var khe=Object.defineProperty,Lhe=Object.defineProperties,Fhe=Object.getOwnPropertyDescriptors,v4=Object.getOwnPropertySymbols,Bhe=Object.prototype.hasOwnProperty,Uhe=Object.prototype.propertyIsEnumerable,b4=(t,e,n)=>e in t?khe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_T=(t,e)=>{for(var n in e||(e={}))Bhe.call(e,n)&&b4(t,n,e[n]);if(v4)for(var n of v4(e))Uhe.call(e,n)&&b4(t,n,e[n]);return t},jhe=(t,e)=>Lhe(t,Fhe(e));function Y6(t,e="-"){let n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){let s=i.replace(r,""),o=t[i];n[s]=o}}),n}function Vhe(t){if(!t.includes("wc:")){let l=iD(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;let e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:J6(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:Y6(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function J6(t){return t.startsWith("//")?t.substring(2):t}function Z6(t,e="-"){let n="relay",r={};return Object.keys(t).forEach(i=>{let s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function Hhe(t){let e=new URLSearchParams,n=_T(_T(jhe(_T({},Z6(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&e.append(r,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function $he(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var qhe=Object.defineProperty,zhe=Object.defineProperties,Ghe=Object.getOwnPropertyDescriptors,E4=Object.getOwnPropertySymbols,Khe=Object.prototype.hasOwnProperty,Whe=Object.prototype.propertyIsEnumerable,I4=(t,e,n)=>e in t?qhe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qhe=(t,e)=>{for(var n in e||(e={}))Khe.call(e,n)&&I4(t,n,e[n]);if(E4)for(var n of E4(e))Whe.call(e,n)&&I4(t,n,e[n]);return t},Yhe=(t,e)=>zhe(t,Ghe(e));function Bl(t){let e=[];return t.forEach(n=>{let[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function X6(t){let e=[];return Object.values(t).forEach(n=>{e.push(...Bl(n.accounts))}),e}function e5(t,e){let n=[];return Object.values(t).forEach(r=>{Bl(r.accounts).includes(e)&&n.push(...r.methods)}),n}function t5(t,e){let n=[];return Object.values(t).forEach(r=>{Bl(r.accounts).includes(e)&&n.push(...r.events)}),n}function Jhe(t,e){let n=h5(t,e);if(n)throw new Error(n.message);let r={};for(let[i,s]of Object.entries(t))r[i]={methods:s.methods,events:s.events,chains:s.accounts.map(o=>`${o.split(":")[0]}:${o.split(":")[1]}`)};return r}function Zhe(t){var e;let{proposal:{requiredNamespaces:n,optionalNamespaces:r={}},supportedNamespaces:i}=t,s=qp(n),o=qp(r),a={};Object.keys(i).forEach(u=>{let d=i[u].chains,h=i[u].methods,f=i[u].events,p=i[u].accounts;d.forEach(g=>{if(!p.some(m=>m.includes(g)))throw new Error(`No accounts provided for chain ${g} in namespace ${u}`)}),a[u]={chains:d,methods:h,events:f,accounts:p}});let c=p5(n,a,"approve()");if(c)throw new Error(c.message);let l={};if(!Object.keys(n).length&&!Object.keys(r).length)return a;Object.keys(s).forEach(u=>{let d=i[u].chains.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.chains)==null?void 0:y.includes(g)}),h=i[u].methods.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.methods)==null?void 0:y.includes(g)}),f=i[u].events.filter(g=>{var m,y;return(y=(m=s[u])==null?void 0:m.events)==null?void 0:y.includes(g)}),p=d.map(g=>i[u].accounts.filter(m=>m.includes(`${g}:`))).flat();l[u]={chains:d,methods:h,events:f,accounts:p}}),Object.keys(o).forEach(u=>{var d,h,f,p,g,m;if(!i[u])return;let y=(h=(d=o[u])==null?void 0:d.chains)==null?void 0:h.filter(k=>i[u].chains.includes(k)),E=i[u].methods.filter(k=>{var N,B;return(B=(N=o[u])==null?void 0:N.methods)==null?void 0:B.includes(k)}),I=i[u].events.filter(k=>{var N,B;return(B=(N=o[u])==null?void 0:N.events)==null?void 0:B.includes(k)}),L=y?.map(k=>i[u].accounts.filter(N=>N.includes(`${k}:`))).flat();l[u]={chains:Ai((f=l[u])==null?void 0:f.chains,y),methods:Ai((p=l[u])==null?void 0:p.methods,E),events:Ai((g=l[u])==null?void 0:g.events,I),accounts:Ai((m=l[u])==null?void 0:m.accounts,L)}});for(let[u,d]of Object.entries(l))(d.accounts.length===0||((e=d?.chains)==null?void 0:e.length)===0)&&delete l[u];return l}function CD(t){return t.includes(":")}function n5(t){return CD(t)?t.split(":")[0]:t}function qp(t){var e,n,r;let i={};if(!Ub(t))return i;for(let[s,o]of Object.entries(t)){let a=CD(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=n5(s);i[u]=Yhe(Qhe({},i[u]),{chains:Ai(a,(e=i[u])==null?void 0:e.chains),methods:Ai(c,(n=i[u])==null?void 0:n.methods),events:Ai(l,(r=i[u])==null?void 0:r.events)})}return i}function r5(t){let e={};return t?.forEach(n=>{var r;let[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function Xhe(t,e){e=e.map(r=>r.replace("did:pkh:",""));let n=r5(e);for(let[r,i]of Object.entries(n))i.methods?i.methods=Ai(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function efe(t,e){var n,r,i,s,o,a;let c=qp(t),l=qp(e),u={},d=Object.keys(c).concat(Object.keys(l));for(let h of d)u[h]={chains:Ai((n=c[h])==null?void 0:n.chains,(r=l[h])==null?void 0:r.chains),methods:Ai((i=c[h])==null?void 0:i.methods,(s=l[h])==null?void 0:s.methods),events:Ai((o=c[h])==null?void 0:o.events,(a=l[h])==null?void 0:a.events)};return u}var i5={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},s5={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Po(t,e){let{message:n,code:r}=s5[t];return{message:e?`${n} ${e}`:n,code:r}}function kl(t,e){let{message:n,code:r}=i5[t];return{message:e?`${n} ${e}`:n,code:r}}function Yp(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Ub(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function nc(t){return typeof t>"u"}function oi(t,e){return e&&nc(t)?!0:typeof t=="string"&&!!t.trim().length}function jb(t,e){return e&&nc(t)?!0:typeof t=="number"&&!isNaN(t)}function tfe(t,e){let{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n),s=!0;return ec(i,r)?(r.forEach(o=>{let{accounts:a,methods:c,events:l}=t.namespaces[o],u=Bl(a),d=n[o];(!ec(_b(o,d),u)||!ec(d.methods,c)||!ec(d.events,l))&&(s=!1)}),s):!1}function zp(t){return oi(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function o5(t){if(oi(t,!1)&&t.includes(":")){let e=t.split(":");if(e.length===3){let n=e[0]+":"+e[1];return!!e[2]&&zp(n)}}return!1}function nfe(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(oi(t,!1)){if(e(t))return!0;let n=iD(t);return e(n)}}catch{}return!1}function rfe(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function ife(t){return t?.topic}function sfe(t,e){let n=null;return oi(t?.publicKey,!1)||(n=Po("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function QT(t){let e=!0;return Yp(t)?t.length&&(e=t.every(n=>oi(n,!1))):e=!1,e}function a5(t,e,n){let r=null;return Yp(e)&&e.length?e.forEach(i=>{r||zp(i)||(r=kl("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):zp(t)||(r=kl("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function c5(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;let o=a5(i,_b(i,s),`${e} ${n}`);o&&(r=o)}),r}function l5(t,e){let n=null;return Yp(t)?t.forEach(r=>{n||o5(r)||(n=kl("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=kl("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function u5(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;let i=l5(r?.accounts,`${e} namespace`);i&&(n=i)}),n}function d5(t,e){let n=null;return QT(t?.methods)?QT(t?.events)||(n=kl("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=kl("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function AD(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;let i=d5(r,`${e}, namespace`);i&&(n=i)}),n}function ofe(t,e,n){let r=null;if(t&&Ub(t)){let i=AD(t,e);i&&(r=i);let s=c5(t,e,n);s&&(r=s)}else r=Po("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function h5(t,e){let n=null;if(t&&Ub(t)){let r=AD(t,e);r&&(n=r);let i=u5(t,e);i&&(n=i)}else n=Po("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function f5(t){return oi(t.protocol,!0)}function afe(t,e){let n=!1;return e&&!t?n=!0:t&&Yp(t)&&t.length&&t.forEach(r=>{n=f5(r)}),n}function cfe(t){return typeof t=="number"}function lfe(t){return typeof t<"u"&&typeof t!==null}function ufe(t){return!(!t||typeof t!="object"||!t.code||!jb(t.code,!1)||!t.message||!oi(t.message,!1))}function dfe(t){return!(nc(t)||!oi(t.method,!1))}function hfe(t){return!(nc(t)||nc(t.result)&&nc(t.error)||!jb(t.id,!1)||!oi(t.jsonrpc,!1))}function ffe(t){return!(nc(t)||!oi(t.name,!1))}function pfe(t,e){return!(!zp(e)||!X6(t).includes(e))}function gfe(t,e,n){return oi(n,!1)?e5(t,e).includes(n):!1}function mfe(t,e,n){return oi(n,!1)?t5(t,e).includes(n):!1}function p5(t,e,n){let r=null,i=yfe(t),s=wfe(e),o=Object.keys(i),a=Object.keys(s),c=C4(Object.keys(t)),l=C4(Object.keys(e)),u=c.filter(d=>!l.includes(d));return u.length&&(r=Po("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),ec(o,a)||(r=Po("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(d=>{if(!d.includes(":")||r)return;let h=Bl(e[d].accounts);h.includes(d)||(r=Po("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${d}
        Required: ${d}
        Approved: ${h.toString()}`))}),o.forEach(d=>{r||(ec(i[d].methods,s[d].methods)?ec(i[d].events,s[d].events)||(r=Po("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${d}`)):r=Po("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${d}`))}),r}function yfe(t){let e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function C4(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function wfe(t){let e={};return Object.keys(t).forEach(n=>{n.includes(":")?e[n]=t[n]:Bl(t[n].accounts)?.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}),e}function vfe(t,e){return jb(t,!1)&&t<=e.max&&t>=e.min}function bfe(){let t=Ll();return new Promise(e=>{switch(t){case vr.browser:e(g5());break;case vr.reactNative:e(m5());break;case vr.node:e(y5());break;default:e(!0)}})}function g5(){return Wd()&&navigator?.onLine}async function m5(){return sc()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function y5(){return!0}function Efe(t){switch(Ll()){case vr.browser:w5(t);break;case vr.reactNative:v5(t);break;case vr.node:break}}function w5(t){!sc()&&Wd()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function v5(t){sc()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function Ife(){var t;return Wd()&&ko.getDocument()?((t=ko.getDocument())==null?void 0:t.visibilityState)==="visible":!0}var TT={},YT=class{static get(e){return TT[e]}static set(e,n){TT[e]=n}static delete(e){delete TT[e]}};function b5(t){let e=Gp.default.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function E5({publicKey:t,signature:e,payload:n}){var r;let i=JT(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=Afe(n.address),a=n.era==="00"?new Uint8Array([0]):JT(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(n.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${Cfe(n.tip)}`),d=_fe(u),h=new Uint8Array([0,...t,o,...e,...a,...l,...d,...i]),f=Sfe(h.length+1);return new Uint8Array([...f,s,...h])}function I5(t){let e=JT(t),n=fle.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function JT(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Cfe(t){return t.startsWith("0x")?t.slice(2):t}function Afe(t){let e=Gp.default.decode(t)[0];return e===42?0:e===60?2:1}function Sfe(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){let e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){let e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function _fe(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){let e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){let e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Tfe(t){let e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=b5(t.transaction.address),r=E5({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return I5(i)}function Dfe({logger:t,name:e}){let n=typeof t=="string"?ple.generatePlatformLogger({opts:{level:t,name:e}}).logger:t;return n.level=typeof t=="string"?t:t.level,n}O.BASE10=wD,O.BASE16=Er,O.BASE64=qd,O.BASE64URL=Fb,O.COLON=Tle,O.DEFAULT_DEPTH=tD,O.EMPTY_SPACE=wb,O.ENV_MAP=vr,O.INTERNAL_ERRORS=s5,O.LimitedSet=xT,O.MemoryStore=YT,O.ONE_THOUSAND=Dle,O.REACT_NATIVE_PRODUCT=N4,O.RELAYER_DEFAULT_PROTOCOL=Q6,O.SDK_ERRORS=i5,O.SDK_TYPE=R4,O.SLASH=x4,O.TYPE_0=vD,O.TYPE_1=Yd,O.TYPE_2=Qp,O.UTF8=Qd,O.addResourceToRecap=m6,O.addSignatureToExtrinsic=E5,O.appendToQueryString=O4,O.assertType=Lle,O.assignAbilityToActions=dD,O.base64Decode=p6,O.base64Encode=f6,O.buildApprovedNamespaces=Zhe,O.buildAuthObject=Xue,O.buildNamespacesFromAuth=Xhe,O.buildRecapStatement=w6,O.buildSignedExtrinsicHash=Tfe,O.calcExpiry=Wle,O.capitalize=Hle,O.capitalizeWord=U4,O.createDelayedPromise=$le,O.createEncodedRecap=rde,O.createExpiringPromise=qle,O.createLogger=Dfe,O.createRecap=g6,O.decodeRecap=ic,O.decodeTypeByte=Ml,O.decodeTypeTwoEnvelope=Dhe,O.decrypt=_he,O.deriveExtrinsicHash=I5,O.deriveSymKey=Ihe,O.deserialize=Bb,O.encodeRecap=Rb,O.encodeTypeByte=ED,O.encodeTypeTwoEnvelope=The,O.encrypt=She,O.engineEvent=Yle,O.enumify=Vle,O.extractSolanaTransactionId=jue,O.formatAccountId=S4,O.formatAccountWithChain=mle,O.formatChainId=A4,O.formatDeeplinkUrl=j4,O.formatExpirerTarget=rD,O.formatIdTarget=Gle,O.formatMessage=l6,O.formatMessageContext=Fle,O.formatRelayParams=Z6,O.formatRelayRpcUrl=Mle,O.formatStatementFromRecap=fD,O.formatTopicTarget=zle,O.formatUA=L4,O.formatUri=Hhe,O.fromBase64=iD,O.generateKeyPair=bhe,O.generateRandomBytes32=Ehe,O.getAccountsChains=Bl,O.getAccountsFromNamespaces=wle,O.getAddressFromAccount=_4,O.getAddressesFromAccounts=yle,O.getAlgorandTransactionId=$ue,O.getAppId=Rle,O.getAppMetadata=P4,O.getBrowserOnlineStatus=g5,O.getChainFromAccount=T4,O.getChainsFromAccounts=D4,O.getChainsFromNamespace=_b,O.getChainsFromNamespaces=vle,O.getChainsFromRecap=ode,O.getChainsFromRequiredNamespaces=ble,O.getCommonValuesInArrays=NT,O.getCryptoKeyFromKeyData=W6,O.getDecodedRecapFromResources=u6,O.getDeepLink=Zle,O.getDidAddress=uD,O.getDidAddressSegments=xb,O.getDidChainId=a6,O.getEnvironment=Ll,O.getHttpUrl=kle,O.getInternalError=Po,O.getJavascriptID=k4,O.getJavascriptOS=M4,O.getLastItems=B4,O.getLinkModeURL=$he,O.getMethodsFromRecap=sde,O.getNamespacedDidChainId=c6,O.getNamespacesChains=X6,O.getNamespacesEventsForChainId=t5,O.getNamespacesFromAccounts=r5,O.getNamespacesMethodsForChainId=e5,O.getNearTransactionIdFromSignedTransaction=Hue,O.getNearUint8ArrayFromBytes=s6,O.getNodeOnlineStatus=y5,O.getReCapActions=h6,O.getReactNativeOnlineStatus=m5,O.getRecapAbilitiesFromResource=nde,O.getRecapFromResources=Ob,O.getRecapResource=d6,O.getRelayClientMetadata=Ple,O.getRelayProtocolApi=Mhe,O.getRelayProtocolName=Phe,O.getRequiredNamespacesFromNamespaces=Jhe,O.getSdkError=kl,O.getSearchParamFromURL=Xle,O.getSignDirectHash=que,O.getSuiDigest=Vue,O.getUniqueValues=eD,O.getWalletSendCallsHashes=zue,O.handleDeeplinkRedirect=Jle,O.hasOverlap=ec,O.hashEthereumMessage=cD,O.hashKey=Che,O.hashMessage=Ahe,O.isAndroid=Nle,O.isAppVisible=Ife,O.isBrowser=Wd,O.isCaipNamespace=CD,O.isConformingNamespaces=p5,O.isExpired=Qle,O.isIframe=$4,O.isIos=xle,O.isNode=nD,O.isOnline=bfe,O.isProposalStruct=rfe,O.isReactNative=sc,O.isRecap=hD,O.isSessionCompatible=tfe,O.isSessionStruct=ife,O.isTelegram=H4,O.isTestRun=tue,O.isTypeOneEnvelope=xhe,O.isTypeTwoEnvelope=Rhe,O.isUndefined=nc,O.isValidAccountId=o5,O.isValidAccounts=l5,O.isValidActions=d5,O.isValidArray=Yp,O.isValidChainId=zp,O.isValidChains=a5,O.isValidController=sfe,O.isValidEip1271Signature=i6,O.isValidEip191Signature=r6,O.isValidErrorReason=ufe,O.isValidEvent=ffe,O.isValidId=cfe,O.isValidNamespaceAccounts=u5,O.isValidNamespaceActions=AD,O.isValidNamespaceChains=c5,O.isValidNamespaceMethodsOrEvents=QT,O.isValidNamespaces=h5,O.isValidNamespacesChainId=pfe,O.isValidNamespacesEvent=mfe,O.isValidNamespacesRequest=gfe,O.isValidNumber=jb,O.isValidObject=Ub,O.isValidParams=lfe,O.isValidRecap=qs,O.isValidRelay=f5,O.isValidRelays=afe,O.isValidRequest=dfe,O.isValidRequestExpiry=vfe,O.isValidRequiredNamespaces=ofe,O.isValidResponse=hfe,O.isValidString=oi,O.isValidUrl=nfe,O.mapEntries=jle,O.mapToObj=Ble,O.mergeArrays=Ai,O.mergeEncodedRecaps=ide,O.mergeRecaps=y6,O.mergeRequiredAndOptionalNamespaces=efe,O.normalizeNamespaces=qp,O.objToMap=Ule,O.openDeeplink=V4,O.parseAccountId=XT,O.parseChainId=ZT,O.parseContextNames=F4,O.parseExpirerTarget=Kle,O.parseNamespaceKey=n5,O.parseRelayParams=Y6,O.parseTopic=J6,O.parseUri=Vhe,O.populateAppMetadata=Ole,O.populateAuthPayload=ede,O.recapHasResource=tde,O.serialize=ID,O.sleep=nue,O.ss58AddressToPublicKey=b5,O.subscribeToBrowserNetworkChange=w5,O.subscribeToNetworkChange=Efe,O.subscribeToReactNativeNetworkChange=v5,O.toBase64=q4,O.uuidv4=eue,O.validateDecoding=Nhe,O.validateEncoding=K6,O.validateSignedCacao=Zue,O.verifyP256Jwt=Ohe,O.verifySignature=n6});var FV=vs(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});var jl=Ks(),Vl=(KN(),Pe(GN)),Nfe=(QN(),Pe(WN)),xt=(db(),Pe(ub)),ys=(gT(),Pe(pT)),_e=Wl(),SD=(_0(),Pe(VN)),ND=(pg(),Pe(fg)),z=Vb(),xfe=(mg(),Pe(gg)),Rfe=(wg(),Pe(yg)),Ir=(Yl(),Pe(Ql)),Ofe=(JN(),Pe(YN)),Pfe=hg();function QD(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}function Mfe(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var kfe=QD(jl),Lfe=QD(Nfe),Hb=Mfe(ND),Ffe=QD(Ofe),YD="wc",JD=2,rg="core",ms=`${YD}@2:${rg}:`,z5={name:rg,logger:"error"},G5={database:":memory:"},K5="crypto",xD="client_ed25519_seed",W5=_e.ONE_DAY,Q5="keychain",Y5="0.3",J5="messages",Z5="0.3",X5=_e.SIX_HOURS,eV="publisher",tV="irn",nV="error",ZD="wss://relay.walletconnect.org",rV="relayer",on={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},iV="_subscription",ci={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},sV=.1,Bfe={database:":memory:"},$b="2.22.4",Ufe=1e4,Ul={link_mode:"link_mode",relay:"relay"},eg={inbound:"inbound",outbound:"outbound"},oV="0.3",aV="WALLETCONNECT_CLIENT_ID",RD="WALLETCONNECT_LINK_MODE_APPS",Hr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},jfe=_e.THIRTY_DAYS,cV="subscription",lV="0.3",Vfe=_e.FIVE_SECONDS*1e3,uV="pairing",dV="0.3",Hfe=_e.THIRTY_DAYS,Xd={wc_pairingDelete:{req:{ttl:_e.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:_e.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:_e.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:_e.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:_e.ONE_DAY,prompt:!1,tag:0},res:{ttl:_e.ONE_DAY,prompt:!1,tag:0}}},eh={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ti={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},hV="history",fV="0.3",pV="expirer",Di={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},gV="0.3",$fe=_e.ONE_DAY,mV="verify-api",qfe="https://verify.walletconnect.com",yV="https://verify.walletconnect.org",tg=yV,wV=`${tg}/v3`,vV=[qfe,yV],bV="echo",EV="https://echo.walletconnect.com",zfe="event-client",Gs={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Fo={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Gfe={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Kfe={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Wfe={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Qfe={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},IV=.1,CV="event-client",AV=86400,SV="https://pulse.walletconnect.org/batch";function Yfe(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,y=0,E=p.length;y!==E&&p[y]===0;)y++,g++;for(var I=(E-y)*u+1>>>0,L=new Uint8Array(I);y!==E;){for(var k=p[y],N=0,B=I-1;(k!==0||N<m)&&B!==-1;B--,N++)k+=256*L[B]>>>0,L[B]=k%a>>>0,k=k/a>>>0;if(k!==0)throw new Error("Non-zero carry");m=N,y++}for(var U=I-m;U!==I&&L[U]===0;)U++;for(var T=c.repeat(g);U<I;++U)T+=t.charAt(L[U]);return T}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,y=0;p[g]===c;)m++,g++;for(var E=(p.length-g)*l+1>>>0,I=new Uint8Array(E);p[g];){var L=n[p.charCodeAt(g)];if(L===255)return;for(var k=0,N=E-1;(L!==0||k<y)&&N!==-1;N--,k++)L+=a*I[N]>>>0,I[N]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");y=k,g++}if(p[g]!==" "){for(var B=E-y;B!==E&&I[B]===0;)B++;for(var U=new Uint8Array(m+(E-B)),T=m;B!==E;)U[T++]=I[B++];return U}}}function f(p){var g=h(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:h,decode:f}}var Jfe=Yfe,Zfe=Jfe,_V=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Xfe=t=>new TextEncoder().encode(t),epe=t=>new TextDecoder().decode(t),OD=class{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},PD=class{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return TV(this,e)}},MD=class{constructor(e){this.decoders=e}or(e){return TV(this,e)}decode(e){let n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},TV=(t,e)=>new MD(H(H({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),kD=class{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new OD(e,n,r),this.decoder=new PD(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},r0=({name:t,prefix:e,encode:n,decode:r})=>new kD(t,e,n,r),ig=({prefix:t,name:e,alphabet:n})=>{let{encode:r,decode:i}=Zfe(n,e);return r0({prefix:t,name:e,encode:r,decode:s=>_V(i(s))})},tpe=(t,e,n,r)=>{let i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;let o=new Uint8Array(s*n/8|0),a=0,c=0,l=0;for(let u=0;u<s;++u){let d=i[t[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|d,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},npe=(t,e,n)=>{let r=e[e.length-1]==="=",i=(1<<n)-1,s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Bn=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>r0({prefix:e,name:t,encode(i){return npe(i,r,n)},decode(i){return tpe(i,r,n,t)}}),rpe=r0({prefix:"\0",name:"identity",encode:t=>epe(t),decode:t=>Xfe(t)}),ipe=Object.freeze({__proto__:null,identity:rpe}),spe=Bn({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ope=Object.freeze({__proto__:null,base2:spe}),ape=Bn({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),cpe=Object.freeze({__proto__:null,base8:ape}),lpe=ig({prefix:"9",name:"base10",alphabet:"0123456789"}),upe=Object.freeze({__proto__:null,base10:lpe}),dpe=Bn({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hpe=Bn({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),fpe=Object.freeze({__proto__:null,base16:dpe,base16upper:hpe}),ppe=Bn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gpe=Bn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mpe=Bn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ype=Bn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wpe=Bn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vpe=Bn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bpe=Bn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Epe=Bn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ipe=Bn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Cpe=Object.freeze({__proto__:null,base32:ppe,base32upper:gpe,base32pad:mpe,base32padupper:ype,base32hex:wpe,base32hexupper:vpe,base32hexpad:bpe,base32hexpadupper:Epe,base32z:Ipe}),Ape=ig({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Spe=ig({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),_pe=Object.freeze({__proto__:null,base36:Ape,base36upper:Spe}),Tpe=ig({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Dpe=ig({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Npe=Object.freeze({__proto__:null,base58btc:Tpe,base58flickr:Dpe}),xpe=Bn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Rpe=Bn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ope=Bn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ppe=Bn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Mpe=Object.freeze({__proto__:null,base64:xpe,base64pad:Rpe,base64url:Ope,base64urlpad:Ppe}),DV=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),kpe=DV.reduce((t,e,n)=>(t[n]=e,t),[]),Lpe=DV.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Fpe(t){return t.reduce((e,n)=>(e+=kpe[n],e),"")}function Bpe(t){let e=[];for(let n of t){let r=Lpe[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}var Upe=r0({prefix:"\u{1F680}",name:"base256emoji",encode:Fpe,decode:Bpe}),jpe=Object.freeze({__proto__:null,base256emoji:Upe}),Vpe=NV,C5=128,Hpe=127,$pe=~Hpe,qpe=Math.pow(2,31);function NV(t,e,n){e=e||[],n=n||0;for(var r=n;t>=qpe;)e[n++]=t&255|C5,t/=128;for(;t&$pe;)e[n++]=t&255|C5,t>>>=7;return e[n]=t|0,NV.bytes=n-r+1,e}var zpe=LD,Gpe=128,A5=127;function LD(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw LD.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&A5)<<i:(o&A5)*Math.pow(2,i),i+=7}while(o>=Gpe);return LD.bytes=s-r,n}var Kpe=Math.pow(2,7),Wpe=Math.pow(2,14),Qpe=Math.pow(2,21),Ype=Math.pow(2,28),Jpe=Math.pow(2,35),Zpe=Math.pow(2,42),Xpe=Math.pow(2,49),ege=Math.pow(2,56),tge=Math.pow(2,63),nge=function(t){return t<Kpe?1:t<Wpe?2:t<Qpe?3:t<Ype?4:t<Jpe?5:t<Zpe?6:t<Xpe?7:t<ege?8:t<tge?9:10},rge={encode:Vpe,decode:zpe,encodingLength:nge},xV=rge,S5=(t,e,n=0)=>(xV.encode(t,e,n),e),_5=t=>xV.encodingLength(t),FD=(t,e)=>{let n=e.byteLength,r=_5(t),i=r+_5(n),s=new Uint8Array(i+n);return S5(t,s,0),S5(n,s,r),s.set(e,i),new BD(t,n,e,s)},BD=class{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}},RV=({name:t,code:e,encode:n})=>new UD(t,e,n),UD=class{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){let n=this.encode(e);return n instanceof Uint8Array?FD(this.code,n):n.then(r=>FD(this.code,r))}else throw Error("Unknown type, must be binary type")}},OV=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),ige=RV({name:"sha2-256",code:18,encode:OV("SHA-256")}),sge=RV({name:"sha2-512",code:19,encode:OV("SHA-512")}),oge=Object.freeze({__proto__:null,sha256:ige,sha512:sge}),PV=0,age="identity",MV=_V,cge=t=>FD(PV,MV(t)),lge={code:PV,name:age,encode:MV,digest:cge},uge=Object.freeze({__proto__:null,identity:lge});new TextEncoder,new TextDecoder;var T5=H(H(H(H(H(H(H(H(H(H({},ipe),ope),cpe),upe),fpe),Cpe),_pe),Npe),Mpe),jpe);H(H({},oge),uge);function kV(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function dge(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?kV(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function LV(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}var D5=LV("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),_D=LV("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);let e=dge(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),hge=H({utf8:D5,"utf-8":D5,hex:T5.base16,latin1:_D,ascii:_D,binary:_D},T5);function fge(t,e="utf8"){let n=hge[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?kV(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var pge=Object.defineProperty,gge=(t,e,n)=>e in t?pge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zs=(t,e,n)=>gge(t,typeof e!="symbol"?e+"":e,n),qb=class{constructor(e,n){this.core=e,this.logger=n,zs(this,"keychain",new Map),zs(this,"name",Q5),zs(this,"version",Y5),zs(this,"initialized",!1),zs(this,"storagePrefix",ms),zs(this,"init",async()=>{if(!this.initialized){let r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),zs(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),zs(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),zs(this,"get",r=>{this.isInitialized();let i=this.keychain.get(r);if(typeof i>"u"){let{message:s}=z.getInternalError("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),zs(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=xt.generateChildLogger(n,this.name)}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,z.mapToObj(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?z.objToMap(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},mge=Object.defineProperty,yge=(t,e,n)=>e in t?mge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sn=(t,e,n)=>yge(t,typeof e!="symbol"?e+"":e,n),zb=class{constructor(e,n,r){this.core=e,this.logger=n,Sn(this,"name",K5),Sn(this,"keychain"),Sn(this,"randomSessionIdentifier",z.generateRandomBytes32()),Sn(this,"initialized",!1),Sn(this,"clientId"),Sn(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Sn(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Sn(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let i=await this.getClientSeed(),s=Hb.generateKeyPair(i),o=Hb.encodeIss(s.publicKey);return this.clientId=o,o}),Sn(this,"generateKeyPair",()=>{this.isInitialized();let i=z.generateKeyPair();return this.setPrivateKey(i.publicKey,i.privateKey)}),Sn(this,"signJWT",async i=>{this.isInitialized();let s=await this.getClientSeed(),o=Hb.generateKeyPair(s),a=this.randomSessionIdentifier,c=W5;return await Hb.signJWT(a,i,c,o)}),Sn(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();let a=this.getPrivateKey(i),c=z.deriveSymKey(a,s);return this.setSymKey(c,o)}),Sn(this,"setSymKey",async(i,s)=>{this.isInitialized();let o=s||z.hashKey(i);return await this.keychain.set(o,i),o}),Sn(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Sn(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Sn(this,"encode",async(i,s,o)=>{this.isInitialized();let a=z.validateEncoding(o),c=SD.safeJsonStringify(s);if(z.isTypeTwoEnvelope(a))return z.encodeTypeTwoEnvelope(c,o?.encoding);if(z.isTypeOneEnvelope(a)){let h=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(h,f)}let l=this.getSymKey(i),{type:u,senderPublicKey:d}=a;return z.encrypt({type:u,symKey:l,message:c,senderPublicKey:d,encoding:o?.encoding})}),Sn(this,"decode",async(i,s,o)=>{this.isInitialized();let a=z.validateDecoding(s,o);if(z.isTypeTwoEnvelope(a)){let c=z.decodeTypeTwoEnvelope(s,o?.encoding);return SD.safeJsonParse(c)}if(z.isTypeOneEnvelope(a)){let c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{let c=this.getSymKey(i),l=z.decrypt({symKey:c,encoded:s,encoding:o?.encoding});return SD.safeJsonParse(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Sn(this,"getPayloadType",(i,s=z.BASE64)=>{let o=z.deserialize({encoded:i,encoding:s});return z.decodeTypeByte(o.type)}),Sn(this,"getPayloadSenderPublicKey",(i,s=z.BASE64)=>{let o=z.deserialize({encoded:i,encoding:s});return o.senderPublicKey?xfe.toString(o.senderPublicKey,z.BASE16):void 0}),this.core=e,this.logger=xt.generateChildLogger(n,this.name),this.keychain=r||new qb(this.core,this.logger)}get context(){return xt.getLoggerContext(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(xD)}catch{e=z.generateRandomBytes32(),await this.keychain.set(xD,e)}return fge(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},wge=Object.defineProperty,vge=Object.defineProperties,bge=Object.getOwnPropertyDescriptors,N5=Object.getOwnPropertySymbols,Ege=Object.prototype.hasOwnProperty,Ige=Object.prototype.propertyIsEnumerable,jD=(t,e,n)=>e in t?wge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cge=(t,e)=>{for(var n in e||(e={}))Ege.call(e,n)&&jD(t,n,e[n]);if(N5)for(var n of N5(e))Ige.call(e,n)&&jD(t,n,e[n]);return t},Age=(t,e)=>vge(t,bge(e)),ai=(t,e,n)=>jD(t,typeof e!="symbol"?e+"":e,n),Gb=class extends ys.IMessageTracker{constructor(e,n){super(e,n),this.logger=e,this.core=n,ai(this,"messages",new Map),ai(this,"messagesWithoutClientAck",new Map),ai(this,"name",J5),ai(this,"version",Z5),ai(this,"initialized",!1),ai(this,"storagePrefix",ms),ai(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);let i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ai(this,"set",async(r,i,s)=>{this.isInitialized();let o=z.hashMessage(i),a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===eg.inbound){let c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,Age(Cge({},c),{[o]:i}))}return await this.persist(),o}),ai(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),ai(this,"getWithoutAck",r=>{this.isInitialized();let i={};for(let s of r){let o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),ai(this,"has",(r,i)=>{this.isInitialized();let s=this.get(r),o=z.hashMessage(i);return typeof s[o]<"u"}),ai(this,"ack",async(r,i)=>{this.isInitialized();let s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;let o=z.hashMessage(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ai(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=xt.generateChildLogger(e,this.name),this.core=n}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,z.mapToObj(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,z.mapToObj(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?z.objToMap(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?z.objToMap(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Sge=Object.defineProperty,_ge=Object.defineProperties,Tge=Object.getOwnPropertyDescriptors,x5=Object.getOwnPropertySymbols,Dge=Object.prototype.hasOwnProperty,Nge=Object.prototype.propertyIsEnumerable,VD=(t,e,n)=>e in t?Sge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jd=(t,e)=>{for(var n in e||(e={}))Dge.call(e,n)&&VD(t,n,e[n]);if(x5)for(var n of x5(e))Nge.call(e,n)&&VD(t,n,e[n]);return t},R5=(t,e)=>_ge(t,Tge(e)),_i=(t,e,n)=>VD(t,typeof e!="symbol"?e+"":e,n),HD=class extends ys.IPublisher{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,_i(this,"events",new jl.EventEmitter),_i(this,"name",eV),_i(this,"queue",new Map),_i(this,"publishTimeout",_e.toMiliseconds(_e.ONE_MINUTE)),_i(this,"initialPublishTimeout",_e.toMiliseconds(_e.ONE_SECOND*15)),_i(this,"needsTransportRestart",!1),_i(this,"publish",async(r,i,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});let d=s?.ttl||X5,h=s?.prompt||!1,f=s?.tag||0,p=s?.id||Ir.getBigIntRpcId().toString(),g=z.getRelayProtocolApi(z.getRelayProtocolName().protocol),m={id:p,method:s?.publishMethod||g.publish,params:Jd({topic:r,message:i,ttl:d,prompt:h,tag:f,attestation:s?.attestation},s?.tvf)},y=`Failed to publish payload, please try again. id:${p} tag:${f}`;try{z.isUndefined((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),z.isUndefined((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);let E=new Promise(async I=>{let L=({id:N})=>{var B;((B=m.id)==null?void 0:B.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(on.publish,L),I())};this.relayer.events.on(on.publish,L);let k=z.createExpiringPromise(new Promise((N,B)=>{this.rpcPublish(m,s).then(N).catch(U=>{this.logger.warn(U,U?.message),B(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${f}`);try{await k,this.events.removeListener(on.publish,L)}catch(N){this.queue.set(p,{request:m,opts:s,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:r,message:i,opts:s}}),await z.createExpiringPromise(E,this.publishTimeout,y)}catch(E){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(E),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw E}finally{this.queue.delete(p)}}),_i(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});let{payload:l,opts:u={}}=r,{attestation:d,tvf:h,publishMethod:f,prompt:p,tag:g,ttl:m=_e.FIVE_MINUTES}=u,y=u.id||Ir.getBigIntRpcId().toString(),E=z.getRelayProtocolApi(z.getRelayProtocolName().protocol),I=f||E.publish,L={id:y,method:I,params:Jd(R5(Jd({},l),{ttl:m,prompt:p,tag:g,attestation:d}),h)},k=`Failed to publish custom payload, please try again. id:${y} tag:${g}`;try{z.isUndefined((i=L.params)==null?void 0:i.prompt)&&((s=L.params)==null||delete s.prompt),z.isUndefined((o=L.params)==null?void 0:o.tag)&&((a=L.params)==null||delete a.tag);let N=new Promise(async B=>{let U=({id:$})=>{var K;((K=L.id)==null?void 0:K.toString())===$.toString()&&(this.removeRequestFromQueue($),this.relayer.events.removeListener(on.publish,U),B())};this.relayer.events.on(on.publish,U);let T=z.createExpiringPromise(new Promise(($,K)=>{this.rpcPublish(L,u).then($).catch(M=>{this.logger.warn(M,M?.message),K(M)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${I} id:${y} tag:${g}`);try{await T,this.events.removeListener(on.publish,U)}catch($){this.queue.set(y,{request:L,opts:u,attempt:1}),this.logger.warn($,$?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:y,payload:l,opts:u}}),await z.createExpiringPromise(N,this.publishTimeout,k)}catch(N){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(N),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw N}finally{this.queue.delete(y)}}),_i(this,"on",(r,i)=>{this.events.on(r,i)}),_i(this,"once",(r,i)=>{this.events.once(r,i)}),_i(this,"off",(r,i)=>{this.events.off(r,i)}),_i(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=xt.generateChildLogger(n,this.name),this.registerEventListeners()}get context(){return xt.getLoggerContext(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=await this.relayer.request(e);return this.relayer.events.emit(on.publish,Jd(Jd({},e),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var r;let i=e.attempt+1;this.queue.set(n,R5(Jd({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(on.connection_stalled);return}this.checkQueue()}),this.relayer.on(on.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},xge=Object.defineProperty,Rge=(t,e,n)=>e in t?xge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zd=(t,e,n)=>Rge(t,typeof e!="symbol"?e+"":e,n),$D=class{constructor(){Zd(this,"map",new Map),Zd(this,"set",(e,n)=>{let r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),Zd(this,"get",e=>this.map.get(e)||[]),Zd(this,"exists",(e,n)=>this.get(e).includes(n)),Zd(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,n))return;let i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Zd(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},Oge=Object.defineProperty,Pge=Object.defineProperties,Mge=Object.getOwnPropertyDescriptors,O5=Object.getOwnPropertySymbols,kge=Object.prototype.hasOwnProperty,Lge=Object.prototype.propertyIsEnumerable,qD=(t,e,n)=>e in t?Oge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jp=(t,e)=>{for(var n in e||(e={}))kge.call(e,n)&&qD(t,n,e[n]);if(O5)for(var n of O5(e))Lge.call(e,n)&&qD(t,n,e[n]);return t},TD=(t,e)=>Pge(t,Mge(e)),Nt=(t,e,n)=>qD(t,typeof e!="symbol"?e+"":e,n),Kb=class extends ys.ISubscriber{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Nt(this,"subscriptions",new Map),Nt(this,"topicMap",new $D),Nt(this,"events",new jl.EventEmitter),Nt(this,"name",cV),Nt(this,"version",lV),Nt(this,"pending",new Map),Nt(this,"cached",[]),Nt(this,"initialized",!1),Nt(this,"storagePrefix",ms),Nt(this,"subscribeTimeout",_e.toMiliseconds(_e.ONE_MINUTE)),Nt(this,"initialSubscribeTimeout",_e.toMiliseconds(_e.ONE_SECOND*15)),Nt(this,"clientId"),Nt(this,"batchSubscribeTopicsLimit",500),Nt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Nt(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{let o=z.getRelayProtocolName(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);let c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Nt(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Nt(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Nt(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),Nt(this,"on",(r,i)=>{this.events.on(r,i)}),Nt(this,"once",(r,i)=>{this.events.once(r,i)}),Nt(this,"off",(r,i)=>{this.events.off(r,i)}),Nt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Nt(this,"start",async()=>{await this.onConnect()}),Nt(this,"stop",async()=>{await this.onDisconnect()}),Nt(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Nt(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Nt(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(Hr.created,async r=>{let i=Hr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Hr.deleted,async r=>{let i=Hr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=xt.generateChildLogger(n,this.name),this.clientId=""}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){let r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{let i=z.getRelayProtocolName(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);let s=z.getSdkError("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i,s;let o=await this.getSubscriptionId(e);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===Ul.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});let a={method:z.getRelayProtocolApi(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===Ul.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(d=>this.logger.warn(d))},_e.toMiliseconds(_e.ONE_SECOND)),o;let l=new Promise(async d=>{let h=f=>{f.topic===e&&(this.events.removeListener(Hr.created,h),d(f.id))};this.events.on(Hr.created,h);try{let f=await z.createExpiringPromise(new Promise((p,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Hr.created,h),d(f)}catch{}}),u=await z.createExpiringPromise(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(on.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;let n=e[0].relay,r={method:z.getRelayProtocolApi(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await z.createExpiringPromise(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(on.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let n=e[0].relay,r={method:z.getRelayProtocolApi(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await z.createExpiringPromise(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(on.connection_stalled)}return i}rpcUnsubscribe(e,n,r){let i={method:z.getRelayProtocolApi(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,TD(Jp({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Jp({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Jp({},n)),this.topicMap.set(n.topic,e),this.events.emit(Hr.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let n=this.subscriptions.get(e);if(!n){let{message:r}=z.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Hr.deleted,TD(Jp({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Hr.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){let i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Hr.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){let{message:n}=z.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>TD(Jp({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await z.sleep(_e.toMiliseconds(_e.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return z.hashMessage(e+await this.getClientId())}},Fge=Object.defineProperty,P5=Object.getOwnPropertySymbols,Bge=Object.prototype.hasOwnProperty,Uge=Object.prototype.propertyIsEnumerable,zD=(t,e,n)=>e in t?Fge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M5=(t,e)=>{for(var n in e||(e={}))Bge.call(e,n)&&zD(t,n,e[n]);if(P5)for(var n of P5(e))Uge.call(e,n)&&zD(t,n,e[n]);return t},it=(t,e,n)=>zD(t,typeof e!="symbol"?e+"":e,n),Wb=class extends ys.IRelayer{constructor(e){var n;super(e),it(this,"protocol","wc"),it(this,"version",2),it(this,"core"),it(this,"logger"),it(this,"events",new jl.EventEmitter),it(this,"provider"),it(this,"messages"),it(this,"subscriber"),it(this,"publisher"),it(this,"name",rV),it(this,"transportExplicitlyClosed",!1),it(this,"initialized",!1),it(this,"connectionAttemptInProgress",!1),it(this,"relayUrl"),it(this,"projectId"),it(this,"packageName"),it(this,"bundleId"),it(this,"hasExperiencedNetworkDisruption",!1),it(this,"pingTimeout"),it(this,"heartBeatTimeout",_e.toMiliseconds(_e.THIRTY_SECONDS+_e.FIVE_SECONDS)),it(this,"reconnectTimeout"),it(this,"connectPromise"),it(this,"reconnectInProgress",!1),it(this,"requestsInFlight",[]),it(this,"connectTimeout",_e.toMiliseconds(_e.ONE_SECOND*15)),it(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");let o=r.id||Ir.getBigIntRpcId().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");let a=`${o}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);let c=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),it(this,"resetPingTimeout",()=>{z.isNode()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),it(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),it(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(on.connect)}),it(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),it(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(on.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),it(this,"registerProviderListeners",()=>{this.provider.on(ci.payload,this.onPayloadHandler),this.provider.on(ci.connect,this.onConnectHandler),this.provider.on(ci.disconnect,this.onDisconnectHandler),this.provider.on(ci.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=z.createLogger({logger:(n=e.logger)!=null?n:nV,name:this.name}),this.messages=new Gb(this.logger,e.core),this.subscriber=new Kb(this,this.logger),this.publisher=new HD(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ZD,z.isAndroid()?this.packageName=z.getAppId():z.isIos()&&(this.bundleId=z.getAppId()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return xt.getLoggerContext(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:Ul.relay},eg.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish,a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c,l=u=>{u.topic===e&&(this.subscriber.off(Hr.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Hr.created,l)}),new Promise(async(u,d)=>{a=await this.subscriber.subscribe(e,M5({internal:{throwOnFailedPublish:o}},n)).catch(h=>{o&&d(h)})||a,u()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await z.createExpiringPromise(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await z.isOnline())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(let r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){let{topic:r}=e;if(!n.sessionExists){let i=z.calcExpiry(_e.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(on.message,e),await this.recordMessageEvent(e,eg.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{let s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(ci.disconnect,s),await z.createExpiringPromise(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(ci.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ci.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ci.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();let i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,_e.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(z.isNode())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Rfe.JsonRpcProvider(new Ffe.default(z.formatRelayRpcUrl({sdkVersion:$b,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){let{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){let{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;let i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ir.isJsonRpcRequest(e)){if(!e.method.endsWith(iV))return;let n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:Ul.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(M5({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ir.isJsonRpcResponse(e)&&this.events.emit(on.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,eg.inbound),this.events.emit(on.message,e))}async acknowledgePayload(e){let n=Ir.formatJsonRpcResult(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(ci.payload,this.onPayloadHandler),this.provider.off(ci.connect,this.onConnectHandler),this.provider.off(ci.disconnect,this.onDisconnectHandler),this.provider.off(ci.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await z.isOnline();z.subscribeToNetworkChange(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&z.isAppVisible())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(on.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},_e.toMiliseconds(sV)))))}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function jge(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function k5(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function L5(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var Vge="[object RegExp]",Hge="[object String]",$ge="[object Number]",qge="[object Boolean]",F5="[object Arguments]",zge="[object Symbol]",Gge="[object Date]",Kge="[object Map]",Wge="[object Set]",Qge="[object Array]",Yge="[object Function]",Jge="[object ArrayBuffer]",DD="[object Object]",Zge="[object Error]",Xge="[object DataView]",eme="[object Uint8Array]",tme="[object Uint8ClampedArray]",nme="[object Uint16Array]",rme="[object Uint32Array]",ime="[object BigUint64Array]",sme="[object Int8Array]",ome="[object Int16Array]",ame="[object Int32Array]",cme="[object BigInt64Array]",lme="[object Float32Array]",ume="[object Float64Array]";function dme(){}function B5(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function hme(t,e,n){return Xp(t,e,void 0,void 0,void 0,void 0,n)}function Xp(t,e,n,r,i,s,o){let a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return ng(t,e,s,o)}return ng(t,e,s,o)}function ng(t,e,n,r){if(Object.is(t,e))return!0;let i=L5(t),s=L5(e);if(i===F5&&(i=DD),s===F5&&(s=DD),i!==s)return!1;switch(i){case Hge:return t.toString()===e.toString();case $ge:{let c=t.valueOf(),l=e.valueOf();return jge(c,l)}case qge:case Gge:case zge:return Object.is(t.valueOf(),e.valueOf());case Vge:return t.source===e.source&&t.flags===e.flags;case Yge:return t===e}n=n??new Map;let o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case Kge:{if(t.size!==e.size)return!1;for(let[c,l]of t.entries())if(!e.has(c)||!Xp(l,e.get(c),c,t,e,n,r))return!1;return!0}case Wge:{if(t.size!==e.size)return!1;let c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){let d=c[u],h=l.findIndex(f=>Xp(d,f,void 0,t,e,n,r));if(h===-1)return!1;l.splice(h,1)}return!0}case Qge:case eme:case tme:case nme:case rme:case ime:case sme:case ome:case ame:case cme:case lme:case ume:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Xp(t[c],e[c],c,t,e,n,r))return!1;return!0}case Jge:return t.byteLength!==e.byteLength?!1:ng(new Uint8Array(t),new Uint8Array(e),n,r);case Xge:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:ng(new Uint8Array(t),new Uint8Array(e),n,r);case Zge:return t.name===e.name&&t.message===e.message;case DD:{if(!(ng(t.constructor,e.constructor,n,r)||B5(t)&&B5(e)))return!1;let c=[...Object.keys(t),...k5(t)],l=[...Object.keys(e),...k5(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){let d=c[u],h=t[d];if(!Object.hasOwn(e,d))return!1;let f=e[d];if(!Xp(h,f,d,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function fme(t,e){return hme(t,e,dme)}var pme=Object.defineProperty,U5=Object.getOwnPropertySymbols,gme=Object.prototype.hasOwnProperty,mme=Object.prototype.propertyIsEnumerable,GD=(t,e,n)=>e in t?pme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j5=(t,e)=>{for(var n in e||(e={}))gme.call(e,n)&&GD(t,n,e[n]);if(U5)for(var n of U5(e))mme.call(e,n)&&GD(t,n,e[n]);return t},Vr=(t,e,n)=>GD(t,typeof e!="symbol"?e+"":e,n),Qb=class extends ys.IStore{constructor(e,n,r,i=ms,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,Vr(this,"map",new Map),Vr(this,"version",oV),Vr(this,"cached",[]),Vr(this,"initialized",!1),Vr(this,"getKey"),Vr(this,"storagePrefix",ms),Vr(this,"recentlyDeleted",[]),Vr(this,"recentlyDeletedLimit",200),Vr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!z.isUndefined(o)?this.map.set(this.getKey(o),o):z.isProposalStruct(o)?this.map.set(o.id,o):z.isSessionStruct(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Vr(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Vr(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Vr(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>fme(a[c],o[c]))):this.values)),Vr(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=j5(j5({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Vr(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=xt.generateChildLogger(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){let{message:i}=z.getInternalError("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}let{message:r}=z.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:n}=z.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},yme=Object.defineProperty,wme=(t,e,n)=>e in t?yme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,We=(t,e,n)=>wme(t,typeof e!="symbol"?e+"":e,n),Yb=class{constructor(e,n){this.core=e,this.logger=n,We(this,"name",uV),We(this,"version",dV),We(this,"events",new kfe.default),We(this,"pairings"),We(this,"initialized",!1),We(this,"storagePrefix",ms),We(this,"ignoredPayloadTypes",[z.TYPE_1]),We(this,"registeredMethods",[]),We(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),We(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),We(this,"create",async r=>{this.isInitialized();let i=z.generateRandomBytes32(),s=await this.core.crypto.setSymKey(i),o=z.calcExpiry(_e.FIVE_MINUTES),a={protocol:tV},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},l=z.formatUri({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(eh.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:l}}),We(this,"pair",async r=>{this.isInitialized();let i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[Gs.pairing_started]}});this.isValidPair(r,i);let{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=z.parseUri(r.uri);i.props.properties.topic=s,i.addTrace(Gs.pairing_uri_validation_success),i.addTrace(Gs.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Gs.existing_pairing),u.active)throw i.setError(Fo.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Gs.pairing_not_expired)}let d=c||z.calcExpiry(_e.FIVE_MINUTES),h={topic:s,relay:a,expiry:d,active:!1,methods:l};this.core.expirer.set(s,d),await this.pairings.set(s,h),i.addTrace(Gs.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(eh.create,h),i.addTrace(Gs.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Gs.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Fo.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(f){throw i.setError(Fo.subscribe_pairing_topic_failure),f}return i.addTrace(Gs.subscribe_pairing_topic_success),h}),We(this,"activate",async({topic:r})=>{this.isInitialized();let i=z.calcExpiry(_e.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),We(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:i}=r;if(this.pairings.keys.includes(i)){let s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=z.createDelayedPromise();this.events.once(z.engineEvent("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),We(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),We(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),We(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),We(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);let{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",z.getSdkError("USER_DISCONNECTED")),await this.deletePairing(i))}),We(this,"formatUriFromPairing",r=>{this.isInitialized();let{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return z.formatUri({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),We(this,"sendRequest",async(r,i,s)=>{let o=Ir.formatJsonRpcRequest(i,s),a=await this.core.crypto.encode(r,o),c=Xd[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),We(this,"sendResult",async(r,i,s)=>{let o=Ir.formatJsonRpcResult(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Xd[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),We(this,"sendError",async(r,i,s)=>{let o=Ir.formatJsonRpcError(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=Xd[c]?Xd[c].res:Xd.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),We(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,z.getSdkError("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),We(this,"cleanup",async()=>{let r=this.pairings.getAll().filter(i=>z.isExpired(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),We(this,"onRelayEventRequest",async r=>{let{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),We(this,"onRelayEventResponse",async r=>{let{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),We(this,"onPairingPingRequest",async(r,i)=>{let{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(eh.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),We(this,"onPairingPingResponse",(r,i)=>{let{id:s}=i;setTimeout(()=>{Ir.isJsonRpcResult(i)?this.events.emit(z.engineEvent("pairing_ping",s),{}):Ir.isJsonRpcError(i)&&this.events.emit(z.engineEvent("pairing_ping",s),{error:i.error})},500)}),We(this,"onPairingDeleteRequest",async(r,i)=>{let{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(eh.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),We(this,"onUnknownRpcMethodRequest",async(r,i)=>{let{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;let a=z.getSdkError("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),We(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(z.getSdkError("WC_METHOD_UNSUPPORTED",r))}),We(this,"isValidPair",(r,i)=>{var s;if(!z.isValidParams(r)){let{message:a}=z.getInternalError("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(Fo.malformed_pairing_uri),new Error(a)}if(!z.isValidUrl(r.uri)){let{message:a}=z.getInternalError("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(Fo.malformed_pairing_uri),new Error(a)}let o=z.parseUri(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){let{message:a}=z.getInternalError("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Fo.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=z.getInternalError("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Fo.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&_e.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(Fo.pairing_expired);let{message:a}=z.getInternalError("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),We(this,"isValidPing",async r=>{if(!z.isValidParams(r)){let{message:s}=z.getInternalError("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}let{topic:i}=r;await this.isValidPairingTopic(i)}),We(this,"isValidDisconnect",async r=>{if(!z.isValidParams(r)){let{message:s}=z.getInternalError("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}let{topic:i}=r;await this.isValidPairingTopic(i)}),We(this,"isValidPairingTopic",async r=>{if(!z.isValidString(r,!1)){let{message:i}=z.getInternalError("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){let{message:i}=z.getInternalError("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(z.isExpired(this.pairings.get(r).expiry)){await this.deletePairing(r);let{message:i}=z.getInternalError("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=xt.generateChildLogger(n,this.name),this.pairings=new Qb(this.core,this.logger,this.name,this.storagePrefix)}get context(){return xt.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(on.message,async e=>{let{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==Ul.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let s=await this.core.crypto.decode(n,r);Ir.isJsonRpcRequest(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):Ir.isJsonRpcResponse(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Di.expired,async e=>{let{topic:n}=z.parseExpirerTarget(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(eh.expire,{topic:n}))})}},vme=Object.defineProperty,bme=(t,e,n)=>e in t?vme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fn=(t,e,n)=>bme(t,typeof e!="symbol"?e+"":e,n),Jb=class extends ys.IJsonRpcHistory{constructor(e,n){super(e,n),this.core=e,this.logger=n,Fn(this,"records",new Map),Fn(this,"events",new jl.EventEmitter),Fn(this,"name",hV),Fn(this,"version",fV),Fn(this,"cached",[]),Fn(this,"initialized",!1),Fn(this,"storagePrefix",ms),Fn(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Fn(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;let o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:z.calcExpiry(_e.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Ti.created,o)}),Fn(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;let i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=Ir.isJsonRpcError(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Ti.updated,i))}),Fn(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Fn(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Ti.deleted,s)}}),this.persist()}),Fn(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Fn(this,"on",(r,i)=>{this.events.on(r,i)}),Fn(this,"once",(r,i)=>{this.events.once(r,i)}),Fn(this,"off",(r,i)=>{this.events.off(r,i)}),Fn(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=xt.generateChildLogger(n,this.name)}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;let r={topic:n.topic,request:Ir.formatJsonRpcRequest(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let n=this.records.get(e);if(!n){let{message:r}=z.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ti.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:n}=z.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Ti.created,e=>{let n=Ti.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Ti.updated,e=>{let n=Ti.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Ti.deleted,e=>{let n=Ti.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{_e.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Ti.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Eme=Object.defineProperty,Ime=(t,e,n)=>e in t?Eme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rr=(t,e,n)=>Ime(t,typeof e!="symbol"?e+"":e,n),Zb=class extends ys.IExpirer{constructor(e,n){super(e,n),this.core=e,this.logger=n,rr(this,"expirations",new Map),rr(this,"events",new jl.EventEmitter),rr(this,"name",pV),rr(this,"version",gV),rr(this,"cached",[]),rr(this,"initialized",!1),rr(this,"storagePrefix",ms),rr(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),rr(this,"has",r=>{try{let i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),rr(this,"set",(r,i)=>{this.isInitialized();let s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Di.created,{target:s,expiration:o})}),rr(this,"get",r=>{this.isInitialized();let i=this.formatTarget(r);return this.getExpiration(i)}),rr(this,"del",r=>{if(this.isInitialized(),this.has(r)){let i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Di.deleted,{target:i,expiration:s})}}),rr(this,"on",(r,i)=>{this.events.on(r,i)}),rr(this,"once",(r,i)=>{this.events.once(r,i)}),rr(this,"off",(r,i)=>{this.events.off(r,i)}),rr(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=xt.generateChildLogger(n,this.name)}get context(){return xt.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return z.formatTopicTarget(e);if(typeof e=="number")return z.formatIdTarget(e);let{message:n}=z.getInternalError("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Di.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:n}=z.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let n=this.expirations.get(e);if(!n){let{message:r}=z.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){let{expiry:r}=n;_e.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Di.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Di.created,e=>{let n=Di.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Di.expired,e=>{let n=Di.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Di.deleted,e=>{let n=Di.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=z.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}},Cme=Object.defineProperty,Ame=(t,e,n)=>e in t?Cme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sn=(t,e,n)=>Ame(t,typeof e!="symbol"?e+"":e,n),Xb=class extends ys.IVerify{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,sn(this,"name",mV),sn(this,"abortController"),sn(this,"isDevEnv"),sn(this,"verifyUrlV3",wV),sn(this,"storagePrefix",ms),sn(this,"version",JD),sn(this,"publicKey"),sn(this,"fetchPromise"),sn(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&_e.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),sn(this,"register",async i=>{if(!z.isBrowser()||this.isDevEnv)return;let s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{let l=Pfe.getDocument(),u=this.startAbortTimer(_e.ONE_SECOND*5),d=await new Promise((h,f)=>{let p=()=>{window.removeEventListener("message",m),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);let g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});let m=y=>{if(y.data&&typeof y.data=="string")try{let E=JSON.parse(y.data);if(E.type==="verify_attestation"){if(ND.decodeJWT(E.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),h(E.attestation===null?"":E.attestation)}}catch(E){this.logger.warn(E)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(l){this.logger.warn(l)}return""}),sn(this,"resolve",async i=>{if(this.isDevEnv)return"";let{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(ND.decodeJWT(s).payload.id!==a)return;let l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;let c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),sn(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);let o=this.startAbortTimer(_e.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),sn(this,"getVerifyUrl",i=>{let s=i||tg;return vV.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${tg}`),s=tg),s}),sn(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let i=this.startAbortTimer(_e.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),sn(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),sn(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),sn(this,"isValidJwtAttestation",async i=>{let s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),sn(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),sn(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});let i=await this.fetchPromise;return this.fetchPromise=void 0,i}),sn(this,"validateAttestation",(i,s)=>{let o=z.verifyP256Jwt(i,s.publicKey),a={hasExpired:_e.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=xt.generateChildLogger(n,this.name),this.abortController=new AbortController,this.isDevEnv=z.isTestRun(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return xt.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),_e.toMiliseconds(e))}},Sme=Object.defineProperty,_me=(t,e,n)=>e in t?Sme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,V5=(t,e,n)=>_me(t,typeof e!="symbol"?e+"":e,n),e0=class extends ys.IEchoClient{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,V5(this,"context",bV),V5(this,"registerDeviceToken",async r=>{let{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${EV}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=xt.generateChildLogger(n,this.context)}},Tme=Object.defineProperty,H5=Object.getOwnPropertySymbols,Dme=Object.prototype.hasOwnProperty,Nme=Object.prototype.propertyIsEnumerable,KD=(t,e,n)=>e in t?Tme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zp=(t,e)=>{for(var n in e||(e={}))Dme.call(e,n)&&KD(t,n,e[n]);if(H5)for(var n of H5(e))Nme.call(e,n)&&KD(t,n,e[n]);return t},_n=(t,e,n)=>KD(t,typeof e!="symbol"?e+"":e,n),t0=class extends ys.IEventClient{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,_n(this,"context",CV),_n(this,"storagePrefix",ms),_n(this,"storageVersion",IV),_n(this,"events",new Map),_n(this,"shouldPersist",!1),_n(this,"init",async()=>{if(!z.isTestRun())try{let i={eventId:z.uuidv4(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:z.formatUA(this.core.relayer.protocol,this.core.relayer.version,$b)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),_n(this,"createEvent",i=>{let{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=z.uuidv4(),u=this.core.projectId||"",d=Date.now(),h=Zp({eventId:l,timestamp:d,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,h),this.shouldPersist=!0),h}),_n(this,"getEvent",i=>{let{eventId:s,topic:o}=i;if(s)return this.events.get(s);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Zp(Zp({},a),this.setMethods(a.eventId))}),_n(this,"deleteEvent",i=>{let{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),_n(this,"setEventListeners",()=>{this.core.heartbeat.on(Vl.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{_e.fromMiliseconds(Date.now())-_e.fromMiliseconds(i.timestamp)>AV&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),_n(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),_n(this,"addTrace",(i,s)=>{let o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),_n(this,"setError",(i,s)=>{let o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),_n(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),_n(this,"restore",async()=>{try{let i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Zp(Zp({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),_n(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let i=[];for(let[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(let s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),_n(this,"sendEvent",async i=>{let s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${SV}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${$b}${s}`,{method:"POST",body:JSON.stringify(i)})}),_n(this,"getAppDomain",()=>z.getAppMetadata().url),this.logger=xt.generateChildLogger(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},xme=Object.defineProperty,$5=Object.getOwnPropertySymbols,Rme=Object.prototype.hasOwnProperty,Ome=Object.prototype.propertyIsEnumerable,WD=(t,e,n)=>e in t?xme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q5=(t,e)=>{for(var n in e||(e={}))Rme.call(e,n)&&WD(t,n,e[n]);if($5)for(var n of $5(e))Ome.call(e,n)&&WD(t,n,e[n]);return t},Ft=(t,e,n)=>WD(t,typeof e!="symbol"?e+"":e,n),n0=class t extends ys.ICore{constructor(e){var n;super(e),Ft(this,"protocol",YD),Ft(this,"version",JD),Ft(this,"name",rg),Ft(this,"relayUrl"),Ft(this,"projectId"),Ft(this,"customStoragePrefix"),Ft(this,"events",new jl.EventEmitter),Ft(this,"logger"),Ft(this,"heartbeat"),Ft(this,"relayer"),Ft(this,"crypto"),Ft(this,"storage"),Ft(this,"history"),Ft(this,"expirer"),Ft(this,"pairing"),Ft(this,"verify"),Ft(this,"echoClient"),Ft(this,"linkModeSupportedApps"),Ft(this,"eventClient"),Ft(this,"initialized",!1),Ft(this,"logChunkController"),Ft(this,"on",(a,c)=>this.events.on(a,c)),Ft(this,"once",(a,c)=>this.events.once(a,c)),Ft(this,"off",(a,c)=>this.events.off(a,c)),Ft(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Ft(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;let u={topic:a,message:c,publishedAt:Date.now(),transportType:Ul.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});let r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ZD,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let i=xt.getDefaultLoggerOptions({level:typeof e?.logger=="string"&&e.logger?e.logger:z5.logger,name:rg}),{logger:s,chunkLoggerController:o}=xt.generatePlatformLogger({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=xt.generateChildLogger(s,this.name),this.heartbeat=new Vl.HeartBeat,this.crypto=new zb(this,this.logger,e?.keychain),this.history=new Jb(this,this.logger),this.expirer=new Zb(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Lfe.default(q5(q5({},G5),e?.storageOptions)),this.relayer=new Wb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Yb(this,this.logger),this.verify=new Xb(this,this.logger,this.storage),this.echoClient=new e0(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new t0(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let n=new t(e);await n.initialize();let r=await n.crypto.getClientId();return await n.storage.setItem(aV,r),n}get context(){return xt.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(RD,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(RD)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},Pme=n0;se.CORE_CONTEXT=rg,se.CORE_DEFAULT=z5,se.CORE_PROTOCOL=YD,se.CORE_STORAGE_OPTIONS=G5,se.CORE_STORAGE_PREFIX=ms,se.CORE_VERSION=JD,se.CRYPTO_CLIENT_SEED=xD,se.CRYPTO_CONTEXT=K5,se.CRYPTO_JWT_TTL=W5,se.Core=Pme,se.Crypto=zb,se.ECHO_CONTEXT=bV,se.ECHO_URL=EV,se.EVENTS_CLIENT_API_URL=SV,se.EVENTS_STORAGE_CLEANUP_INTERVAL=AV,se.EVENTS_STORAGE_CONTEXT=CV,se.EVENTS_STORAGE_VERSION=IV,se.EVENT_CLIENT_AUTHENTICATE_ERRORS=Qfe,se.EVENT_CLIENT_AUTHENTICATE_TRACES=Wfe,se.EVENT_CLIENT_CONTEXT=zfe,se.EVENT_CLIENT_PAIRING_ERRORS=Fo,se.EVENT_CLIENT_PAIRING_TRACES=Gs,se.EVENT_CLIENT_SESSION_ERRORS=Kfe,se.EVENT_CLIENT_SESSION_TRACES=Gfe,se.EXPIRER_CONTEXT=pV,se.EXPIRER_DEFAULT_TTL=$fe,se.EXPIRER_EVENTS=Di,se.EXPIRER_STORAGE_VERSION=gV,se.EchoClient=e0,se.EventClient=t0,se.Expirer=Zb,se.HISTORY_CONTEXT=hV,se.HISTORY_EVENTS=Ti,se.HISTORY_STORAGE_VERSION=fV,se.JsonRpcHistory=Jb,se.KEYCHAIN_CONTEXT=Q5,se.KEYCHAIN_STORAGE_VERSION=Y5,se.KeyChain=qb,se.MESSAGES_CONTEXT=J5,se.MESSAGES_STORAGE_VERSION=Z5,se.MESSAGE_DIRECTION=eg,se.MessageTracker=Gb,se.PAIRING_CONTEXT=uV,se.PAIRING_DEFAULT_TTL=Hfe,se.PAIRING_EVENTS=eh,se.PAIRING_RPC_OPTS=Xd,se.PAIRING_STORAGE_VERSION=dV,se.PENDING_SUB_RESOLUTION_TIMEOUT=Vfe,se.PUBLISHER_CONTEXT=eV,se.PUBLISHER_DEFAULT_TTL=X5,se.Pairing=Yb,se.RELAYER_CONTEXT=rV,se.RELAYER_DEFAULT_LOGGER=nV,se.RELAYER_DEFAULT_PROTOCOL=tV,se.RELAYER_DEFAULT_RELAY_URL=ZD,se.RELAYER_EVENTS=on,se.RELAYER_PROVIDER_EVENTS=ci,se.RELAYER_RECONNECT_TIMEOUT=sV,se.RELAYER_SDK_VERSION=$b,se.RELAYER_STORAGE_OPTIONS=Bfe,se.RELAYER_SUBSCRIBER_SUFFIX=iV,se.RELAYER_TRANSPORT_CUTOFF=Ufe,se.Relayer=Wb,se.STORE_STORAGE_VERSION=oV,se.SUBSCRIBER_CONTEXT=cV,se.SUBSCRIBER_DEFAULT_TTL=jfe,se.SUBSCRIBER_EVENTS=Hr,se.SUBSCRIBER_STORAGE_VERSION=lV,se.Store=Qb,se.Subscriber=Kb,se.TRANSPORT_TYPES=Ul,se.TRUSTED_VERIFY_URLS=vV,se.VERIFY_CONTEXT=mV,se.VERIFY_SERVER=tg,se.VERIFY_SERVER_V3=wV,se.Verify=Xb,se.WALLETCONNECT_CLIENT_ID=aV,se.WALLETCONNECT_LINK_MODE_APPS=RD,se.default=n0});var ZV=vs(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});var UV=Ks(),pe=FV(),jV=(gT(),Pe(pT)),_=Vb(),Mme=(db(),Pe(ub)),ft=Wl(),Be=(Yl(),Pe(Ql));function kme(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var Lme=kme(UV),uN="wc",dN=2,hN="client",c0=`${uN}@${dN}:${hN}:`,i0={name:hN,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},Fme={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},Bme={database:":memory:"},eN="WALLETCONNECT_DEEPLINK_CHOICE",Ume={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},jme="history",Vme="0.3",VV="proposal",Hme=ft.THIRTY_DAYS,tN="Proposal expired",HV="session",Hl=ft.SEVEN_DAYS,$V="engine",Tn={wc_sessionPropose:{req:{ttl:ft.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ft.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ft.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ft.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ft.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ft.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ft.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ft.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ft.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ft.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ft.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ft.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ft.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ft.FIVE_MINUTES,prompt:!1,tag:1119}}},s0={min:ft.FIVE_MINUTES,max:ft.SEVEN_DAYS},ws={idle:"IDLE",active:"ACTIVE"},qV={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},zV="request",GV=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],KV="wc",$me=1.5,WV="auth",QV="authKeys",YV="pairingTopics",JV="requests",og=`${KV}@${1.5}:${WV}:`,sg=`${og}:PUB_KEY`,qme=Object.defineProperty,zme=Object.defineProperties,Gme=Object.getOwnPropertyDescriptors,BV=Object.getOwnPropertySymbols,Kme=Object.prototype.hasOwnProperty,Wme=Object.prototype.propertyIsEnumerable,nN=(t,e,n)=>e in t?qme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yt=(t,e)=>{for(var n in e||(e={}))Kme.call(e,n)&&nN(t,n,e[n]);if(BV)for(var n of BV(e))Wme.call(e,n)&&nN(t,n,e[n]);return t},ir=(t,e)=>zme(t,Gme(e)),J=(t,e,n)=>nN(t,typeof e!="symbol"?e+"":e,n),rN=class extends jV.IEngine{constructor(e){super(e),J(this,"name",$V),J(this,"events",new Lme.default),J(this,"initialized",!1),J(this,"requestQueue",{state:ws.idle,queue:[]}),J(this,"sessionRequestQueue",{state:ws.idle,queue:[]}),J(this,"emittedSessionRequests",new _.LimitedSet({limit:500})),J(this,"requestQueueDelay",ft.ONE_SECOND),J(this,"expectedPairingMethodMap",new Map),J(this,"recentlyDeletedMap",new Map),J(this,"recentlyDeletedLimit",200),J(this,"relayMessageCache",[]),J(this,"pendingSessions",new Map),J(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Tn)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ft.toMiliseconds(this.requestQueueDelay)))}),J(this,"connect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let r=ir(yt({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=_.mergeRequiredAndOptionalNamespaces(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};let{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=r,u=i,d,h=!1;try{if(u){let N=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=N.active}}catch(N){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),N}if(!u||!h){let{topic:N,uri:B}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=N,d=B}if(!u){let{message:N}=_.getInternalError("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(N)}let f=await this.client.core.crypto.generateKeyPair(),p=Tn.wc_sessionPropose.req.ttl||ft.FIVE_MINUTES,g=_.calcExpiry(p),m=ir(yt(yt({requiredNamespaces:s,optionalNamespaces:o,relays:l??[{protocol:pe.RELAYER_DEFAULT_PROTOCOL}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Be.payloadId()}),y=_.engineEvent("session_connect",m.id),{reject:E,resolve:I,done:L}=_.createDelayedPromise(p,tN),k=({id:N})=>{N===m.id&&(this.client.events.off("proposal_expire",k),this.pendingSessions.delete(m.id),this.events.emit(y,{error:{message:tN,code:0}}))};return this.client.events.on("proposal_expire",k),this.events.once(y,({error:N,session:B})=>{this.client.events.off("proposal_expire",k),N?E(N):B&&I(B)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:d,approval:L}}),J(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),J(this,"approve",async n=>{var r,i,s;let o=this.client.core.eventClient.createEvent({properties:{topic:(r=n?.id)==null?void 0:r.toString(),trace:[pe.EVENT_CLIENT_SESSION_TRACES.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(T){throw o.setError(pe.EVENT_CLIENT_SESSION_ERRORS.no_internet_connection),T}try{await this.isValidProposalId(n?.id)}catch(T){throw this.client.logger.error(`approve() -> proposal.get(${n?.id}) failed`),o.setError(pe.EVENT_CLIENT_SESSION_ERRORS.proposal_not_found),T}try{await this.isValidApprove(n)}catch(T){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(pe.EVENT_CLIENT_SESSION_ERRORS.session_approve_namespace_validation_failure),T}let{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:d,sessionConfig:h}=n,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:p,proposer:g,requiredNamespaces:m,optionalNamespaces:y}=f,E=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:p});E||(E=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:pe.EVENT_CLIENT_SESSION_TRACES.session_approve_started,properties:{topic:p,trace:[pe.EVENT_CLIENT_SESSION_TRACES.session_approve_started,pe.EVENT_CLIENT_SESSION_TRACES.session_namespaces_validation_success]}}));let I=await this.client.core.crypto.generateKeyPair(),L=g.publicKey,k=await this.client.core.crypto.generateSharedKey(I,L),N=yt(yt(yt({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:I,metadata:this.client.metadata},expiry:_.calcExpiry(Hl)},u&&{sessionProperties:u}),d&&{scopedProperties:d}),h&&{sessionConfig:h}),B=pe.TRANSPORT_TYPES.relay;E.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.subscribing_session_topic);try{await this.client.core.relayer.subscribe(k,{transportType:B,internal:{skipSubscribe:!0}})}catch(T){throw E.setError(pe.EVENT_CLIENT_SESSION_ERRORS.subscribe_session_topic_failure),T}E.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.subscribe_session_topic_success);let U=ir(yt({},N),{topic:k,requiredNamespaces:m,optionalNamespaces:y,pairingTopic:p,acknowledged:!1,self:N.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:I,transportType:pe.TRANSPORT_TYPES.relay});await this.client.session.set(k,U),E.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.store_session);try{await this.sendApproveSession({sessionTopic:k,proposal:f,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:I},sessionSettleRequest:N,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),E.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.session_approve_publish_success)}catch(T){throw this.client.logger.error(T),this.client.session.delete(k,_.getSdkError("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(k),T}return this.client.core.eventClient.deleteEvent({eventId:E.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(k,_.calcExpiry(Hl)),{topic:k,acknowledged:()=>Promise.resolve(this.client.session.get(k))}}),J(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:r,reason:i}=n,s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:Tn.wc_sessionPropose.reject}),await this.deleteProposal(r)}),J(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(d){throw this.client.logger.error("update() -> isValidUpdate() failed"),d}let{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=_.createDelayedPromise(),c=Be.payloadId(),l=Be.getBigIntRpcId().toString(),u=this.client.session.get(r).namespaces;return this.events.once(_.engineEvent("session_update",c),({error:d})=>{d?a(d):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(d=>{this.client.logger.error(d),this.client.session.update(r,{namespaces:u}),a(d)}),{acknowledged:s}}),J(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:r}=n,i=Be.payloadId(),{done:s,resolve:o,reject:a}=_.createDelayedPromise();return this.events.once(_.engineEvent("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,_.calcExpiry(Hl)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),J(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}let{chainId:r,request:i,topic:s,expiry:o=Tn.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);a?.transportType===pe.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let c=Be.payloadId(),l=Be.getBigIntRpcId().toString(),{done:u,resolve:d,reject:h}=_.createDelayedPromise(o,"Request expired. Please try again.");this.events.once(_.engineEvent("session_request",c),({error:m,result:y})=>{m?h(m):d(y)});let f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:f,params:{request:ir(yt({},i),{expiryTimestamp:_.calcExpiry(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>h(m)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await u();let g={request:ir(yt({},i),{expiryTimestamp:_.calcExpiry(o)}),chainId:r};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:f,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(y=>h(y)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),m()}),new Promise(async m=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){let E=await _.getDeepLink(this.client.core.storage,eN);await _.handleDeeplinkRedirect({id:c,topic:s,wcDeepLink:E})}m()}),u()]).then(m=>m[2])}),J(this,"respond",async n=>{var r,i;this.isInitialized();let s=this.client.core.eventClient.createEvent({properties:{topic:n?.topic||((i=(r=n?.response)==null?void 0:r.id)==null?void 0:i.toString()),trace:[pe.EVENT_CLIENT_SESSION_TRACES.session_request_response_started]}});try{await this.isValidRespond(n)}catch(d){throw s.addTrace(d?.message),s.setError(pe.EVENT_CLIENT_SESSION_ERRORS.session_request_response_validation_failure),d}s.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.session_request_response_validation_success);let{topic:o,response:a}=n,{id:c}=a,l=this.client.session.get(o);l.transportType===pe.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(pe.EVENT_CLIENT_SESSION_TRACES.session_request_response_publish_started),Be.isJsonRpcResult(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):Be.isJsonRpcError(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(n)}catch(d){throw s.addTrace(d?.message),s.setError(pe.EVENT_CLIENT_SESSION_ERRORS.session_request_response_publish_failure),d}}),J(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}let{topic:r}=n;if(this.client.session.keys.includes(r)){let i=Be.payloadId(),s=Be.getBigIntRpcId().toString(),{done:o,resolve:a,reject:c}=_.createDelayedPromise();this.events.once(_.engineEvent("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),J(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);let{topic:r,event:i,chainId:s}=n,o=Be.getBigIntRpcId().toString(),a=Be.payloadId();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),J(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);let{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:_.getSdkError("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{let{message:i}=_.getInternalError("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),J(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>_.isSessionCompatible(r,n)))),J(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),J(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);let s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?pe.TRANSPORT_TYPES.link_mode:pe.TRANSPORT_TYPES.relay;o===pe.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:l,domain:u,nonce:d,type:h,exp:f,nbf:p,methods:g=[],expiry:m}=n,y=[...n.resources||[]],{topic:E,uri:I}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:I}});let L=await this.client.core.crypto.generateKeyPair(),k=_.hashKey(L);if(await Promise.all([this.client.auth.authKeys.set(sg,{responseTopic:k,publicKey:L}),this.client.auth.pairingTopics.set(k,{topic:k,pairingTopic:E})]),await this.client.core.relayer.subscribe(k,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${E}`),g.length>0){let{namespace:A}=_.parseChainId(a[0]),P=_.createEncodedRecap(A,"request",g);_.getRecapFromResources(y)&&(P=_.mergeEncodedRecaps(P,y.pop())),y.push(P)}let N=m&&m>Tn.wc_sessionAuthenticate.req.ttl?m:Tn.wc_sessionAuthenticate.req.ttl,B={authPayload:{type:h??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:d,iat:new Date().toISOString(),exp:f,nbf:p,resources:y},requester:{publicKey:L,metadata:this.client.metadata},expiryTimestamp:_.calcExpiry(N)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},T={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:L,metadata:this.client.metadata},expiryTimestamp:_.calcExpiry(Tn.wc_sessionPropose.req.ttl),id:Be.payloadId()},{done:$,resolve:K,reject:M}=_.createDelayedPromise(N,"Request expired"),v=Be.payloadId(),b=_.engineEvent("session_connect",T.id),w=_.engineEvent("session_request",v),C=async({error:A,session:P})=>{this.events.off(w,x),A?M(A):P&&K({session:P})},x=async A=>{var P,V,j;if(await this.deletePendingAuthRequest(v,{message:"fulfilled",code:0}),A.error){let ne=_.getSdkError("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===ne.code?void 0:(this.events.off(b,C),M(A.error.message))}await this.deleteProposal(T.id),this.events.off(b,C);let{cacaos:oe,responder:X}=A.result,Q=[],ae=[];for(let ne of oe){await _.validateSignedCacao({cacao:ne,projectId:this.client.core.projectId})||(this.client.logger.error(ne,"Signature verification failed"),M(_.getSdkError("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:be}=ne,Ot=_.getRecapFromResources(be.resources),vt=[_.getNamespacedDidChainId(be.iss)],$t=_.getDidAddress(be.iss);if(Ot){let pn=_.getMethodsFromRecap(Ot),Gl=_.getChainsFromRecap(Ot);Q.push(...pn),vt.push(...Gl)}for(let pn of vt)ae.push(`${pn}:${$t}`)}let ee=await this.client.core.crypto.generateSharedKey(L,X.publicKey),we;Q.length>0&&(we={topic:ee,acknowledged:!0,self:{publicKey:L,metadata:this.client.metadata},peer:X,controller:X.publicKey,expiry:_.calcExpiry(Hl),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:_.buildNamespacesFromAuth([...new Set(Q)],[...new Set(ae)]),transportType:o},await this.client.core.relayer.subscribe(ee,{transportType:o}),await this.client.session.set(ee,we),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:X.metadata}),we=this.client.session.get(ee)),(P=this.client.metadata.redirect)!=null&&P.linkMode&&(V=X.metadata.redirect)!=null&&V.linkMode&&(j=X.metadata.redirect)!=null&&j.universal&&r&&(this.client.core.addLinkModeSupportedApp(X.metadata.redirect.universal),this.client.session.update(ee,{transportType:pe.TRANSPORT_TYPES.link_mode})),K({auths:oe,session:we})};this.events.once(b,C),this.events.once(w,x);let F;try{if(s){let A=Be.formatJsonRpcRequest("wc_sessionAuthenticate",B,v);this.client.core.history.set(E,A);let P=await this.client.core.crypto.encode("",A,{type:_.TYPE_2,encoding:_.BASE64URL});F=_.getLinkModeURL(r,E,P)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:B,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:v}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:T,expiry:Tn.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(A){throw this.events.off(b,C),this.events.off(w,x),A}return await this.setProposal(T.id,T),await this.setAuthRequest(v,{request:ir(yt({},B),{verifyContext:{}}),pairingTopic:E,transportType:o}),{uri:F??I,response:$}}),J(this,"approveSessionAuthenticate",async n=>{let{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[pe.EVENT_CLIENT_AUTHENTICATE_TRACES.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(pe.EVENT_CLIENT_AUTHENTICATE_ERRORS.no_internet_connection),m}let o=this.getPendingAuthRequest(r);if(!o)throw s.setError(pe.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);let a=o.transportType||pe.TRANSPORT_TYPES.relay;a===pe.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=_.hashKey(c),d={type:_.TYPE_1,receiverPublicKey:c,senderPublicKey:l},h=[],f=[];for(let m of i){if(!await _.validateSignedCacao({cacao:m,projectId:this.client.core.projectId})){s.setError(pe.EVENT_CLIENT_AUTHENTICATE_ERRORS.invalid_cacao);let k=_.getSdkError("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:k,encodeOpts:d}),new Error(k.message)}s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.cacaos_verified);let{p:y}=m,E=_.getRecapFromResources(y.resources),I=[_.getNamespacedDidChainId(y.iss)],L=_.getDidAddress(y.iss);if(E){let k=_.getMethodsFromRecap(E),N=_.getChainsFromRecap(E);h.push(...k),I.push(...N)}for(let k of I)f.push(`${k}:${L}`)}let p=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.create_authenticated_session_topic);let g;if(h?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:_.calcExpiry(Hl),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:_.buildNamespacesFromAuth([...new Set(h)],[...new Set(f)]),transportType:a},s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw s.setError(pe.EVENT_CLIENT_AUTHENTICATE_ERRORS.subscribe_authenticated_session_topic_failure),m}s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(pe.EVENT_CLIENT_AUTHENTICATE_TRACES.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(pe.EVENT_CLIENT_AUTHENTICATE_ERRORS.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),J(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();let{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===pe.TRANSPORT_TYPES.relay&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=_.hashKey(o),l={type:_.TYPE_1,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:Tn.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),J(this,"formatAuthMessage",n=>{this.isInitialized();let{request:r,iss:i}=n;return _.formatMessage(r,i)}),J(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),J(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{let r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),J(this,"deleteSession",async n=>{var r;let{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,_.getSdkError("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(eN).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===i&&this.deletePendingSessionRequest(l.id,_.getSdkError("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=ws.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),J(this,"deleteProposal",async(n,r)=>{if(r)try{let i=this.client.proposal.get(n);this.client.core.eventClient.getEvent({topic:i.pairingTopic})?.setError(pe.EVENT_CLIENT_SESSION_ERRORS.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,_.getSdkError("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),J(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=ws.idle,this.client.events.emit("session_request_expire",{id:n}))}),J(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),J(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),J(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,_.calcExpiry(Tn.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),J(this,"setAuthRequest",async(n,r)=>{let{request:i,pairingTopic:s,transportType:o=pe.TRANSPORT_TYPES.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),J(this,"setPendingSessionRequest",async n=>{let{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||_.calcExpiry(Tn.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),J(this,"sendRequest",async n=>{let{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:d,publishOpts:h={}}=n,f=Be.formatJsonRpcRequest(i,s,c),p,g=!!u;try{let E=g?_.BASE64URL:_.BASE64;p=await this.client.core.crypto.encode(r,f,{encoding:E})}catch(E){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),E}let m;if(GV.includes(i)){let E=_.hashMessage(JSON.stringify(f)),I=_.hashMessage(p);m=await this.client.core.verify.register({id:I,decryptedId:E})}let y=yt(yt({},Tn[i].req),h);if(y.attestation=m,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(r,f),g){let E=_.getLinkModeURL(u,r,p);await global.Linking.openURL(E,this.client.name)}else y.tvf=ir(yt({},d),{correlationId:f.id}),l?(y.internal=ir(yt({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,p,y)):this.client.core.relayer.publish(r,p,y).catch(E=>this.client.logger.error(E));return f.id}),J(this,"sendProposeSession",async n=>{let{proposal:r,publishOpts:i}=n,s=Be.formatJsonRpcRequest("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,s);let o=await this.client.core.crypto.encode(r.pairingTopic,s,{encoding:_.BASE64}),a=_.hashMessage(JSON.stringify(s)),c=_.hashMessage(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:ir(yt({},i),{publishMethod:"wc_proposeSession",attestation:l})})}),J(this,"sendApproveSession",async n=>{let{sessionTopic:r,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=n,c=Be.formatJsonRpcResult(s.id,i),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:_.BASE64}),u=Be.formatJsonRpcRequest("wc_sessionSettle",o,a?.id),d=await this.client.core.crypto.encode(r,u,{encoding:_.BASE64});this.client.core.history.set(r,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:d},opts:ir(yt({},a),{publishMethod:"wc_approveSession"})})}),J(this,"sendResult",async n=>{let{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,l=Be.formatJsonRpcResult(r,s),u,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=d?_.BASE64URL:_.BASE64;u=await this.client.core.crypto.encode(i,l,ir(yt({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),p}let h,f;try{h=await this.client.core.history.get(i,r);let p=h.request;try{f=this.getTVFParams(r,p.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),p}if(d){let p=_.getLinkModeURL(c,i,u);await global.Linking.openURL(p,this.client.name)}else{let p=h.request.method,g=Tn[p].res;g.tvf=ir(yt({},f),{correlationId:r}),o?(g.internal=ir(yt({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,g)):this.client.core.relayer.publish(i,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),J(this,"sendError",async n=>{let{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,l=Be.formatJsonRpcError(r,s),u,d=c&&typeof(global==null?void 0:global.Linking)<"u";try{let f=d?_.BASE64URL:_.BASE64;u=await this.client.core.crypto.encode(i,l,ir(yt({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let h;try{h=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(d){let f=_.getLinkModeURL(c,i,u);await global.Linking.openURL(f,this.client.name)}else{let f=h.request.method,p=a||Tn[f].res;this.client.core.relayer.publish(i,u,p)}await this.client.core.history.resolve(l)}),J(this,"cleanup",async()=>{let n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;_.isExpired(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{_.isExpired(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),J(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),J(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),J(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ws.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ws.active;let n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=ws.idle}),J(this,"processRequest",async n=>{let{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),J(this,"onRelayEventResponse",async n=>{let{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),J(this,"onRelayEventUnknownPayload",n=>{let{topic:r}=n,{message:i}=_.getInternalError("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),J(this,"shouldIgnorePairingRequest",n=>{let{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),J(this,"onSessionProposeRequest",async n=>{let{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{let l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(pe.EVENT_CLIENT_PAIRING_ERRORS.proposal_listener_not_found)),this.isValidConnect(yt({},i.params));let u=a.expiryTimestamp||_.calcExpiry(Tn.wc_sessionPropose.req.ttl),d=yt({id:c,pairingTopic:r,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,d);let h=await this.getVerifyContext({attestationId:s,hash:_.hashMessage(JSON.stringify(i)),encryptedId:o,metadata:d.proposer.metadata});l?.addTrace(pe.EVENT_CLIENT_PAIRING_TRACES.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:h})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:Tn.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),J(this,"onSessionProposeResponse",async(n,r,i)=>{let{id:s}=r;if(Be.isJsonRpcResult(r)){let{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});let u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:n,proposalId:s,publicKey:c});let d=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:n})}else if(Be.isJsonRpcError(r)){await this.deleteProposal(s);let o=_.engineEvent("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),J(this,"onSessionSettleRequest",async(n,r)=>{let{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);let{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:d,sessionConfig:h}=r.params,f=[...this.pendingSessions.values()].find(m=>m.sessionTopic===n);if(!f)return this.client.logger.error(`Pending session not found for topic ${n}`);let p=this.client.proposal.get(f.proposalId),g=ir(yt(yt(yt({topic:n,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),d&&{scopedProperties:d}),h&&{sessionConfig:h}),{transportType:pe.TRANSPORT_TYPES.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(_.engineEvent("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:n,result:!0})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"onSessionSettleResponse",async(n,r)=>{let{id:i}=r;Be.isJsonRpcResult(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(_.engineEvent("session_approve",i),{})):Be.isJsonRpcError(r)&&(await this.client.session.delete(n,_.getSdkError("USER_DISCONNECTED")),this.events.emit(_.engineEvent("session_approve",i),{error:r.error}))}),J(this,"onSessionUpdateRequest",async(n,r)=>{let{params:i,id:s}=r;try{let o=`${n}_session_update`,a=_.MemoryStore.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:_.getSdkError("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(yt({topic:n},i));try{_.MemoryStore.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw _.MemoryStore.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),J(this,"onSessionUpdateResponse",(n,r)=>{let{id:i}=r,s=_.engineEvent("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Be.isJsonRpcResult(r)?this.events.emit(_.engineEvent("session_update",i),{}):Be.isJsonRpcError(r)&&this.events.emit(_.engineEvent("session_update",i),{error:r.error})}),J(this,"onSessionExtendRequest",async(n,r)=>{let{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,_.calcExpiry(Hl)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),J(this,"onSessionExtendResponse",(n,r)=>{let{id:i}=r,s=_.engineEvent("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Be.isJsonRpcResult(r)?this.events.emit(_.engineEvent("session_extend",i),{}):Be.isJsonRpcError(r)&&this.events.emit(_.engineEvent("session_extend",i),{error:r.error})}),J(this,"onSessionPingRequest",async(n,r)=>{let{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),J(this,"onSessionPingResponse",(n,r)=>{let{id:i}=r,s=_.engineEvent("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Be.isJsonRpcResult(r)?this.events.emit(_.engineEvent("session_ping",i),{}):Be.isJsonRpcError(r)&&this.events.emit(_.engineEvent("session_ping",i),{error:r.error})},500)}),J(this,"onSessionDeleteRequest",async(n,r)=>{let{id:i}=r;try{this.isValidDisconnect({topic:n,reason:r.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(pe.RELAYER_EVENTS.publish,async()=>{s(await this.deleteSession({topic:n,id:i}))})}),this.sendResult({id:i,topic:n,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:n,error:_.getSdkError("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),J(this,"onSessionRequest",async n=>{var r,i,s;let{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=n,{id:d,params:h}=a;try{await this.isValidRequest(yt({topic:o},h));let f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:_.hashMessage(JSON.stringify(Be.formatJsonRpcRequest("wc_sessionRequest",h,d))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),g={id:d,topic:o,params:h,verifyContext:p};await this.setPendingSessionRequest(g),u===pe.TRANSPORT_TYPES.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:d,topic:o,error:f}),this.client.logger.error(f)}}),J(this,"onSessionRequestResponse",(n,r)=>{let{id:i}=r,s=_.engineEvent("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Be.isJsonRpcResult(r)?this.events.emit(_.engineEvent("session_request",i),{result:r.result}):Be.isJsonRpcError(r)&&this.events.emit(_.engineEvent("session_request",i),{error:r.error})}),J(this,"onSessionEventRequest",async(n,r)=>{let{id:i,params:s}=r;try{let o=`${n}_session_event_${s.event.name}`,a=_.MemoryStore.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(yt({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),_.MemoryStore.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"onSessionAuthenticateResponse",(n,r)=>{let{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),Be.isJsonRpcResult(r)?this.events.emit(_.engineEvent("session_request",i),{result:r.result}):Be.isJsonRpcError(r)&&this.events.emit(_.engineEvent("session_request",i),{error:r.error})}),J(this,"onSessionAuthenticateRequest",async n=>{var r;let{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{let{requester:l,authPayload:u,expiryTimestamp:d}=s.params,h=await this.getVerifyContext({attestationId:o,hash:_.hashMessage(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:i,id:s.id,authPayload:u,verifyContext:h,expiryTimestamp:d};await this.setAuthRequest(s.id,{request:f,pairingTopic:i,transportType:c}),c===pe.TRANSPORT_TYPES.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:h})}catch(l){this.client.logger.error(l);let u=s.params.requester.publicKey,d=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(s.params.requester.metadata,c),f={type:_.TYPE_1,receiverPublicKey:u,senderPublicKey:d};await this.sendError({id:s.id,topic:i,error:l,encodeOpts:f,rpcOpts:Tn.wc_sessionAuthenticate.autoReject,appLink:h})}}),J(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),J(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ws.idle,this.processSessionRequestQueue()},ft.toMiliseconds(this.requestQueueDelay))}),J(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{let i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{let o=s.request.id,a=_.engineEvent("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(_.engineEvent("session_request",s.request.id),{error:r})})}),J(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ws.active){this.client.logger.info("session request queue is already active.");return}let n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),J(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=ws.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),J(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;let r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:Be.formatJsonRpcRequest("wc_sessionPropose",ir(yt({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),J(this,"isValidConnect",async n=>{if(!_.isValidParams(n)){let{message:l}=_.getInternalError("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(l)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(_.isUndefined(r)||await this.isValidPairingTopic(r),!_.isValidRelays(c,!0)){let{message:l}=_.getInternalError("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(i&&!_.isUndefined(i)&&_.isValidObject(i)!==0){let l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!_.isUndefined(s)&&_.isValidObject(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!_.isUndefined(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!_.isUndefined(a)){this.validateSessionProps(a,"scopedProperties");let l=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),J(this,"validateNamespaces",(n,r)=>{let i=_.isValidRequiredNamespaces(n,"connect()",r);if(i)throw new Error(i.message)}),J(this,"isValidApprove",async n=>{if(!_.isValidParams(n))throw new Error(_.getInternalError("MISSING_OR_INVALID",`approve() params: ${n}`).message);let{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);let c=this.client.proposal.get(r),l=_.isValidNamespaces(i,"approve()");if(l)throw new Error(l.message);let u=_.isConformingNamespaces(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!_.isValidString(s,!0)){let{message:d}=_.getInternalError("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(d)}if(o&&!_.isUndefined(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!_.isUndefined(a)){this.validateSessionProps(a,"scopedProperties");let d=new Set(Object.keys(i));if(!Object.keys(a).every(h=>d.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(d).join(", ")}`)}}),J(this,"isValidReject",async n=>{if(!_.isValidParams(n)){let{message:s}=_.getInternalError("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}let{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!_.isValidErrorReason(i)){let{message:s}=_.getInternalError("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),J(this,"isValidSessionSettleRequest",n=>{if(!_.isValidParams(n)){let{message:l}=_.getInternalError("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(l)}let{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!_.isValidRelay(r)){let{message:l}=_.getInternalError("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}let a=_.isValidController(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=_.isValidNamespaces(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(_.isExpired(o)){let{message:l}=_.getInternalError("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),J(this,"isValidUpdate",async n=>{if(!_.isValidParams(n)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}let{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);let s=this.client.session.get(r),o=_.isValidNamespaces(i,"update()");if(o)throw new Error(o.message);let a=_.isConformingNamespaces(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),J(this,"isValidExtend",async n=>{if(!_.isValidParams(n)){let{message:i}=_.getInternalError("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}let{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),J(this,"isValidRequest",async n=>{if(!_.isValidParams(n)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}let{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);let{namespaces:a}=this.client.session.get(r);if(!_.isValidNamespacesChainId(a,s)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!_.isValidRequest(i)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!_.isValidNamespacesRequest(a,s,i.method)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!_.isValidRequestExpiry(o,s0)){let{message:c}=_.getInternalError("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${s0.min} and ${s0.max}`);throw new Error(c)}}),J(this,"isValidRespond",async n=>{var r;if(!_.isValidParams(n)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(a)}let{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(a){throw(r=n?.response)!=null&&r.id&&this.cleanupAfterResponse(n),a}if(!_.isValidResponse(s)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}let o=this.client.pendingRequest.get(s.id);if(o.topic!==i){let{message:a}=_.getInternalError("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),J(this,"isValidPing",async n=>{if(!_.isValidParams(n)){let{message:i}=_.getInternalError("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}let{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),J(this,"isValidEmit",async n=>{if(!_.isValidParams(n)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}let{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);let{namespaces:o}=this.client.session.get(r);if(!_.isValidNamespacesChainId(o,s)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!_.isValidEvent(i)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!_.isValidNamespacesEvent(o,s,i.name)){let{message:a}=_.getInternalError("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),J(this,"isValidDisconnect",async n=>{if(!_.isValidParams(n)){let{message:i}=_.getInternalError("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}let{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),J(this,"isValidAuthenticate",n=>{let{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!_.isValidString(i,!1))throw new Error("uri is required parameter");if(!_.isValidString(s,!1))throw new Error("domain is required parameter");if(!_.isValidString(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>_.parseChainId(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=_.parseChainId(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),J(this,"getVerifyContext",async n=>{let{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||pe.VERIFY_SERVER,validation:"UNKNOWN",origin:o.url||""}};try{if(a===pe.TRANSPORT_TYPES.link_mode){let u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}let l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),J(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){let{message:o}=_.getInternalError("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),J(this,"getPendingAuthRequest",n=>{let r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),J(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0,s=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),J(this,"checkRecentlyDeleted",n=>{let r=this.recentlyDeletedMap.get(n);if(r){let{message:i}=_.getInternalError("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),J(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,l,u,d,h;return!n||r!==pe.TRANSPORT_TYPES.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=n?.redirect)==null?void 0:u.universal)!==void 0&&((d=n?.redirect)==null?void 0:d.universal)!==""&&((h=n?.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),J(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n?.redirect)==null?void 0:i.universal:void 0}),J(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;let r=_.getSearchParamFromURL(n,"topic")||"",i=decodeURIComponent(_.getSearchParamFromURL(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:pe.TRANSPORT_TYPES.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),J(this,"registerLinkModeListeners",async()=>{var n;if(_.isTestRun()||_.isReactNative()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){let r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);let i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),J(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};let c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{let l=this.extractTxHashesFromResult(r.request,i);c.txHashes=l,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),J(this,"isValidContractData",n=>{var r;if(!n)return!1;try{let i=n?.data||((r=n?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;let s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),J(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];let s=n.method,o=qV[s];if(s==="sui_signTransaction")return[_.getSuiDigest(r.transactionBytes)];if(s==="near_signTransaction")return[_.getNearTransactionIdFromSignedTransaction(r)];if(s==="near_signTransactions")return r.map(c=>_.getNearTransactionIdFromSignedTransaction(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[_.buildSignedExtrinsicHash({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return _.isValidArray(r)?r.map(c=>_.getAlgorandTransactionId(c)):[_.getAlgorandTransactionId(r)];if(s==="cosmos_signDirect")return[_.getSignDirectHash(r)];if(s==="wallet_sendCalls")return _.getWalletSendCallsHashes(r);if(typeof r=="string")return[r];let a=r[o.key];if(_.isValidArray(a))return s==="solana_signAllTransactions"?a.map(c=>_.extractSolanaTransactionId(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(let[r,i]of Object.entries(n))for(let s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=_.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(pe.RELAYER_EVENTS.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(sg)?this.client.auth.authKeys.get(sg):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===pe.TRANSPORT_TYPES.link_mode?_.BASE64URL:_.BASE64});Be.isJsonRpcRequest(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:_.hashMessage(r)})):Be.isJsonRpcResponse(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(pe.EXPIRER_EVENTS.expired,async e=>{let{topic:n,id:r}=_.parseExpirerTarget(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,_.getInternalError("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,_.getInternalError("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(pe.PAIRING_EVENTS.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(pe.PAIRING_EVENTS.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!_.isValidString(e,!1)){let{message:n}=_.getInternalError("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:n}=_.getInternalError("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(_.isExpired(this.client.core.pairing.pairings.get(e).expiry)){let{message:n}=_.getInternalError("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!_.isValidString(e,!1)){let{message:n}=_.getInternalError("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:n}=_.getInternalError("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(_.isExpired(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:n}=_.getInternalError("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){let{message:n}=_.getInternalError("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(_.isValidString(e,!1)){let{message:n}=_.getInternalError("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{let{message:n}=_.getInternalError("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!_.isValidId(e)){let{message:n}=_.getInternalError("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){let{message:n}=_.getInternalError("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(_.isExpired(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:n}=_.getInternalError("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}},iN=class extends pe.Store{constructor(e,n){super(e,n,VV,c0),this.core=e,this.logger=n}},o0=class extends pe.Store{constructor(e,n){super(e,n,HV,c0),this.core=e,this.logger=n}},sN=class extends pe.Store{constructor(e,n){super(e,n,zV,c0,r=>r.id),this.core=e,this.logger=n}},oN=class extends pe.Store{constructor(e,n){super(e,n,QV,og,()=>sg),this.core=e,this.logger=n}},aN=class extends pe.Store{constructor(e,n){super(e,n,YV,og),this.core=e,this.logger=n}},cN=class extends pe.Store{constructor(e,n){super(e,n,JV,og,r=>r.id),this.core=e,this.logger=n}},Qme=Object.defineProperty,Yme=(t,e,n)=>e in t?Qme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,XD=(t,e,n)=>Yme(t,typeof e!="symbol"?e+"":e,n),lN=class{constructor(e,n){this.core=e,this.logger=n,XD(this,"authKeys"),XD(this,"pairingTopics"),XD(this,"requests"),this.authKeys=new oN(this.core,this.logger),this.pairingTopics=new aN(this.core,this.logger),this.requests=new cN(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},Jme=Object.defineProperty,Zme=(t,e,n)=>e in t?Jme(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qe=(t,e,n)=>Zme(t,typeof e!="symbol"?e+"":e,n),a0=class t extends jV.ISignClient{constructor(e){super(e),Qe(this,"protocol",uN),Qe(this,"version",dN),Qe(this,"name",i0.name),Qe(this,"metadata"),Qe(this,"core"),Qe(this,"logger"),Qe(this,"events",new UV.EventEmitter),Qe(this,"engine"),Qe(this,"session"),Qe(this,"proposal"),Qe(this,"pendingRequest"),Qe(this,"auth"),Qe(this,"signConfig"),Qe(this,"on",(r,i)=>this.events.on(r,i)),Qe(this,"once",(r,i)=>this.events.once(r,i)),Qe(this,"off",(r,i)=>this.events.off(r,i)),Qe(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),Qe(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),Qe(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),Qe(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),Qe(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||i0.name,this.metadata=_.populateAppMetadata(e?.metadata),this.signConfig=e?.signConfig;let n=_.createLogger({logger:e?.logger||i0.logger,name:this.name});this.logger=n,this.core=e?.core||new pe.Core(e),this.session=new o0(this.core,this.logger),this.proposal=new iN(this.core,this.logger),this.pendingRequest=new sN(this.core,this.logger),this.engine=new rN(this),this.auth=new lN(this.core,this.logger)}static async init(e){let n=new t(e);return await n.initialize(),n}get context(){return Mme.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}},Xme=o0,eye=a0;He.AUTH_CONTEXT=WV,He.AUTH_KEYS_CONTEXT=QV,He.AUTH_PAIRING_TOPIC_CONTEXT=YV,He.AUTH_PROTOCOL=KV,He.AUTH_PUBLIC_KEY_NAME=sg,He.AUTH_REQUEST_CONTEXT=JV,He.AUTH_STORAGE_PREFIX=og,He.AUTH_VERSION=$me,He.ENGINE_CONTEXT=$V,He.ENGINE_QUEUE_STATES=ws,He.ENGINE_RPC_OPTS=Tn,He.HISTORY_CONTEXT=jme,He.HISTORY_EVENTS=Ume,He.HISTORY_STORAGE_VERSION=Vme,He.METHODS_TO_VERIFY=GV,He.PROPOSAL_CONTEXT=VV,He.PROPOSAL_EXPIRY=Hme,He.PROPOSAL_EXPIRY_MESSAGE=tN,He.REQUEST_CONTEXT=zV,He.SESSION_CONTEXT=HV,He.SESSION_EXPIRY=Hl,He.SESSION_REQUEST_EXPIRY_BOUNDARIES=s0,He.SIGN_CLIENT_CONTEXT=hN,He.SIGN_CLIENT_DEFAULT=i0,He.SIGN_CLIENT_EVENTS=Fme,He.SIGN_CLIENT_PROTOCOL=uN,He.SIGN_CLIENT_STORAGE_OPTIONS=Bme,He.SIGN_CLIENT_STORAGE_PREFIX=c0,He.SIGN_CLIENT_VERSION=dN,He.SessionStore=Xme,He.SignClient=eye,He.TVF_METHODS=qV,He.WALLETCONNECT_DEEPLINK_CHOICE=eN,He.default=a0});var PH=vs(p0=>{"use strict";Object.defineProperty(p0,"__esModule",{value:!0});var tye=ZV(),wt=Vb(),SN=(Yl(),Pe(Ql)),wH=(wg(),Pe(yg)),vH=(XN(),Pe(ZN)),nye=Ks();function bH(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var rye=bH(vH),iye=bH(nye);function _N(t){return t==null||typeof t!="object"&&typeof t!="function"}function EH(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function IH(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var sye="[object RegExp]",CH="[object String]",AH="[object Number]",SH="[object Boolean]",_H="[object Arguments]",oye="[object Symbol]",aye="[object Date]",cye="[object Map]",lye="[object Set]",uye="[object Array]",dye="[object ArrayBuffer]",hye="[object Object]",fye="[object DataView]",pye="[object Uint8Array]",gye="[object Uint8ClampedArray]",mye="[object Uint16Array]",yye="[object Uint32Array]",wye="[object Int8Array]",vye="[object Int16Array]",bye="[object Int32Array]",Eye="[object Float32Array]",Iye="[object Float64Array]";function TN(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Cye(t,e){return nh(t,void 0,t,new Map,e)}function nh(t,e,n,r=new Map,i=void 0){let s=i?.(t,e,n,r);if(s!=null)return s;if(_N(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){let o=new Array(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=nh(t[a],a,n,r,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){let o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){let o=new Map;r.set(t,o);for(let[a,c]of t)o.set(a,nh(c,a,n,r,i));return o}if(t instanceof Set){let o=new Set;r.set(t,o);for(let a of t)o.add(nh(a,void 0,n,r,i));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(TN(t)){let o=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=nh(t[a],a,n,r,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){let o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,o),ql(o,t,n,r,i),o}if(typeof File<"u"&&t instanceof File){let o=new File([t],t.name,{type:t.type});return r.set(t,o),ql(o,t,n,r,i),o}if(t instanceof Blob){let o=new Blob([t],{type:t.type});return r.set(t,o),ql(o,t,n,r,i),o}if(t instanceof Error){let o=new t.constructor;return r.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,ql(o,t,n,r,i),o}if(typeof t=="object"&&Aye(t)){let o=Object.create(Object.getPrototypeOf(t));return r.set(t,o),ql(o,t,n,r,i),o}return t}function ql(t,e,n=t,r,i){let s=[...Object.keys(e),...EH(e)];for(let o=0;o<s.length;o++){let a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=nh(e[a],a,n,r,i))}}function Aye(t){switch(IH(t)){case _H:case uye:case dye:case fye:case SH:case aye:case Eye:case Iye:case wye:case vye:case bye:case cye:case AH:case hye:case sye:case lye:case CH:case oye:case pye:case gye:case mye:case yye:return!0;default:return!1}}function Sye(t,e){return Cye(t,(n,r,i,s)=>{let o=e?.(n,r,i,s);if(o!=null)return o;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case AH:case CH:case SH:{let a=new t.constructor(t?.valueOf());return ql(a,t),a}case _H:{let a={};return ql(a,t),a.length=t.length,a[Symbol.iterator]=t[Symbol.iterator],a}default:return}})}function XV(t){return Sye(t)}function eH(t){return t!==null&&typeof t=="object"&&IH(t)==="[object Arguments]"}function tH(t){return typeof t=="object"&&t!==null}function _ye(){}function Tye(t){return TN(t)}function Dye(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){let n=t[Symbol.toStringTag];return n==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function Nye(t){if(_N(t))return t;if(Array.isArray(t)||TN(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);let e=Object.getPrototypeOf(t),n=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new n(t);if(t instanceof RegExp){let r=new n(t);return r.lastIndex=t.lastIndex,r}if(t instanceof DataView)return new n(t.buffer.slice(0));if(t instanceof Error){let r=new n(t.message);return r.stack=t.stack,r.name=t.name,r.cause=t.cause,r}if(typeof File<"u"&&t instanceof File)return new n([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){let r=Object.create(e);return Object.assign(r,t)}return t}function xye(t,...e){let n=e.slice(0,-1),r=e[e.length-1],i=t;for(let s=0;s<n.length;s++){let o=n[s];i=vN(i,o,r,new Map)}return i}function vN(t,e,n,r){if(_N(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(r.has(e))return Nye(r.get(e));if(r.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}let i=[...Object.keys(e),...EH(e)];for(let s=0;s<i.length;s++){let o=i[s],a=e[o],c=t[o];if(eH(a)&&(a=H({},a)),eH(c)&&(c=H({},c)),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=XV(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let u=[],d=Reflect.ownKeys(c);for(let h=0;h<d.length;h++){let f=d[h];u[f]=c[f]}c=u}else c=[];let l=n(c,a,o,t,e,r);l!=null?t[o]=l:Array.isArray(a)||tH(c)&&tH(a)?t[o]=vN(c,a,n,r):c==null&&Dye(a)?t[o]=vN({},a,n,r):c==null&&Tye(a)?t[o]=XV(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function Rye(t,...e){return xye(t,...e,_ye)}var nH="error",Oye="wss://relay.walletconnect.org",Pye="wc",TH="universal_provider",l0=`${Pye}@2:${TH}:`,DH="https://rpc.walletconnect.org/v1/",NH="generic",Mye=`${DH}bundler`,rh="call_status",kye=86400,DN={DEFAULT_CHAIN_CHANGED:"default_chain_changed"},Lye=Object.defineProperty,Fye=Object.defineProperties,Bye=Object.getOwnPropertyDescriptors,rH=Object.getOwnPropertySymbols,Uye=Object.prototype.hasOwnProperty,jye=Object.prototype.propertyIsEnumerable,iH=(t,e,n)=>e in t?Lye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u0=(t,e)=>{for(var n in e||(e={}))Uye.call(e,n)&&iH(t,n,e[n]);if(rH)for(var n of rH(e))jye.call(e,n)&&iH(t,n,e[n]);return t},Vye=(t,e)=>Fye(t,Bye(e));function xH(t,e,n){var r;let i=wt.parseChainId(t);return((r=e.rpcMap)==null?void 0:r[i.reference])||`${DH}?chainId=${i.namespace}:${i.reference}&projectId=${n}`}function Hye(t){return t.includes(":")?t.split(":")[1]:t}function RH(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function $ye(t,e){let n=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!n.length)return[];let r=[];return n.forEach(i=>{let s=e.namespaces[i].accounts;r.push(...s)}),r}function sH(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>{var r,i;return((r=n?.chains)==null?void 0:r.length)&&((i=n?.chains)==null?void 0:i.length)>0}))}function d0(t={},e={}){let n=sH(oH(t)),r=sH(oH(e));return Rye(n,r)}function oH(t){var e,n,r,i,s;let o={};if(!wt.isValidObject(t))return o;for(let[a,c]of Object.entries(t)){let l=wt.isCaipNamespace(a)?[a]:c.chains,u=c.methods||[],d=c.events||[],h=c.rpcMap||{},f=wt.parseNamespaceKey(a);o[f]=Vye(u0(u0({},o[f]),c),{chains:wt.mergeArrays(l,(e=o[f])==null?void 0:e.chains),methods:wt.mergeArrays(u,(n=o[f])==null?void 0:n.methods),events:wt.mergeArrays(d,(r=o[f])==null?void 0:r.events)}),(wt.isValidObject(h)||wt.isValidObject(((i=o[f])==null?void 0:i.rpcMap)||{}))&&(o[f].rpcMap=u0(u0({},h),(s=o[f])==null?void 0:s.rpcMap))}return o}function aH(t){return t.includes(":")?t.split(":")[2]:t}function cH(t){let e={};for(let[n,r]of Object.entries(t)){let i=r.methods||[],s=r.events||[],o=r.accounts||[],a=wt.isCaipNamespace(n)?[n]:r.chains?r.chains:RH(r.accounts);e[n]={chains:a,methods:i,events:s,accounts:o}}return e}function fN(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function qye(t){try{let e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}var OH={},ih=t=>OH[t],pN=(t,e)=>{OH[t]=e},zye=Object.defineProperty,lH=Object.getOwnPropertySymbols,Gye=Object.prototype.hasOwnProperty,Kye=Object.prototype.propertyIsEnumerable,uH=(t,e,n)=>e in t?zye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,dH=(t,e)=>{for(var n in e||(e={}))Gye.call(e,n)&&uH(t,n,e[n]);if(lH)for(var n of lH(e))Kye.call(e,n)&&uH(t,n,e[n]);return t},hH="eip155",Wye=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],Qye=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,gN=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,fH=t=>Object.keys(t).filter(e=>Wye.includes(e)).reduce((e,n)=>(e[n]=Yye(t[n]),e),{}),Yye=t=>typeof t=="string"&&qye(t)?JSON.parse(t):t,Jye=(t,e,n)=>{let{sessionProperties:r={},scopedProperties:i={}}=t,s={};if(!wt.isValidObject(i)&&!wt.isValidObject(r))return;let o=fH(r);for(let a of n){let c=Qye(a);if(!c)continue;s[gN(c)]=o;let l=i?.[`${hH}:${c}`];if(l){let u=l?.[`${hH}:${c}:${e}`];s[gN(c)]=dH(dH({},s[gN(c)]),fH(u||l))}}for(let[a,c]of Object.entries(s))Object.keys(c).length===0&&delete s[a];return Object.keys(s).length>0?s:void 0},Zye=Object.defineProperty,Xye=(t,e,n)=>e in t?Zye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ewe=(t,e,n)=>Xye(t,typeof e!="symbol"?e+"":e,n),mN,bN=class t{constructor(e){ewe(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,n){return await this.storage.setItem(e,n)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return mN||(mN=new t(e)),mN}},twe=Object.defineProperty,nwe=Object.defineProperties,rwe=Object.getOwnPropertyDescriptors,pH=Object.getOwnPropertySymbols,iwe=Object.prototype.hasOwnProperty,swe=Object.prototype.propertyIsEnumerable,gH=(t,e,n)=>e in t?twe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,owe=(t,e)=>{for(var n in e||(e={}))iwe.call(e,n)&&gH(t,n,e[n]);if(pH)for(var n of pH(e))swe.call(e,n)&&gH(t,n,e[n]);return t},awe=(t,e)=>nwe(t,rwe(e));async function cwe(t,e){let n=wt.parseChainId(t.result.capabilities.caip345.caip2),r=t.result.capabilities.caip345.transactionHashes,i=await Promise.allSettled(r.map(d=>lwe(n.reference,d,e))),s=i.filter(d=>d.status==="fulfilled").map(d=>d.value).filter(d=>d);i.filter(d=>d.status==="rejected").forEach(d=>console.warn("Failed to fetch transaction receipt:",d.reason));let o=!s.length||s.some(d=>!d),a=s.every(d=>d?.status==="0x1"),c=s.every(d=>d?.status==="0x0"),l=s.some(d=>d?.status==="0x0"),u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:s,status:u}}async function lwe(t,e,n){return await n(parseInt(t)).request(SN.formatJsonRpcRequest("eth_getTransactionReceipt",[e]))}async function uwe({sendCalls:t,storage:e}){let n=await e.getItem(rh);await e.setItem(rh,awe(owe({},n),{[t.result.id]:{request:t.request,result:t.result,expiry:wt.calcExpiry(kye)}}))}async function dwe({resultId:t,storage:e}){let n=await e.getItem(rh);if(n){delete n[t],await e.setItem(rh,n);for(let r in n)wt.isExpired(n[r].expiry)&&delete n[r];await e.setItem(rh,n)}}async function hwe({resultId:t,storage:e}){let n=await e.getItem(rh),r=n?.[t];if(r&&!wt.isExpired(r.expiry))return r;await dwe({resultId:t,storage:e})}var fwe=Object.defineProperty,pwe=Object.defineProperties,gwe=Object.getOwnPropertyDescriptors,mH=Object.getOwnPropertySymbols,mwe=Object.prototype.hasOwnProperty,ywe=Object.prototype.propertyIsEnumerable,EN=(t,e,n)=>e in t?fwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yN=(t,e)=>{for(var n in e||(e={}))mwe.call(e,n)&&EN(t,n,e[n]);if(mH)for(var n of mH(e))ywe.call(e,n)&&EN(t,n,e[n]);return t},wN=(t,e)=>pwe(t,gwe(e)),$l=(t,e,n)=>EN(t,typeof e!="symbol"?e+"":e,n),IN=class{constructor(e){$l(this,"name","eip155"),$l(this,"client"),$l(this,"chainId"),$l(this,"namespace"),$l(this,"httpProviders"),$l(this,"events"),$l(this,"storage"),this.namespace=e.namespace,this.events=ih("events"),this.client=ih("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=bN.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(parseInt(e),n);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(DN.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,n){let r=n||xH(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new wH.JsonRpcProvider(new vH.HttpConnection(r,ih("disableProviderPing")))}setHttpProvider(e,n){let r=this.createHttpProvider(e,n);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(n=>{var r;let i=parseInt(Hye(n));e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[n])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}getHttpProvider(e){let n=e||this.chainId;return this.httpProviders[n]||(this.httpProviders=wN(yN({},this.httpProviders),{[n]:this.createHttpProvider(n)}),this.httpProviders[n])}async handleSwitchChain(e){var n,r;let i=e.request.params?(n=e.request.params[0])==null?void 0:n.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;let s=parseInt(i,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var n,r,i,s,o;let a=(r=(n=e.request)==null?void 0:n.params)==null?void 0:r[0],c=((s=(i=e.request)==null?void 0:i.params)==null?void 0:s[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},d=`${a}${c.join(",")}`,h=u?.[d];if(h)return h;let f;try{f=Jye(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(f)return f;let p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:wN(yN({},l.sessionProperties||{}),{capabilities:wN(yN({},u||{}),{[d]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var n,r,i;let s=this.client.session.get(e.topic),o=(n=s.sessionProperties)==null?void 0:n.bundler_name;if(o){let l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}let a=(r=s.sessionProperties)==null?void 0:r.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}let c=await hwe({resultId:(i=e.request.params)==null?void 0:i[0],storage:this.storage});if(c)try{return await cwe(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,n){var r;let i=new URL(e),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(SN.formatJsonRpcRequest("eth_getUserOperationReceipt",[(r=n.request.params)==null?void 0:r[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,n){return`${Mye}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${n}`}async sendCalls(e){var n,r,i;let s=await this.client.request(e),o=(n=e.request.params)==null?void 0:n[0],a=s?.id,c=s?.capabilities||{},l=(r=c?.caip345)==null?void 0:r.caip2,u=(i=c?.caip345)==null?void 0:i.transactionHashes;return!a||!l||!(u!=null&&u.length)||await uwe({sendCalls:{request:o,result:s},storage:this.storage}),s}},wwe=Object.defineProperty,vwe=(t,e,n)=>e in t?wwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,th=(t,e,n)=>vwe(t,typeof e!="symbol"?e+"":e,n),CN=class{constructor(e){th(this,"name",NH),th(this,"client"),th(this,"httpProviders"),th(this,"events"),th(this,"namespace"),th(this,"chainId"),this.namespace=e.namespace,this.events=ih("events"),this.client=ih("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,n){this.httpProviders[e]||this.setHttpProvider(e,n);let r=this.chainId;this.chainId=e,this.events.emit(DN.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return wt.parseChainId(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(n=>n.split(":")[1]===this.chainId.toString()).map(n=>n.split(":")[2]))]:[]}createHttpProviders(){var e,n;let r={};return(n=(e=this.namespace)==null?void 0:e.accounts)==null||n.forEach(i=>{var s,o;let a=wt.parseChainId(i),c=(o=(s=this.namespace)==null?void 0:s.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];r[a.reference]=this.createHttpProvider(i,c)}),r}getHttpProvider(e){let n=wt.parseChainId(e).reference,r=this.httpProviders[n];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,n){let r=this.createHttpProvider(e,n);r&&(this.httpProviders[e]=r)}createHttpProvider(e,n){let r=n||xH(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new wH.JsonRpcProvider(new rye.default(r,ih("disableProviderPing")))}},bwe=Object.defineProperty,Ewe=Object.defineProperties,Iwe=Object.getOwnPropertyDescriptors,yH=Object.getOwnPropertySymbols,Cwe=Object.prototype.hasOwnProperty,Awe=Object.prototype.propertyIsEnumerable,AN=(t,e,n)=>e in t?bwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ag=(t,e)=>{for(var n in e||(e={}))Cwe.call(e,n)&&AN(t,n,e[n]);if(yH)for(var n of yH(e))Awe.call(e,n)&&AN(t,n,e[n]);return t},h0=(t,e)=>Ewe(t,Iwe(e)),Ni=(t,e,n)=>AN(t,typeof e!="symbol"?e+"":e,n),f0=class t{constructor(e){Ni(this,"client"),Ni(this,"namespaces"),Ni(this,"optionalNamespaces"),Ni(this,"sessionProperties"),Ni(this,"scopedProperties"),Ni(this,"events",new iye.default),Ni(this,"rpcProviders",{}),Ni(this,"session"),Ni(this,"providerOpts"),Ni(this,"logger"),Ni(this,"uri"),Ni(this,"disableProviderPing",!1);var n,r;this.providerOpts=e,this.logger=wt.createLogger({logger:(n=e.logger)!=null?n:nH,name:(r=this.providerOpts.name)!=null?r:TH}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let n=new t(e);return await n.initialize(),n}async request(e,n,r){let[i,s]=this.validateChain(n);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:ag({},e),chainId:`${i}:${s}`,topic:this.session.topic,expiry:r})}sendAsync(e,n,r,i){let s=new Date().getTime();this.request(e,r,i).then(o=>n(null,SN.formatJsonRpcResult(s,o))).catch(o=>n(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:wt.getSdkError("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,n){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,n);r&&(this.uri=r,this.events.emit("display_uri",r));let s=await i();if(this.session=s.session,this.session){let o=cH(this.session.namespaces);this.namespaces=d0(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}removeListener(e,n){this.events.removeListener(e,n)}off(e,n){this.events.off(e,n)}get isWalletConnect(){return!0}async pair(e){let{uri:n,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});n&&(this.uri=n,this.events.emit("display_uri",n));let i=await r();this.session=i;let s=cH(i.namespaces);return this.namespaces=d0(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,n){try{if(!this.session)return;let[r,i]=this.validateChain(e);this.getProvider(r).setDefaultChain(i,n)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let n=this.client.pairing.getAll();if(!wt.isValidArray(n))return;for(let r of n)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${n.length}`)}catch(n){this.logger.warn(n,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,n;if(this.client=this.providerOpts.client||await tye.SignClient.init({core:this.providerOpts.core,logger:this.providerOpts.logger||nH,relayUrl:this.providerOpts.relayUrl||Oye,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),new Error(`The provided session: ${(n=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:n.topic} doesn't exist in the Sign client`)}else{let r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(n=>wt.parseNamespaceKey(n)))];pN("client",this.client),pN("events",this.events),pN("disableProviderPing",this.disableProviderPing),e.forEach(n=>{if(!this.session)return;let r=$ye(n,this.session);if(r?.length===0)return;let i=RH(r),s=d0(this.namespaces,this.optionalNamespaces),o=h0(ag({},s[n]),{accounts:r,chains:i});switch(n){case"eip155":this.rpcProviders[n]=new IN({namespace:o});break;default:this.rpcProviders[n]=new CN({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var n;let{topic:r}=e;r===((n=this.session)==null?void 0:n.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var n;let{params:r,topic:i}=e;if(i!==((n=this.session)==null?void 0:n.topic))return;let{event:s}=r;if(s.name==="accountsChanged"){let o=s.data;o&&wt.isValidArray(o)&&this.events.emit("accountsChanged",o.map(aH))}else if(s.name==="chainChanged"){let o=r.chainId,a=r.event.data,c=wt.parseNamespaceKey(o),l=fN(o)!==fN(a)?`${c}:${fN(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:n})=>{var r,i;if(e!==((r=this.session)==null?void 0:r.topic))return;let{namespaces:s}=n,o=(i=this.client)==null?void 0:i.session.get(e);this.session=h0(ag({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:n})}),this.client.on("session_delete",async e=>{var n;e.topic===((n=this.session)==null?void 0:n.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",h0(ag({},wt.getSdkError("USER_DISCONNECTED")),{data:e.topic})))}),this.on(DN.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(h0(ag({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[NH]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var n;this.getProvider(e).updateNamespace((n=this.session)==null?void 0:n.namespaces[e])})}setNamespaces(e){let{namespaces:n={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:s}=e;this.optionalNamespaces=d0(n,r),this.sessionProperties=i,this.scopedProperties=s}validateChain(e){let[n,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[n,r];if(n&&!Object.keys(this.namespaces||{}).map(o=>wt.parseNamespaceKey(o)).includes(n))throw new Error(`Namespace '${n}' is not configured. Please call connect() first with namespace config.`);if(n&&r)return[n,r];let i=wt.parseNamespaceKey(Object.keys(this.namespaces)[0]),s=this.rpcProviders[i].getDefaultChain();return[i,s]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:n,internal:r=!1}){if(!this.namespaces)return;let[i,s]=this.validateChain(e);s&&(this.updateNamespaceChain(i,s),r?(this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:n})):this.getProvider(i).setDefaultChain(s),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:n,previousCaipChainId:r}){var i,s;try{if(r===n)return;let o=(s=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:s.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${n}:`)).map(aH);if(!wt.isValidArray(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,n){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${n}`,i={chains:[],methods:[],events:[],defaultChain:n};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=n):this.namespaces[r]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,n){var r;let i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${l0}/${e}${i}`,n)}async getFromStore(e){var n;let r=((n=this.session)==null?void 0:n.topic)||"";return await this.client.core.storage.getItem(`${l0}/${e}${r}`)}async deleteFromStore(e){var n;let r=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.removeItem(`${l0}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let n=await this.client.core.storage.getKeys();for(let r of n)r.startsWith(l0)&&await this.client.core.storage.removeItem(r)}catch(n){this.logger.warn(n,"Failed to cleanup storage")}}},Swe=f0;p0.UniversalProvider=Swe,p0.default=f0});var MH=$r(()=>{"use strict";l$();a$();c$()});function _we(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){let u=t.charAt(l),d=u.charCodeAt(0);if(e[d]!==255)throw new TypeError(u+" is ambiguous");e[d]=l}let n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,d=0,h=0,f=l.length;for(;h!==f&&l[h]===0;)h++,u++;let p=(f-h)*s+1>>>0,g=new Uint8Array(p);for(;h!==f;){let E=l[h],I=0;for(let L=p-1;(E!==0||I<d)&&L!==-1;L--,I++)E+=256*g[L]>>>0,g[L]=E%n>>>0,E=E/n>>>0;if(E!==0)throw new Error("Non-zero carry");d=I,h++}let m=p-d;for(;m!==p&&g[m]===0;)m++;let y=r.repeat(u);for(;m<p;++m)y+=t.charAt(g[m]);return y}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,d=0,h=0;for(;l[u]===r;)d++,u++;let f=(l.length-u)*i+1>>>0,p=new Uint8Array(f);for(;u<l.length;){let E=l.charCodeAt(u);if(E>255)return;let I=e[E];if(I===255)return;let L=0;for(let k=f-1;(I!==0||L<h)&&k!==-1;k--,L++)I+=n*p[k]>>>0,p[k]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");h=L,u++}let g=f-h;for(;g!==f&&p[g]===0;)g++;let m=new Uint8Array(d+(f-g)),y=d;for(;g!==f;)m[y++]=p[g++];return m}function c(l){let u=a(l);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var kH,LH=$r(()=>{"use strict";kH=_we});var Twe,FH,BH=$r(()=>{"use strict";LH();Twe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",FH=kH(Twe)});var cg,UH=$r(()=>{"use strict";cg={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603}});var g0,jH=$r(()=>{"use strict";BH();o$();tx();ch();ch();UH();g0=class extends ax{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new cx({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async getAccounts({namespace:e}){let r=this.provider?.session?.namespaces?.[e]?.accounts?.map(i=>{let[,,s]=i.split(":");return s}).filter((i,s,o)=>o.indexOf(i)===s)||[];return Promise.resolve({accounts:r.map(i=>sr.createAccount(e,i,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){if(!(e.caipNetwork&&Qt.BALANCE_SUPPORTED_CHAINS.includes(e.caipNetwork?.chainNamespace))||e.caipNetwork?.testnet)return{balance:"0.00",symbol:e.caipNetwork?.nativeCurrency.symbol||""};let r=W.getAccountData();if(r?.balanceLoading&&e.chainId===W.state.activeCaipNetwork?.id)return{balance:r?.balance||"0.00",symbol:r?.balanceSymbol||""};let s=(await W.fetchTokenBalance()).find(o=>o.chainId===`${e.caipNetwork?.chainNamespace}:${e.chainId}`&&o.symbol===e.caipNetwork?.nativeCurrency.symbol);return{balance:s?.quantity.numeric||"0.00",symbol:s?.symbol||e.caipNetwork?.nativeCurrency.symbol||""}}async signMessage(e){let{provider:n,message:r,address:i}=e;if(!n)throw new Error("UniversalAdapter:signMessage - provider is undefined");let s="";return W.state.activeCaipNetwork?.chainNamespace===st.CHAIN.SOLANA?s=(await n.request({method:"solana_signMessage",params:{message:FH.encode(new TextEncoder().encode(r)),pubkey:i}},W.state.activeCaipNetwork?.caipNetworkId)).signature:s=await n.request({method:"personal_sign",params:[r,i]},W.state.activeCaipNetwork?.caipNetworkId),{signature:s}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){let{caipNetwork:n}=e,r=this.getWalletConnectConnector();if(n.chainNamespace===st.CHAIN.EVM)try{await r.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:T0(n.id)}]})}catch(i){if(i.code===cg.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||i.code===cg.ERROR_INVALID_CHAIN_ID||i.code===cg.ERROR_CODE_DEFAULT||i?.data?.originalError?.code===cg.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await r.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:T0(n.id),rpcUrls:[n?.rpcUrls.chainDefault?.http],chainName:n.name,nativeCurrency:n.nativeCurrency,blockExplorerUrls:[n.blockExplorers?.default.url]}]})}catch{throw new Error("Chain is not supported")}}r.provider.setDefaultChain(n.caipNetworkId)}getWalletConnectProvider(){return this.connectors.find(r=>r.type==="WALLET_CONNECT")?.provider}}});var Dwe,m0,VH,HH=$r(()=>{"use strict";ch();dx();Dwe=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication"],m0={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;let e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;let e=t.config;return t.isEnabled&&e.length>0?e.filter(n=>n!=="email"):!1},processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?Qt.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;let e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?Qt.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;let e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?Qt.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Qt.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>t.isEnabled&&(t.config??[]),processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Qt.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Qt.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>Qt.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>typeof t>"u"?Qt.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!t}},VH={localSettingsOverridden:new Set,getApiConfig(t,e){return e?.find(n=>n.id===t)},addWarning(t,e){if(t!==void 0){let n=m0[e],r=n.isLegacy?`"features.${n.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(r)}},processFeature(t,e,n,r,i){let s=m0[t],o=e[s.localFeatureName];if(i&&!s.isAvailableOnBasic)return!1;if(r){let a=this.getApiConfig(s.apiFeatureName,n);return a?.config===null?this.processFallbackFeature(t,o):a?.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return m0[t].processApi(e)},processFallbackFeature(t,e){return m0[t].processFallback(e)},async fetchRemoteFeatures(t){let e=t.basic??!1,n=t.features||{};this.localSettingsOverridden.clear();let r=null,i=!1;try{r=await Jl.fetchProjectConfig(),i=r!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}let s=i&&!e?Qt.DEFAULT_REMOTE_FEATURES:Qt.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(let o of Dwe){let a=this.processFeature(o,n,r,i,e);Object.assign(s,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),Qt.DEFAULT_REMOTE_FEATURES}if(i&&this.localSettingsOverridden.size>0){let o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;or.open({debugMessage:Ar.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(o)},"warning")}return s}}});var $H,y0,qH=$r(()=>{"use strict";$H=Kl(PH(),1);tx();ch();MH();u$();dx();jH();HH();y0=class{constructor(e){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(n,r)=>{if(n){let i=W.getCaipNetworks(n)?.find(a=>a.id===r);if(i)return i;let s=W.getNetworkData(n)?.caipNetwork;return s||W.getRequestedCaipNetworks(n).filter(a=>a.chainNamespace===n)?.[0]}return W.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{let n=this.getCaipNetwork();if(n)return n.id},this.getCaipNetworks=n=>W.getCaipNetworks(n),this.getActiveChainNamespace=()=>W.state.activeChain,this.setRequestedCaipNetworks=(n,r)=>{W.setRequestedCaipNetworks(n,r)},this.getApprovedCaipNetworkIds=()=>W.getAllApprovedCaipNetworkIds(),this.getCaipAddress=n=>W.state.activeChain===n||!n?W.state.activeCaipAddress:W.state.chains.get(n)?.accountState?.caipAddress,this.setClientId=n=>{N0.setClientId(n)},this.getProvider=n=>qt.getProvider(n),this.getProviderType=n=>qt.getProviderId(n),this.getPreferredAccountType=n=>x0(n),this.setCaipAddress=(n,r,i=!1)=>{W.setAccountProp("caipAddress",n,r,i),W.setAccountProp("address",sr.getPlainAddress(n),r,i)},this.setBalance=(n,r,i)=>{W.setAccountProp("balance",n,i),W.setAccountProp("balanceSymbol",r,i)},this.setProfileName=(n,r)=>{W.setAccountProp("profileName",n,r)},this.setProfileImage=(n,r)=>{W.setAccountProp("profileImage",n,r)},this.setUser=(n,r)=>{W.setAccountProp("user",n,r)},this.resetAccount=n=>{W.resetAccount(n)},this.setCaipNetwork=n=>{W.setActiveCaipNetwork(n)},this.setCaipNetworkOfNamespace=(n,r)=>{W.setChainNetworkData(r,{caipNetwork:n})},this.setStatus=(n,r)=>{W.setAccountProp("status",n,r),bt.isConnected()?Ut.setConnectionStatus("connected"):Ut.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=n=>W.getAccountData(n)?.address,this.setConnectors=n=>{let r=[...bt.state.allConnectors,...n];bt.setConnectors(r)},this.setConnections=(n,r)=>{Ut.setConnections(n,r),Vt.setConnections(n,r)},this.fetchIdentity=n=>N0.fetchIdentity(n),this.getReownName=n=>ox.getNamesForAddress(n),this.getConnectors=()=>bt.getConnectors(),this.getConnectorImage=n=>nx.getConnectorImage(n),this.getConnections=n=>this.remoteFeatures.multiWallet?R0.getConnectionsData(n).connections:(or.open(st.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=n=>this.remoteFeatures.multiWallet?R0.getConnectionsData(n).recentConnections:(or.open(st.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async n=>{if(!this.remoteFeatures.multiWallet){or.open(st.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await Vt.switchConnection(n)},this.deleteConnection=n=>{if(!this.remoteFeatures.multiWallet){or.open(st.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}Ut.deleteAddressFromConnection(n),Vt.syncStorageConnections()},this.setConnectedWalletInfo=(n,r)=>{let i=qt.getProviderId(r),s=n?fe(H({},n),{type:i}):void 0;W.setAccountProp("connectedWalletInfo",s,r)},this.getIsConnectedState=()=>!!W.state.activeCaipAddress,this.addAddressLabel=(n,r,i)=>{let s=W.getAccountData(i)?.addressLabels||{};W.setAccountProp("addressLabels",fe(H({},s),{[n]:r}),i)},this.removeAddressLabel=(n,r)=>{let i=W.getAccountData(r)?.addressLabels||{};W.setAccountProp("addressLabels",fe(H({},i),{[n]:void 0}),r)},this.getAddress=n=>{let r=n||W.state.activeChain;return W.getAccountData(r)?.address},this.resetNetwork=n=>{W.resetNetwork(n)},this.addConnector=n=>{bt.addConnector(n)},this.resetWcConnection=()=>{Vt.resetWcConnection()},this.setAddressExplorerUrl=(n,r)=>{W.setAccountProp("addressExplorerUrl",n,r)},this.setSmartAccountDeployed=(n,r)=>{W.setAccountProp("smartAccountDeployed",n,r)},this.setPreferredAccountType=(n,r)=>{W.setAccountProp("preferredAccountType",n,r)},this.setEIP6963Enabled=n=>{de.setEIP6963Enabled(n)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,n){let r=e?.map(s=>s.namespace).filter(s=>!!s);if(r?.length)return[...new Set(r)];let i=n?.map(s=>s.chainNamespace);return[...new Set(i)]}async initialize(e){if(this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),de.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),this.remoteFeatures=await VH.fetchRemoteFeatures(e),await Jl.fetchUsage(),de.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&ix.setOnrampProviders(this.remoteFeatures.onramp),(de.state.remoteFeatures?.email||Array.isArray(de.state.remoteFeatures?.socials)&&de.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins(),de.state.features?.reownAuthentication||de.state.remoteFeatures?.reownAuthentication){let{ReownAuthentication:n}=await import("./chunk-56SKK657.js"),r=de.state.siwx;r instanceof n||(r&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),de.setSIWX(new n))}}async openSend(e){let n=e.namespace||W.state.activeChain,r=this.getCaipAddress(n),i=this.getCaipNetwork(n)?.id;if(!r)throw new Error("openSend: caipAddress not found");if(i?.toString()!==e.chainId.toString()){let s=W.getCaipNetworkById(e.chainId,n);if(!s)throw new Error(`openSend: caipNetwork with chainId ${e.chainId} not found`);await this.switchNetwork(s,{throwOnFailure:!0})}try{let s=lx.getTokenSymbolByAddress(e.assetAddress);s&&await Jl.fetchTokenImages([s])}catch{}return await Ws.open({view:"WalletSend",data:{send:e}}),new Promise((s,o)=>{let a=P0.subscribeKey("hash",u=>{u&&(l(),s({hash:u}))}),c=Ws.subscribe(u=>{u.open||(l(),o(new Error("Modal closed")))}),l=this.createCleanupHandler([a,c])})}toModalOptions(){function e(r){return r?.view==="Swap"}function n(r){return r?.view==="WalletSend"}return{isSwap:e,isSend:n}}async checkAllowedOrigins(){try{let e=await Jl.fetchAllowedOrigins();if(!sr.isClient())return;let n=window.location.origin;vg.isOriginAllowed(n,e,st.DEFAULT_ALLOWED_ANCESTORS)||or.open(Ar.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error))return;switch(e.message){case"RATE_LIMITED":or.open(Ar.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{let n=e.cause instanceof Error?e.cause:e;or.open({displayMessage:Ar.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:Ar.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(n.message)},"error");break}default:break}}}createCleanupHandler(e){return()=>{e.forEach(n=>{try{n()}catch{}})}}sendInitializeEvent(e){let n=ON(e,[]);delete n.adapters,delete n.universalProvider,Bo.sendEvent({type:"track",event:"INITIALIZE",properties:fe(H({},n),{networks:e.networks.map(r=>r.id),siweConfig:{options:e.siweConfig?.options||{}}})})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initAdapterController(){rx.initialize(this.chainAdapters)}initializeThemeController(e){e.themeMode&&bs.setThemeMode(e.themeMode),e.themeVariables&&bs.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient)throw new Error("ConnectionControllerClient must be set");W.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});let n=this.getDefaultNetwork();n&&W.setActiveCaipNetwork(n)}initializeConnectionController(e){Vt.initialize(e.adapters??[]),Vt.setWcBasic(e.basic??!1)}initializeConnectorController(){bt.initialize(this.chainNamespaces)}initializeProjectSettings(e){de.setProjectId(e.projectId),de.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){de.setDebug(e.debug!==!1),de.setEnableWalletGuide(e.enableWalletGuide!==!1),de.setEnableWallets(e.enableWallets!==!1),de.setEIP6963Enabled(e.enableEIP6963!==!1),de.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),de.setEnableReconnect(e.enableReconnect!==!1),de.setEnableMobileFullScreen(e.enableMobileFullScreen===!0),de.setCoinbasePreference(e.coinbasePreference),de.setEnableAuthLogger(e.enableAuthLogger!==!1),de.setCustomRpcUrls(e.customRpcUrls),de.setEnableEmbedded(e.enableEmbedded),de.setAllWallets(e.allWallets),de.setIncludeWalletIds(e.includeWalletIds),de.setExcludeWalletIds(e.excludeWalletIds),de.setFeaturedWalletIds(e.featuredWalletIds),de.setTokens(e.tokens),de.setTermsConditionsUrl(e.termsConditionsUrl),de.setPrivacyPolicyUrl(e.privacyPolicyUrl),de.setCustomWallets(e.customWallets),de.setFeatures(e.features),de.setAllowUnsupportedChain(e.allowUnsupportedChain),de.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),de.setPreferUniversalLinks(e.experimental_preferUniversalLinks),de.setDefaultAccountTypes(e.defaultAccountTypes);let n=this.getDefaultMetaData();if(!e.metadata&&n&&(e.metadata=n),de.setMetadata(e.metadata),de.setDisableAppend(e.disableAppend),de.setEnableEmbedded(e.enableEmbedded),de.setSIWX(e.siwx),this.features=de.state.features??{},!e.projectId){or.open(Ar.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(e.adapters?.find(i=>i.namespace===st.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");de.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){return sr.isClient()?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(e){let n=this.getActiveChainNamespace();if(n){let r=Zl.getUnsupportedNetwork(`${n}:${e}`);W.setActiveCaipNetwork(r)}}getDefaultNetwork(){return Zl.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,n){return Zl.extendCaipNetwork(e,{customNetworkImageUrls:n.chainImages,projectId:n.projectId})}extendCaipNetworks(e){return Zl.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){let n=e.networks.find(i=>i.id===e.defaultNetwork?.id);return n?Zl.extendCaipNetwork(n,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectConnector(e,n){try{this.setLoading(!0,e);let r={connections:[]},i=this.getAdapter(e);return(W.state.chains.get(e)?.accountState?.caipAddress||!de.state.enableReconnect)&&i?.disconnect&&(r=await i.disconnect({id:n})),this.setLoading(!1,e),r}catch(r){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${r.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{let e=W.state.activeChain,n=this.getAdapter(e),r=this.getCaipNetwork(e)?.id,i=Vt.getConnections(e),s=this.remoteFeatures.multiWallet,o=i.length>0;if(!n)throw new Error("Adapter not found");let a=await n.connectWalletConnect(r);(!o||!s)&&this.close(),this.setClientId(a?.clientId||null),Ut.setConnectedNamespaces([...W.state.chains.keys()]),await this.syncWalletConnectAccount(),await bg.initializeIfEnabled()},connectExternal:async e=>{let n=await this.onConnectExternal(e);return await this.connectInactiveNamespaces(e,n),n?{address:n.address}:void 0},reconnectExternal:async({id:e,info:n,type:r,provider:i})=>{let s=W.state.activeChain,o=this.getAdapter(s);if(!s)throw new Error("reconnectExternal: namespace not found");if(!o)throw new Error("reconnectExternal: adapter not found");o?.reconnect&&(await o?.reconnect({id:e,info:n,type:r,provider:i,chainId:this.getCaipNetwork()?.id}),Ut.addConnectedNamespace(s),this.syncConnectedWalletInfo(s))},disconnectConnector:async e=>{await this.disconnectConnector(e.namespace,e.id)},disconnect:async e=>{let{id:n,chainNamespace:r,initialDisconnect:i}=e||{},s=r||W.state.activeChain,o=bt.getConnectorId(s),a=n===st.CONNECTOR_ID.AUTH||o===st.CONNECTOR_ID.AUTH,c=n===st.CONNECTOR_ID.WALLET_CONNECT||o===st.CONNECTOR_ID.WALLET_CONNECT;try{let l=Array.from(W.state.chains.keys()),u=r?[r]:l;(c||a)&&(u=l);let d=u.map(async p=>{let g=bt.getConnectorId(p),m=n||g,y=await this.disconnectConnector(p,m);y&&(a&&Ut.deleteConnectedSocialProvider(),y.connections.forEach(E=>{Ut.addDisconnectedConnectorId(E.connectorId,p)})),i&&this.onDisconnectNamespace({chainNamespace:p,closeModal:!1})}),h=await Promise.allSettled(d);P0.resetSend(),Vt.resetWcConnection(),bg.getSIWX()?.signOutOnDisconnect&&await bg.clearSessions(),bt.setFilterByNamespace(void 0),Vt.syncStorageConnections();let f=h.filter(p=>p.status==="rejected");if(f.length>0)throw new Error(f.map(p=>p.reason.message).join(", "));Bo.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:r||"all"}})}catch(l){throw new Error(`Failed to disconnect chains: ${l.message}`)}},checkInstalled:e=>e?e.some(n=>!!window.ethereum?.[String(n)]):!!window.ethereum,signMessage:async e=>{let n=W.state.activeChain,r=this.getAdapter(W.state.activeChain);if(!n)throw new Error("signMessage: namespace not found");if(!r)throw new Error("signMessage: adapter not found");let i=this.getAddress(n);if(!i)throw new Error("signMessage: address not found");return(await r?.signMessage({message:e,address:i,provider:qt.getProvider(n)}))?.signature||""},sendTransaction:async e=>{let n=e.chainNamespace;if(!n)throw new Error("sendTransaction: namespace not found");if(Qt.SEND_SUPPORTED_NAMESPACES.includes(n)){let r=this.getAdapter(n);if(!r)throw new Error("sendTransaction: adapter not found");let i=qt.getProvider(n);return(await r?.sendTransaction(fe(H({},e),{caipNetwork:this.getCaipNetwork(),provider:i})))?.hash||""}return""},estimateGas:async e=>{let n=e.chainNamespace;if(n===st.CHAIN.EVM){let r=this.getAdapter(n);if(!r)throw new Error("estimateGas: adapter is required but got undefined");let i=qt.getProvider(n),s=this.getCaipNetwork();if(!s)throw new Error("estimateGas: caipNetwork is required but got undefined");return(await r?.estimateGas(fe(H({},e),{provider:i,caipNetwork:s})))?.gas||0n}return 0n},getEnsAvatar:async()=>{let e=W.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");let n=this.getAddress(e);if(!n)throw new Error("getEnsAvatar: address not found");return await this.syncIdentity({address:n,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:e}),W.getAccountData()?.profileImage||!1},getEnsAddress:async e=>await vg.resolveReownName(e),writeContract:async e=>{let n=W.state.activeChain,r=this.getAdapter(n);if(!n)throw new Error("writeContract: namespace is required but got undefined");if(!r)throw new Error("writeContract: adapter is required but got undefined");let i=this.getCaipNetwork(),s=this.getCaipAddress(),o=qt.getProvider(n);if(!i||!s)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");return(await r?.writeContract(fe(H({},e),{caipNetwork:i,provider:o,caipAddress:s})))?.hash},parseUnits:(e,n)=>{let r=this.getAdapter(W.state.activeChain);if(!r)throw new Error("parseUnits: adapter is required but got undefined");return r?.parseUnits({value:e,decimals:n})??0n},formatUnits:(e,n)=>{let r=this.getAdapter(W.state.activeChain);if(!r)throw new Error("formatUnits: adapter is required but got undefined");return r?.formatUnits({value:e,decimals:n})??"0"},getCapabilities:async e=>{let n=this.getAdapter(W.state.activeChain);if(!n)throw new Error("getCapabilities: adapter is required but got undefined");return await n?.getCapabilities(e)},grantPermissions:async e=>{let n=this.getAdapter(W.state.activeChain);if(!n)throw new Error("grantPermissions: adapter is required but got undefined");return await n?.grantPermissions(e)},revokePermissions:async e=>{let n=this.getAdapter(W.state.activeChain);if(!n)throw new Error("revokePermissions: adapter is required but got undefined");return n?.revokePermissions?await n.revokePermissions(e):"0x"},walletGetAssets:async e=>{let n=this.getAdapter(W.state.activeChain);if(!n)throw new Error("walletGetAssets: adapter is required but got undefined");return await n?.walletGetAssets(e)??{}},updateBalance:e=>{let n=this.getAddress(e),r=this.getCaipNetwork(e);!r||!n||this.updateNativeBalance(n,r?.id,e)}},Vt.setClient(this.connectionControllerClient)}async onConnectExternal(e){let n=W.state.activeChain,r=e.chain||n,i=this.getAdapter(r),s=!0;if(e.type===Qs.CONNECTOR_TYPE_AUTH&&st.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(d=>bt.getConnectorId(d)===st.CONNECTOR_ID.AUTH)&&e.chain!==n&&(s=!1),e.chain&&e.chain!==n&&!e.caipNetwork){let l=this.getCaipNetworks().find(u=>u.chainNamespace===e.chain);l&&s&&this.setCaipNetwork(l)}if(!r)throw new Error("connectExternal: namespace not found");if(!i)throw new Error("connectExternal: adapter not found");let o=this.getCaipNetwork(r),a=e.caipNetwork||o,c=await i.connect({id:e.id,address:e.address,info:e.info,type:e.type,provider:e.provider,socialUri:e.socialUri,chainId:e.caipNetwork?.id||o?.id,rpcUrl:e.caipNetwork?.rpcUrls?.default?.http?.[0]||o?.rpcUrls?.default?.http?.[0]});if(c)return Ut.addConnectedNamespace(r),this.syncProvider(fe(H({},c),{chainNamespace:r})),this.setStatus("connected",r),this.syncConnectedWalletInfo(r),Ut.removeDisconnectedConnectorId(e.id,r),{address:c.address,connectedCaipNetwork:a}}async connectInactiveNamespaces(e,n){let r=e.type===Qs.CONNECTOR_TYPE_AUTH,i=M0.getOtherAuthNamespaces(n?.connectedCaipNetwork?.chainNamespace),s=W.state.activeCaipNetwork,o=this.getAdapter(s?.chainNamespace);r&&(await Promise.all(i.map(async a=>{try{let c=qt.getProvider(a),l=this.getCaipNetwork(a);await this.getAdapter(a)?.connect(fe(H({},e),{provider:c,socialUri:void 0,chainId:l?.id,rpcUrl:l?.rpcUrls?.default?.http?.[0]}))&&(Ut.addConnectedNamespace(a),Ut.removeDisconnectedConnectorId(e.id,a),this.setStatus("connected",a),this.syncConnectedWalletInfo(a))}catch(c){or.warn(Ar.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,Ar.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(a,c instanceof Error?c.message:void 0),Ar.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),s&&await o?.switchNetwork({caipNetwork:s}))}getApprovedCaipNetworksData(){if(qt.getProviderId(W.state.activeChain)===Qs.CONNECTOR_TYPE_WALLET_CONNECT){let n=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(n)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){let n=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){let i=qt.getProviderId(n);if(e.chainNamespace===W.state.activeChain)await this.getAdapter(n)?.switchNetwork({caipNetwork:e});else if(this.setCaipNetwork(e),i===Qs.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{let s=this.getAddressByChainNamespace(n);s&&this.syncAccount({address:s,chainId:e.id,chainNamespace:n})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(n=>{let r=n.chains||[],i=n.accounts.map(s=>{let{chainId:o,chainNamespace:a}=cc.parseCaipAddress(s);return`${a}:${o}`});return Array.from(new Set([...r,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((n,r)=>{let i=e?.find(s=>s.namespace===r);return i?(i.construct({namespace:r,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:s})=>s===r)}),n[r]=i):n[r]=new g0({namespace:r,networks:this.getCaipNetworks()}),n},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e);let n=this.getAdapter(e);if(!n)throw new Error("adapter not found");await n.syncConnectors(),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)})),this.initAdapterController()}onConnectors(e){this.getAdapter(e)?.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){let n=this.getAdapter(e);if(!n)return;let r=Ut.getConnectionStatus();de.state.enableReconnect===!1?this.setStatus("disconnected",e):r==="connected"?this.setStatus("connecting",e):r==="disconnected"?(Ut.clearAddressCache(),this.setStatus(r,e)):this.setStatus(r,e),n.on("switchNetwork",({address:i,chainId:s})=>{let o=this.getCaipNetworks().find(l=>l.id.toString()===s.toString()||l.caipNetworkId.toString()===s.toString()),a=W.state.activeChain===e,c=W.state.chains.get(e)?.accountState?.address;if(o){let l=a&&i?i:c;l&&this.syncAccount({address:l,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(s)}),n.on("disconnect",()=>{let i=this.remoteFeatures.multiWallet,s=Array.from(Vt.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!i||s.length===0})}),n.on("connections",i=>{this.setConnections(i,e)}),n.on("pendingTransactions",()=>{let i=this.getAddress(e),s=W.state.activeCaipNetwork;!i||!s?.id||this.updateNativeBalance(i,s.id,s.chainNamespace)}),n.on("accountChanged",({address:i,chainId:s,connector:o})=>{this.handlePreviousConnectorConnection(o);let a=W.state.activeChain===e;o?.provider&&(this.syncProvider({id:o.id,type:o.type,provider:o?.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e));let c=W.getNetworkData(e)?.caipNetwork?.id,l=s||c;a&&l?this.syncAccount({address:i,chainId:l,chainNamespace:e}):!a&&l?(this.syncAccountInfo(i,l,e),this.syncBalance({address:i,chainId:l,chainNamespace:e})):this.syncAccountInfo(i,s,e),Ut.addConnectedNamespace(e)})}async handlePreviousConnectorConnection(e){let n=e?.chain,r=e?.id,i=bt.getConnectorId(n),s=de.state.remoteFeatures?.multiWallet,a=n&&r&&i&&i!==r&&!s;try{a&&await Vt.disconnect({id:i,namespace:n})}catch(c){console.warn("Error disconnecting previous connector",c)}}async createUniversalProviderForAdapter(e){await this.getUniversalProvider(),this.universalProvider&&await this.chainAdapters?.[e]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>Vt.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();let e=this.getAddress();this.getCaipAddress()||Ut.deleteRecentWallet();let n=Ut.getRecentWallet();Bo.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:e,properties:{method:sr.isMobile()?"mobile":"qrcode",name:n?.name||"Unknown",reconnect:!0,view:lc.state.view,walletRank:n?.order}})}async syncNamespaceConnection(e){try{e===st.CHAIN.EVM&&sr.isSafeApp()&&bt.setConnectorId(st.CONNECTOR_ID.SAFE,e);let n=bt.getConnectorId(e);switch(this.setStatus("connecting",e),n){case st.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case st.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(n){console.warn("AppKit couldn't sync existing connection",n),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){let{chainNamespace:n,closeModal:r}=e||{};W.resetAccount(n),W.resetNetwork(n),Ut.removeConnectedNamespace(n);let i=Array.from(W.state.chains.keys());(n?[n]:i).forEach(o=>Ut.addDisconnectedConnectorId(bt.getConnectorId(o)||"",o)),bt.removeConnectorId(n),qt.resetChain(n),this.setUser(null,n),this.setStatus("disconnected",n),this.setConnectedWalletInfo(null,n),r!==!1&&Ws.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{let n=this.getAdapter(e),r=this.getCaipAddress(e),i=this.getCaipNetwork(e);return n?.syncConnections({connectToFirstConnector:!r,caipNetwork:i})}))}async syncAdapterConnection(e){let n=this.getAdapter(e),r=this.getCaipNetwork(e),i=bt.getConnectorId(e),o=bt.getConnectors(e).find(a=>a.id===i);try{if(!n||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!r?.id)throw new Error("CaipNetwork not found");let a=await n?.syncConnection({namespace:e,id:o.id,chainId:r.id,rpcUrl:r?.rpcUrls?.default?.http?.[0]});a?(this.syncProvider(fe(H({},a),{chainNamespace:e})),await this.syncAccount(fe(H({},a),{chainNamespace:e})),this.setStatus("connected",e),Bo.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:a.address,properties:{method:"browser",name:o.info?.name||o.name||"Unknown",reconnect:!0,view:lc.state.view,walletRank:void 0}})):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){let e=Object.keys(this.universalProvider?.session?.namespaces||{}),n=this.chainNamespaces.map(async r=>{let i=this.getAdapter(r);if(!i)return;let s=this.universalProvider?.session?.namespaces?.[r]?.accounts||[],o=W.state.activeCaipNetwork?.id,a=s.find(l=>{let{chainId:u}=cc.parseCaipAddress(l);return u===o?.toString()})||s[0];if(a){let l=cc.validateCaipAddress(a),{chainId:u,address:d}=cc.parseCaipAddress(l);if(qt.setProviderId(r,Qs.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&W.state.activeCaipNetwork&&i.namespace!==st.CHAIN.EVM){let h=i.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:W.state.activeCaipNetwork});qt.setProvider(r,h)}else qt.setProvider(r,this.universalProvider);bt.setConnectorId(st.CONNECTOR_ID.WALLET_CONNECT,r),Ut.addConnectedNamespace(r),await this.syncAccount({address:d,chainId:u,chainNamespace:r})}else e.includes(r)&&this.setStatus("disconnected",r);let c=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(r),W.setApprovedCaipNetworksData(r,{approvedCaipNetworkIds:c.approvedCaipNetworkIds,supportsAllNetworks:c.supportsAllNetworks})});await Promise.all(n)}syncProvider({type:e,provider:n,id:r,chainNamespace:i}){qt.setProviderId(i,e),qt.setProvider(i,n),bt.setConnectorId(r,i)}async syncAccount(e){let n=e.chainNamespace===W.state.activeChain,r=W.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:i,chainId:s,chainNamespace:o}=e,{chainId:a}=Ut.getActiveNetworkProps(),c=r?.id||a,l=W.state.activeCaipNetwork?.name===st.UNSUPPORTED_NETWORK_NAME,u=W.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!u)&&c){let d=this.getCaipNetworks().find(g=>g.id.toString()===c.toString()),h=this.getCaipNetworks().find(g=>g.chainNamespace===o);if(!u&&!d&&!h){let g=this.getApprovedCaipNetworkIds()||[],m=g.find(E=>cc.parseCaipNetworkId(E)?.chainId===c.toString()),y=g.find(E=>cc.parseCaipNetworkId(E)?.chainNamespace===o);d=this.getCaipNetworks().find(E=>E.caipNetworkId===m),h=this.getCaipNetworks().find(E=>E.caipNetworkId===y||"deprecatedCaipNetworkId"in E&&E.deprecatedCaipNetworkId===y)}let f=d||h;f?.chainNamespace===W.state.activeChain?de.state.enableNetworkSwitch&&!de.state.allowUnsupportedChain&&W.state.activeCaipNetwork?.name===st.UNSUPPORTED_NETWORK_NAME?W.showUnsupportedChainUI():this.setCaipNetwork(f):n||r&&this.setCaipNetworkOfNamespace(r,o),this.syncConnectedWalletInfo(o);let p=this.getAddress(o);M0.isLowerCaseMatch(i,p)||this.syncAccountInfo(i,f?.id,o),n?await this.syncBalance({address:i,chainId:f?.id,chainNamespace:o}):await this.syncBalance({address:i,chainId:r?.id,chainNamespace:o}),this.syncIdentity({address:i,chainId:s,chainNamespace:o})}}async syncAccountInfo(e,n,r){let i=this.getCaipAddress(r),s=n||i?.split(":")[1];if(!s)return;let o=`${r}:${s}:${e}`;this.setCaipAddress(o,r,!0),await this.syncIdentity({address:e,chainId:s,chainNamespace:r})}async syncReownName(e,n){try{let r=await this.getReownName(e);if(r[0]){let i=r[0];this.setProfileName(i.name,n)}else this.setProfileName(null,n)}catch{this.setProfileName(null,n)}}syncConnectedWalletInfo(e){let n=bt.getConnectorId(e),r=qt.getProviderId(e);if(r===Qs.CONNECTOR_TYPE_ANNOUNCED||r===Qs.CONNECTOR_TYPE_INJECTED){if(n){let s=this.getConnectors().find(o=>{let a=o.id===n,c=o.info?.rdns===n,l=o.connectors?.some(u=>u.id===n||u.info?.rdns===n);return a||c||!!l});if(s){let{info:o,name:a,imageUrl:c}=s,l=c||this.getConnectorImage(s);this.setConnectedWalletInfo(H({name:a,icon:l},o),e)}}}else if(r===Qs.CONNECTOR_TYPE_WALLET_CONNECT){let i=qt.getProvider(e);i?.session&&this.setConnectedWalletInfo(fe(H({},i.session.peer.metadata),{name:i.session.peer.metadata.name,icon:i.session.peer.metadata.icons?.[0]}),e)}else if(n&&(n===st.CONNECTOR_ID.COINBASE_SDK||n===st.CONNECTOR_ID.COINBASE)){let i=this.getConnectors().find(c=>c.id===n),s=i?.name||"Coinbase Wallet",o=i?.imageUrl||this.getConnectorImage(i),a=i?.info;this.setConnectedWalletInfo(fe(H({},a),{name:s,icon:o}),e)}}async syncBalance(e){!ex.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(r=>r.id.toString()===e.chainId?.toString())||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,n,r){let i=this.getAdapter(r),s=W.getCaipNetworkByNamespace(r,n);if(i){let o=await i.getBalance({address:e,chainId:n,caipNetwork:s,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,r),o}}async initializeUniversalAdapter(){let e=ux.createLogger((r,...i)=>{r&&this.handleAlertError(r),console.error(...i)}),n={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:e};de.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await $H.default.init(n),de.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{vg.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:n=>{Vt.setUri(n)},onConnect:n=>{let{address:r}=sr.getAccount(n[0]);Vt.finalizeWcConnection(r)},onDisconnect:()=>{W.state.noAdapters&&this.resetAccount(e),Vt.resetWcConnection()},onChainChanged:n=>{let r=W.state.activeChain,i=r&&bt.state.activeConnectorIds[r]===st.CONNECTOR_ID.WALLET_CONNECT;if(r===e&&(W.state.noAdapters||i)){let s=this.getCaipNetworks().find(a=>a.id.toString()===n.toString()||a.caipNetworkId.toString()===n.toString()),o=this.getCaipNetwork();if(!s){this.setUnsupportedNetwork(n);return}o?.id.toString()!==s?.id.toString()&&o?.chainNamespace===s?.chainNamespace&&this.setCaipNetwork(s)}},onAccountsChanged:n=>{let r=W.state.activeChain,i=r&&bt.state.activeConnectorIds[r]===st.CONNECTOR_ID.WALLET_CONNECT;if(r===e&&(W.state.noAdapters||i)){let s=n?.[0];s&&this.syncAccount({address:s.address,chainId:s.chainId,chainNamespace:s.chainNamespace})}}})})}createUniversalProvider(){return!this.universalProviderInitPromise&&sr.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Bo.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}getDisabledCaipNetworks(){let e=W.getAllApprovedCaipNetworkIds(),n=W.getAllRequestedCaipNetworks();return sr.sortRequestedNetworks(e,n).filter(i=>W.isCaipNetworkDisabled(i))}handleAlertError(e){let n=Object.entries(Ar.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[r,i]=n??[],{message:s,alertErrorKey:o}=i??{};if(r&&s&&!this.reportedAlertErrors[r]){let a=Ar.ALERT_ERRORS[o];a&&(or.open(a,"error"),this.reportedAlertErrors[r]=!0)}}getAdapter(e){if(e)return this.chainAdapters?.[e]}createAdapter(e){if(!e)return;let n=e.namespace;if(!n)return;this.createClients();let r=e;r.namespace=n,r.construct({namespace:n,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:i})=>i===n)}),this.chainNamespaces.includes(n)||this.chainNamespaces.push(n),this.chainAdapters&&(this.chainAdapters[n]=r)}async open(e){await this.injectModalUi(),e?.uri&&Vt.setUri(e.uri);let{isSwap:n,isSend:r}=this.toModalOptions();return n(e)?Ws.open(fe(H({},e),{data:{swap:e.arguments}})):r(e)&&e.arguments?this.openSend(e.arguments):Ws.open(e)}async close(){await this.injectModalUi(),Ws.close()}setLoading(e,n){Ws.setLoading(e,n)}async disconnect(e){await Vt.disconnect({namespace:e})}getSIWX(){return de.state.siwx}getError(){return""}getChainId(){return W.state.activeCaipNetwork?.id}async switchNetwork(e,{throwOnFailure:n=!1}={}){let r=this.getCaipNetworks().find(i=>i.id===e.id);if(!r){or.open(Ar.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await W.switchActiveNetwork(r,{throwOnFailure:n})}getWalletProvider(){return W.state.activeChain?qt.state.providers[W.state.activeChain]:null}getWalletProviderType(){return qt.getProviderId(W.state.activeChain)}subscribeProviders(e){return qt.subscribeProviders(e)}getThemeMode(){return bs.state.themeMode}getThemeVariables(){return bs.state.themeVariables}setThemeMode(e){bs.setThemeMode(e),fx(bs.state.themeMode)}setTermsConditionsUrl(e){de.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){de.setPrivacyPolicyUrl(e)}setThemeVariables(e){bs.setThemeVariables(e),px(bs.state.themeVariables)}subscribeTheme(e){return bs.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?Vt.subscribe(e):(or.open(st.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){return e?W.state.chains.get(e)?.accountState?.connectedWalletInfo:W.getAccountData()?.connectedWalletInfo}getAccount(e){let n=e||W.state.activeChain,r=bt.getAuthConnector(n),i=W.getAccountData(n),s=Ut.getConnectedConnectorId(W.state.activeChain),o=Vt.getConnections(n);if(!n)throw new Error("AppKit:getAccount - namespace is required");let a=o.flatMap(c=>c.accounts.map(({address:l,type:u,publicKey:d})=>sr.createAccount(n,l,u||"eoa",d)));if(i)return{allAccounts:a,caipAddress:i.caipAddress,address:sr.getPlainAddress(i.caipAddress),isConnected:!!i.caipAddress,status:i.status,embeddedWalletInfo:r&&s===st.CONNECTOR_ID.AUTH?{user:i.user?fe(H({},i.user),{username:Ut.getConnectedSocialUsername()}):void 0,authProvider:i.socialProvider||"email",accountType:x0(n),isSmartAccountDeployed:!!i.smartAccountDeployed}:void 0}}subscribeAccount(e,n){let r=()=>{let i=this.getAccount(n);i&&e(i)};n?W.subscribeChainProp("accountState",r,n):W.subscribe(r),bt.subscribe(r)}subscribeNetwork(e){return W.subscribe(({activeCaipNetwork:n})=>{e({caipNetwork:n,chainId:n?.id,caipNetworkId:n?.caipNetworkId})})}subscribeWalletInfo(e,n){return n?W.subscribeChainProp("accountState",r=>e(r?.connectedWalletInfo),n):W.subscribeChainProp("accountState",r=>e(r?.connectedWalletInfo))}subscribeShouldUpdateToAddress(e){W.subscribeChainProp("accountState",n=>e(n?.shouldUpdateToAddress))}subscribeCaipNetworkChange(e){W.subscribeKey("activeCaipNetwork",e)}getState(){return O0.state}getRemoteFeatures(){return de.state.remoteFeatures}subscribeState(e){return O0.subscribe(e)}subscribeRemoteFeatures(e){return de.subscribeKey("remoteFeatures",e)}showErrorMessage(e){D0.showError(e)}showSuccessMessage(e){D0.showSuccess(e)}getEvent(){return H({},Bo.state)}subscribeEvents(e){return Bo.subscribe(e)}replace(e){lc.replace(e)}redirect(e){lc.push(e)}popTransactionStack(e){lc.popTransactionStack(e)}isOpen(){return Ws.state.open}isTransactionStackEmpty(){return lc.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){de.setFeatures(e)}updateRemoteFeatures(e){de.setRemoteFeatures(e)}updateOptions(e){let n=de.state||{},r=H(H({},n),e);de.setOptions(r)}setConnectMethodsOrder(e){de.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){de.setWalletFeaturesOrder(e)}setCollapseWallets(e){de.setCollapseWallets(e)}setSocialsOrder(e){de.setSocialsOrder(e)}getConnectMethodsOrder(){return hx.getConnectOrderMethod(de.state.features,bt.getConnectors())}addNetwork(e,n){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);let r=this.extendCaipNetwork(n,this.options);this.getCaipNetworks().find(i=>i.id===r.id)||W.addNetwork(r)}removeNetwork(e,n){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(i=>i.id===n)&&W.removeNetwork(e,n)}}});var zH,lg,GH=$r(()=>{"use strict";ch();qH();zH=!1,lg=class extends y0{async open(e){bt.isConnected()||await super.open(e)}async close(){if(await super.close(),this.options.manualWCControl){let e=W.getAccountData(this.activeChainNamespace)?.address;Vt.finalizeWcConnection(e)}}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!zH&&sr.isClient()){if(await import("./chunk-KJKMARVB.js"),await import("./chunk-SSH6VHQK.js"),!document.querySelector("w3m-modal")){let n=document.createElement("w3m-modal");!de.state.disableAppend&&!de.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",n)}zH=!0}}}});var KH,WH=$r(()=>{"use strict";KH="1.8.11"});var QH={};ah(QH,{AppKit:()=>lg,createAppKit:()=>Nwe});function Nwe(t){return new lg(fe(H({},t),{basic:!0,sdkVersion:`html-core-${KH}`}))}var YH=$r(()=>{"use strict";GH();WH()});var i$=vs(ac=>{"use strict";Object.defineProperty(ac,"__esModule",{value:!0});var xwe=Ks(),sh=Ap(),Rwe=O8();function Owe(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var Pwe="wc",Mwe="ethereum_provider",kwe=`${Pwe}@2:${Mwe}:`,Lwe="https://rpc.walletconnect.org/v1/",v0=["eth_sendTransaction","personal_sign"],e$=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],b0=["chainChanged","accountsChanged"],t$=["chainChanged","accountsChanged","message","disconnect","connect"],Fwe=async()=>{let{createAppKit:t}=await Promise.resolve().then(function(){return Owe((YH(),Pe(QH)))});return t},Bwe=Object.defineProperty,Uwe=Object.defineProperties,jwe=Object.getOwnPropertyDescriptors,JH=Object.getOwnPropertySymbols,Vwe=Object.prototype.hasOwnProperty,Hwe=Object.prototype.propertyIsEnumerable,NN=(t,e,n)=>e in t?Bwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zl=(t,e)=>{for(var n in e||(e={}))Vwe.call(e,n)&&NN(t,n,e[n]);if(JH)for(var n of JH(e))Hwe.call(e,n)&&NN(t,n,e[n]);return t},ug=(t,e)=>Uwe(t,jwe(e)),li=(t,e,n)=>NN(t,typeof e!="symbol"?e+"":e,n);function E0(t){return Number(t[0].split(":")[1])}function w0(t){return`0x${t.toString(16)}`}function $we(t){let{chains:e,optionalChains:n,methods:r,optionalMethods:i,events:s,optionalEvents:o,rpcMap:a}=t;if(!sh.isValidArray(e))throw new Error("Invalid chains");let c={chains:e,methods:r||v0,events:s||b0,rpcMap:zl({},e.length?{[E0(e)]:a[E0(e)]}:{})},l=s?.filter(f=>!b0.includes(f)),u=r?.filter(f=>!v0.includes(f));if(!n&&!o&&!i&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};let d=l?.length&&u?.length||!n,h={chains:[...new Set(d?c.chains.concat(n||[]):n)],methods:[...new Set(c.methods.concat(i!=null&&i.length?i:e$))],events:[...new Set(c.events.concat(o!=null&&o.length?o:t$))],rpcMap:a};return{required:e.length?c:void 0,optional:n.length?h:void 0}}var I0=class t{constructor(){li(this,"events",new xwe.EventEmitter),li(this,"namespace","eip155"),li(this,"accounts",[]),li(this,"signer"),li(this,"chainId",1),li(this,"modal"),li(this,"rpc"),li(this,"STORAGE_KEY",kwe),li(this,"on",(e,n)=>(this.events.on(e,n),this)),li(this,"once",(e,n)=>(this.events.once(e,n),this)),li(this,"removeListener",(e,n)=>(this.events.removeListener(e,n),this)),li(this,"off",(e,n)=>(this.events.off(e,n),this)),li(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){let n=new t;return await n.initialize(e),n}async request(e,n){return await this.signer.request(e,this.formatChainId(this.chainId),n)}sendAsync(e,n,r){this.signer.sendAsync(e,n,this.formatChainId(this.chainId),r)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);let{required:r,optional:i}=$we(this.rpc);try{let s=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));let d=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(ug(zl({namespaces:zl({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e?.pairingTopic,scopedProperties:d})).then(h=>{a(h)}).catch(h=>{var f;(f=this.modal)==null||f.showErrorMessage("Unable to connect"),c(new Error(h.message))})});if(!s)return;let o=sh.getAccountsFromNamespaces(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:w0(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{(n=this.modal)==null||n.close()}}async authenticate(e,n){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{let i=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(ug(zl({},e),{chains:this.rpc.chains}),n).then(u=>{o(u)}).catch(u=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),s=i.session;if(s){let o=sh.getAccountsFromNamespaces(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:w0(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{(r=this.modal)==null||r.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{let{params:n}=e,{event:r}=n;r.name==="accountsChanged"?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):r.name==="chainChanged"?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{let n=parseInt(e);this.chainId=n,this.events.emit("chainChanged",w0(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ug(zl({},sh.getSdkError("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){let n=e.filter(r=>this.isCompatibleChainId(r)).map(r=>this.parseChainId(r));n.length&&(this.chainId=n[0],this.events.emit("chainChanged",w0(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){let n=this.parseChainId(e);this.chainId=n,this.switchEthereumChain(n)}}parseAccountId(e){let[n,r,i]=e.split(":");return{chainId:`${n}:${r}`,address:i}}setAccounts(e){this.accounts=e.filter(n=>this.parseChainId(this.parseAccountId(n).chainId)===this.chainId).map(n=>this.parseAccountId(n).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var n,r;let i=(n=e?.chains)!=null?n:[],s=(r=e?.optionalChains)!=null?r:[],o=i.concat(s);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");let a=i.length?e?.methods||v0:[],c=i.length?e?.events||b0:[],l=e?.optionalMethods||[],u=e?.optionalEvents||[],d=e?.rpcMap||this.buildRpcMap(o,e.projectId),h=e?.qrModalOptions||void 0;return{chains:i?.map(f=>this.formatChainId(f)),optionalChains:s.map(f=>this.formatChainId(f)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:d,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:h,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,n){let r={};return e.forEach(i=>{r[i]=this.getRpcUrl(i,n)}),r}async initialize(e){var n;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?E0(this.rpc.chains):E0(this.rpc.optionalChains),this.signer=await Rwe.UniversalProvider.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{let i=await Fwe(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return eve}),o=s(ug(zl({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!o.networks.length)throw new Error("No networks found for WalletConnect");r=i(ug(zl({},o),{universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:((n=this.rpc.qrModalOptions)==null?void 0:n.enableMobileFullScreen)===!0}))}catch(i){throw console.warn(i),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;let{chains:n,optionalChains:r,rpcMap:i}=e;n&&sh.isValidArray(n)&&(this.rpc.chains=n.map(s=>this.formatChainId(s)),n.forEach(s=>{this.rpc.rpcMap[s]=i?.[s]||this.getRpcUrl(s)})),r&&sh.isValidArray(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(s=>this.formatChainId(s)),r.forEach(s=>{this.rpc.rpcMap[s]=i?.[s]||this.getRpcUrl(s)}))}getRpcUrl(e,n){var r;return((r=this.rpc.rpcMap)==null?void 0:r[e])||`${Lwe}?chainId=eip155:${e}&projectId=${n||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),n=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:n?.accounts),this.setAccounts(n?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(n=>this.signer.logger.warn(n))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(n=>this.parseAccount(n))}},qwe=I0,zwe=Object.defineProperty,Gwe=Object.defineProperties,Kwe=Object.getOwnPropertyDescriptors,ZH=Object.getOwnPropertySymbols,Wwe=Object.prototype.hasOwnProperty,Qwe=Object.prototype.propertyIsEnumerable,XH=(t,e,n)=>e in t?zwe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,n$=(t,e)=>{for(var n in e||(e={}))Wwe.call(e,n)&&XH(t,n,e[n]);if(ZH)for(var n of ZH(e))Qwe.call(e,n)&&XH(t,n,e[n]);return t},Ywe=(t,e)=>Gwe(t,Kwe(e));function Jwe(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}var Zwe=t=>{let[e,n]=t.split(":");return r$({id:n,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function Xwe(t){var e,n,r,i,s,o,a;let c=(e=t.chains)==null?void 0:e.map(Zwe).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");let l=c.find(d=>{var h;return d.id===((h=t.defaultChain)==null?void 0:h.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:Jwe(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:Ywe(n$({},t.metadata),{name:((n=t.metadata)==null?void 0:n.name)||"WalletConnect",description:((r=t.metadata)==null?void 0:r.description)||"Connect to WalletConnect-compatible wallets",url:((i=t.metadata)==null?void 0:i.url)||"https://walletconnect.org",icons:((s=t.metadata)==null?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){let d=[...(t.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(t.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],h=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],f=d.filter(p=>!h.includes(p.id));f.length&&(u.customWallets=f)}return u}function r$(t){return n$({formatters:void 0,fees:void 0,serializers:void 0},t)}var eve=Object.freeze({__proto__:null,convertWCMToAppKitOptions:Xwe,defineChain:r$});ac.EthereumProvider=qwe,ac.OPTIONAL_EVENTS=t$,ac.OPTIONAL_METHODS=e$,ac.REQUIRED_EVENTS=b0,ac.REQUIRED_METHODS=v0,ac.default=I0});var Un=null,Eg=!1,L0=1,d$=null,ui=Symbol("SIGNAL");function Ie(t){let e=Un;return Un=t,e}function Ig(){return Un}var lh={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Cg(t){if(Eg)throw new Error("");if(Un===null)return;Un.consumerOnSignalRead(t);let e=Un.producersTail;if(e!==void 0&&e.producer===t)return;let n,r=Un.recomputing;if(r&&(n=e!==void 0?e.nextProducer:Un.producers,n!==void 0&&n.producer===t)){Un.producersTail=n,n.lastReadVersion=t.version;return}let i=t.consumersTail;if(i!==void 0&&i.consumer===Un&&(!r||f$(i,Un)))return;let s=Xl(Un),o={producer:t,consumer:Un,nextProducer:n,prevConsumer:i,lastReadVersion:t.version,nextConsumer:void 0};Un.producersTail=o,e!==void 0?e.nextProducer=o:Un.producers=o,s&&vx(t,o)}function gx(){L0++}function mx(t){if(!(Xl(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===L0)){if(!t.producerMustRecompute(t)&&!dh(t)){k0(t);return}t.producerRecomputeValue(t),k0(t)}}function F0(t){if(t.consumers===void 0)return;let e=Eg;Eg=!0;try{for(let n=t.consumers;n!==void 0;n=n.nextConsumer){let r=n.consumer;r.dirty||h$(r)}}finally{Eg=e}}function B0(){return Un?.consumerAllowSignalWrites!==!1}function h$(t){t.dirty=!0,F0(t),t.consumerMarkedDirty?.(t)}function k0(t){t.dirty=!1,t.lastCleanEpoch=L0}function uh(t){return t&&yx(t),Ie(t)}function yx(t){t.producersTail=void 0,t.recomputing=!0}function Ag(t,e){Ie(e),t&&wx(t)}function wx(t){t.recomputing=!1;let e=t.producersTail,n=e!==void 0?e.nextProducer:t.producers;if(n!==void 0){if(Xl(t))do n=U0(n);while(n!==void 0);e!==void 0?e.nextProducer=void 0:t.producers=void 0}}function dh(t){for(let e=t.producers;e!==void 0;e=e.nextProducer){let n=e.producer,r=e.lastReadVersion;if(r!==n.version||(mx(n),r!==n.version))return!0}return!1}function uc(t){if(Xl(t)){let e=t.producers;for(;e!==void 0;)e=U0(e)}t.producers=void 0,t.producersTail=void 0,t.consumers=void 0,t.consumersTail=void 0}function vx(t,e){let n=t.consumersTail,r=Xl(t);if(n!==void 0?(e.nextConsumer=n.nextConsumer,n.nextConsumer=e):(e.nextConsumer=void 0,t.consumers=e),e.prevConsumer=n,t.consumersTail=e,!r)for(let i=t.producers;i!==void 0;i=i.nextProducer)vx(i.producer,i)}function U0(t){let e=t.producer,n=t.nextProducer,r=t.nextConsumer,i=t.prevConsumer;if(t.nextConsumer=void 0,t.prevConsumer=void 0,r!==void 0?r.prevConsumer=i:e.consumersTail=i,i!==void 0)i.nextConsumer=r;else if(e.consumers=r,!Xl(e)){let s=e.producers;for(;s!==void 0;)s=U0(s)}return n}function Xl(t){return t.consumerIsAlwaysLive||t.consumers!==void 0}function bx(t){d$?.(t)}function f$(t,e){let n=e.producersTail;if(n!==void 0){let r=e.producers;do{if(r===t)return!0;if(r===n)break;r=r.nextProducer}while(r!==void 0)}return!1}function Ex(t,e){return Object.is(t,e)}function p$(){throw new Error}var Ix=p$;function Cx(t){Ix(t)}function j0(t){Ix=t}var g$=null;function V0(t,e){let n=Object.create(Sg);n.value=t,e!==void 0&&(n.equal=e);let r=()=>Ax(n);return r[ui]=n,bx(n),[r,o=>hh(n,o),o=>Sx(n,o)]}function Ax(t){return Cg(t),t.value}function hh(t,e){B0()||Cx(t),t.equal(t.value,e)||(t.value=e,m$(t))}function Sx(t,e){B0()||Cx(t),hh(t,e(t.value))}var Sg=fe(H({},lh),{equal:Ex,value:void 0,kind:"signal"});function m$(t){t.version++,gx(),F0(t),g$?.(t)}function H0(t){let e=Ie(null);try{return t()}finally{Ie(e)}}var $0=fe(H({},lh),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,kind:"effect"});function q0(t){if(t.dirty=!1,t.version>0&&!dh(t))return;t.version++;let e=uh(t);try{t.cleanup(),t.fn()}finally{Ag(t,e)}}function Oe(t){return typeof t=="function"}function eu(t){let n=t(r=>{Error.call(r),r.stack=new Error().stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var _g=eu(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:
${n.map((r,i)=>`${i+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=n});function fh(t,e){if(t){let n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Dn=class t{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(let s of n)s.remove(this);else n.remove(this);let{initialTeardown:r}=this;if(Oe(r))try{r()}catch(s){e=s instanceof _g?s.errors:[s]}let{_finalizers:i}=this;if(i){this._finalizers=null;for(let s of i)try{_x(s)}catch(o){e=e??[],o instanceof _g?e=[...e,...o.errors]:e.push(o)}}if(e)throw new _g(e)}}add(e){var n;if(e&&e!==this)if(this.closed)_x(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}}_hasParent(e){let{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){let{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){let{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&fh(n,e)}remove(e){let{_finalizers:n}=this;n&&fh(n,e),e instanceof t&&e._removeParent(this)}};Dn.EMPTY=(()=>{let t=new Dn;return t.closed=!0,t})();var z0=Dn.EMPTY;function Tg(t){return t instanceof Dn||t&&"closed"in t&&Oe(t.remove)&&Oe(t.add)&&Oe(t.unsubscribe)}function _x(t){Oe(t)?t():t.unsubscribe()}var xi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var tu={setTimeout(t,e,...n){let{delegate:r}=tu;return r?.setTimeout?r.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){let{delegate:e}=tu;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Dg(t){tu.setTimeout(()=>{let{onUnhandledError:e}=xi;if(e)e(t);else throw t})}function ph(){}var Tx=G0("C",void 0,void 0);function Dx(t){return G0("E",void 0,t)}function Nx(t){return G0("N",t,void 0)}function G0(t,e,n){return{kind:t,value:e,error:n}}var dc=null;function nu(t){if(xi.useDeprecatedSynchronousErrorHandling){let e=!dc;if(e&&(dc={errorThrown:!1,error:null}),t(),e){let{errorThrown:n,error:r}=dc;if(dc=null,n)throw r}}else t()}function xx(t){xi.useDeprecatedSynchronousErrorHandling&&dc&&(dc.errorThrown=!0,dc.error=t)}var hc=class extends Dn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Tg(e)&&e.add(this)):this.destination=v$}static create(e,n,r){return new ru(e,n,r)}next(e){this.isStopped?W0(Nx(e),this):this._next(e)}error(e){this.isStopped?W0(Dx(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?W0(Tx,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},y$=Function.prototype.bind;function K0(t,e){return y$.call(t,e)}var Q0=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(r){Ng(r)}}error(e){let{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(r){Ng(r)}else Ng(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){Ng(n)}}},ru=class extends hc{constructor(e,n,r){super();let i;if(Oe(e)||!e)i={next:e??void 0,error:n??void 0,complete:r??void 0};else{let s;this&&xi.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&K0(e.next,s),error:e.error&&K0(e.error,s),complete:e.complete&&K0(e.complete,s)}):i=e}this.destination=new Q0(i)}};function Ng(t){xi.useDeprecatedSynchronousErrorHandling?xx(t):Dg(t)}function w$(t){throw t}function W0(t,e){let{onStoppedNotification:n}=xi;n&&tu.setTimeout(()=>n(t,e))}var v$={closed:!0,next:ph,error:w$,complete:ph};var iu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ri(t){return t}function Y0(...t){return J0(t)}function J0(t){return t.length===0?Ri:t.length===1?t[0]:function(n){return t.reduce((r,i)=>i(r),n)}}var ot=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){let r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,i){let s=E$(n)?n:new ru(n,r,i);return nu(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return r=Rx(r),new r((i,s)=>{let o=new ru({next:a=>{try{n(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(n){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(n)}[iu](){return this}pipe(...n){return J0(n)(this)}toPromise(n){return n=Rx(n),new n((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return t.create=e=>new t(e),t})();function Rx(t){var e;return(e=t??xi.Promise)!==null&&e!==void 0?e:Promise}function b$(t){return t&&Oe(t.next)&&Oe(t.error)&&Oe(t.complete)}function E$(t){return t&&t instanceof hc||b$(t)&&Tg(t)}function I$(t){return Oe(t?.lift)}function lt(t){return e=>{if(I$(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Et(t,e,n,r,i){return new Z0(t,e,n,r,i)}var Z0=class extends hc{constructor(e,n,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=n?function(a){try{n(a)}catch(c){e.error(c)}}:super._next,this._error=i?function(a){try{i(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:n}=this;super.unsubscribe(),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};var Ox=eu(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var jn=(()=>{class t extends ot{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){let r=new xg(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Ox}next(n){nu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(n)}})}error(n){nu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;let{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){nu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){let{hasError:r,isStopped:i,observers:s}=this;return r||i?z0:(this.currentObservers=null,s.push(n),new Dn(()=>{this.currentObservers=null,fh(s,n)}))}_checkFinalizedStatuses(n){let{hasError:r,thrownError:i,isStopped:s}=this;r?n.error(i):s&&n.complete()}asObservable(){let n=new ot;return n.source=this,n}}return t.create=(e,n)=>new xg(e,n),t})(),xg=class extends jn{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.next)===null||r===void 0||r.call(n,e)}error(e){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.error)===null||r===void 0||r.call(n,e)}complete(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)}_subscribe(e){var n,r;return(r=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&r!==void 0?r:z0}};var Nn=class extends jn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){let{hasError:e,thrownError:n,_value:r}=this;if(e)throw n;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}};var Sr=new ot(t=>t.complete());function Px(t){return t&&Oe(t.schedule)}function Mx(t){return t[t.length-1]}function kx(t){return Oe(Mx(t))?t.pop():void 0}function Uo(t){return Px(Mx(t))?t.pop():void 0}function Fx(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function Lx(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fc(t){return this instanceof fc?(this.v=t,this):new fc(t)}function Bx(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(f){return function(p){return Promise.resolve(p).then(f,d)}}function a(f,p){r[f]&&(i[f]=function(g){return new Promise(function(m,y){s.push([f,g,m,y])>1||c(f,g)})},p&&(i[f]=p(i[f])))}function c(f,p){try{l(r[f](p))}catch(g){h(s[0][3],g)}}function l(f){f.value instanceof fc?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,p){f(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Ux(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Lx=="function"?Lx(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var Rg=t=>t&&typeof t.length=="number"&&typeof t!="function";function Og(t){return Oe(t?.then)}function Pg(t){return Oe(t[iu])}function Mg(t){return Symbol.asyncIterator&&Oe(t?.[Symbol.asyncIterator])}function kg(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function C$(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Lg=C$();function Fg(t){return Oe(t?.[Lg])}function Bg(t){return Bx(this,arguments,function*(){let n=t.getReader();try{for(;;){let{value:r,done:i}=yield fc(n.read());if(i)return yield fc(void 0);yield yield fc(r)}}finally{n.releaseLock()}})}function Ug(t){return Oe(t?.getReader)}function gn(t){if(t instanceof ot)return t;if(t!=null){if(Pg(t))return A$(t);if(Rg(t))return S$(t);if(Og(t))return _$(t);if(Mg(t))return jx(t);if(Fg(t))return T$(t);if(Ug(t))return D$(t)}throw kg(t)}function A$(t){return new ot(e=>{let n=t[iu]();if(Oe(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function S$(t){return new ot(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function _$(t){return new ot(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,Dg)})}function T$(t){return new ot(e=>{for(let n of t)if(e.next(n),e.closed)return;e.complete()})}function jx(t){return new ot(e=>{N$(t,e).catch(n=>e.error(n))})}function D$(t){return jx(Bg(t))}function N$(t,e){var n,r,i,s;return Fx(this,void 0,void 0,function*(){try{for(n=Ux(t);r=yield n.next(),!r.done;){let o=r.value;if(e.next(o),e.closed)return}}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}e.complete()})}function _r(t,e,n,r=0,i=!1){let s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function jg(t,e=0){return lt((n,r)=>{n.subscribe(Et(r,i=>_r(r,t,()=>r.next(i),e),()=>_r(r,t,()=>r.complete(),e),i=>_r(r,t,()=>r.error(i),e)))})}function Vg(t,e=0){return lt((n,r)=>{r.add(t.schedule(()=>n.subscribe(r),e))})}function Vx(t,e){return gn(t).pipe(Vg(e),jg(e))}function Hx(t,e){return gn(t).pipe(Vg(e),jg(e))}function $x(t,e){return new ot(n=>{let r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function qx(t,e){return new ot(n=>{let r;return _r(n,e,()=>{r=t[Lg](),_r(n,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){n.error(o);return}s?n.complete():n.next(i)},0,!0)}),()=>Oe(r?.return)&&r.return()})}function Hg(t,e){if(!t)throw new Error("Iterable cannot be null");return new ot(n=>{_r(n,e,()=>{let r=t[Symbol.asyncIterator]();_r(n,e,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function zx(t,e){return Hg(Bg(t),e)}function Gx(t,e){if(t!=null){if(Pg(t))return Vx(t,e);if(Rg(t))return $x(t,e);if(Og(t))return Hx(t,e);if(Mg(t))return Hg(t,e);if(Fg(t))return qx(t,e);if(Ug(t))return zx(t,e)}throw kg(t)}function mn(t,e){return e?Gx(t,e):gn(t)}function $e(...t){let e=Uo(t);return mn(t,e)}function X0(t,e){let n=Oe(t)?t:()=>t,r=i=>i.error(n());return new ot(e?i=>e.schedule(r,0,i):r)}function $g(t){return!!t&&(t instanceof ot||Oe(t.lift)&&Oe(t.subscribe))}var pc=eu(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function jt(t,e){return lt((n,r)=>{let i=0;n.subscribe(Et(r,s=>{r.next(t.call(e,s,i++))}))})}var{isArray:x$}=Array;function R$(t,e){return x$(e)?t(...e):t(e)}function Kx(t){return jt(e=>R$(t,e))}var{isArray:O$}=Array,{getPrototypeOf:P$,prototype:M$,keys:k$}=Object;function Wx(t){if(t.length===1){let e=t[0];if(O$(e))return{args:e,keys:null};if(L$(e)){let n=k$(e);return{args:n.map(r=>e[r]),keys:n}}}return{args:t,keys:null}}function L$(t){return t&&typeof t=="object"&&P$(t)===M$}function Qx(t,e){return t.reduce((n,r,i)=>(n[r]=e[i],n),{})}function eE(...t){let e=Uo(t),n=kx(t),{args:r,keys:i}=Wx(t);if(r.length===0)return mn([],e);let s=new ot(F$(r,e,i?o=>Qx(i,o):Ri));return n?s.pipe(Kx(n)):s}function F$(t,e,n=Ri){return r=>{Yx(e,()=>{let{length:i}=t,s=new Array(i),o=i,a=i;for(let c=0;c<i;c++)Yx(e,()=>{let l=mn(t[c],e),u=!1;l.subscribe(Et(r,d=>{s[c]=d,u||(u=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}function Yx(t,e,n){t?_r(n,t,e):e()}function Jx(t,e,n,r,i,s,o,a){let c=[],l=0,u=0,d=!1,h=()=>{d&&!c.length&&!l&&e.complete()},f=g=>l<r?p(g):c.push(g),p=g=>{s&&e.next(g),l++;let m=!1;gn(n(g,u++)).subscribe(Et(e,y=>{i?.(y),s?f(y):e.next(y)},()=>{m=!0},void 0,()=>{if(m)try{for(l--;c.length&&l<r;){let y=c.shift();o?_r(e,o,()=>p(y)):p(y)}h()}catch(y){e.error(y)}}))};return t.subscribe(Et(e,f,()=>{d=!0,h()})),()=>{a?.()}}function ar(t,e,n=1/0){return Oe(e)?ar((r,i)=>jt((s,o)=>e(r,s,i,o))(gn(t(r,i))),n):(typeof e=="number"&&(n=e),lt((r,i)=>Jx(r,i,t,n)))}function Zx(t=1/0){return ar(Ri,t)}function Xx(){return Zx(1)}function su(...t){return Xx()(mn(t,Uo(t)))}function gh(t){return new ot(e=>{gn(t()).subscribe(e)})}function Es(t,e){return lt((n,r)=>{let i=0;n.subscribe(Et(r,s=>t.call(e,s,i++)&&r.next(s)))})}function mh(t){return lt((e,n)=>{let r=null,i=!1,s;r=e.subscribe(Et(n,void 0,void 0,o=>{s=gn(t(o,mh(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function qg(t,e){return Oe(e)?ar(t,e,1):ar(t,1)}function tE(t){return lt((e,n)=>{let r=!1;e.subscribe(Et(n,i=>{r=!0,n.next(i)},()=>{r||n.next(t),n.complete()}))})}function Ys(t){return t<=0?()=>Sr:lt((e,n)=>{let r=0;e.subscribe(Et(n,i=>{++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function eR(t=B$){return lt((e,n)=>{let r=!1;e.subscribe(Et(n,i=>{r=!0,n.next(i)},()=>r?n.complete():n.error(t())))})}function B$(){return new pc}function nE(t){return lt((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}function Js(t,e){let n=arguments.length>=2;return r=>r.pipe(t?Es((i,s)=>t(i,s,r)):Ri,Ys(1),n?tE(e):eR(()=>new pc))}function zg(t){return t<=0?()=>Sr:lt((e,n)=>{let r=[];e.subscribe(Et(n,i=>{r.push(i),t<r.length&&r.shift()},()=>{for(let i of r)n.next(i);n.complete()},void 0,()=>{r=null}))})}function rE(...t){let e=Uo(t);return lt((n,r)=>{(e?su(t,n,e):su(t,n)).subscribe(r)})}function Is(t,e){return lt((n,r)=>{let i=null,s=0,o=!1,a=()=>o&&!i&&r.complete();n.subscribe(Et(r,c=>{i?.unsubscribe();let l=0,u=s++;gn(t(c,u)).subscribe(i=Et(r,d=>r.next(e?e(c,d,u,l++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function yh(t){return lt((e,n)=>{gn(t).subscribe(Et(n,()=>n.complete(),ph)),!n.closed&&e.subscribe(n)})}function cr(t,e,n){let r=Oe(t)||e||n?{next:t,error:e,complete:n}:t;return r?lt((i,s)=>{var o;(o=r.subscribe)===null||o===void 0||o.call(r);let a=!0;i.subscribe(Et(s,c=>{var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},()=>{var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},c=>{var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},()=>{var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Ri}var iE;function Gg(){return iE}function Cs(t){let e=iE;return iE=t,e}var tR=Symbol("NotFound");function ou(t){return t===tR||t?.name==="\u0275NotFound"}var me=class extends Error{code;constructor(e,n){super(cu(e,n)),this.code=e}};function j$(t){return`NG0${Math.abs(t)}`}function cu(t,e){return`${j$(t)}${e?": "+e:""}`}var bc=globalThis;function ut(t){for(let e in t)if(t[e]===ut)return e;throw Error("")}function jo(t){if(typeof t=="string")return t;if(Array.isArray(t))return`[${t.map(jo).join(", ")}]`;if(t==null)return""+t;let e=t.overriddenName||t.name;if(e)return`${e}`;let n=t.toString();if(n==null)return""+n;let r=n.indexOf(`
`);return r>=0?n.slice(0,r):n}function yE(t,e){return t?e?`${t} ${e}`:t:e||""}var V$=ut({__forward_ref__:ut});function Xg(t){return t.__forward_ref__=Xg,t.toString=function(){return jo(this())},t}function Tr(t){return wE(t)?t():t}function wE(t){return typeof t=="function"&&t.hasOwnProperty(V$)&&t.__forward_ref__===Xg}function Ae(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Sh(t){return H$(t,em)}function vE(t){return Sh(t)!==null}function H$(t,e){return t.hasOwnProperty(e)&&t[e]||null}function $$(t){let e=t?.[em]??null;return e||null}function oE(t){return t&&t.hasOwnProperty(Wg)?t[Wg]:null}var em=ut({\u0275prov:ut}),Wg=ut({\u0275inj:ut}),Ce=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,n){this._desc=e,this.\u0275prov=void 0,typeof n=="number"?this.__NG_ELEMENT_ID__=n:n!==void 0&&(this.\u0275prov=Ae({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function bE(t){return t&&!!t.\u0275providers}var EE=ut({\u0275cmp:ut}),IE=ut({\u0275dir:ut}),CE=ut({\u0275pipe:ut}),AE=ut({\u0275mod:ut}),vh=ut({\u0275fac:ut}),Ec=ut({__NG_ELEMENT_ID__:ut}),nR=ut({__NG_ENV_ID__:ut});function _h(t){return typeof t=="string"?t:t==null?"":String(t)}function oR(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():_h(t)}var aR=ut({ngErrorCode:ut}),q$=ut({ngErrorMessage:ut}),z$=ut({ngTokenPath:ut});function SE(t,e){return cR("",-200,e)}function tm(t,e){throw new me(-201,!1)}function cR(t,e,n){let r=new me(e,t);return r[aR]=e,r[q$]=t,n&&(r[z$]=n),r}function G$(t){return t[aR]}var aE;function lR(){return aE}function lr(t){let e=aE;return aE=t,e}function _E(t,e,n){let r=Sh(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(n&8)return null;if(e!==void 0)return e;tm(t,"Injector")}var K$={},gc=K$,W$="__NG_DI_FLAG__",cE=class{injector;constructor(e){this.injector=e}retrieve(e,n){let r=mc(n)||0;try{return this.injector.get(e,r&8?null:gc,r)}catch(i){if(ou(i))return i;throw i}}};function Q$(t,e=0){let n=Gg();if(n===void 0)throw new me(-203,!1);if(n===null)return _E(t,void 0,e);{let r=Y$(e),i=n.retrieve(t,r);if(ou(i)){if(r.optional)return null;throw i}return i}}function ke(t,e=0){return(lR()||Q$)(Tr(t),e)}function re(t,e){return ke(t,mc(e))}function mc(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Y$(t){return{optional:!!(t&8),host:!!(t&1),self:!!(t&2),skipSelf:!!(t&4)}}function lE(t){let e=[];for(let n=0;n<t.length;n++){let r=Tr(t[n]);if(Array.isArray(r)){if(r.length===0)throw new me(900,!1);let i,s=0;for(let o=0;o<r.length;o++){let a=r[o],c=J$(a);typeof c=="number"?c===-1?i=a.token:s|=c:i=a}e.push(ke(i,s))}else e.push(ke(r))}return e}function J$(t){return t[W$]}function Vo(t,e){let n=t.hasOwnProperty(vh);return n?t[vh]:null}function nm(t,e){t.forEach(n=>Array.isArray(n)?nm(n,e):e(n))}function TE(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Th(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}var Ic={},yc=[],Cc=new Ce(""),DE=new Ce("",-1),NE=new Ce(""),bh=class{get(e,n=gc){if(n===gc){let i=cR("",-201);throw i.name="\u0275NotFound",i}return n}};function xE(t){return t[AE]||null}function qo(t){return t[EE]||null}function RE(t){return t[IE]||null}function uR(t){return t[CE]||null}function Ac(t){return{\u0275providers:t}}function dR(t){return Ac([{provide:Cc,multi:!0,useValue:t}])}function hR(...t){return{\u0275providers:OE(!0,t),\u0275fromNgModule:!0}}function OE(t,...e){let n=[],r=new Set,i,s=o=>{n.push(o)};return nm(e,o=>{let a=o;Qg(a,s,[],r)&&(i||=[],i.push(a))}),i!==void 0&&fR(i,s),n}function fR(t,e){for(let n=0;n<t.length;n++){let{ngModule:r,providers:i}=t[n];PE(i,s=>{e(s,r)})}}function Qg(t,e,n,r){if(t=Tr(t),!t)return!1;let i=null,s=oE(t),o=!s&&qo(t);if(!s&&!o){let c=t.ngModule;if(s=oE(c),s)i=c;else return!1}else{if(o&&!o.standalone)return!1;i=t}let a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){let c=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let l of c)Qg(l,e,n,r)}}else if(s){if(s.imports!=null&&!a){r.add(i);let l;try{nm(s.imports,u=>{Qg(u,e,n,r)&&(l||=[],l.push(u))})}finally{}l!==void 0&&fR(l,e)}if(!a){let l=Vo(i)||(()=>new i);e({provide:i,useFactory:l,deps:yc},i),e({provide:NE,useValue:i,multi:!0},i),e({provide:Cc,useValue:()=>ke(i),multi:!0},i)}let c=s.providers;if(c!=null&&!a){let l=t;PE(c,u=>{e(u,l)})}}else return!1;return i!==t&&t.providers!==void 0}function PE(t,e){for(let n of t)bE(n)&&(n=n.\u0275providers),Array.isArray(n)?PE(n,e):e(n)}var Z$=ut({provide:String,useValue:ut});function pR(t){return t!==null&&typeof t=="object"&&Z$ in t}function X$(t){return!!(t&&t.useExisting)}function eq(t){return!!(t&&t.useFactory)}function Yg(t){return typeof t=="function"}var Dh=new Ce(""),Kg={},rR={},sE;function Nh(){return sE===void 0&&(sE=new bh),sE}var Vn=class{},wc=class extends Vn{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,dE(e,o=>this.processProvider(o)),this.records.set(DE,au(void 0,this)),i.has("environment")&&this.records.set(Vn,au(void 0,this));let s=this.records.get(Dh);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(NE,yc,{self:!0}))}retrieve(e,n){let r=mc(n)||0;try{return this.get(e,gc,r)}catch(i){if(ou(i))return i;throw i}}destroy(){wh(this),this._destroyed=!0;let e=Ie(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let n=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of n)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ie(e)}}onDestroy(e){return wh(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){wh(this);let n=Cs(this),r=lr(void 0),i;try{return e()}finally{Cs(n),lr(r)}}get(e,n=gc,r){if(wh(this),e.hasOwnProperty(nR))return e[nR](this);let i=mc(r),s,o=Cs(this),a=lr(void 0);try{if(!(i&4)){let l=this.records.get(e);if(l===void 0){let u=sq(e)&&Sh(e);u&&this.injectableDefInScope(u)?l=au(uE(e),Kg):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l,i)}let c=i&2?Nh():this.parent;return n=i&8&&n===gc?null:n,c.get(e,n)}catch(c){let l=G$(c);throw l===-200||l===-201?new me(l,null):c}finally{lr(a),Cs(o)}}resolveInjectorInitializers(){let e=Ie(null),n=Cs(this),r=lr(void 0),i;try{let s=this.get(Cc,yc,{self:!0});for(let o of s)o()}finally{Cs(n),lr(r),Ie(e)}}toString(){let e=[],n=this.records;for(let r of n.keys())e.push(jo(r));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Tr(e);let n=Yg(e)?e:Tr(e&&e.provide),r=nq(e);if(!Yg(e)&&e.multi===!0){let i=this.records.get(n);i||(i=au(void 0,Kg,!0),i.factory=()=>lE(i.multi),this.records.set(n,i)),n=e,i.multi.push(e)}this.records.set(n,r)}hydrate(e,n,r){let i=Ie(null);try{if(n.value===rR)throw SE(jo(e));return n.value===Kg&&(n.value=rR,n.value=n.factory(void 0,r)),typeof n.value=="object"&&n.value&&iq(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{Ie(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;let n=Tr(e.providedIn);return typeof n=="string"?n==="any"||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(e){let n=this._onDestroyHooks.indexOf(e);n!==-1&&this._onDestroyHooks.splice(n,1)}};function uE(t){let e=Sh(t),n=e!==null?e.factory:Vo(t);if(n!==null)return n;if(t instanceof Ce)throw new me(204,!1);if(t instanceof Function)return tq(t);throw new me(204,!1)}function tq(t){if(t.length>0)throw new me(204,!1);let n=$$(t);return n!==null?()=>n.factory(t):()=>new t}function nq(t){if(pR(t))return au(void 0,t.useValue);{let e=gR(t);return au(e,Kg)}}function gR(t,e,n){let r;if(Yg(t)){let i=Tr(t);return Vo(i)||uE(i)}else if(pR(t))r=()=>Tr(t.useValue);else if(eq(t))r=()=>t.useFactory(...lE(t.deps||[]));else if(X$(t))r=(i,s)=>ke(Tr(t.useExisting),s!==void 0&&s&8?8:void 0);else{let i=Tr(t&&(t.useClass||t.provide));if(rq(t))r=()=>new i(...lE(t.deps));else return Vo(i)||uE(i)}return r}function wh(t){if(t.destroyed)throw new me(205,!1)}function au(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function rq(t){return!!t.deps}function iq(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function sq(t){return typeof t=="function"||typeof t=="object"&&t.ngMetadataName==="InjectionToken"}function dE(t,e){for(let n of t)Array.isArray(n)?dE(n,e):n&&bE(n)?dE(n.\u0275providers,e):e(n)}function dr(t,e){let n;t instanceof wc?(wh(t),n=t):n=new cE(t);let r,i=Cs(n),s=lr(void 0);try{return e()}finally{Cs(i),lr(s)}}function mR(){return lR()!==void 0||Gg()!=null}var Pi=0,De=1,Ne=2,yn=3,di=4,hi=5,lu=6,uu=7,Yt=8,eo=9,to=10,wn=11,du=12,ME=13,Sc=14,zr=15,_c=16,Tc=17,Dc=18,xh=19,kE=20,Zs=21,rm=22,Ho=23,Gr=24,im=25,Nc=26,vn=27,yR=1,LE=6,zo=7,Rh=8,Oh=9,Jt=10;function no(t){return Array.isArray(t)&&typeof t[yR]=="object"}function Mi(t){return Array.isArray(t)&&t[yR]===!0}function FE(t){return(t.flags&4)!==0}function Go(t){return t.componentOffset>-1}function sm(t){return(t.flags&1)===1}function xc(t){return!!t.template}function hu(t){return(t[Ne]&512)!==0}function Rc(t){return(t[Ne]&256)===256}var BE="svg",wR="math";function fi(t){for(;Array.isArray(t);)t=t[Pi];return t}function vR(t,e){return fi(e[t])}function As(t,e){return fi(e[t.index])}function Ph(t,e){return t.data[e]}function bR(t,e){return t[e]}function UE(t,e,n,r){n>=t.data.length&&(t.data[n]=null,t.blueprint[n]=null),e[n]=r}function ki(t,e){let n=e[t];return no(n)?n:n[Pi]}function om(t){return(t[Ne]&128)===128}function ER(t){return Mi(t[yn])}function Ko(t,e){return e==null?null:t[e]}function jE(t){t[Tc]=0}function VE(t){t[Ne]&1024||(t[Ne]|=1024,om(t)&&fu(t))}function IR(t,e){for(;t>0;)e=e[Sc],t--;return e}function Mh(t){return!!(t[Ne]&9216||t[Gr]?.dirty)}function am(t){t[to].changeDetectionScheduler?.notify(8),t[Ne]&64&&(t[Ne]|=1024),Mh(t)&&fu(t)}function fu(t){t[to].changeDetectionScheduler?.notify(0);let e=$o(t);for(;e!==null&&!(e[Ne]&8192||(e[Ne]|=8192,!om(e)));)e=$o(e)}function HE(t,e){if(Rc(t))throw new me(911,!1);t[Zs]===null&&(t[Zs]=[]),t[Zs].push(e)}function CR(t,e){if(t[Zs]===null)return;let n=t[Zs].indexOf(e);n!==-1&&t[Zs].splice(n,1)}function $o(t){let e=t[yn];return Mi(e)?e[yn]:e}function AR(t){return t[uu]??=[]}function SR(t){return t.cleanup??=[]}var Le={lFrame:$R(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var hE=!1;function _R(){return Le.lFrame.elementDepthCount}function TR(){Le.lFrame.elementDepthCount++}function DR(){Le.lFrame.elementDepthCount--}function NR(){return Le.bindingsEnabled}function xR(){return Le.skipHydrationRootTNode!==null}function RR(t){return Le.skipHydrationRootTNode===t}function OR(){Le.skipHydrationRootTNode=null}function At(){return Le.lFrame.lView}function Ss(){return Le.lFrame.tView}function Li(t){return Le.lFrame.contextLView=t,t[Yt]}function Fi(t){return Le.lFrame.contextLView=null,t}function _s(){let t=$E();for(;t!==null&&t.type===64;)t=t.parent;return t}function $E(){return Le.lFrame.currentTNode}function PR(){let t=Le.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}function pu(t,e){let n=Le.lFrame;n.currentTNode=t,n.isParent=e}function qE(){return Le.lFrame.isParent}function MR(){Le.lFrame.isParent=!1}function zE(){return hE}function Eh(t){let e=hE;return hE=t,e}function kR(){let t=Le.lFrame,e=t.bindingRootIndex;return e===-1&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function LR(){return Le.lFrame.bindingIndex}function FR(t){return Le.lFrame.bindingIndex=t}function kh(){return Le.lFrame.bindingIndex++}function BR(t){let e=Le.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}function UR(){return Le.lFrame.inI18n}function jR(t,e){let n=Le.lFrame;n.bindingIndex=n.bindingRootIndex=t,cm(e)}function VR(){return Le.lFrame.currentDirectiveIndex}function cm(t){Le.lFrame.currentDirectiveIndex=t}function GE(t){Le.lFrame.currentQueryIndex=t}function oq(t){let e=t[De];return e.type===2?e.declTNode:e.type===1?t[hi]:null}function KE(t,e,n){if(n&4){let i=e,s=t;for(;i=i.parent,i===null&&!(n&1);)if(i=oq(s),i===null||(s=s[Sc],i.type&10))break;if(i===null)return!1;e=i,t=s}let r=Le.lFrame=HR();return r.currentTNode=e,r.lView=t,!0}function lm(t){let e=HR(),n=t[De];Le.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function HR(){let t=Le.lFrame,e=t===null?null:t.child;return e===null?$R(t):e}function $R(t){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=e),e}function qR(){let t=Le.lFrame;return Le.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var WE=qR;function um(){let t=qR();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function zR(t){return(Le.lFrame.contextLView=IR(t,Le.lFrame.contextLView))[Yt]}function gu(){return Le.lFrame.selectedIndex}function Wo(t){Le.lFrame.selectedIndex=t}function GR(){let t=Le.lFrame;return Ph(t.tView,t.selectedIndex)}function mu(){Le.lFrame.currentNamespace=BE}function Lh(){aq()}function aq(){Le.lFrame.currentNamespace=null}function KR(){return Le.lFrame.currentNamespace}var WR=!0;function dm(){return WR}function hm(t){WR=t}function fE(t,e=null,n=null,r){let i=QE(t,e,n,r);return i.resolveInjectorInitializers(),i}function QE(t,e=null,n=null,r,i=new Set){let s=[n||yc,hR(t)];return r=r||(typeof t=="object"?void 0:jo(t)),new wc(s,e||Nh(),r||null,i)}var Oi=class t{static THROW_IF_NOT_FOUND=gc;static NULL=new bh;static create(e,n){if(Array.isArray(e))return fE({name:""},n,e,"");{let r=e.name??"";return fE({name:r},e.parent,e.providers,r)}}static \u0275prov=Ae({token:t,providedIn:"any",factory:()=>ke(DE)});static __NG_ELEMENT_ID__=-1},Hn=new Ce(""),Qo=(()=>{class t{static __NG_ELEMENT_ID__=cq;static __NG_ENV_ID__=n=>n}return t})(),Jg=class extends Qo{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Rc(this._lView)}onDestroy(e){let n=this._lView;return HE(n,e),()=>CR(n,e)}};function cq(){return new Jg(At())}var QR=!1,Yo=(()=>{class t{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Nn(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new ot(n=>{n.next(!1),n.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let n=this.taskId++;return this.pendingTasks.add(n),n}has(n){return this.pendingTasks.has(n)}remove(n){this.pendingTasks.delete(n),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Ae({token:t,providedIn:"root",factory:()=>new t})}return t})(),pE=class extends jn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,mR()&&(this.destroyRef=re(Qo,{optional:!0})??void 0,this.pendingTasks=re(Yo,{optional:!0})??void 0)}emit(e){let n=Ie(null);try{super.next(e)}finally{Ie(n)}}subscribe(e,n,r){let i=e,s=n||(()=>null),o=r;if(e&&typeof e=="object"){let c=e;i=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=this.wrapInTimeout(s),i&&(i=this.wrapInTimeout(i)),o&&(o=this.wrapInTimeout(o)));let a=super.subscribe({next:i,error:s,complete:o});return e instanceof Dn&&e.add(a),a}wrapInTimeout(e){return n=>{let r=this.pendingTasks?.add();setTimeout(()=>{try{e(n)}finally{r!==void 0&&this.pendingTasks?.remove(r)}})}}},ur=pE;function Ih(...t){}function YE(t){let e,n;function r(){t=Ih;try{n!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(n),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(n=requestAnimationFrame(()=>{t(),r()})),()=>r()}function JE(t){return queueMicrotask(()=>t()),()=>{t=Ih}}var ZE="isAngularZone",Ch=ZE+"_ID",lq=0,qr=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new ur(!1);onMicrotaskEmpty=new ur(!1);onStable=new ur(!1);onError=new ur(!1);constructor(e){let{enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:i=!1,scheduleInRootZone:s=QR}=e;if(typeof Zone>"u")throw new me(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&r,o.shouldCoalesceRunChangeDetection=i,o.callbackScheduled=!1,o.scheduleInRootZone=s,hq(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(ZE)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new me(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new me(909,!1)}run(e,n,r){return this._inner.run(e,n,r)}runTask(e,n,r,i){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,uq,Ih,Ih);try{return s.runTask(o,n,r)}finally{s.cancelTask(o)}}runGuarded(e,n,r){return this._inner.runGuarded(e,n,r)}runOutsideAngular(e){return this._outer.run(e)}},uq={};function XE(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function dq(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function e(){YE(()=>{t.callbackScheduled=!1,gE(t),t.isCheckStableRunning=!0,XE(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{e()}):t._outer.run(()=>{e()}),gE(t)}function hq(t){let e=()=>{dq(t)},n=lq++;t._inner=t._inner.fork({name:"angular",properties:{[ZE]:!0,[Ch]:n,[Ch+n]:!0},onInvokeTask:(r,i,s,o,a,c)=>{if(fq(c))return r.invokeTask(s,o,a,c);try{return iR(t),r.invokeTask(s,o,a,c)}finally{(t.shouldCoalesceEventChangeDetection&&o.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&e(),sR(t)}},onInvoke:(r,i,s,o,a,c,l)=>{try{return iR(t),r.invoke(s,o,a,c,l)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!pq(c)&&e(),sR(t)}},onHasTask:(r,i,s,o)=>{r.hasTask(s,o),i===s&&(o.change=="microTask"?(t._hasPendingMicrotasks=o.microTask,gE(t),XE(t)):o.change=="macroTask"&&(t.hasPendingMacrotasks=o.macroTask))},onHandleError:(r,i,s,o)=>(r.handleError(s,o),t.runOutsideAngular(()=>t.onError.emit(o)),!1)})}function gE(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function iR(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function sR(t){t._nesting--,XE(t)}var Ah=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new ur;onMicrotaskEmpty=new ur;onStable=new ur;onError=new ur;run(e,n,r){return e.apply(n,r)}runGuarded(e,n,r){return e.apply(n,r)}runOutsideAngular(e){return e()}runTask(e,n,r,i){return e.apply(n,r)}};function fq(t){return YR(t,"__ignore_ng_zone__")}function pq(t){return YR(t,"__scheduler_tick__")}function YR(t,e){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[e]===!0}var Xs=class{_console=console;handleError(e){this._console.error("ERROR",e)}},Bi=new Ce("",{factory:()=>{let t=re(qr),e=re(Vn),n;return r=>{t.runOutsideAngular(()=>{e.destroyed&&!n?setTimeout(()=>{throw r}):(n??=e.get(Xs),n.handleError(r))})}}}),JR={provide:Cc,useValue:()=>{let t=re(Xs,{optional:!0})},multi:!0},gq=new Ce("",{factory:()=>{let t=re(Hn).defaultView;if(!t)return;let e=re(Bi),n=s=>{e(s.reason),s.preventDefault()},r=s=>{s.error?e(s.error):e(new Error(s.message,{cause:s})),s.preventDefault()},i=()=>{t.addEventListener("unhandledrejection",n),t.addEventListener("error",r)};typeof Zone<"u"?Zone.root.run(i):i(),re(Qo).onDestroy(()=>{t.removeEventListener("error",r),t.removeEventListener("unhandledrejection",n)})}});function eI(){return Ac([dR(()=>void re(gq))])}function pt(t,e){let[n,r,i]=V0(t,e?.equal),s=n,o=s[ui];return s.set=r,s.update=i,s.asReadonly=ZR.bind(s),s}function ZR(){let t=this[ui];if(t.readonlyFn===void 0){let e=()=>this();e[ui]=t,t.readonlyFn=e}return t.readonlyFn}var fm=(()=>{class t{view;node;constructor(n,r){this.view=n,this.node=r}static __NG_ELEMENT_ID__=mq}return t})();function mq(){return new fm(At(),_s())}var vc=class{},Fh=new Ce("",{factory:()=>!0});var tI=new Ce("");var pm=(()=>{class t{static \u0275prov=Ae({token:t,providedIn:"root",factory:()=>new mE})}return t})(),mE=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let n=e.zone,r=this.queues.get(n);r.has(e)&&(r.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let n=e.zone;this.queues.has(n)||this.queues.set(n,new Set);let r=this.queues.get(n);r.has(e)||r.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[n,r]of this.queues)n===null?e||=this.flushQueue(r):e||=n.run(()=>this.flushQueue(r));e||(this.dirtyEffectCount=0)}}flushQueue(e){let n=!1;for(let r of e)r.dirty&&(this.dirtyEffectCount--,n=!0,r.run());return n}},Zg=class{[ui];constructor(e){this[ui]=e}destroy(){this[ui].destroy()}};function nI(t,e){let n=e?.injector??re(Oi),r=e?.manualCleanup!==!0?n.get(Qo):null,i,s=n.get(fm,null,{optional:!0}),o=n.get(vc);return s!==null?(i=vq(s.view,o,t),r instanceof Jg&&r._lView===s.view&&(r=null)):i=bq(t,n.get(pm),o),i.injector=n,r!==null&&(i.onDestroyFn=r.onDestroy(()=>i.destroy())),new Zg(i)}var XR=fe(H({},$0),{cleanupFns:void 0,zone:null,onDestroyFn:Ih,run(){let t=Eh(!1);try{q0(this)}finally{Eh(t)}},cleanup(){if(!this.cleanupFns?.length)return;let t=Ie(null);try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[],Ie(t)}}}),yq=fe(H({},XR),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){uc(this),this.onDestroyFn(),this.cleanup(),this.scheduler.remove(this)}}),wq=fe(H({},XR),{consumerMarkedDirty(){this.view[Ne]|=8192,fu(this.view),this.notifier.notify(13)},destroy(){uc(this),this.onDestroyFn(),this.cleanup(),this.view[Ho]?.delete(this)}});function vq(t,e,n){let r=Object.create(wq);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=e,r.fn=eO(r,n),t[Ho]??=new Set,t[Ho].add(r),r.consumerMarkedDirty(r),r}function bq(t,e,n){let r=Object.create(yq);return r.fn=eO(r,t),r.scheduler=e,r.notifier=n,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.add(r),r.notifier.notify(12),r}function eO(t,e){return()=>{e(n=>(t.cleanupFns??=[]).push(n))}}function Ts(t){return H0(t)}function Om(t){return{toString:t}.toString()}function Dq(t){return typeof t=="function"}function TO(t,e,n,r){e!==null?e.applyValueToInputSignal(e,r):t[n]=r}var wm=class{previousValue;currentValue;firstChange;constructor(e,n,r){this.previousValue=e,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}},Pm=(()=>{let t=()=>DO;return t.ngInherit=!0,t})();function DO(t){return t.type.prototype.ngOnChanges&&(t.setInput=xq),Nq}function Nq(){let t=xO(this),e=t?.current;if(e){let n=t.previous;if(n===Ic)t.previous=e;else for(let r in e)n[r]=e[r];t.current=null,this.ngOnChanges(e)}}function xq(t,e,n,r,i){let s=this.declaredInputs[r],o=xO(t)||Rq(t,{previous:Ic,current:null}),a=o.current||(o.current={}),c=o.previous,l=c[s];a[s]=new wm(l&&l.currentValue,n,c===Ic),TO(t,e,i,n)}var NO="__ngSimpleChanges__";function xO(t){return t[NO]||null}function Rq(t,e){return t[NO]=e}var tO=[];var St=function(t,e=null,n){for(let r=0;r<tO.length;r++){let i=tO[r];i(t,e,n)}};function Oq(t,e,n){let{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){let o=DO(e);(n.preOrderHooks??=[]).push(t,o),(n.preOrderCheckHooks??=[]).push(t,o)}i&&(n.preOrderHooks??=[]).push(0-t,i),s&&((n.preOrderHooks??=[]).push(t,s),(n.preOrderCheckHooks??=[]).push(t,s))}function Pq(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){let s=t.data[n].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(t.contentHooks??=[]).push(-n,o),a&&((t.contentHooks??=[]).push(n,a),(t.contentCheckHooks??=[]).push(n,a)),c&&(t.viewHooks??=[]).push(-n,c),l&&((t.viewHooks??=[]).push(n,l),(t.viewCheckHooks??=[]).push(n,l)),u!=null&&(t.destroyHooks??=[]).push(n,u)}}function gm(t,e,n){RO(t,e,3,n)}function mm(t,e,n,r){(t[Ne]&3)===n&&RO(t,e,n,r)}function rI(t,e){let n=t[Ne];(n&3)===e&&(n&=16383,n+=1,t[Ne]=n)}function RO(t,e,n,r){let i=r!==void 0?t[Tc]&65535:0,s=r??-1,o=e.length-1,a=0;for(let c=i;c<o;c++)if(typeof e[c+1]=="number"){if(a=e[c],r!=null&&a>=r)break}else e[c]<0&&(t[Tc]+=65536),(a<s||s==-1)&&(Mq(t,n,e,c),t[Tc]=(t[Tc]&4294901760)+c+2),c++}function nO(t,e){St(4,t,e);let n=Ie(null);try{e.call(t)}finally{Ie(n),St(5,t,e)}}function Mq(t,e,n,r){let i=n[r]<0,s=n[r+1],o=i?-n[r]:n[r],a=t[o];i?t[Ne]>>14<t[Tc]>>16&&(t[Ne]&3)===e&&(t[Ne]+=16384,nO(a,s)):nO(a,s)}var wu=-1,Vh=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,n,r,i){this.factory=e,this.name=i,this.canSeeViewProviders=n,this.injectImpl=r}};function kq(t){return(t.flags&8)!==0}function Lq(t){return(t.flags&16)!==0}function Fq(t,e,n){let r=0;for(;r<n.length;){let i=n[r];if(typeof i=="number"){if(i!==0)break;r++;let s=n[r++],o=n[r++],a=n[r++];t.setAttribute(e,o,a,s)}else{let s=i,o=n[++r];Uq(s)?t.setProperty(e,s,o):t.setAttribute(e,s,o),r++}}return r}function Bq(t){return t===3||t===4||t===6}function Uq(t){return t.charCodeAt(0)===64}function NI(t,e){if(!(e===null||e.length===0))if(t===null||t.length===0)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){let i=e[r];typeof i=="number"?n=i:n===0||(n===-1||n===2?rO(t,n,i,null,e[++r]):rO(t,n,i,null,null))}}return t}function rO(t,e,n,r,i){let s=0,o=t.length;if(e===-1)o=-1;else for(;s<t.length;){let a=t[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<t.length;){let a=t[s];if(typeof a=="number")break;if(a===n){i!==null&&(t[s+1]=i);return}s++,i!==null&&s++}o!==-1&&(t.splice(o,0,e),s=o+1),t.splice(s++,0,n),i!==null&&t.splice(s++,0,i)}function OO(t){return t!==wu}function vm(t){return t&32767}function jq(t){return t>>16}function bm(t,e){let n=jq(t),r=e;for(;n>0;)r=r[Sc],n--;return r}var uI=!0;function Em(t){let e=uI;return uI=t,e}var Vq=256,PO=Vq-1,MO=5,Hq=0,Ds={};function $q(t,e,n){let r;typeof n=="string"?r=n.charCodeAt(0)||0:n.hasOwnProperty(Ec)&&(r=n[Ec]),r==null&&(r=n[Ec]=Hq++);let i=r&PO,s=1<<i;e.data[t+(i>>MO)]|=s}function kO(t,e){let n=LO(t,e);if(n!==-1)return n;let r=e[De];r.firstCreatePass&&(t.injectorIndex=e.length,iI(r.data,t),iI(e,null),iI(r.blueprint,null));let i=xI(t,e),s=t.injectorIndex;if(OO(i)){let o=vm(i),a=bm(i,e),c=a[De].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=i,s}function iI(t,e){t.push(0,0,0,0,0,0,0,0,e)}function LO(t,e){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||e[t.injectorIndex+8]===null?-1:t.injectorIndex}function xI(t,e){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let n=0,r=null,i=e;for(;i!==null;){if(r=VO(i),r===null)return wu;if(n++,i=i[Sc],r.injectorIndex!==-1)return r.injectorIndex|n<<16}return wu}function qq(t,e,n){$q(t,e,n)}function FO(t,e,n){if(n&8||t!==void 0)return t;tm(e,"NodeInjector")}function BO(t,e,n,r){if(n&8&&r===void 0&&(r=null),(n&3)===0){let i=t[eo],s=lr(void 0);try{return i?i.get(e,r,n&8):_E(e,r,n&8)}finally{lr(s)}}return FO(r,e,n)}function UO(t,e,n,r=0,i){if(t!==null){if(e[Ne]&2048&&!(r&2)){let o=Qq(t,e,n,r,Ds);if(o!==Ds)return o}let s=jO(t,e,n,r,Ds);if(s!==Ds)return s}return BO(e,n,r,i)}function jO(t,e,n,r,i){let s=Kq(n);if(typeof s=="function"){if(!KE(e,t,r))return r&1?FO(i,n,r):BO(e,n,r,i);try{let o;if(o=s(r),o==null&&!(r&8))tm(n);else return o}finally{WE()}}else if(typeof s=="number"){let o=null,a=LO(t,e),c=wu,l=r&1?e[zr][hi]:null;for((a===-1||r&4)&&(c=a===-1?xI(t,e):e[a+8],c===wu||!sO(r,!1)?a=-1:(o=e[De],a=vm(c),e=bm(c,e)));a!==-1;){let u=e[De];if(iO(s,a,u.data)){let d=zq(a,e,n,o,r,l);if(d!==Ds)return d}c=e[a+8],c!==wu&&sO(r,e[De].data[a+8]===l)&&iO(s,a,e)?(o=u,a=vm(c),e=bm(c,e)):a=-1}}return i}function zq(t,e,n,r,i,s){let o=e[De],a=o.data[t+8],c=r==null?Go(a)&&uI:r!=o&&(a.type&3)!==0,l=i&1&&s===a,u=Gq(a,o,n,c,l);return u!==null?dI(e,o,u,a,i):Ds}function Gq(t,e,n,r,i){let s=t.providerIndexes,o=e.data,a=s&1048575,c=t.directiveStart,l=t.directiveEnd,u=s>>20,d=r?a:a+u,h=i?a+u:l;for(let f=d;f<h;f++){let p=o[f];if(f<c&&n===p||f>=c&&p.type===n)return f}if(i){let f=o[c];if(f&&xc(f)&&f.type===n)return c}return null}function dI(t,e,n,r,i){let s=t[n],o=e.data;if(s instanceof Vh){let a=s;if(a.resolving){let f=oR(o[n]);throw SE(f)}let c=Em(a.canSeeViewProviders);a.resolving=!0;let l=o[n].type||o[n],u,d=a.injectImpl?lr(a.injectImpl):null,h=KE(t,r,0);try{s=t[n]=a.factory(void 0,i,o,t,r),e.firstCreatePass&&n>=r.directiveStart&&Oq(n,o[n],e)}finally{d!==null&&lr(d),Em(c),a.resolving=!1,WE()}}return s}function Kq(t){if(typeof t=="string")return t.charCodeAt(0)||0;let e=t.hasOwnProperty(Ec)?t[Ec]:void 0;return typeof e=="number"?e>=0?e&PO:Wq:e}function iO(t,e,n){let r=1<<t;return!!(n[e+(t>>MO)]&r)}function sO(t,e){return!(t&2)&&!(t&1&&e)}var Oc=class{_tNode;_lView;constructor(e,n){this._tNode=e,this._lView=n}get(e,n,r){return UO(this._tNode,this._lView,e,mc(r),n)}};function Wq(){return new Oc(_s(),At())}function Mm(t){return Om(()=>{let e=t.prototype.constructor,n=e[vh]||hI(e),r=Object.prototype,i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==r;){let s=i[vh]||hI(i);if(s&&s!==n)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function hI(t){return wE(t)?()=>{let e=hI(Tr(t));return e&&e()}:Vo(t)}function Qq(t,e,n,r,i){let s=t,o=e;for(;s!==null&&o!==null&&o[Ne]&2048&&!hu(o);){let a=jO(s,o,n,r|2,Ds);if(a!==Ds)return a;let c=s.parent;if(!c){let l=o[kE];if(l){let u=l.get(n,Ds,r);if(u!==Ds)return u}c=VO(o),o=o[Sc]}s=c}return i}function VO(t){let e=t[De],n=e.type;return n===2?e.declTNode:n===1?t[hi]:null}function Yq(){return RI(_s(),At())}function RI(t,e){return new OI(As(t,e))}var OI=(()=>{class t{nativeElement;constructor(n){this.nativeElement=n}static __NG_ELEMENT_ID__=Yq}return t})();function HO(t){return(t.flags&128)===128}var PI=(function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t})(PI||{}),$O=new Map,Jq=0;function Zq(){return Jq++}function Xq(t){$O.set(t[xh],t)}function fI(t){$O.delete(t[xh])}var oO="__ngContext__";function vu(t,e){no(e)?(t[oO]=e[xh],Xq(e)):t[oO]=e}function qO(t){return GO(t[du])}function zO(t){return GO(t[di])}function GO(t){for(;t!==null&&!Mi(t);)t=t[di];return t}var pI;function MI(t){pI=t}function KO(){if(pI!==void 0)return pI;if(typeof document<"u")return document;throw new me(210,!1)}var km=new Ce("",{factory:()=>e9}),e9="ng";var Lm=new Ce(""),Gh=new Ce("",{providedIn:"platform",factory:()=>"unknown"});var Fm=new Ce("",{factory:()=>KO().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var WO="r";var QO="di";var YO=!1,JO=new Ce("",{factory:()=>YO});var t9=(t,e,n,r)=>{};function n9(t,e,n,r){t9(t,e,n,r)}function kI(t){return(t.flags&32)===32}var r9=()=>null;function ZO(t,e,n=!1){return r9(t,e,n)}function XO(t,e){let n=t.contentQueries;if(n!==null){let r=Ie(null);try{for(let i=0;i<n.length;i+=2){let s=n[i],o=n[i+1];if(o!==-1){let a=t.data[o];GE(s),a.contentQueries(2,e[o],o)}}}finally{Ie(r)}}}function gI(t,e,n){GE(0);let r=Ie(null);try{e(t,n)}finally{Ie(r)}}function eP(t,e,n){if(FE(e)){let r=Ie(null);try{let i=e.directiveStart,s=e.directiveEnd;for(let o=i;o<s;o++){let a=t.data[o];if(a.contentQueries){let c=n[o];a.contentQueries(1,c,o)}}}finally{Ie(r)}}}var ji=(function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t[t.ExperimentalIsolatedShadowDom=4]="ExperimentalIsolatedShadowDom",t})(ji||{});function tP(t){return t instanceof Function?t():t}function i9(t,e,n){let r=t.length;for(;;){let i=t.indexOf(e,n);if(i===-1)return i;if(i===0||t.charCodeAt(i-1)<=32){let s=e.length;if(i+s===r||t.charCodeAt(i+s)<=32)return i}n=i+1}}var nP="ng-template";function s9(t,e,n,r){let i=0;if(r){for(;i<e.length&&typeof e[i]=="string";i+=2)if(e[i]==="class"&&i9(e[i+1].toLowerCase(),n,0)!==-1)return!0}else if(LI(t))return!1;if(i=e.indexOf(1,i),i>-1){let s;for(;++i<e.length&&typeof(s=e[i])=="string";)if(s.toLowerCase()===n)return!0}return!1}function LI(t){return t.type===4&&t.value!==nP}function o9(t,e,n){let r=t.type===4&&!n?nP:t.value;return e===r}function a9(t,e,n){let r=4,i=t.attrs,s=i!==null?u9(i):0,o=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!o&&!Ui(r)&&!Ui(c))return!1;if(o&&Ui(c))continue;o=!1,r=c|r&1;continue}if(!o)if(r&4){if(r=2|r&1,c!==""&&!o9(t,c,n)||c===""&&e.length===1){if(Ui(r))return!1;o=!0}}else if(r&8){if(i===null||!s9(t,i,c,n)){if(Ui(r))return!1;o=!0}}else{let l=e[++a],u=c9(c,i,LI(t),n);if(u===-1){if(Ui(r))return!1;o=!0;continue}if(l!==""){let d;if(u>s?d="":d=i[u+1].toLowerCase(),r&2&&l!==d){if(Ui(r))return!1;o=!0}}}}return Ui(r)||o}function Ui(t){return(t&1)===0}function c9(t,e,n,r){if(e===null)return-1;let i=0;if(r||!n){let s=!1;for(;i<e.length;){let o=e[i];if(o===t)return i;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++i];for(;typeof a=="string";)a=e[++i];continue}else{if(o===4)break;if(o===0){i+=4;continue}}i+=s?1:2}return-1}else return d9(e,t)}function l9(t,e,n=!1){for(let r=0;r<e.length;r++)if(a9(t,e[r],n))return!0;return!1}function u9(t){for(let e=0;e<t.length;e++){let n=t[e];if(Bq(n))return e}return t.length}function d9(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){let r=t[n];if(typeof r=="number")return-1;if(r===e)return n;n++}return-1}function aO(t,e){return t?":not("+e.trim()+")":e}function h9(t){let e=t[0],n=1,r=2,i="",s=!1;for(;n<t.length;){let o=t[n];if(typeof o=="string")if(r&2){let a=t[++n];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else r&8?i+="."+o:r&4&&(i+=" "+o);else i!==""&&!Ui(o)&&(e+=aO(s,i),i=""),r=o,s=s||!Ui(r);n++}return i!==""&&(e+=aO(s,i)),e}function f9(t){return t.map(h9).join(",")}function p9(t){let e=[],n=[],r=1,i=2;for(;r<t.length;){let s=t[r];if(typeof s=="string")i===2?s!==""&&e.push(s,t[++r]):i===8&&n.push(s);else{if(!Ui(i))break;i=s}r++}return n.length&&e.push(1,...n),e}var Ns={};function g9(t,e){return t.createText(e)}function m9(t,e,n){t.setValue(e,n)}function rP(t,e,n){return t.createElement(e,n)}function Im(t,e,n,r,i){t.insertBefore(e,n,r,i)}function iP(t,e,n){t.appendChild(e,n)}function cO(t,e,n,r,i){r!==null?Im(t,e,n,r,i):iP(t,e,n)}function sP(t,e,n,r){t.removeChild(null,e,n,r)}function y9(t,e,n){t.setAttribute(e,"style",n)}function w9(t,e,n){n===""?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}function oP(t,e,n){let{mergedAttrs:r,classes:i,styles:s}=n;r!==null&&Fq(t,e,r),i!==null&&w9(t,e,i),s!==null&&y9(t,e,s)}function FI(t,e,n,r,i,s,o,a,c,l,u){let d=vn+r,h=d+i,f=v9(d,h),p=typeof l=="function"?l():l;return f[De]={type:t,blueprint:f,template:n,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1,ssrId:u}}function v9(t,e){let n=[];for(let r=0;r<e;r++)n.push(r<t?null:Ns);return n}function b9(t){let e=t.tView;return e===null||e.incompleteFirstPass?t.tView=FI(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}function BI(t,e,n,r,i,s,o,a,c,l,u){let d=e.blueprint.slice();return d[Pi]=i,d[Ne]=r|4|128|8|64|1024,(l!==null||t&&t[Ne]&2048)&&(d[Ne]|=2048),jE(d),d[yn]=d[Sc]=t,d[Yt]=n,d[to]=o||t&&t[to],d[wn]=a||t&&t[wn],d[eo]=c||t&&t[eo]||null,d[hi]=s,d[xh]=Zq(),d[lu]=u,d[kE]=l,d[zr]=e.type==2?t[zr]:d,d}function E9(t,e,n){let r=As(e,t),i=b9(n),s=t[to].rendererFactory,o=UI(t,BI(t,i,null,aP(n),r,e,null,s.createRenderer(r,n),null,null,null));return t[e.index]=o}function aP(t){let e=16;return t.signals?e=4096:t.onPush&&(e=64),e}function cP(t,e,n,r){if(n===0)return-1;let i=e.length;for(let s=0;s<n;s++)e.push(r),t.blueprint.push(r),t.data.push(null);return i}function UI(t,e){return t[du]?t[ME][di]=e:t[du]=e,t[ME]=e,e}function je(t=1){lP(Ss(),At(),gu()+t,!1)}function lP(t,e,n,r){if(!r)if((e[Ne]&3)===3){let s=t.preOrderCheckHooks;s!==null&&gm(e,s,n)}else{let s=t.preOrderHooks;s!==null&&mm(e,s,0,n)}Wo(n)}var Bm=(function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t})(Bm||{});function mI(t,e,n,r){let i=Ie(null);try{let[s,o,a]=t.inputs[n],c=null;(o&Bm.SignalBased)!==0&&(c=e[s][ui]),c!==null&&c.transformFn!==void 0?r=c.transformFn(r):a!==null&&(r=a.call(e,r)),t.setInput!==null?t.setInput(e,c,r,n,s):TO(e,c,s,r)}finally{Ie(i)}}var Jo=(function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t})(Jo||{}),I9;function jI(t,e){return I9(t,e)}var Pc=new Set,VI=(function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t})(VI||{}),Kh=new Ce(""),lO=new Set;function Fc(t){lO.has(t)||(lO.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}var uP=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ae({token:t,providedIn:"root",factory:()=>new t})}return t})();var dP=new Ce("",{factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function hP(t,e,n){let r=t.get(dP);if(Array.isArray(e))for(let i of e)r.queue.add(i),n?.detachedLeaveAnimationFns?.push(i);else r.queue.add(e),n?.detachedLeaveAnimationFns?.push(e);r.scheduler&&r.scheduler(t)}function C9(t,e){let n=t.get(dP);if(e.detachedLeaveAnimationFns){for(let r of e.detachedLeaveAnimationFns)n.queue.delete(r);e.detachedLeaveAnimationFns=void 0}}function A9(t,e){for(let[n,r]of e)hP(t,r.animateFns)}function uO(t,e,n,r){let i=t?.[Nc]?.enter;e!==null&&i&&i.has(n.index)&&A9(r,i)}function yu(t,e,n,r,i,s,o,a){if(i!=null){let c,l=!1;Mi(i)?c=i:no(i)&&(l=!0,i=i[Pi]);let u=fi(i);t===0&&r!==null?(uO(a,r,s,n),o==null?iP(e,r,u):Im(e,r,u,o||null,!0)):t===1&&r!==null?(uO(a,r,s,n),Im(e,r,u,o||null,!0)):t===2?dO(a,s,n,d=>{sP(e,u,l,d)}):t===3&&dO(a,s,n,()=>{e.destroyNode(u)}),c!=null&&F9(e,t,n,c,s,r,o)}}function S9(t,e){fP(t,e),e[Pi]=null,e[hi]=null}function _9(t,e,n,r,i,s){r[Pi]=i,r[hi]=e,jm(t,r,n,1,i,s)}function fP(t,e){e[to].changeDetectionScheduler?.notify(9),jm(t,e,e[wn],2,null,null)}function T9(t){let e=t[du];if(!e)return sI(t[De],t);for(;e;){let n=null;if(no(e))n=e[du];else{let r=e[Jt];r&&(n=r)}if(!n){for(;e&&!e[di]&&e!==t;)no(e)&&sI(e[De],e),e=e[yn];e===null&&(e=t),no(e)&&sI(e[De],e),n=e&&e[di]}e=n}}function HI(t,e){let n=t[Oh],r=n.indexOf(e);n.splice(r,1)}function Um(t,e){if(Rc(e))return;let n=e[wn];n.destroyNode&&jm(t,e,n,3,null,null),T9(e)}function sI(t,e){if(Rc(e))return;let n=Ie(null);try{e[Ne]&=-129,e[Ne]|=256,e[Gr]&&uc(e[Gr]),x9(t,e),N9(t,e),e[De].type===1&&e[wn].destroy();let r=e[_c];if(r!==null&&Mi(e[yn])){r!==e[yn]&&HI(r,e);let i=e[Dc];i!==null&&i.detachView(t)}fI(e)}finally{Ie(n)}}function dO(t,e,n,r){let i=t?.[Nc];if(i==null||i.leave==null||!i.leave.has(e.index))return r(!1);t&&Pc.add(t),hP(n,()=>{if(i.leave&&i.leave.has(e.index)){let o=i.leave.get(e.index),a=[];if(o){for(let c=0;c<o.animateFns.length;c++){let l=o.animateFns[c],{promise:u}=l();a.push(u)}i.detachedLeaveAnimationFns=void 0}i.running=Promise.allSettled(a),D9(t,r)}else t&&Pc.delete(t),r(!1)},i)}function D9(t,e){let n=t[Nc]?.running;if(n){n.then(()=>{t[Nc].running=void 0,Pc.delete(t),e(!0)});return}e(!1)}function N9(t,e){let n=t.cleanup,r=e[uu];if(n!==null)for(let o=0;o<n.length-1;o+=2)if(typeof n[o]=="string"){let a=n[o+3];a>=0?r[a]():r[-a].unsubscribe(),o+=2}else{let a=r[n[o+1]];n[o].call(a)}r!==null&&(e[uu]=null);let i=e[Zs];if(i!==null){e[Zs]=null;for(let o=0;o<i.length;o++){let a=i[o];a()}}let s=e[Ho];if(s!==null){e[Ho]=null;for(let o of s)o.destroy()}}function x9(t,e){let n;if(t!=null&&(n=t.destroyHooks)!=null)for(let r=0;r<n.length;r+=2){let i=e[n[r]];if(!(i instanceof Vh)){let s=n[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=i[s[o]],c=s[o+1];St(4,a,c);try{c.call(a)}finally{St(5,a,c)}}else{St(4,i,s);try{s.call(i)}finally{St(5,i,s)}}}}}function R9(t,e,n){return O9(t,e.parent,n)}function O9(t,e,n){let r=e;for(;r!==null&&r.type&168;)e=r,r=e.parent;if(r===null)return n[Pi];if(Go(r)){let{encapsulation:i}=t.data[r.directiveStart+r.componentOffset];if(i===ji.None||i===ji.Emulated)return null}return As(r,n)}function P9(t,e,n){return k9(t,e,n)}function M9(t,e,n){return t.type&40?As(t,n):null}var k9=M9,hO;function $I(t,e,n,r){let i=R9(t,r,e),s=e[wn],o=r.parent||e[hi],a=P9(o,r,e);if(i!=null)if(Array.isArray(n))for(let c=0;c<n.length;c++)cO(s,i,n[c],a,!1);else cO(s,i,n,a,!1);hO!==void 0&&hO(s,r,e,n,i)}function Uh(t,e){if(e!==null){let n=e.type;if(n&3)return As(e,t);if(n&4)return yI(-1,t[e.index]);if(n&8){let r=e.child;if(r!==null)return Uh(t,r);{let i=t[e.index];return Mi(i)?yI(-1,i):fi(i)}}else{if(n&128)return Uh(t,e.next);if(n&32)return jI(e,t)()||fi(t[e.index]);{let r=pP(t,e);if(r!==null){if(Array.isArray(r))return r[0];let i=$o(t[zr]);return Uh(i,r)}else return Uh(t,e.next)}}}return null}function pP(t,e){if(e!==null){let r=t[zr][hi],i=e.projection;return r.projection[i]}return null}function yI(t,e){let n=Jt+t+1;if(n<e.length){let r=e[n],i=r[De].firstChild;if(i!==null)return Uh(r,i)}return e[zo]}function qI(t,e,n,r,i,s,o){for(;n!=null;){let a=r[eo];if(n.type===128){n=n.next;continue}let c=r[n.index],l=n.type;if(o&&e===0&&(c&&vu(fi(c),r),n.flags|=2),!kI(n))if(l&8)qI(t,e,n.child,r,i,s,!1),yu(e,t,a,i,c,n,s,r);else if(l&32){let u=jI(n,r),d;for(;d=u();)yu(e,t,a,i,d,n,s,r);yu(e,t,a,i,c,n,s,r)}else l&16?L9(t,e,r,n,i,s):yu(e,t,a,i,c,n,s,r);n=o?n.projectionNext:n.next}}function jm(t,e,n,r,i,s){qI(n,r,t.firstChild,e,i,s,!1)}function L9(t,e,n,r,i,s){let o=n[zr],c=o[hi].projection[r.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let u=c[l];yu(e,t,n[eo],i,u,r,s,n)}else{let l=c,u=o[yn];HO(r)&&(l.flags|=128),qI(t,e,l,u,i,s,!0)}}function F9(t,e,n,r,i,s,o){let a=r[zo],c=fi(r);a!==c&&yu(e,t,n,s,a,i,o);for(let l=Jt;l<r.length;l++){let u=r[l];jm(u[De],u,t,e,s,a)}}function gP(t,e,n,r,i){let s=gu(),o=r&2;try{Wo(-1),o&&e.length>vn&&lP(t,e,vn,!1),St(o?2:0,i,n),n(r,i)}finally{Wo(s),St(o?3:1,i,n)}}function mP(t,e,n){z9(t,e,n),(n.flags&64)===64&&G9(t,e,n)}function yP(t,e,n=As){let r=e.localNames;if(r!==null){let i=e.index+1;for(let s=0;s<r.length;s+=2){let o=r[s+1],a=o===-1?n(e,t):t[o];t[i++]=a}}}function B9(t,e,n,r){let s=r.get(JO,YO)||n===ji.ShadowDom||n===ji.ExperimentalIsolatedShadowDom,o=t.selectRootElement(e,s);return U9(o),o}function U9(t){j9(t)}var j9=()=>null;function V9(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function H9(t,e,n,r,i,s){let o=e[De];if(zI(t,o,e,n,r)){Go(t)&&q9(e,t.index);return}t.type&3&&(n=V9(n)),$9(t,e,n,r,i,s)}function $9(t,e,n,r,i,s){if(t.type&3){let o=As(t,e);r=s!=null?s(r,t.value||"",n):r,i.setProperty(o,n,r)}else t.type&12}function q9(t,e){let n=ki(e,t);n[Ne]&16||(n[Ne]|=64)}function z9(t,e,n){let r=n.directiveStart,i=n.directiveEnd;Go(n)&&E9(e,n,t.data[r+n.componentOffset]),t.firstCreatePass||kO(n,e);let s=n.initialInputs;for(let o=r;o<i;o++){let a=t.data[o],c=dI(e,t,o,n);if(vu(c,e),s!==null&&Q9(e,o-r,c,a,n,s),xc(a)){let l=ki(n.index,e);l[Yt]=dI(e,t,o,n)}}}function G9(t,e,n){let r=n.directiveStart,i=n.directiveEnd,s=n.index,o=VR();try{Wo(s);for(let a=r;a<i;a++){let c=t.data[a],l=e[a];cm(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&K9(c,l)}}finally{Wo(-1),cm(o)}}function K9(t,e){t.hostBindings!==null&&t.hostBindings(1,e)}function W9(t,e){let n=t.directiveRegistry,r=null;if(n)for(let i=0;i<n.length;i++){let s=n[i];l9(e,s.selectors,!1)&&(r??=[],xc(s)?r.unshift(s):r.push(s))}return r}function Q9(t,e,n,r,i,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;a+=2){let c=o[a],l=o[a+1];mI(r,n,c,l)}}function Y9(t,e,n,r,i){let s=vn+n,o=e[De],a=i(o,e,t,r,n);e[s]=a,pu(t,!0);let c=t.type===2;return c?(oP(e[wn],a,t),(_R()===0||sm(t))&&vu(a,e),TR()):vu(a,e),dm()&&(!c||!kI(t))&&$I(o,e,a,t),t}function J9(t){let e=t;return qE()?MR():(e=e.parent,pu(e,!1)),e}function Z9(t,e){let n=t[eo];if(!n)return;let r;try{r=n.get(Bi,null)}catch{r=null}r?.(e)}function zI(t,e,n,r,i){let s=t.inputs?.[r],o=t.hostDirectiveInputs?.[r],a=!1;if(o)for(let c=0;c<o.length;c+=2){let l=o[c],u=o[c+1],d=e.data[l];mI(d,n[l],u,i),a=!0}if(s)for(let c of s){let l=n[c],u=e.data[c];mI(u,l,r,i),a=!0}return a}function X9(t,e){let n=ki(e,t),r=n[De];ez(r,n);let i=n[Pi];i!==null&&n[lu]===null&&(n[lu]=ZO(i,n[eo])),St(18),GI(r,n,n[Yt]),St(19,n[Yt])}function ez(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}function GI(t,e,n){lm(e);try{let r=t.viewQuery;r!==null&&gI(1,r,n);let i=t.template;i!==null&&gP(t,e,i,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),e[Dc]?.finishViewCreation(t),t.staticContentQueries&&XO(t,e),t.staticViewQueries&&gI(2,t.viewQuery,n);let s=t.components;s!==null&&tz(e,s)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{e[Ne]&=-5,um()}}function tz(t,e){for(let n=0;n<e.length;n++)X9(t,e[n])}function KI(t,e,n,r){let i=Ie(null);try{let s=e.tView,a=t[Ne]&4096?4096:16,c=BI(t,s,n,a,null,e,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),l=t[e.index];c[_c]=l;let u=t[Dc];return u!==null&&(c[Dc]=u.createEmbeddedView(s)),GI(s,c,n),c}finally{Ie(i)}}function Hh(t,e){return!e||e.firstChild===null||HO(t)}function $h(t,e,n,r,i=!1){for(;n!==null;){if(n.type===128){n=i?n.projectionNext:n.next;continue}let s=e[n.index];s!==null&&r.push(fi(s)),Mi(s)&&wP(s,r);let o=n.type;if(o&8)$h(t,e,n.child,r);else if(o&32){let a=jI(n,e),c;for(;c=a();)r.push(c)}else if(o&16){let a=pP(e,n);if(Array.isArray(a))r.push(...a);else{let c=$o(e[zr]);$h(c[De],c,a,r,!0)}}n=i?n.projectionNext:n.next}return r}function wP(t,e){for(let n=Jt;n<t.length;n++){let r=t[n],i=r[De].firstChild;i!==null&&$h(r[De],r,i,e)}t[zo]!==t[Pi]&&e.push(t[zo])}function vP(t){if(t[im]!==null){for(let e of t[im])e.impl.addSequence(e);t[im].length=0}}var bP=[];function nz(t){return t[Gr]??rz(t)}function rz(t){let e=bP.pop()??Object.create(sz);return e.lView=t,e}function iz(t){t.lView[Gr]!==t&&(t.lView=null,bP.push(t))}var sz=fe(H({},lh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{fu(t.lView)},consumerOnSignalRead(){this.lView[Gr]=this}});function oz(t){let e=t[Gr]??Object.create(az);return e.lView=t,e}var az=fe(H({},lh),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let e=$o(t.lView);for(;e&&!EP(e[De]);)e=$o(e);e&&VE(e)},consumerOnSignalRead(){this.lView[Gr]=this}});function EP(t){return t.type!==2}function IP(t){if(t[Ho]===null)return;let e=!0;for(;e;){let n=!1;for(let r of t[Ho])r.dirty&&(n=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));e=n&&!!(t[Ne]&8192)}}var cz=100;function CP(t,e=0){let r=t[to].rendererFactory,i=!1;i||r.begin?.();try{lz(t,e)}finally{i||r.end?.()}}function lz(t,e){let n=zE();try{Eh(!0),wI(t,e);let r=0;for(;Mh(t);){if(r===cz)throw new me(103,!1);r++,wI(t,1)}}finally{Eh(n)}}function uz(t,e,n,r){if(Rc(e))return;let i=e[Ne],s=!1,o=!1;lm(e);let a=!0,c=null,l=null;s||(EP(t)?(l=nz(e),c=uh(l)):Ig()===null?(a=!1,l=oz(e),c=uh(l)):e[Gr]&&(uc(e[Gr]),e[Gr]=null));try{jE(e),FR(t.bindingStartIndex),n!==null&&gP(t,e,n,2,r);let u=(i&3)===3;if(!s)if(u){let f=t.preOrderCheckHooks;f!==null&&gm(e,f,null)}else{let f=t.preOrderHooks;f!==null&&mm(e,f,0,null),rI(e,0)}if(o||dz(e),IP(e),AP(e,0),t.contentQueries!==null&&XO(t,e),!s)if(u){let f=t.contentCheckHooks;f!==null&&gm(e,f)}else{let f=t.contentHooks;f!==null&&mm(e,f,1),rI(e,1)}fz(t,e);let d=t.components;d!==null&&_P(e,d,0);let h=t.viewQuery;if(h!==null&&gI(2,h,r),!s)if(u){let f=t.viewCheckHooks;f!==null&&gm(e,f)}else{let f=t.viewHooks;f!==null&&mm(e,f,2),rI(e,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),e[rm]){for(let f of e[rm])f();e[rm]=null}s||(vP(e),e[Ne]&=-73)}catch(u){throw s||fu(e),u}finally{l!==null&&(Ag(l,c),a&&iz(l)),um()}}function AP(t,e){for(let n=qO(t);n!==null;n=zO(n))for(let r=Jt;r<n.length;r++){let i=n[r];SP(i,e)}}function dz(t){for(let e=qO(t);e!==null;e=zO(e)){if(!(e[Ne]&2))continue;let n=e[Oh];for(let r=0;r<n.length;r++){let i=n[r];VE(i)}}}function hz(t,e,n){St(18);let r=ki(e,t);SP(r,n),St(19,r[Yt])}function SP(t,e){om(t)&&wI(t,e)}function wI(t,e){let r=t[De],i=t[Ne],s=t[Gr],o=!!(e===0&&i&16);if(o||=!!(i&64&&e===0),o||=!!(i&1024),o||=!!(s?.dirty&&dh(s)),o||=!1,s&&(s.dirty=!1),t[Ne]&=-9217,o)uz(r,t,r.template,t[Yt]);else if(i&8192){let a=Ie(null);try{IP(t),AP(t,1);let c=r.components;c!==null&&_P(t,c,1),vP(t)}finally{Ie(a)}}}function _P(t,e,n){for(let r=0;r<e.length;r++)hz(t,e[r],n)}function fz(t,e){let n=t.hostBindingOpCodes;if(n!==null)try{for(let r=0;r<n.length;r++){let i=n[r];if(i<0)Wo(~i);else{let s=i,o=n[++r],a=n[++r];jR(o,s);let c=e[s];St(24,c),a(2,c),St(25,c)}}}finally{Wo(-1)}}function WI(t,e){let n=zE()?64:1088;for(t[to].changeDetectionScheduler?.notify(e);t;){t[Ne]|=n;let r=$o(t);if(hu(t)&&!r)return t;t=r}return null}function TP(t,e,n,r){return[t,!0,0,e,null,r,null,n,null,null]}function DP(t,e){let n=Jt+e;if(n<t.length)return t[n]}function Vm(t,e,n,r=!0){let i=e[De];if(pz(i,e,t,n),r){let o=yI(n,t),a=e[wn],c=a.parentNode(t[zo]);c!==null&&_9(i,t[hi],a,e,c,o)}let s=e[lu];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function NP(t,e){let n=qh(t,e);return n!==void 0&&Um(n[De],n),n}function qh(t,e){if(t.length<=Jt)return;let n=Jt+e,r=t[n];if(r){let i=r[_c];i!==null&&i!==t&&HI(i,r),e>0&&(t[n-1][di]=r[di]);let s=Th(t,Jt+e);S9(r[De],r);let o=s[Dc];o!==null&&o.detachView(s[De]),r[yn]=null,r[di]=null,r[Ne]&=-129}return r}function pz(t,e,n,r){let i=Jt+r,s=n.length;r>0&&(n[i-1][di]=e),r<s-Jt?(e[di]=n[i],TE(n,Jt+r,e)):(n.push(e),e[di]=null),e[yn]=n;let o=e[_c];o!==null&&n!==o&&xP(o,e);let a=e[Dc];a!==null&&a.insertView(t),am(e),e[Ne]|=128}function xP(t,e){let n=t[Oh],r=e[yn];if(no(r))t[Ne]|=2;else{let i=r[yn][zr];e[zr]!==i&&(t[Ne]|=2)}n===null?t[Oh]=[e]:n.push(e)}var Mc=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,n=e[De];return $h(n,e,n.firstChild,[])}constructor(e,n){this._lView=e,this._cdRefInjectingView=n}get context(){return this._lView[Yt]}set context(e){this._lView[Yt]=e}get destroyed(){return Rc(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[yn];if(Mi(e)){let n=e[Rh],r=n?n.indexOf(this):-1;r>-1&&(qh(e,r),Th(n,r))}this._attachedToViewContainer=!1}Um(this._lView[De],this._lView)}onDestroy(e){HE(this._lView,e)}markForCheck(){WI(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ne]&=-129}reattach(){am(this._lView),this._lView[Ne]|=128}detectChanges(){this._lView[Ne]|=1024,CP(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new me(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=hu(this._lView),n=this._lView[_c];n!==null&&!e&&HI(n,this._lView),fP(this._lView[De],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new me(902,!1);this._appRef=e;let n=hu(this._lView),r=this._lView[_c];r!==null&&!n&&xP(r,this._lView),am(this._lView)}};function QI(t,e,n,r,i){let s=t.data[e];if(s===null)s=gz(t,e,n,r,i),UR()&&(s.flags|=32);else if(s.type&64){s.type=n,s.value=r,s.attrs=i;let o=PR();s.injectorIndex=o===null?-1:o.injectorIndex}return pu(s,!0),s}function gz(t,e,n,r,i){let s=$E(),o=qE(),a=o?s:s&&s.parent,c=t.data[e]=yz(t,a,n,e,r,i);return mz(t,c,s,o),c}function mz(t,e,n,r){t.firstChild===null&&(t.firstChild=e),n!==null&&(r?n.child==null&&e.parent!==null&&(n.child=e):n.next===null&&(n.next=e,e.prev=n))}function yz(t,e,n,r,i,s){let o=e?e.injectorIndex:-1,a=0;return xR()&&(a|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function wz(t){let e=t[LE]??[],r=t[yn][wn],i=[];for(let s of e)s.data[QO]!==void 0?i.push(s):vz(s,r);t[LE]=i}function vz(t,e){let n=0,r=t.firstChild;if(r){let i=t.data[WO];for(;n<i;){let s=r.nextSibling;sP(e,r,!1),r=s,n++}}}var bz=()=>null,Ez=()=>null;function vI(t,e){return bz(t,e)}function RP(t,e,n){return Ez(t,e,n)}var OP=class{},Hm=class{},bI=class{resolveComponentFactory(e){throw new me(917,!1)}},Wh=class{static NULL=new bI},kc=class{};var PP=(()=>{class t{static \u0275prov=Ae({token:t,providedIn:"root",factory:()=>null})}return t})();var ym={},EI=class{injector;parentInjector;constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,r){let i=this.injector.get(e,ym,r);return i!==ym||n===ym?i:this.parentInjector.get(e,n,r)}};function fO(t,e,n){let r=n?t.styles:null,i=n?t.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)i=yE(i,a);else if(s==2){let c=a,l=e[++o];r=yE(r,c+": "+l+";")}}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=i:t.classesWithoutHost=i}function Zo(t,e=0){let n=At();if(n===null)return ke(t,e);let r=_s();return UO(r,n,Tr(t),e)}function Iz(t,e,n,r,i){let s=r===null?null:{"":-1},o=i(t,n);if(o!==null){let a=o,c=null,l=null;for(let u of o)if(u.resolveHostDirectives!==null){[a,c,l]=u.resolveHostDirectives(o);break}Sz(t,e,n,a,s,c,l)}s!==null&&r!==null&&Cz(n,r,s)}function Cz(t,e,n){let r=t.localNames=[];for(let i=0;i<e.length;i+=2){let s=n[e[i+1]];if(s==null)throw new me(-301,!1);r.push(e[i],s)}}function Az(t,e,n){e.componentOffset=n,(t.components??=[]).push(e.index)}function Sz(t,e,n,r,i,s,o){let a=r.length,c=!1;for(let h=0;h<a;h++){let f=r[h];!c&&xc(f)&&(c=!0,Az(t,n,h)),qq(kO(n,e),t,f.type)}Rz(n,t.data.length,a);for(let h=0;h<a;h++){let f=r[h];f.providersResolver&&f.providersResolver(f)}let l=!1,u=!1,d=cP(t,e,a,null);a>0&&(n.directiveToIndex=new Map);for(let h=0;h<a;h++){let f=r[h];if(n.mergedAttrs=NI(n.mergedAttrs,f.hostAttrs),Tz(t,n,e,d,f),xz(d,f,i),o!==null&&o.has(f)){let[g,m]=o.get(f);n.directiveToIndex.set(f.type,[d,g+n.directiveStart,m+n.directiveStart])}else(s===null||!s.has(f))&&n.directiveToIndex.set(f.type,d);f.contentQueries!==null&&(n.flags|=4),(f.hostBindings!==null||f.hostAttrs!==null||f.hostVars!==0)&&(n.flags|=64);let p=f.type.prototype;!l&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((t.preOrderHooks??=[]).push(n.index),l=!0),!u&&(p.ngOnChanges||p.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(n.index),u=!0),d++}_z(t,n,s)}function _z(t,e,n){for(let r=e.directiveStart;r<e.directiveEnd;r++){let i=t.data[r];if(n===null||!n.has(i))pO(0,e,i,r),pO(1,e,i,r),mO(e,r,!1);else{let s=n.get(i);gO(0,e,s,r),gO(1,e,s,r),mO(e,r,!0)}}}function pO(t,e,n,r){let i=t===0?n.inputs:n.outputs;for(let s in i)if(i.hasOwnProperty(s)){let o;t===0?o=e.inputs??={}:o=e.outputs??={},o[s]??=[],o[s].push(r),MP(e,s)}}function gO(t,e,n,r){let i=t===0?n.inputs:n.outputs;for(let s in i)if(i.hasOwnProperty(s)){let o=i[s],a;t===0?a=e.hostDirectiveInputs??={}:a=e.hostDirectiveOutputs??={},a[o]??=[],a[o].push(r,s),MP(e,o)}}function MP(t,e){e==="class"?t.flags|=8:e==="style"&&(t.flags|=16)}function mO(t,e,n){let{attrs:r,inputs:i,hostDirectiveInputs:s}=t;if(r===null||!n&&i===null||n&&s===null||LI(t)){t.initialInputs??=[],t.initialInputs.push(null);return}let o=null,a=0;for(;a<r.length;){let c=r[a];if(c===0){a+=4;continue}else if(c===5){a+=2;continue}else if(typeof c=="number")break;if(!n&&i.hasOwnProperty(c)){let l=i[c];for(let u of l)if(u===e){o??=[],o.push(c,r[a+1]);break}}else if(n&&s.hasOwnProperty(c)){let l=s[c];for(let u=0;u<l.length;u+=2)if(l[u]===e){o??=[],o.push(l[u+1],r[a+1]);break}}a+=2}t.initialInputs??=[],t.initialInputs.push(o)}function Tz(t,e,n,r,i){t.data[r]=i;let s=i.factory||(i.factory=Vo(i.type,!0)),o=new Vh(s,xc(i),Zo,null);t.blueprint[r]=o,n[r]=o,Dz(t,e,r,cP(t,n,i.hostVars,Ns),i)}function Dz(t,e,n,r,i){let s=i.hostBindings;if(s){let o=t.hostBindingOpCodes;o===null&&(o=t.hostBindingOpCodes=[]);let a=~e.index;Nz(o)!=a&&o.push(a),o.push(n,r,s)}}function Nz(t){let e=t.length;for(;e>0;){let n=t[--e];if(typeof n=="number"&&n<0)return n}return 0}function xz(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;xc(e)&&(n[""]=t)}}function Rz(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function kP(t,e,n,r,i,s,o,a){let c=e[De],l=c.consts,u=Ko(l,o),d=QI(c,t,n,r,u);return s&&Iz(c,e,d,Ko(l,a),i),d.mergedAttrs=NI(d.mergedAttrs,d.attrs),d.attrs!==null&&fO(d,d.attrs,!1),d.mergedAttrs!==null&&fO(d,d.mergedAttrs,!0),c.queries!==null&&c.queries.elementStart(c,d),d}function LP(t,e){Pq(t,e),FE(e)&&t.queries.elementEnd(e)}function Oz(t,e,n){return t[e]=n}function bu(t,e,n){if(n===Ns)return!1;let r=t[e];return Object.is(r,n)?!1:(t[e]=n,!0)}function FP(t,e,n,r){let i=bu(t,e,n);return bu(t,e+1,r)||i}function oI(t,e,n){return function r(i){let s=Go(t)?ki(t.index,e):e;WI(s,5);let o=e[Yt],a=yO(e,o,n,i),c=r.__ngNextListenerFn__;for(;c;)a=yO(e,o,c,i)&&a,c=c.__ngNextListenerFn__;return a}}function yO(t,e,n,r){let i=Ie(null);try{return St(6,e,n),n(r)!==!1}catch(s){return Z9(t,s),!1}finally{St(7,e,n),Ie(i)}}function Pz(t,e,n,r,i,s,o,a){let c=sm(t),l=!1,u=null;if(!r&&c&&(u=kz(e,n,s,t.index)),u!==null){let d=u.__ngLastListenerFn__||u;d.__ngNextListenerFn__=o,u.__ngLastListenerFn__=o,l=!0}else{let d=As(t,n),h=r?r(d):d;n9(n,h,s,a);let f=i.listen(h,s,a);if(!Mz(s)){let p=r?g=>r(fi(g[t.index])):t.index;BP(p,e,n,s,a,f,!1)}}return l}function Mz(t){return t.startsWith("animation")||t.startsWith("transition")}function kz(t,e,n,r){let i=t.cleanup;if(i!=null)for(let s=0;s<i.length-1;s+=2){let o=i[s];if(o===n&&i[s+1]===r){let a=e[uu],c=i[s+2];return a&&a.length>c?a[c]:null}typeof o=="string"&&(s+=2)}return null}function BP(t,e,n,r,i,s,o){let a=e.firstCreatePass?SR(e):null,c=AR(n),l=c.length;c.push(i,s),a&&a.push(r,t,l,(l+1)*(o?-1:1))}function wO(t,e,n,r,i,s){let o=e[n],a=e[De],l=a.data[n].outputs[r],d=o[l].subscribe(s);BP(t.index,a,e,i,s,d,!0)}var II=Symbol("BINDING");var Cm=class extends Wh{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let n=qo(e);return new Eu(n,this.ngModule)}};function Lz(t){return Object.keys(t).map(e=>{let[n,r,i]=t[e],s={propName:n,templateName:e,isSignal:(r&Bm.SignalBased)!==0};return i&&(s.transform=i),s})}function Fz(t){return Object.keys(t).map(e=>({propName:t[e],templateName:e}))}function Bz(t,e,n){let r=e instanceof Vn?e:e?.injector;return r&&t.getStandaloneInjector!==null&&(r=t.getStandaloneInjector(r)||r),r?new EI(n,r):n}function Uz(t){let e=t.get(kc,null);if(e===null)throw new me(407,!1);let n=t.get(PP,null),r=t.get(vc,null);return{rendererFactory:e,sanitizer:n,changeDetectionScheduler:r,ngReflect:!1}}function jz(t,e){let n=UP(t);return rP(e,n,n==="svg"?BE:n==="math"?wR:null)}function UP(t){return(t.selectors[0][0]||"div").toLowerCase()}var Eu=class extends Hm{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=Lz(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=Fz(this.componentDef.outputs),this.cachedOutputs}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=f9(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!n}create(e,n,r,i,s,o){St(22);let a=Ie(null);try{let c=this.componentDef,l=Vz(r,c,o,s),u=Bz(c,i||this.ngModule,e),d=Uz(u),h=d.rendererFactory.createRenderer(null,c),f=r?B9(h,r,c.encapsulation,u):jz(c,h),p=o?.some(vO)||s?.some(y=>typeof y!="function"&&y.bindings.some(vO)),g=BI(null,l,null,512|aP(c),null,null,d,h,u,null,ZO(f,u,!0));g[vn]=f,lm(g);let m=null;try{let y=kP(vn,g,2,"#host",()=>l.directiveRegistry,!0,0);oP(h,f,y),vu(f,g),mP(l,g,y),eP(l,y,g),LP(l,y),n!==void 0&&$z(y,this.ngContentSelectors,n),m=ki(y.index,g),g[Yt]=m[Yt],GI(l,g,null)}catch(y){throw m!==null&&fI(m),fI(g),y}finally{St(23),um()}return new Am(this.componentType,g,!!p)}finally{Ie(a)}}};function Vz(t,e,n,r){let i=t?["ng-version","21.0.0"]:p9(e.selectors[0]),s=null,o=null,a=0;if(n)for(let u of n)a+=u[II].requiredVars,u.create&&(u.targetIdx=0,(s??=[]).push(u)),u.update&&(u.targetIdx=0,(o??=[]).push(u));if(r)for(let u=0;u<r.length;u++){let d=r[u];if(typeof d!="function")for(let h of d.bindings){a+=h[II].requiredVars;let f=u+1;h.create&&(h.targetIdx=f,(s??=[]).push(h)),h.update&&(h.targetIdx=f,(o??=[]).push(h))}}let c=[e];if(r)for(let u of r){let d=typeof u=="function"?u:u.type,h=RE(d);c.push(h)}return FI(0,null,Hz(s,o),1,a,c,null,null,null,[i],null)}function Hz(t,e){return!t&&!e?null:n=>{if(n&1&&t)for(let r of t)r.create();if(n&2&&e)for(let r of e)r.update()}}function vO(t){let e=t[II].kind;return e==="input"||e==="twoWay"}var Am=class extends OP{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,n,r){super(),this._rootLView=n,this._hasInputBindings=r,this._tNode=Ph(n[De],vn),this.location=RI(this._tNode,n),this.instance=ki(this._tNode.index,n)[Yt],this.hostView=this.changeDetectorRef=new Mc(n,void 0),this.componentType=e}setInput(e,n){this._hasInputBindings;let r=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),n))return;let i=this._rootLView,s=zI(r,i[De],i,e,n);this.previousInputValues.set(e,n);let o=ki(r.index,i);WI(o,1)}get injector(){return new Oc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function $z(t,e,n){let r=t.projection=[];for(let i=0;i<e.length;i++){let s=n[i];r.push(s!=null&&s.length?Array.from(s):null)}}var Qh=(()=>{class t{static __NG_ELEMENT_ID__=qz}return t})();function qz(){let t=_s();return Gz(t,At())}var zz=Qh,jP=class extends zz{_lContainer;_hostTNode;_hostLView;constructor(e,n,r){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=r}get element(){return RI(this._hostTNode,this._hostLView)}get injector(){return new Oc(this._hostTNode,this._hostLView)}get parentInjector(){let e=xI(this._hostTNode,this._hostLView);if(OO(e)){let n=bm(e,this._hostLView),r=vm(e),i=n[De].data[r+8];return new Oc(i,n)}else return new Oc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let n=bO(this._lContainer);return n!==null&&n[e]||null}get length(){return this._lContainer.length-Jt}createEmbeddedView(e,n,r){let i,s;typeof r=="number"?i=r:r!=null&&(i=r.index,s=r.injector);let o=vI(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(n||{},s,o);return this.insertImpl(a,i,Hh(this._hostTNode,o)),a}createComponent(e,n,r,i,s,o,a){let c=e&&!Dq(e),l;if(c)l=n;else{let m=n||{};l=m.index,r=m.injector,i=m.projectableNodes,s=m.environmentInjector||m.ngModuleRef,o=m.directives,a=m.bindings}let u=c?e:new Eu(qo(e)),d=r||this.parentInjector;if(!s&&u.ngModule==null){let y=(c?d:this.parentInjector).get(Vn,null);y&&(s=y)}let h=qo(u.componentType??{}),f=vI(this._lContainer,h?.id??null),p=f?.firstChild??null,g=u.create(d,i,p,s,o,a);return this.insertImpl(g.hostView,l,Hh(this._hostTNode,f)),g}insert(e,n){return this.insertImpl(e,n,!0)}insertImpl(e,n,r){let i=e._lView;if(ER(i)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=i[yn],l=new jP(c,c[hi],c[yn]);l.detach(l.indexOf(e))}}let s=this._adjustIndex(n),o=this._lContainer;return Vm(o,i,s,r),e.attachToViewContainerRef(),TE(aI(o),s,e),e}move(e,n){return this.insert(e,n)}indexOf(e){let n=bO(this._lContainer);return n!==null?n.indexOf(e):-1}remove(e){let n=this._adjustIndex(e,-1),r=qh(this._lContainer,n);r&&(Th(aI(this._lContainer),n),Um(r[De],r))}detach(e){let n=this._adjustIndex(e,-1),r=qh(this._lContainer,n);return r&&Th(aI(this._lContainer),n)!=null?new Mc(r):null}_adjustIndex(e,n=0){return e??this.length+n}};function bO(t){return t[Rh]}function aI(t){return t[Rh]||(t[Rh]=[])}function Gz(t,e){let n,r=e[t.index];return Mi(r)?n=r:(n=TP(r,e,null,t),e[t.index]=n,UI(e,n)),Wz(n,e,t,r),new jP(n,t,e)}function Kz(t,e){let n=t[wn],r=n.createComment(""),i=As(e,t),s=n.parentNode(i);return Im(n,s,r,n.nextSibling(i),!1),r}var Wz=Jz,Qz=()=>!1;function Yz(t,e,n){return Qz(t,e,n)}function Jz(t,e,n,r){if(t[zo])return;let i;n.type&8?i=fi(r):i=Kz(e,n),t[zo]=i}var Lc=class{},$m=class{};var Sm=class extends Lc{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Cm(this);constructor(e,n,r,i=!0){super(),this.ngModuleType=e,this._parent=n;let s=xE(e);this._bootstrapComponents=tP(s.bootstrap),this._r3Injector=QE(e,n,[{provide:Lc,useValue:this},{provide:Wh,useValue:this.componentFactoryResolver},...r],jo(e),new Set(["environment"])),i&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},_m=class extends $m{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Sm(this.moduleType,e,[])}};var zh=class extends Lc{injector;componentFactoryResolver=new Cm(this);instance=null;constructor(e){super();let n=new wc([...e.providers,{provide:Lc,useValue:this},{provide:Wh,useValue:this.componentFactoryResolver}],e.parent||Nh(),e.debugName,new Set(["environment"]));this.injector=n,e.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function Yh(t,e,n=null){return new zh({providers:t,parent:e,debugName:n,runEnvironmentInitializers:!0}).injector}var Zz=(()=>{class t{_injector;cachedInjectors=new Map;constructor(n){this._injector=n}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){let r=OE(!1,n.type),i=r.length>0?Yh([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,i)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(let n of this.cachedInjectors.values())n!==null&&n.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ae({token:t,providedIn:"environment",factory:()=>new t(ke(Vn))})}return t})();function Jh(t){return Om(()=>{let e=VP(t),n=fe(H({},e),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===PI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:e.standalone?i=>i.get(Zz).getOrCreateStandaloneInjector(n):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||ji.Emulated,styles:t.styles||yc,_:null,schemas:t.schemas||null,tView:null,id:""});e.standalone&&Fc("NgStandalone"),HP(n);let r=t.dependencies;return n.directiveDefs=EO(r,Xz),n.pipeDefs=EO(r,uR),n.id=n7(n),n})}function Xz(t){return qo(t)||RE(t)}function e7(t,e){if(t==null)return Ic;let n={};for(let r in t)if(t.hasOwnProperty(r)){let i=t[r],s,o,a,c;Array.isArray(i)?(a=i[0],s=i[1],o=i[2]??s,c=i[3]||null):(s=i,o=i,a=Bm.None,c=null),n[s]=[r,a,c],e[s]=o}return n}function t7(t){if(t==null)return Ic;let e={};for(let n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function qm(t){return Om(()=>{let e=VP(t);return HP(e),e})}function zm(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function VP(t){let e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputConfig:t.inputs||Ic,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||yc,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:e7(t.inputs,e),outputs:t7(t.outputs),debugInfo:null}}function HP(t){t.features?.forEach(e=>e(t))}function EO(t,e){return t?()=>{let n=typeof t=="function"?t():t,r=[];for(let i of n){let s=e(i);s!==null&&r.push(s)}return r}:null}function n7(t){let e=0,n=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,n,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let s of r.join("|"))e=Math.imul(31,e)+s.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function r7(t,e,n,r,i,s,o,a){if(n.firstCreatePass){t.mergedAttrs=NI(t.mergedAttrs,t.attrs);let u=t.tView=FI(2,t,i,s,o,n.directiveRegistry,n.pipeRegistry,null,n.schemas,n.consts,null);n.queries!==null&&(n.queries.template(n,t),u.queries=n.queries.embeddedTView(t))}a&&(t.flags|=a),pu(t,!1);let c=i7(n,e,t,r);dm()&&$I(n,e,c,t),vu(c,e);let l=TP(c,e,c,t);e[r+vn]=l,UI(e,l),Yz(l,t,e)}function Tm(t,e,n,r,i,s,o,a,c,l,u){let d=n+vn,h;if(e.firstCreatePass){if(h=QI(e,d,4,o||null,a||null),l!=null){let f=Ko(e.consts,l);h.localNames=[];for(let p=0;p<f.length;p+=2)h.localNames.push(f[p],-1)}}else h=e.data[d];return r7(h,t,e,n,r,i,s,c),l!=null&&yP(t,h,u),h}var i7=s7;function s7(t,e,n,r){return hm(!0),e[wn].createComment("")}var YI=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var JI=new Ce("");function Iu(t){return!!t&&typeof t.then=="function"}function ZI(t){return!!t&&typeof t.subscribe=="function"}var $P=new Ce("");var XI=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r});appInits=re($P,{optional:!0})??[];injector=re(Oi);constructor(){}runInitializers(){if(this.initialized)return;let n=[];for(let i of this.appInits){let s=dr(this.injector,i);if(Iu(s))n.push(s);else if(ZI(s)){let o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});n.push(o)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(i=>{this.reject(i)}),n.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Gm=new Ce("");function qP(){j0(()=>{let t="";throw new me(600,t)})}function zP(t){return t.isBoundToModule}var o7=10;var Cu=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=re(Bi);afterRenderManager=re(uP);zonelessEnabled=re(Fh);rootEffectScheduler=re(pm);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new jn;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=re(Yo);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(jt(n=>!n))}constructor(){re(Kh,{optional:!0})}whenStable(){let n;return new Promise(r=>{n=this.isStable.subscribe({next:i=>{i&&r()}})}).finally(()=>{n.unsubscribe()})}_injector=re(Vn);_rendererFactory=null;get injector(){return this._injector}bootstrap(n,r){return this.bootstrapImpl(n,r)}bootstrapImpl(n,r,i=Oi.NULL){return this._injector.get(qr).run(()=>{St(10);let o=n instanceof Hm;if(!this._injector.get(XI).done){let p="";throw new me(405,p)}let c;o?c=n:c=this._injector.get(Wh).resolveComponentFactory(n),this.componentTypes.push(c.componentType);let l=zP(c)?void 0:this._injector.get(Lc),u=r||c.selector,d=c.create(i,[],u,l),h=d.location.nativeElement,f=d.injector.get(JI,null);return f?.registerApplication(h),d.onDestroy(()=>{this.detachView(d.hostView),jh(this.components,d),f?.unregisterApplication(h)}),this._loadComponent(d),St(11,d),d})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){St(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(VI.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new me(101,!1);let n=Ie(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Ie(n),this.afterTick.next(),St(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(kc,null,{optional:!0}));let n=0;for(;this.dirtyFlags!==0&&n++<o7;)St(14),this.synchronizeOnce(),St(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let n=!1;if(this.dirtyFlags&7){let r=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i}of this.allViews){if(!r&&!Mh(i))continue;let s=r&&!this.zonelessEnabled?0:1;CP(i,s),n=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}n||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:n})=>Mh(n))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(n){let r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){let r=n;jh(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView);try{this.tick()}catch(i){this.internalErrorHandler(i)}this.components.push(n),this._injector.get(Gm,[]).forEach(i=>i(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>jh(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new me(406,!1);let n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function jh(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}var hSe=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var CI=class{destroy(e){}updateValue(e,n){}swap(e,n){let r=Math.min(e,n),i=Math.max(e,n),s=this.detach(i);if(i-r>1){let o=this.detach(r);this.attach(r,s),this.attach(i,o)}else this.attach(r,s)}move(e,n){this.attach(n,this.detach(e))}};function cI(t,e,n,r,i){return t===n&&Object.is(e,r)?1:Object.is(i(t,e),i(n,r))?-1:0}function a7(t,e,n,r){let i,s,o=0,a=t.length-1,c=void 0;if(Array.isArray(e)){Ie(r);let l=e.length-1;for(Ie(null);o<=a&&o<=l;){let u=t.at(o),d=e[o],h=cI(o,u,o,d,n);if(h!==0){h<0&&t.updateValue(o,d),o++;continue}let f=t.at(a),p=e[l],g=cI(a,f,l,p,n);if(g!==0){g<0&&t.updateValue(a,p),a--,l--;continue}let m=n(o,u),y=n(a,f),E=n(o,d);if(Object.is(E,y)){let I=n(l,p);Object.is(I,m)?(t.swap(o,a),t.updateValue(a,p),l--,a--):t.move(a,o),t.updateValue(o,d),o++;continue}if(i??=new Dm,s??=CO(t,o,a,n),AI(t,i,o,E))t.updateValue(o,d),o++,a++;else if(s.has(E))i.set(m,t.detach(o)),a--;else{let I=t.create(o,e[o]);t.attach(o,I),o++,a++}}for(;o<=l;)IO(t,i,n,o,e[o]),o++}else if(e!=null){Ie(r);let l=e[Symbol.iterator]();Ie(null);let u=l.next();for(;!u.done&&o<=a;){let d=t.at(o),h=u.value,f=cI(o,d,o,h,n);if(f!==0)f<0&&t.updateValue(o,h),o++,u=l.next();else{i??=new Dm,s??=CO(t,o,a,n);let p=n(o,h);if(AI(t,i,o,p))t.updateValue(o,h),o++,a++,u=l.next();else if(!s.has(p))t.attach(o,t.create(o,h)),o++,a++,u=l.next();else{let g=n(o,d);i.set(g,t.detach(o)),a--}}}for(;!u.done;)IO(t,i,n,t.length,u.value),u=l.next()}for(;o<=a;)t.destroy(t.detach(a--));i?.forEach(l=>{t.destroy(l)})}function AI(t,e,n,r){return e!==void 0&&e.has(r)?(t.attach(n,e.get(r)),e.delete(r),!0):!1}function IO(t,e,n,r,i){if(AI(t,e,r,n(r,i)))t.updateValue(r,i);else{let s=t.create(r,i);t.attach(r,s)}}function CO(t,e,n,r){let i=new Set;for(let s=e;s<=n;s++)i.add(r(s,t.at(s)));return i}var Dm=class{kvMap=new Map;_vMap=void 0;has(e){return this.kvMap.has(e)}delete(e){if(!this.has(e))return!1;let n=this.kvMap.get(e);return this._vMap!==void 0&&this._vMap.has(n)?(this.kvMap.set(e,this._vMap.get(n)),this._vMap.delete(n)):this.kvMap.delete(e),!0}get(e){return this.kvMap.get(e)}set(e,n){if(this.kvMap.has(e)){let r=this.kvMap.get(e);this._vMap===void 0&&(this._vMap=new Map);let i=this._vMap;for(;i.has(r);)r=i.get(r);i.set(r,n)}else this.kvMap.set(e,n)}forEach(e){for(let[n,r]of this.kvMap)if(e(r,n),this._vMap!==void 0){let i=this._vMap;for(;i.has(r);)r=i.get(r),e(r,n)}}};function xs(t,e,n,r,i,s,o,a){Fc("NgControlFlow");let c=At(),l=Ss(),u=Ko(l.consts,s);return Tm(c,l,t,e,n,r,i,u,256,o,a),eC}function eC(t,e,n,r,i,s,o,a){Fc("NgControlFlow");let c=At(),l=Ss(),u=Ko(l.consts,s);return Tm(c,l,t,e,n,r,i,u,512,o,a),eC}function Rs(t,e){Fc("NgControlFlow");let n=At(),r=kh(),i=n[r]!==Ns?n[r]:-1,s=i!==-1?Nm(n,vn+i):void 0,o=0;if(bu(n,r,t)){let a=Ie(null);try{if(s!==void 0&&NP(s,o),t!==-1){let c=vn+t,l=Nm(n,c),u=DI(n[De],c),d=RP(l,u,n),h=KI(n,u,e,{dehydratedView:d});Vm(l,h,o,Hh(u,d))}}finally{Ie(a)}}else if(s!==void 0){let a=DP(s,o);a!==void 0&&(a[Yt]=e)}}var SI=class{lContainer;$implicit;$index;constructor(e,n,r){this.lContainer=e,this.$implicit=n,this.$index=r}get $count(){return this.lContainer.length-Jt}};function tC(t,e){return e}var _I=class{hasEmptyBlock;trackByFn;liveCollection;constructor(e,n,r){this.hasEmptyBlock=e,this.trackByFn=n,this.liveCollection=r}};function Au(t,e,n,r,i,s,o,a,c,l,u,d,h){Fc("NgControlFlow");let f=At(),p=Ss(),g=c!==void 0,m=At(),y=a?o.bind(m[zr][Yt]):o,E=new _I(g,y);m[vn+t]=E,Tm(f,p,t+1,e,n,r,i,Ko(p.consts,s),256),g&&Tm(f,p,t+2,c,l,u,d,Ko(p.consts,h),512)}var TI=class extends CI{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(e,n,r){super(),this.lContainer=e,this.hostLView=n,this.templateTNode=r}get length(){return this.lContainer.length-Jt}at(e){return this.getLView(e)[Yt].$implicit}attach(e,n){let r=n[lu];this.needsIndexUpdate||=e!==this.length,Vm(this.lContainer,n,e,Hh(this.templateTNode,r)),c7(this.lContainer,e)}detach(e){return this.needsIndexUpdate||=e!==this.length-1,l7(this.lContainer,e),u7(this.lContainer,e)}create(e,n){let r=vI(this.lContainer,this.templateTNode.tView.ssrId),i=KI(this.hostLView,this.templateTNode,new SI(this.lContainer,n,e),{dehydratedView:r});return this.operationsCounter?.recordCreate(),i}destroy(e){Um(e[De],e),this.operationsCounter?.recordDestroy()}updateValue(e,n){this.getLView(e)[Yt].$implicit=n}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let e=0;e<this.length;e++)this.getLView(e)[Yt].$index=e}getLView(e){return d7(this.lContainer,e)}};function Su(t){let e=Ie(null),n=gu();try{let r=At(),i=r[De],s=r[n],o=n+1,a=Nm(r,o);if(s.liveCollection===void 0){let l=DI(i,o);s.liveCollection=new TI(a,r,l)}else s.liveCollection.reset();let c=s.liveCollection;if(a7(c,t,s.trackByFn,e),c.updateIndexes(),s.hasEmptyBlock){let l=kh(),u=c.length===0;if(bu(r,l,u)){let d=n+2,h=Nm(r,d);if(u){let f=DI(i,d),p=RP(h,f,r),g=KI(r,f,void 0,{dehydratedView:p});Vm(h,g,0,Hh(f,p))}else i.firstUpdatePass&&wz(h),NP(h,0)}}}finally{Ie(e)}}function Nm(t,e){return t[e]}function c7(t,e){if(t.length<=Jt)return;let n=Jt+e,r=t[n],i=r?r[Nc]:void 0;if(r&&i&&i.detachedLeaveAnimationFns&&i.detachedLeaveAnimationFns.length>0){let s=r[eo];C9(s,i),Pc.delete(r),i.detachedLeaveAnimationFns=void 0}}function l7(t,e){if(t.length<=Jt)return;let n=Jt+e,r=t[n],i=r?r[Nc]:void 0;i&&i.leave&&i.leave.size>0&&(i.detachedLeaveAnimationFns=[])}function u7(t,e){return qh(t,e)}function d7(t,e){return DP(t,e)}function DI(t,e){return Ph(t,e)}function ro(t,e,n){let r=At(),i=kh();if(bu(r,i,e)){let s=Ss(),o=GR();H9(o,r,t,e,r[wn],n)}return ro}function AO(t,e,n,r,i){zI(e,t,n,i?"class":"style",r)}function Ee(t,e,n,r){let i=At(),s=i[De],o=t+vn,a=s.firstCreatePass?kP(o,i,2,e,W9,NR(),n,r):s.data[o];if(Y9(a,i,t,e,h7),sm(a)){let c=i[De];mP(c,i,a),eP(c,a,i)}return r!=null&&yP(i,a),Ee}function Te(){let t=Ss(),e=_s(),n=J9(e);return t.firstCreatePass&&LP(t,n),RR(n)&&OR(),DR(),n.classesWithoutHost!=null&&kq(n)&&AO(t,n,At(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&Lq(n)&&AO(t,n,At(),n.stylesWithoutHost,!1),Te}function Vi(t,e,n,r){return Ee(t,e,n,r),Te(),Vi}var h7=(t,e,n,r,i)=>(hm(!0),rP(e[wn],r,KR()));function Bc(){return At()}var Bh=void 0;function f7(t){let e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&n===0?1:5}var p7=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Bh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Bh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm\u202Fa","h:mm:ss\u202Fa","h:mm:ss\u202Fa z","h:mm:ss\u202Fa zzzz"],["{1}, {0}",Bh,Bh,Bh],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",f7],lI={};function Dr(t){let e=g7(t),n=SO(e);if(n)return n;let r=e.split("-")[0];if(n=SO(r),n)return n;if(r==="en")return p7;throw new me(701,!1)}function SO(t){return t in lI||(lI[t]=bc.ng&&bc.ng.common&&bc.ng.common.locales&&bc.ng.common.locales[t]),lI[t]}var zt=(function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t})(zt||{});function g7(t){return t.toLowerCase().replace(/_/g,"-")}var Zh="en-US";var m7=Zh;function GP(t){typeof t=="string"&&(m7=t.toLowerCase().replace(/_/g,"-"))}function Hi(t,e,n){let r=At(),i=Ss(),s=_s();return y7(i,r,r[wn],s,t,e,n),Hi}function y7(t,e,n,r,i,s,o){let a=!0,c=null;if((r.type&3||o)&&(c??=oI(r,e,s),Pz(r,t,e,o,n,i,s,c)&&(a=!1)),a){let l=r.outputs?.[i],u=r.hostDirectiveOutputs?.[i];if(u&&u.length)for(let d=0;d<u.length;d+=2){let h=u[d],f=u[d+1];c??=oI(r,e,s),wO(r,e,h,f,i,c)}if(l&&l.length)for(let d of l)c??=oI(r,e,s),wO(r,e,d,i,i,c)}}function an(t=1){return zR(t)}function Ye(t,e=""){let n=At(),r=Ss(),i=t+vn,s=r.firstCreatePass?QI(r,i,1,e,null):r.data[i],o=w7(r,n,s,e,t);n[i]=o,dm()&&$I(r,n,o,s),pu(s,!1)}var w7=(t,e,n,r,i)=>(hm(!0),g9(e[wn],r));function v7(t,e,n,r=""){return bu(t,kh(),n)?e+_h(n)+r:Ns}function b7(t,e,n,r,i,s=""){let o=LR(),a=FP(t,o,n,i);return BR(2),a?e+_h(n)+r+_h(i)+s:Ns}function Os(t){return Nr("",t),Os}function Nr(t,e,n){let r=At(),i=v7(r,t,e,n);return i!==Ns&&KP(r,gu(),i),Nr}function Km(t,e,n,r,i){let s=At(),o=b7(s,t,e,n,r,i);return o!==Ns&&KP(s,gu(),o),Km}function KP(t,e,n){let r=vR(e,t);m9(t[wn],r,n)}function E7(t,e){let n=t[e];return n===Ns?void 0:n}function I7(t,e,n,r,i,s,o){let a=e+n;return FP(t,a,i,s)?Oz(t,a+2,o?r.call(o,i,s):r(i,s)):E7(t,a+2)}function $i(t,e){let n=Ss(),r,i=t+vn;n.firstCreatePass?(r=C7(e,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks??=[]).push(i,r.onDestroy)):r=n.data[i];let s=r.factory||(r.factory=Vo(r.type,!0)),o,a=lr(Zo);try{let c=Em(!1),l=s();return Em(c),UE(n,At(),i,l),l}finally{lr(a)}}function C7(t,e){if(e)for(let n=e.length-1;n>=0;n--){let r=e[n];if(t===r.name)return r}}function qi(t,e,n,r){let i=t+vn,s=At(),o=bR(s,i);return A7(s,i)?I7(s,kR(),e,o.transform,n,r,o):o.transform(n,r)}function A7(t,e){return t[De].data[e].pure}var xm=class{ngModuleFactory;componentFactories;constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}},nC=(()=>{class t{compileModuleSync(n){return new _m(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){let r=this.compileModuleSync(n),i=xE(n),s=tP(i.declarations).reduce((o,a)=>{let c=qo(a);return c&&o.push(new Eu(c)),o},[]);return new xm(r,s)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var WP=(()=>{class t{applicationErrorHandler=re(Bi);appRef=re(Cu);taskService=re(Yo);ngZone=re(qr);zonelessEnabled=re(Fh);tracing=re(Kh,{optional:!0});zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Dn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ch):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(re(tI,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()}))}notify(n){if(!this.zonelessEnabled&&n===5)return;switch(n){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2;break}case 12:{this.appRef.dirtyFlags|=16;break}case 13:{this.appRef.dirtyFlags|=2;break}case 11:break;case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick())return;let r=this.useMicrotaskScheduler?JE:YE;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(){return!(this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ch+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let n=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){this.taskService.remove(n),this.applicationErrorHandler(r)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,JE(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(n)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function QP(){return[{provide:vc,useExisting:WP},{provide:qr,useClass:Ah},{provide:Fh,useValue:!0}]}function S7(){return typeof $localize<"u"&&$localize.locale||Zh}var _u=new Ce("",{factory:()=>re(_u,{optional:!0,skipSelf:!0})||S7()});var JP=Symbol("InputSignalNode#UNSET"),H7=fe(H({},Sg),{transformFn:void 0,applyValueToInputSignal(t,e){hh(t,e)}});function ZP(t,e){let n=Object.create(H7);n.value=t,n.transformFn=e?.transform;function r(){if(Cg(n),n.value===JP){let i=null;throw new me(-950,i)}return n.value}return r[ui]=n,r}function YP(t,e){return ZP(t,e)}function $7(t){return ZP(JP,t)}var XP=(YP.required=$7,YP);var rC=new Ce(""),q7=new Ce("");function Xh(t){return!t.moduleRef}function z7(t){let e=Xh(t)?t.r3Injector:t.moduleRef.injector,n=e.get(qr);return n.run(()=>{Xh(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=e.get(Bi),i;if(n.runOutsideAngular(()=>{i=n.onError.subscribe({next:r})}),Xh(t)){let s=()=>e.destroy(),o=t.platformInjector.get(rC);o.add(s),e.onDestroy(()=>{i.unsubscribe(),o.delete(s)})}else{let s=()=>t.moduleRef.destroy(),o=t.platformInjector.get(rC);o.add(s),t.moduleRef.onDestroy(()=>{jh(t.allPlatformModules,t.moduleRef),i.unsubscribe(),o.delete(s)})}return K7(r,n,()=>{let s=e.get(Yo),o=s.add(),a=e.get(XI);return a.runInitializers(),a.donePromise.then(()=>{let c=e.get(_u,Zh);if(GP(c||Zh),!e.get(q7,!0))return Xh(t)?e.get(Cu):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(Xh(t)){let u=e.get(Cu);return t.rootComponent!==void 0&&u.bootstrap(t.rootComponent),u}else return G7?.(t.moduleRef,t.allPlatformModules),t.moduleRef}).finally(()=>void s.remove(o))})})}var G7;function K7(t,e,n){try{let r=n();return Iu(r)?r.catch(i=>{throw e.runOutsideAngular(()=>t(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>t(r)),r}}var Wm=null;function W7(t=[],e){return Oi.create({name:e,providers:[{provide:Dh,useValue:"platform"},{provide:rC,useValue:new Set([()=>Wm=null])},...t]})}function Q7(t=[]){if(Wm)return Wm;let e=W7(t);return Wm=e,qP(),Y7(e),e}function Y7(t){let e=t.get(Lm,null);dr(t,()=>{e?.forEach(n=>n())})}var sC=(()=>{class t{static __NG_ELEMENT_ID__=J7}return t})();function J7(t){return Z7(_s(),At(),(t&16)===16)}function Z7(t,e,n){if(Go(t)&&!n){let r=ki(t.index,e);return new Mc(r,r)}else if(t.type&175){let r=e[zr];return new Mc(r,e)}return null}function eM(t){let{rootComponent:e,appProviders:n,platformProviders:r,platformRef:i}=t;St(8);try{let s=i?.injector??Q7(r),o=[QP(),JR,...n||[]],a=new zh({providers:o,parent:s,debugName:"",runEnvironmentInitializers:!1});return z7({r3Injector:a.injector,platformInjector:s,rootComponent:e})}catch(s){return Promise.reject(s)}finally{St(9)}}var rM=null;function so(){return rM}function oC(t){rM??=t}var ef=class{},aC=(()=>{class t{historyGo(n){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(iM),providedIn:"platform"})}return t})();var iM=(()=>{class t extends aC{_location;_history;_doc=re(Hn);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return so().getBaseHref(this._doc)}onPopState(n){let r=so().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){let r=so().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,i){this._history.pushState(n,r,i)}replaceState(n,r,i){this._history.replaceState(n,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function sM(t,e){return t?e?t.endsWith("/")?e.startsWith("/")?t+e.slice(1):t+e:e.startsWith("/")?t+e:`${t}/${e}`:t:e}function tM(t){let e=t.search(/#|\?|$/);return t[e-1]==="/"?t.slice(0,e-1)+t.slice(e):t}function Xo(t){return t&&t[0]!=="?"?`?${t}`:t}var Qm=(()=>{class t{historyGo(n){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(aM),providedIn:"root"})}return t})(),oM=new Ce(""),aM=(()=>{class t extends Qm{_platformLocation;_baseHref;_removeListenerFns=[];constructor(n,r){super(),this._platformLocation=n,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??re(Hn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return sM(this._baseHref,n)}path(n=!1){let r=this._platformLocation.pathname+Xo(this._platformLocation.search),i=this._platformLocation.hash;return i&&n?`${r}${i}`:r}pushState(n,r,i,s){let o=this.prepareExternalUrl(i+Xo(s));this._platformLocation.pushState(n,r,o)}replaceState(n,r,i,s){let o=this.prepareExternalUrl(i+Xo(s));this._platformLocation.replaceState(n,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static \u0275fac=function(r){return new(r||t)(ke(aC),ke(oM,8))};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Tu=(()=>{class t{_subject=new jn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(n){this._locationStrategy=n;let r=this._locationStrategy.getBaseHref();this._basePath=tG(tM(nM(r))),this._locationStrategy.onPopState(i=>{this._subject.next({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Xo(r))}normalize(n){return t.stripTrailingSlash(eG(this._basePath,nM(n)))}prepareExternalUrl(n){return n&&n[0]!=="/"&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",i=null){this._locationStrategy.pushState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Xo(r)),i)}replaceState(n,r="",i=null){this._locationStrategy.replaceState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Xo(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(i=>i(n,r))}subscribe(n,r,i){return this._subject.subscribe({next:n,error:r??void 0,complete:i??void 0})}static normalizeQueryParams=Xo;static joinWithSlash=sM;static stripTrailingSlash=tM;static \u0275fac=function(r){return new(r||t)(ke(Qm))};static \u0275prov=Ae({token:t,factory:()=>X7(),providedIn:"root"})}return t})();function X7(){return new Tu(ke(Qm))}function eG(t,e){if(!t||!e.startsWith(t))return e;let n=e.substring(t.length);return n===""||["/",";","?","#"].includes(n[0])?n:e}function nM(t){return t.replace(/\/index.html$/,"")}function tG(t){if(new RegExp("^(https?:)?//").test(t)){let[,n]=t.split(/\/\/[^\/]+/);return n}return t}var fC=(function(t){return t[t.Decimal=0]="Decimal",t[t.Percent=1]="Percent",t[t.Currency=2]="Currency",t[t.Scientific=3]="Scientific",t})(fC||{});var $n=(function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t})($n||{}),It=(function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t})(It||{}),xr=(function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t})(xr||{}),Rr={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function uM(t){return Dr(t)[zt.LocaleId]}function dM(t,e,n){let r=Dr(t),i=[r[zt.DayPeriodsFormat],r[zt.DayPeriodsStandalone]],s=pi(i,e);return pi(s,n)}function hM(t,e,n){let r=Dr(t),i=[r[zt.DaysFormat],r[zt.DaysStandalone]],s=pi(i,e);return pi(s,n)}function fM(t,e,n){let r=Dr(t),i=[r[zt.MonthsFormat],r[zt.MonthsStandalone]],s=pi(i,e);return pi(s,n)}function pM(t,e){let r=Dr(t)[zt.Eras];return pi(r,e)}function tf(t,e){let n=Dr(t);return pi(n[zt.DateFormat],e)}function nf(t,e){let n=Dr(t);return pi(n[zt.TimeFormat],e)}function rf(t,e){let r=Dr(t)[zt.DateTimeFormat];return pi(r,e)}function Ps(t,e){let n=Dr(t),r=n[zt.NumberSymbols][e];if(typeof r>"u"){if(e===Rr.CurrencyDecimal)return n[zt.NumberSymbols][Rr.Decimal];if(e===Rr.CurrencyGroup)return n[zt.NumberSymbols][Rr.Group]}return r}function gM(t,e){return Dr(t)[zt.NumberFormats][e]}function mM(t){if(!t[zt.ExtraData])throw new me(2303,!1)}function yM(t){let e=Dr(t);return mM(e),(e[zt.ExtraData][2]||[]).map(r=>typeof r=="string"?cC(r):[cC(r[0]),cC(r[1])])}function wM(t,e,n){let r=Dr(t);mM(r);let i=[r[zt.ExtraData][0],r[zt.ExtraData][1]],s=pi(i,e)||[];return pi(s,n)||[]}function pi(t,e){for(let n=e;n>-1;n--)if(typeof t[n]<"u")return t[n];throw new me(2304,!1)}function cC(t){let[e,n]=t.split(":");return{hours:+e,minutes:+n}}var nG=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Ym={},rG=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function vM(t,e,n,r){let i=hG(t);e=oo(n,e)||e;let o=[],a;for(;e;)if(a=rG.exec(e),a){o=o.concat(a.slice(1));let u=o.pop();if(!u)break;e=u}else{o.push(e);break}let c=i.getTimezoneOffset();r&&(c=EM(r,c),i=dG(i,r));let l="";return o.forEach(u=>{let d=lG(u);l+=d?d(i,n,c):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),l}function ty(t,e,n){let r=new Date(0);return r.setFullYear(t,e,n),r.setHours(0,0,0),r}function oo(t,e){let n=uM(t);if(Ym[n]??={},Ym[n][e])return Ym[n][e];let r="";switch(e){case"shortDate":r=tf(t,xr.Short);break;case"mediumDate":r=tf(t,xr.Medium);break;case"longDate":r=tf(t,xr.Long);break;case"fullDate":r=tf(t,xr.Full);break;case"shortTime":r=nf(t,xr.Short);break;case"mediumTime":r=nf(t,xr.Medium);break;case"longTime":r=nf(t,xr.Long);break;case"fullTime":r=nf(t,xr.Full);break;case"short":let i=oo(t,"shortTime"),s=oo(t,"shortDate");r=Jm(rf(t,xr.Short),[i,s]);break;case"medium":let o=oo(t,"mediumTime"),a=oo(t,"mediumDate");r=Jm(rf(t,xr.Medium),[o,a]);break;case"long":let c=oo(t,"longTime"),l=oo(t,"longDate");r=Jm(rf(t,xr.Long),[c,l]);break;case"full":let u=oo(t,"fullTime"),d=oo(t,"fullDate");r=Jm(rf(t,xr.Full),[u,d]);break}return r&&(Ym[n][e]=r),r}function Jm(t,e){return e&&(t=t.replace(/\{([^}]+)}/g,function(n,r){return e!=null&&r in e?e[r]:n})),t}function zi(t,e,n="-",r,i){let s="";(t<0||i&&t<=0)&&(i?t=-t+1:(t=-t,s=n));let o=String(t);for(;o.length<e;)o="0"+o;return r&&(o=o.slice(o.length-e)),s+o}function iG(t,e){return zi(t,3).substring(0,e)}function Xt(t,e,n=0,r=!1,i=!1){return function(s,o){let a=sG(t,s);if((n>0||a>-n)&&(a+=n),t===3)a===0&&n===-12&&(a=12);else if(t===6)return iG(a,e);let c=Ps(o,Rr.MinusSign);return zi(a,e,c,r,i)}}function sG(t,e){switch(t){case 0:return e.getFullYear();case 1:return e.getMonth();case 2:return e.getDate();case 3:return e.getHours();case 4:return e.getMinutes();case 5:return e.getSeconds();case 6:return e.getMilliseconds();case 7:return e.getDay();default:throw new me(2301,!1)}}function Pt(t,e,n=$n.Format,r=!1){return function(i,s){return oG(i,s,t,e,n,r)}}function oG(t,e,n,r,i,s){switch(n){case 2:return fM(e,i,r)[t.getMonth()];case 1:return hM(e,i,r)[t.getDay()];case 0:let o=t.getHours(),a=t.getMinutes();if(s){let l=yM(e),u=wM(e,i,r),d=l.findIndex(h=>{if(Array.isArray(h)){let[f,p]=h,g=o>=f.hours&&a>=f.minutes,m=o<p.hours||o===p.hours&&a<p.minutes;if(f.hours<p.hours){if(g&&m)return!0}else if(g||m)return!0}else if(h.hours===o&&h.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return dM(e,i,r)[o<12?0:1];case 3:return pM(e,r)[t.getFullYear()<=0?0:1];default:let c=n;throw new me(2302,!1)}}function Zm(t){return function(e,n,r){let i=-1*r,s=Ps(n,Rr.MinusSign),o=i>0?Math.floor(i/60):Math.ceil(i/60);switch(t){case 0:return(i>=0?"+":"")+zi(o,2,s)+zi(Math.abs(i%60),2,s);case 1:return"GMT"+(i>=0?"+":"")+zi(o,1,s);case 2:return"GMT"+(i>=0?"+":"")+zi(o,2,s)+":"+zi(Math.abs(i%60),2,s);case 3:return r===0?"Z":(i>=0?"+":"")+zi(o,2,s)+":"+zi(Math.abs(i%60),2,s);default:throw new me(2310,!1)}}}var aG=0,ey=4;function cG(t){let e=ty(t,aG,1).getDay();return ty(t,0,1+(e<=ey?ey:ey+7)-e)}function bM(t){let e=t.getDay(),n=e===0?-3:ey-e;return ty(t.getFullYear(),t.getMonth(),t.getDate()+n)}function lC(t,e=!1){return function(n,r){let i;if(e){let s=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,o=n.getDate();i=1+Math.floor((o+s)/7)}else{let s=bM(n),o=cG(s.getFullYear()),a=s.getTime()-o.getTime();i=1+Math.round(a/6048e5)}return zi(i,t,Ps(r,Rr.MinusSign))}}function Xm(t,e=!1){return function(n,r){let s=bM(n).getFullYear();return zi(s,t,Ps(r,Rr.MinusSign),e)}}var uC={};function lG(t){if(uC[t])return uC[t];let e;switch(t){case"G":case"GG":case"GGG":e=Pt(3,It.Abbreviated);break;case"GGGG":e=Pt(3,It.Wide);break;case"GGGGG":e=Pt(3,It.Narrow);break;case"y":e=Xt(0,1,0,!1,!0);break;case"yy":e=Xt(0,2,0,!0,!0);break;case"yyy":e=Xt(0,3,0,!1,!0);break;case"yyyy":e=Xt(0,4,0,!1,!0);break;case"Y":e=Xm(1);break;case"YY":e=Xm(2,!0);break;case"YYY":e=Xm(3);break;case"YYYY":e=Xm(4);break;case"M":case"L":e=Xt(1,1,1);break;case"MM":case"LL":e=Xt(1,2,1);break;case"MMM":e=Pt(2,It.Abbreviated);break;case"MMMM":e=Pt(2,It.Wide);break;case"MMMMM":e=Pt(2,It.Narrow);break;case"LLL":e=Pt(2,It.Abbreviated,$n.Standalone);break;case"LLLL":e=Pt(2,It.Wide,$n.Standalone);break;case"LLLLL":e=Pt(2,It.Narrow,$n.Standalone);break;case"w":e=lC(1);break;case"ww":e=lC(2);break;case"W":e=lC(1,!0);break;case"d":e=Xt(2,1);break;case"dd":e=Xt(2,2);break;case"c":case"cc":e=Xt(7,1);break;case"ccc":e=Pt(1,It.Abbreviated,$n.Standalone);break;case"cccc":e=Pt(1,It.Wide,$n.Standalone);break;case"ccccc":e=Pt(1,It.Narrow,$n.Standalone);break;case"cccccc":e=Pt(1,It.Short,$n.Standalone);break;case"E":case"EE":case"EEE":e=Pt(1,It.Abbreviated);break;case"EEEE":e=Pt(1,It.Wide);break;case"EEEEE":e=Pt(1,It.Narrow);break;case"EEEEEE":e=Pt(1,It.Short);break;case"a":case"aa":case"aaa":e=Pt(0,It.Abbreviated);break;case"aaaa":e=Pt(0,It.Wide);break;case"aaaaa":e=Pt(0,It.Narrow);break;case"b":case"bb":case"bbb":e=Pt(0,It.Abbreviated,$n.Standalone,!0);break;case"bbbb":e=Pt(0,It.Wide,$n.Standalone,!0);break;case"bbbbb":e=Pt(0,It.Narrow,$n.Standalone,!0);break;case"B":case"BB":case"BBB":e=Pt(0,It.Abbreviated,$n.Format,!0);break;case"BBBB":e=Pt(0,It.Wide,$n.Format,!0);break;case"BBBBB":e=Pt(0,It.Narrow,$n.Format,!0);break;case"h":e=Xt(3,1,-12);break;case"hh":e=Xt(3,2,-12);break;case"H":e=Xt(3,1);break;case"HH":e=Xt(3,2);break;case"m":e=Xt(4,1);break;case"mm":e=Xt(4,2);break;case"s":e=Xt(5,1);break;case"ss":e=Xt(5,2);break;case"S":e=Xt(6,1);break;case"SS":e=Xt(6,2);break;case"SSS":e=Xt(6,3);break;case"Z":case"ZZ":case"ZZZ":e=Zm(0);break;case"ZZZZZ":e=Zm(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=Zm(1);break;case"OOOO":case"ZZZZ":case"zzzz":e=Zm(2);break;default:return null}return uC[t]=e,e}function EM(t,e){t=t.replace(/:/g,"");let n=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(n)?e:n}function uG(t,e){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+e),t}function dG(t,e,n){let i=t.getTimezoneOffset(),s=EM(e,i);return uG(t,-1*(s-i))}function hG(t){if(cM(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[i,s=1,o=1]=t.split("-").map(a=>+a);return ty(i,s-1,o)}let n=parseFloat(t);if(!isNaN(t-n))return new Date(n);let r;if(r=t.match(nG))return fG(r)}let e=new Date(t);if(!cM(e))throw new me(2311,!1);return e}function fG(t){let e=new Date(0),n=0,r=0,i=t[8]?e.setUTCFullYear:e.setFullYear,s=t[8]?e.setUTCHours:e.setHours;t[9]&&(n=Number(t[9]+t[10]),r=Number(t[9]+t[11])),i.call(e,Number(t[1]),Number(t[2])-1,Number(t[3]));let o=Number(t[4]||0)-n,a=Number(t[5]||0)-r,c=Number(t[6]||0),l=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return s.call(e,o,a,c,l),e}function cM(t){return t instanceof Date&&!isNaN(t.valueOf())}var pG=/^(\d+)?\.((\d+)(-(\d+))?)?$/,lM=22,ny=".",sf="0",gG=";",mG=",",dC="#";function yG(t,e,n,r,i,s,o=!1){let a="",c=!1;if(!isFinite(t))a=Ps(n,Rr.Infinity);else{let l=bG(t);o&&(l=vG(l));let u=e.minInt,d=e.minFrac,h=e.maxFrac;if(s){let E=s.match(pG);if(E===null)throw new me(2306,!1);let I=E[1],L=E[3],k=E[5];I!=null&&(u=hC(I)),L!=null&&(d=hC(L)),k!=null?h=hC(k):L!=null&&d>h&&(h=d)}EG(l,d,h);let f=l.digits,p=l.integerLen,g=l.exponent,m=[];for(c=f.every(E=>!E);p<u;p++)f.unshift(0);for(;p<0;p++)f.unshift(0);p>0?m=f.splice(p,f.length):(m=f,f=[0]);let y=[];for(f.length>=e.lgSize&&y.unshift(f.splice(-e.lgSize,f.length).join(""));f.length>e.gSize;)y.unshift(f.splice(-e.gSize,f.length).join(""));f.length&&y.unshift(f.join("")),a=y.join(Ps(n,r)),m.length&&(a+=Ps(n,i)+m.join("")),g&&(a+=Ps(n,Rr.Exponential)+"+"+g)}return t<0&&!c?a=e.negPre+a+e.negSuf:a=e.posPre+a+e.posSuf,a}function IM(t,e,n){let r=gM(e,fC.Decimal),i=wG(r,Ps(e,Rr.MinusSign));return yG(t,i,e,Rr.Group,Rr.Decimal,n)}function wG(t,e="-"){let n={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},r=t.split(gG),i=r[0],s=r[1],o=i.indexOf(ny)!==-1?i.split(ny):[i.substring(0,i.lastIndexOf(sf)+1),i.substring(i.lastIndexOf(sf)+1)],a=o[0],c=o[1]||"";n.posPre=a.substring(0,a.indexOf(dC));for(let u=0;u<c.length;u++){let d=c.charAt(u);d===sf?n.minFrac=n.maxFrac=u+1:d===dC?n.maxFrac=u+1:n.posSuf+=d}let l=a.split(mG);if(n.gSize=l[1]?l[1].length:0,n.lgSize=l[2]||l[1]?(l[2]||l[1]).length:0,s){let u=i.length-n.posPre.length-n.posSuf.length,d=s.indexOf(dC);n.negPre=s.substring(0,d).replace(/'/g,""),n.negSuf=s.slice(d+u).replace(/'/g,"")}else n.negPre=e+n.posPre,n.negSuf=n.posSuf;return n}function vG(t){if(t.digits[0]===0)return t;let e=t.digits.length-t.integerLen;return t.exponent?t.exponent+=2:(e===0?t.digits.push(0,0):e===1&&t.digits.push(0),t.integerLen+=2),t}function bG(t){let e=Math.abs(t)+"",n=0,r,i,s,o,a;for((i=e.indexOf(ny))>-1&&(e=e.replace(ny,"")),(s=e.search(/e/i))>0?(i<0&&(i=s),i+=+e.slice(s+1),e=e.substring(0,s)):i<0&&(i=e.length),s=0;e.charAt(s)===sf;s++);if(s===(a=e.length))r=[0],i=1;else{for(a--;e.charAt(a)===sf;)a--;for(i-=s,r=[],o=0;s<=a;s++,o++)r[o]=Number(e.charAt(s))}return i>lM&&(r=r.splice(0,lM-1),n=i-1,i=1),{digits:r,exponent:n,integerLen:i}}function EG(t,e,n){if(e>n)throw new me(2307,!1);let r=t.digits,i=r.length-t.integerLen,s=Math.min(Math.max(e,i),n),o=s+t.integerLen,a=r[o];if(o>0){r.splice(Math.max(t.integerLen,o));for(let d=o;d<r.length;d++)r[d]=0}else{i=Math.max(0,i),t.integerLen=1,r.length=Math.max(1,o=s+1),r[0]=0;for(let d=1;d<o;d++)r[d]=0}if(a>=5)if(o-1<0){for(let d=0;d>o;d--)r.unshift(0),t.integerLen++;r.unshift(1),t.integerLen++}else r[o-1]++;for(;i<Math.max(0,s);i++)r.push(0);let c=s!==0,l=e+t.integerLen,u=r.reduceRight(function(d,h,f,p){return h=h+d,p[f]=h<10?h:h-10,c&&(p[f]===0&&f>=l?p.pop():c=!1),h>=10?1:0},0);u&&(r.unshift(u),t.integerLen++)}function hC(t){let e=parseInt(t);if(isNaN(e))throw new me(2305,!1);return e}function CM(t,e){return new me(2100,!1)}var IG="mediumDate",AM=new Ce(""),SM=new Ce(""),pC=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(n,r,i){this.locale=n,this.defaultTimezone=r,this.defaultOptions=i}transform(n,r,i,s){if(n==null||n===""||n!==n)return null;try{let o=r??this.defaultOptions?.dateFormat??IG,a=i??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return vM(n,o,s||this.locale,a)}catch(o){throw CM(t,o.message)}}static \u0275fac=function(r){return new(r||t)(Zo(_u,16),Zo(AM,24),Zo(SM,24))};static \u0275pipe=zm({name:"date",type:t,pure:!0})}return t})();var gC=(()=>{class t{_locale;constructor(n){this._locale=n}transform(n,r,i){if(!CG(n))return null;i||=this._locale;try{let s=AG(n);return IM(s,i,r)}catch(s){throw CM(t,s.message)}}static \u0275fac=function(r){return new(r||t)(Zo(_u,16))};static \u0275pipe=zm({name:"number",type:t,pure:!0})}return t})();function CG(t){return!(t==null||t===""||t!==t)}function AG(t){if(typeof t=="string"&&!isNaN(Number(t)-parseFloat(t)))return Number(t);if(typeof t!="number")throw new me(2309,!1);return t}function mC(t,e){e=encodeURIComponent(e);for(let n of t.split(";")){let r=n.indexOf("="),[i,s]=r==-1?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}var of=class{};var _M="browser";var af=class{_doc;constructor(e){this._doc=e}manager},ry=(()=>{class t extends af{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,i,s){return n.addEventListener(r,i,s),()=>this.removeEventListener(n,r,i,s)}removeEventListener(n,r,i,s){return n.removeEventListener(r,i,s)}static \u0275fac=function(r){return new(r||t)(ke(Hn))};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})(),oy=new Ce(""),bC=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(n,r){this._zone=r,n.forEach(o=>{o.manager=this});let i=n.filter(o=>!(o instanceof ry));this._plugins=i.slice().reverse();let s=n.find(o=>o instanceof ry);s&&this._plugins.push(s)}addEventListener(n,r,i,s){return this._findPluginFor(r).addEventListener(n,r,i,s)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(s=>s.supports(n)),!r)throw new me(5101,!1);return this._eventNameToPlugin.set(n,r),r}static \u0275fac=function(r){return new(r||t)(ke(oy),ke(qr))};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})(),yC="ng-app-id";function TM(t){for(let e of t)e.remove()}function DM(t,e){let n=e.createElement("style");return n.textContent=t,n}function TG(t,e,n,r){let i=t.head?.querySelectorAll(`style[${yC}="${e}"],link[${yC}="${e}"]`);if(i)for(let s of i)s.removeAttribute(yC),s instanceof HTMLLinkElement?r.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&n.set(s.textContent,{usage:0,elements:[s]})}function vC(t,e){let n=e.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",t),n}var EC=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(n,r,i,s={}){this.doc=n,this.appId=r,this.nonce=i,TG(n,r,this.inline,this.external),this.hosts.add(n.head)}addStyles(n,r){for(let i of n)this.addUsage(i,this.inline,DM);r?.forEach(i=>this.addUsage(i,this.external,vC))}removeStyles(n,r){for(let i of n)this.removeUsage(i,this.inline);r?.forEach(i=>this.removeUsage(i,this.external))}addUsage(n,r,i){let s=r.get(n);s?s.usage++:r.set(n,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,i(n,this.doc)))})}removeUsage(n,r){let i=r.get(n);i&&(i.usage--,i.usage<=0&&(TM(i.elements),r.delete(n)))}ngOnDestroy(){for(let[,{elements:n}]of[...this.inline,...this.external])TM(n);this.hosts.clear()}addHost(n){this.hosts.add(n);for(let[r,{elements:i}]of this.inline)i.push(this.addElement(n,DM(r,this.doc)));for(let[r,{elements:i}]of this.external)i.push(this.addElement(n,vC(r,this.doc)))}removeHost(n){this.hosts.delete(n)}addElement(n,r){return this.nonce&&r.setAttribute("nonce",this.nonce),n.appendChild(r)}static \u0275fac=function(r){return new(r||t)(ke(Hn),ke(km),ke(Fm,8),ke(Gh))};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})(),wC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},IC=/%COMP%/g;var xM="%COMP%",DG=`_nghost-${xM}`,NG=`_ngcontent-${xM}`,xG=!0,RG=new Ce("",{factory:()=>xG});function OG(t){return NG.replace(IC,t)}function PG(t){return DG.replace(IC,t)}function RM(t,e){return e.map(n=>n.replace(IC,t))}var CC=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(n,r,i,s,o,a,c=null,l=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=s,this.doc=o,this.ngZone=a,this.nonce=c,this.tracingService=l,this.platformIsServer=!1,this.defaultRenderer=new cf(n,o,a,this.platformIsServer,this.tracingService)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;let i=this.getOrCreateRenderer(n,r);return i instanceof sy?i.applyToHost(n):i instanceof lf&&i.applyStyles(),i}getOrCreateRenderer(n,r){let i=this.rendererByCompId,s=i.get(r.id);if(!s){let o=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,h=this.tracingService;switch(r.encapsulation){case ji.Emulated:s=new sy(c,l,r,this.appId,u,o,a,d,h);break;case ji.ShadowDom:return new iy(c,n,r,o,a,this.nonce,d,h,l);case ji.ExperimentalIsolatedShadowDom:return new iy(c,n,r,o,a,this.nonce,d,h);default:s=new lf(c,l,r,u,o,a,d,h);break}i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(n){this.rendererByCompId.delete(n)}static \u0275fac=function(r){return new(r||t)(ke(bC),ke(EC),ke(km),ke(RG),ke(Hn),ke(qr),ke(Fm),ke(Kh,8))};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})(),cf=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,n,r,i,s){this.eventManager=e,this.doc=n,this.ngZone=r,this.platformIsServer=i,this.tracingService=s}destroy(){}destroyNode=null;createElement(e,n){return n?this.doc.createElementNS(wC[n]||n,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,n){(NM(e)?e.content:e).appendChild(n)}insertBefore(e,n,r){e&&(NM(e)?e.content:e).insertBefore(n,r)}removeChild(e,n){n.remove()}selectRootElement(e,n){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new me(-5104,!1);return n||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,r,i){if(i){n=i+":"+n;let s=wC[i];s?e.setAttributeNS(s,n,r):e.setAttribute(n,r)}else e.setAttribute(n,r)}removeAttribute(e,n,r){if(r){let i=wC[r];i?e.removeAttributeNS(i,n):e.removeAttribute(`${r}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,r,i){i&(Jo.DashCase|Jo.Important)?e.style.setProperty(n,r,i&Jo.Important?"important":""):e.style[n]=r}removeStyle(e,n,r){r&Jo.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,r){e!=null&&(e[n]=r)}setValue(e,n){e.nodeValue=n}listen(e,n,r,i){if(typeof e=="string"&&(e=so().getGlobalEventTarget(this.doc,e),!e))throw new me(5102,!1);let s=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(s=this.tracingService.wrapEventListener(e,n,s)),this.eventManager.addEventListener(e,n,s,i)}decoratePreventDefault(e){return n=>{if(n==="__ngUnwrap__")return e;e(n)===!1&&n.preventDefault()}}};function NM(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var iy=class extends cf{hostEl;sharedStylesHost;shadowRoot;constructor(e,n,r,i,s,o,a,c,l){super(e,i,s,a,c),this.hostEl=n,this.sharedStylesHost=l,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost&&this.sharedStylesHost.addHost(this.shadowRoot);let u=r.styles;u=RM(r.id,u);for(let h of u){let f=document.createElement("style");o&&f.setAttribute("nonce",o),f.textContent=h,this.shadowRoot.appendChild(f)}let d=r.getExternalStyles?.();if(d)for(let h of d){let f=vC(h,i);o&&f.setAttribute("nonce",o),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,r){return super.insertBefore(this.nodeOrShadowRoot(e),n,r)}removeChild(e,n){return super.removeChild(null,n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost&&this.sharedStylesHost.removeHost(this.shadowRoot)}},lf=class extends cf{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,n,r,i,s,o,a,c,l){super(e,s,o,a,c),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=i;let u=r.styles;this.styles=l?RM(l,u):u,this.styleUrls=r.getExternalStyles?.(l)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&Pc.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},sy=class extends lf{contentAttr;hostAttr;constructor(e,n,r,i,s,o,a,c,l){let u=i+"-"+r.id;super(e,n,r,s,o,a,c,l,u),this.contentAttr=OG(u),this.hostAttr=PG(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){let r=super.createElement(e,n);return super.setAttribute(r,this.contentAttr,""),r}};var ay=class t extends ef{supportsDOMEvents=!0;static makeCurrent(){oC(new t)}onAndCancel(e,n,r,i){return e.addEventListener(n,r,i),()=>{e.removeEventListener(n,r,i)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.remove()}createElement(e,n){return n=n||this.getDefaultDocument(),n.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return n==="window"?window:n==="document"?e:n==="body"?e.body:null}getBaseHref(e){let n=MG();return n==null?null:kG(n)}resetBaseElement(){uf=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return mC(document.cookie,e)}},uf=null;function MG(){return uf=uf||document.head.querySelector("base"),uf?uf.getAttribute("href"):null}function kG(t){return new URL(t,document.baseURI).pathname}var LG=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})(),OM=["alt","control","meta","shift"],FG={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},BG={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},PM=(()=>{class t extends af{constructor(n){super(n)}supports(n){return t.parseEventName(n)!=null}addEventListener(n,r,i,s){let o=t.parseEventName(r),a=t.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>so().onAndCancel(n,o.domEventName,a,s))}static parseEventName(n){let r=n.toLowerCase().split("."),i=r.shift();if(r.length===0||!(i==="keydown"||i==="keyup"))return null;let s=t._normalizeKey(r.pop()),o="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),o="code."),OM.forEach(l=>{let u=r.indexOf(l);u>-1&&(r.splice(u,1),o+=l+".")}),o+=s,r.length!=0||s.length===0)return null;let c={};return c.domEventName=i,c.fullKey=o,c}static matchEventFullKeyCode(n,r){let i=FG[n.key]||n.key,s="";return r.indexOf("code.")>-1&&(i=n.code,s="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),OM.forEach(o=>{if(o!==i){let a=BG[o];a(n)&&(s+=o+".")}}),s+=i,s===r)}static eventCallback(n,r,i){return s=>{t.matchEventFullKeyCode(s,n)&&i.runGuarded(()=>r(s))}}static _normalizeKey(n){return n==="esc"?"escape":n}static \u0275fac=function(r){return new(r||t)(ke(Hn))};static \u0275prov=Ae({token:t,factory:t.\u0275fac})}return t})();function AC(t,e,n){let r=H({rootComponent:t,platformRef:n?.platformRef},UG(e));return eM(r)}function UG(t){return{appProviders:[...qG,...t?.providers??[]],platformProviders:$G}}function jG(){ay.makeCurrent()}function VG(){return new Xs}function HG(){return MI(document),document}var $G=[{provide:Gh,useValue:_M},{provide:Lm,useValue:jG,multi:!0},{provide:Hn,useFactory:HG}];var qG=[{provide:Dh,useValue:"root"},{provide:Xs,useFactory:VG},{provide:oy,useClass:ry,multi:!0},{provide:oy,useClass:PM,multi:!0},CC,EC,bC,{provide:kc,useExisting:CC},{provide:of,useClass:LG},[]];var MM=(()=>{class t{_doc;constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static \u0275fac=function(r){return new(r||t)(ke(Hn))};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var xe="primary",Cf=Symbol("RouteTitle"),NC=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}};function Hc(t){return new NC(t)}function $M(t,e,n){let r=n.path.split("/");if(r.length>t.length||n.pathMatch==="full"&&(e.hasChildren()||r.length<t.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=t[s];if(o[0]===":")i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}function fy(t){return new Promise((e,n)=>{t.pipe(Js()).subscribe({next:r=>e(r),error:r=>n(r)})})}function GG(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Ms(t[n],e[n]))return!1;return!0}function Ms(t,e){let n=t?xC(t):void 0,r=e?xC(e):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!qM(t[i],e[i]))return!1;return!0}function xC(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function qM(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;let n=[...t].sort(),r=[...e].sort();return n.every((i,s)=>r[s]===i)}else return t===e}function zM(t){return t.length>0?t[t.length-1]:null}function qc(t){return $g(t)?t:Iu(t)?mn(Promise.resolve(t)):$e(t)}function GM(t){return $g(t)?fy(t):Promise.resolve(t)}var KG={exact:WM,subset:QM},KM={exact:WG,subset:QG,ignored:()=>!0};function kM(t,e,n){return KG[n.paths](t.root,e.root,n.matrixParams)&&KM[n.queryParams](t.queryParams,e.queryParams)&&!(n.fragment==="exact"&&t.fragment!==e.fragment)}function WG(t,e){return Ms(t,e)}function WM(t,e,n){if(!jc(t.segments,e.segments)||!uy(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!t.children[r]||!WM(t.children[r],e.children[r],n))return!1;return!0}function QG(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>qM(t[n],e[n]))}function QM(t,e,n){return YM(t,e,e.segments,n)}function YM(t,e,n,r){if(t.segments.length>n.length){let i=t.segments.slice(0,n.length);return!(!jc(i,n)||e.hasChildren()||!uy(i,n,r))}else if(t.segments.length===n.length){if(!jc(t.segments,n)||!uy(t.segments,n,r))return!1;for(let i in e.children)if(!t.children[i]||!QM(t.children[i],e.children[i],r))return!1;return!0}else{let i=n.slice(0,t.segments.length),s=n.slice(t.segments.length);return!jc(t.segments,i)||!uy(t.segments,i,r)||!t.children[xe]?!1:YM(t.children[xe],e,s,r)}}function uy(t,e,n){return e.every((r,i)=>KM[n](t[i].parameters,r.parameters))}var Ki=class{root;queryParams;fragment;_queryParamMap;constructor(e=new at([],{}),n={},r=null){this.root=e,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Hc(this.queryParams),this._queryParamMap}toString(){return ZG.serialize(this)}},at=class{segments;children;parent=null;constructor(e,n){this.segments=e,this.children=n,Object.values(n).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return dy(this)}},ea=class{path;parameters;_parameterMap;constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap??=Hc(this.parameters),this._parameterMap}toString(){return ZM(this)}};function YG(t,e){return jc(t,e)&&t.every((n,r)=>Ms(n.parameters,e[r].parameters))}function jc(t,e){return t.length!==e.length?!1:t.every((n,r)=>n.path===e[r].path)}function JG(t,e){let n=[];return Object.entries(t.children).forEach(([r,i])=>{r===xe&&(n=n.concat(e(i,r)))}),Object.entries(t.children).forEach(([r,i])=>{r!==xe&&(n=n.concat(e(i,r)))}),n}var Af=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>new ta,providedIn:"root"})}return t})(),ta=class{parse(e){let n=new OC(e);return new Ki(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){let n=`/${df(e.root,!0)}`,r=tK(e.queryParams),i=typeof e.fragment=="string"?`#${XG(e.fragment)}`:"";return`${n}${r}${i}`}},ZG=new ta;function dy(t){return t.segments.map(e=>ZM(e)).join("/")}function df(t,e){if(!t.hasChildren())return dy(t);if(e){let n=t.children[xe]?df(t.children[xe],!1):"",r=[];return Object.entries(t.children).forEach(([i,s])=>{i!==xe&&r.push(`${i}:${df(s,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}else{let n=JG(t,(r,i)=>i===xe?[df(t.children[xe],!1)]:[`${i}:${df(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[xe]!=null?`${dy(t)}/${n[0]}`:`${dy(t)}/(${n.join("//")})`}}function JM(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function cy(t){return JM(t).replace(/%3B/gi,";")}function XG(t){return encodeURI(t)}function RC(t){return JM(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hy(t){return decodeURIComponent(t)}function LM(t){return hy(t.replace(/\+/g,"%20"))}function ZM(t){return`${RC(t.path)}${eK(t.parameters)}`}function eK(t){return Object.entries(t).map(([e,n])=>`;${RC(e)}=${RC(n)}`).join("")}function tK(t){let e=Object.entries(t).map(([n,r])=>Array.isArray(r)?r.map(i=>`${cy(n)}=${cy(i)}`).join("&"):`${cy(n)}=${cy(r)}`).filter(n=>n);return e.length?`?${e.join("&")}`:""}var nK=/^[^\/()?;#]+/;function SC(t){let e=t.match(nK);return e?e[0]:""}var rK=/^[^\/()?;=#]+/;function iK(t){let e=t.match(rK);return e?e[0]:""}var sK=/^[^=?&#]+/;function oK(t){let e=t.match(sK);return e?e[0]:""}var aK=/^[^&#]+/;function cK(t){let e=t.match(aK);return e?e[0]:""}var OC=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new at([],{}):new at([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(r[xe]=new at(e,n)),r}parseSegment(){let e=SC(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new me(4009,!1);return this.capture(e),new ea(hy(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let n=iK(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){let i=SC(this.remaining);i&&(r=i,this.capture(r))}e[hy(n)]=hy(r)}parseQueryParam(e){let n=oK(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){let o=cK(this.remaining);o&&(r=o,this.capture(r))}let i=LM(n),s=LM(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=SC(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new me(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=xe);let o=this.parseChildren();n[s??xe]=Object.keys(o).length===1&&o[xe]?o[xe]:new at([],o),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new me(4011,!1)}};function XM(t){return t.segments.length>0?new at([],{[xe]:t}):t}function ek(t){let e={};for(let[r,i]of Object.entries(t.children)){let s=ek(i);if(r===xe&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let n=new at(t.segments,e);return lK(n)}function lK(t){if(t.numberOfChildren===1&&t.children[xe]){let e=t.children[xe];return new at(t.segments.concat(e.segments),e.children)}return t}function Ru(t){return t instanceof Ki}function tk(t,e,n=null,r=null,i=new ta){let s=nk(t);return rk(s,e,n,r,i)}function nk(t){let e;function n(s){let o={};for(let c of s.children){let l=n(c);o[c.outlet]=l}let a=new at(s.url,o);return s===t&&(e=a),a}let r=n(t.root),i=XM(r);return e??i}function rk(t,e,n,r,i){let s=t;for(;s.parent;)s=s.parent;if(e.length===0)return _C(s,s,s,n,r,i);let o=uK(e);if(o.toRoot())return _C(s,s,new at([],{}),n,r,i);let a=dK(o,s,t),c=a.processChildren?ff(a.segmentGroup,a.index,o.commands):sk(a.segmentGroup,a.index,o.commands);return _C(s,a.segmentGroup,c,n,r,i)}function py(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function mf(t){return typeof t=="object"&&t!=null&&t.outlets}function FM(t,e,n){t||="\u0275";let r=new Ki;return r.queryParams={[t]:e},n.parse(n.serialize(r)).queryParams[t]}function _C(t,e,n,r,i,s){let o={};for(let[l,u]of Object.entries(r??{}))o[l]=Array.isArray(u)?u.map(d=>FM(l,d,s)):FM(l,u,s);let a;t===e?a=n:a=ik(t,e,n);let c=XM(ek(a));return new Ki(c,o,i)}function ik(t,e,n){let r={};return Object.entries(t.children).forEach(([i,s])=>{s===e?r[i]=n:r[i]=ik(s,e,n)}),new at(t.segments,r)}var gy=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,n,r){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=r,e&&r.length>0&&py(r[0]))throw new me(4003,!1);let i=r.find(mf);if(i&&i!==zM(r))throw new me(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function uK(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new gy(!0,0,t);let e=0,n=!1,r=t.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?n=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new gy(n,e,r)}var Nu=class{segmentGroup;processChildren;index;constructor(e,n,r){this.segmentGroup=e,this.processChildren=n,this.index=r}};function dK(t,e,n){if(t.isAbsolute)return new Nu(e,!0,0);if(!n)return new Nu(e,!1,NaN);if(n.parent===null)return new Nu(n,!0,0);let r=py(t.commands[0])?0:1,i=n.segments.length-1+r;return hK(n,i,t.numberOfDoubleDots)}function hK(t,e,n){let r=t,i=e,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new me(4005,!1);i=r.segments.length}return new Nu(r,!1,i-s)}function fK(t){return mf(t[0])?t[0].outlets:{[xe]:t}}function sk(t,e,n){if(t??=new at([],{}),t.segments.length===0&&t.hasChildren())return ff(t,e,n);let r=pK(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let s=new at(t.segments.slice(0,r.pathIndex),{});return s.children[xe]=new at(t.segments.slice(r.pathIndex),t.children),ff(s,0,i)}else return r.match&&i.length===0?new at(t.segments,{}):r.match&&!t.hasChildren()?PC(t,e,n):r.match?ff(t,0,i):PC(t,e,n)}function ff(t,e,n){if(n.length===0)return new at(t.segments,{});{let r=fK(n),i={};if(Object.keys(r).some(s=>s!==xe)&&t.children[xe]&&t.numberOfChildren===1&&t.children[xe].segments.length===0){let s=ff(t.children[xe],e,n);return new at(t.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=sk(t.children[s],e,o))}),Object.entries(t.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new at(t.segments,i)}}function pK(t,e,n){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=n.length)return s;let o=t.segments[i],a=n[r];if(mf(a))break;let c=`${a}`,l=r<n.length-1?n[r+1]:null;if(i>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!UM(c,l,o))return s;r+=2}else{if(!UM(c,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function PC(t,e,n){let r=t.segments.slice(0,e),i=0;for(;i<n.length;){let s=n[i];if(mf(s)){let c=gK(s.outlets);return new at(r,c)}if(i===0&&py(n[0])){let c=t.segments[e];r.push(new ea(c.path,BM(n[0]))),i++;continue}let o=mf(s)?s.outlets[xe]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&py(a)?(r.push(new ea(o,BM(a))),i+=2):(r.push(new ea(o,{})),i++)}return new at(r,{})}function gK(t){let e={};return Object.entries(t).forEach(([n,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[n]=PC(new at([],{}),0,r))}),e}function BM(t){let e={};return Object.entries(t).forEach(([n,r])=>e[n]=`${r}`),e}function UM(t,e,n){return t==n.path&&Ms(e,n.parameters)}var pf="imperative",bn=(function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t})(bn||{}),Wr=class{id;url;constructor(e,n){this.id=e,this.url=n}},$c=class extends Wr{type=bn.NavigationStart;navigationTrigger;restoredState;constructor(e,n,r="imperative",i=null){super(e,n),this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ao=class extends Wr{urlAfterRedirects;type=bn.NavigationEnd;constructor(e,n,r){super(e,n),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},hr=(function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t[t.Aborted=4]="Aborted",t})(hr||{}),yf=(function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t})(yf||{}),ks=class extends Wr{reason;code;type=bn.NavigationCancel;constructor(e,n,r,i){super(e,n),this.reason=r,this.code=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},co=class extends Wr{reason;code;type=bn.NavigationSkipped;constructor(e,n,r,i){super(e,n),this.reason=r,this.code=i}},Ou=class extends Wr{error;target;type=bn.NavigationError;constructor(e,n,r,i){super(e,n),this.error=r,this.target=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},wf=class extends Wr{urlAfterRedirects;state;type=bn.RoutesRecognized;constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},my=class extends Wr{urlAfterRedirects;state;type=bn.GuardsCheckStart;constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},yy=class extends Wr{urlAfterRedirects;state;shouldActivate;type=bn.GuardsCheckEnd;constructor(e,n,r,i,s){super(e,n),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},wy=class extends Wr{urlAfterRedirects;state;type=bn.ResolveStart;constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vy=class extends Wr{urlAfterRedirects;state;type=bn.ResolveEnd;constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},by=class{route;type=bn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Ey=class{route;type=bn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Iy=class{snapshot;type=bn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Cy=class{snapshot;type=bn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ay=class{snapshot;type=bn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Sy=class{snapshot;type=bn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var vf=class{},Pu=class{url;navigationBehaviorOptions;constructor(e,n){this.url=e,this.navigationBehaviorOptions=n}};function mK(t){return!(t instanceof vf)&&!(t instanceof Pu)}function yK(t,e){return t.providers&&!t._injector&&(t._injector=Yh(t.providers,e,`Route: ${t.path}`)),t._injector??e}function Gi(t){return t.outlet||xe}function wK(t,e){let n=t.filter(r=>Gi(r)===e);return n.push(...t.filter(r=>Gi(r)!==e)),n}function Lu(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let e=t.parent;e;e=e.parent){let n=e.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}var _y=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Lu(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Fu(this.rootInjector)}},Fu=(()=>{class t{rootInjector;contexts=new Map;constructor(n){this.rootInjector=n}onChildOutletCreated(n,r){let i=this.getOrCreateContext(n);i.outlet=r,this.contexts.set(n,i)}onChildOutletDestroyed(n){let r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new _y(this.rootInjector),this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}static \u0275fac=function(r){return new(r||t)(ke(Vn))};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Ty=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){let n=MC(e,this._root);return n?n.children.map(r=>r.value):[]}firstChild(e){let n=MC(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){let n=kC(e,this._root);return n.length<2?[]:n[n.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return kC(e,this._root).map(n=>n.value)}};function MC(t,e){if(t===e.value)return e;for(let n of e.children){let r=MC(t,n);if(r)return r}return null}function kC(t,e){if(t===e.value)return[e];for(let n of e.children){let r=kC(t,n);if(r.length)return r.unshift(e),r}return[]}var Kr=class{value;children;constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}};function Du(t){let e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}var bf=class extends Ty{snapshot;constructor(e,n){super(e),this.snapshot=n,VC(this,e)}toString(){return this.snapshot.toString()}};function ok(t){let e=vK(t),n=new Nn([new ea("",{})]),r=new Nn({}),i=new Nn({}),s=new Nn({}),o=new Nn(""),a=new na(n,r,s,o,i,xe,t,e.root);return a.snapshot=e.root,new bf(new Kr(a,[]),e)}function vK(t){let e={},n={},r={},s=new Vc([],e,r,"",n,xe,t,null,{});return new Ef("",new Kr(s,[]))}var na=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,n,r,i,s,o,a,c){this.urlSubject=e,this.paramsSubject=n,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(jt(l=>l[Cf]))??$e(void 0),this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(jt(e=>Hc(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(jt(e=>Hc(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Dy(t,e,n="emptyOnly"){let r,{routeConfig:i}=t;return e!==null&&(n==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:H(H({},e.params),t.params),data:H(H({},e.data),t.data),resolve:H(H(H(H({},t.data),e.data),i?.data),t._resolvedData)}:r={params:H({},t.params),data:H({},t.data),resolve:H(H({},t.data),t._resolvedData??{})},i&&ck(i)&&(r.resolve[Cf]=i.title),r}var Vc=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Cf]}constructor(e,n,r,i,s,o,a,c,l){this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Hc(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Hc(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),n=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${n}')`}},Ef=class extends Ty{url;constructor(e,n){super(n),this.url=e,VC(this,n)}toString(){return ak(this._root)}};function VC(t,e){e.value._routerState=t,e.children.forEach(n=>VC(t,n))}function ak(t){let e=t.children.length>0?` { ${t.children.map(ak).join(", ")} } `:"";return`${t.value}${e}`}function TC(t){if(t.snapshot){let e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Ms(e.queryParams,n.queryParams)||t.queryParamsSubject.next(n.queryParams),e.fragment!==n.fragment&&t.fragmentSubject.next(n.fragment),Ms(e.params,n.params)||t.paramsSubject.next(n.params),GG(e.url,n.url)||t.urlSubject.next(n.url),Ms(e.data,n.data)||t.dataSubject.next(n.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function LC(t,e){let n=Ms(t.params,e.params)&&YG(t.url,e.url),r=!t.parent!=!e.parent;return n&&!r&&(!t.parent||LC(t.parent,e.parent))}function ck(t){return typeof t.title=="string"||t.title===null}var lk=new Ce(""),Sf=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=xe;activateEvents=new ur;deactivateEvents=new ur;attachEvents=new ur;detachEvents=new ur;routerOutletData=XP();parentContexts=re(Fu);location=re(Qh);changeDetector=re(sC);inputBinder=re(Oy,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(n){if(n.name){let{firstChange:r,previousValue:i}=n.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new me(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new me(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new me(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new me(4013,!1);this._activatedRoute=n;let i=this.location,o=n.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new FC(n,a,i.injector,this.routerOutletData);this.activated=i.createComponent(o,{index:i.length,injector:c,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=qm({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Pm]})}return t})(),FC=class{route;childContexts;parent;outletData;constructor(e,n,r,i){this.route=e,this.childContexts=n,this.parent=r,this.outletData=i}get(e,n){return e===na?this.route:e===Fu?this.childContexts:e===lk?this.outletData:this.parent.get(e,n)}},Oy=new Ce("");var HC=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Jh({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,i){r&1&&Vi(0,"router-outlet")},dependencies:[Sf],encapsulation:2})}return t})();function $C(t){let e=t.children&&t.children.map($C),n=e?fe(H({},t),{children:e}):H({},t);return!n.component&&!n.loadComponent&&(e||n.loadChildren)&&n.outlet&&n.outlet!==xe&&(n.component=HC),n}function bK(t,e,n){let r=If(t,e._root,n?n._root:void 0);return new bf(r,e)}function If(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){let r=n.value;r._futureSnapshot=e.value;let i=EK(t,e,n);return new Kr(r,i)}else{if(t.shouldAttach(e.value)){let s=t.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>If(t,a)),o}}let r=IK(e.value),i=e.children.map(s=>If(t,s));return new Kr(r,i)}}function EK(t,e,n){return e.children.map(r=>{for(let i of n.children)if(t.shouldReuseRoute(r.value,i.value.snapshot))return If(t,r,i);return If(t,r)})}function IK(t){return new na(new Nn(t.url),new Nn(t.params),new Nn(t.queryParams),new Nn(t.fragment),new Nn(t.data),t.outlet,t.component,t)}var Mu=class{redirectTo;navigationBehaviorOptions;constructor(e,n){this.redirectTo=e,this.navigationBehaviorOptions=n}},uk="ngNavigationCancelingError";function Ny(t,e){let{redirectTo:n,navigationBehaviorOptions:r}=Ru(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=dk(!1,hr.Redirect);return i.url=n,i.navigationBehaviorOptions=r,i}function dk(t,e){let n=new Error(`NavigationCancelingError: ${t||""}`);return n[uk]=!0,n.cancellationCode=e,n}function CK(t){return hk(t)&&Ru(t.url)}function hk(t){return!!t&&t[uk]}var AK=(t,e,n,r)=>jt(i=>(new BC(e,i.targetRouterState,i.currentRouterState,n,r).activate(t),i)),BC=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,n,r,i,s){this.routeReuseStrategy=e,this.futureState=n,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,e),TC(this.futureState.root),this.activateChildRoutes(n,r,e)}deactivateChildRoutes(e,n,r){let i=Du(n);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,n,r){let i=e.value,s=n?n.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,n,o.children)}else this.deactivateChildRoutes(e,n,r);else s&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){let r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Du(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,n){let r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Du(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,n,r){let i=Du(n);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Sy(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Cy(e.value.snapshot))}activateRoutes(e,n,r){let i=e.value,s=n?n.value:null;if(TC(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,n,o.children)}else this.activateChildRoutes(e,n,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),TC(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=i,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,r)}},xy=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},xu=class{component;route;constructor(e,n){this.component=e,this.route=n}};function SK(t,e,n){let r=t._root,i=e?e._root:null;return hf(r,i,n,[r.value])}function _K(t){let e=t.routeConfig?t.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:t,guards:e}}function Bu(t,e){let n=Symbol(),r=e.get(t,n);return r===n?typeof t=="function"&&!vE(t)?t:e.get(t):r}function hf(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Du(e);return t.children.forEach(o=>{TK(o,s[o.value.outlet],n,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>gf(a,n.getContext(o),i)),i}function TK(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=t.value,o=e?e.value:null,a=n?n.getContext(t.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let c=DK(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new xy(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?hf(t,e,a?a.children:null,r,i):hf(t,e,n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new xu(a.outlet.component,o))}else o&&gf(e,a,i),i.canActivateChecks.push(new xy(r)),s.component?hf(t,null,a?a.children:null,r,i):hf(t,null,n,r,i);return i}function DK(t,e,n){if(typeof n=="function")return n(t,e);switch(n){case"pathParamsChange":return!jc(t.url,e.url);case"pathParamsOrQueryParamsChange":return!jc(t.url,e.url)||!Ms(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!LC(t,e)||!Ms(t.queryParams,e.queryParams);case"paramsChange":default:return!LC(t,e)}}function gf(t,e,n){let r=Du(t),i=t.value;Object.entries(r).forEach(([s,o])=>{i.component?e?gf(o,e.children.getContext(s),n):gf(o,null,n):gf(o,e,n)}),i.component?e&&e.outlet&&e.outlet.isActivated?n.canDeactivateChecks.push(new xu(e.outlet.component,i)):n.canDeactivateChecks.push(new xu(null,i)):n.canDeactivateChecks.push(new xu(null,i))}function _f(t){return typeof t=="function"}function NK(t){return typeof t=="boolean"}function xK(t){return t&&_f(t.canLoad)}function RK(t){return t&&_f(t.canActivate)}function OK(t){return t&&_f(t.canActivateChild)}function PK(t){return t&&_f(t.canDeactivate)}function MK(t){return t&&_f(t.canMatch)}function fk(t){return t instanceof pc||t?.name==="EmptyError"}var ly=Symbol("INITIAL_VALUE");function ku(){return Is(t=>eE(t.map(e=>e.pipe(Ys(1),rE(ly)))).pipe(jt(e=>{for(let n of e)if(n!==!0){if(n===ly)return ly;if(n===!1||kK(n))return n}return!0}),Es(e=>e!==ly),Ys(1)))}function kK(t){return Ru(t)||t instanceof Mu}function pk(t){return t.aborted?$e(void 0).pipe(Ys(1)):new ot(e=>{let n=()=>{e.next(),e.complete()};return t.addEventListener("abort",n),()=>t.removeEventListener("abort",n)})}function gk(t){return yh(pk(t))}function LK(t,e){return ar(n=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return o.length===0&&s.length===0?$e(fe(H({},n),{guardsResult:!0})):FK(o,r,i,t).pipe(ar(a=>a&&NK(a)?BK(r,s,t,e):$e(a)),jt(a=>fe(H({},n),{guardsResult:a})))})}function FK(t,e,n,r){return mn(t).pipe(ar(i=>$K(i.component,i.route,n,e,r)),Js(i=>i!==!0,!0))}function BK(t,e,n,r){return mn(e).pipe(qg(i=>su(jK(i.route.parent,r),UK(i.route,r),HK(t,i.path,n),VK(t,i.route,n))),Js(i=>i!==!0,!0))}function UK(t,e){return t!==null&&e&&e(new Ay(t)),$e(!0)}function jK(t,e){return t!==null&&e&&e(new Iy(t)),$e(!0)}function VK(t,e,n){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return $e(!0);let i=r.map(s=>gh(()=>{let o=Lu(e)??n,a=Bu(s,o),c=RK(a)?a.canActivate(e,t):dr(o,()=>a(e,t));return qc(c).pipe(Js())}));return $e(i).pipe(ku())}function HK(t,e,n){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>_K(o)).filter(o=>o!==null).map(o=>gh(()=>{let a=o.guards.map(c=>{let l=Lu(o.node)??n,u=Bu(c,l),d=OK(u)?u.canActivateChild(r,t):dr(l,()=>u(r,t));return qc(d).pipe(Js())});return $e(a).pipe(ku())}));return $e(s).pipe(ku())}function $K(t,e,n,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return $e(!0);let o=s.map(a=>{let c=Lu(e)??i,l=Bu(a,c),u=PK(l)?l.canDeactivate(t,e,n,r):dr(c,()=>l(t,e,n,r));return qc(u).pipe(Js())});return $e(o).pipe(ku())}function qK(t,e,n,r,i){let s=e.canLoad;if(s===void 0||s.length===0)return $e(!0);let o=s.map(a=>{let c=Bu(a,t),l=xK(c)?c.canLoad(e,n):dr(t,()=>c(e,n)),u=qc(l);return i?u.pipe(gk(i)):u});return $e(o).pipe(ku(),mk(r))}function mk(t){return Y0(cr(e=>{if(typeof e!="boolean")throw Ny(t,e)}),jt(e=>e===!0))}function zK(t,e,n,r,i){let s=e.canMatch;if(!s||s.length===0)return $e(!0);let o=s.map(a=>{let c=Bu(a,t),l=MK(c)?c.canMatch(e,n):dr(t,()=>c(e,n)),u=qc(l);return i?u.pipe(gk(i)):u});return $e(o).pipe(ku(),mk(r))}var Uc=class yk extends Error{segmentGroup;constructor(e){super(),this.segmentGroup=e||null,Object.setPrototypeOf(this,yk.prototype)}},UC=class wk extends Error{urlTree;constructor(e){super(),this.urlTree=e,Object.setPrototypeOf(this,wk.prototype)}};function GK(t){throw new me(4e3,!1)}function KK(t){throw dk(!1,hr.GuardRejected)}var WK=class{urlSerializer;urlTree;constructor(e,n){this.urlSerializer=e,this.urlTree=n}async lineralizeSegments(e,n){let r=[],i=n.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return r;if(i.numberOfChildren>1||!i.children[xe])throw GK(`${e.redirectTo}`);i=i.children[xe]}}async applyRedirectCommands(e,n,r,i,s){let o=await QK(n,i,s);if(o instanceof Ki)throw new UC(o);let a=this.applyRedirectCreateUrlTree(o,this.urlSerializer.parse(o),e,r);if(o[0]==="/")throw new UC(a);return a}applyRedirectCreateUrlTree(e,n,r,i){let s=this.createSegmentGroup(e,n.root,r,i);return new Ki(s,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);r[i]=n[a]}else r[i]=s}),r}createSegmentGroup(e,n,r,i){let s=this.createSegments(e,n.segments,r,i),o={};return Object.entries(n.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(e,c,r,i)}),new at(s,o)}createSegments(e,n,r,i){return n.map(s=>s.path[0]===":"?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,n,r){let i=r[n.path.substring(1)];if(!i)throw new me(4001,!1);return i}findOrReturn(e,n){let r=0;for(let i of n){if(i.path===e.path)return n.splice(r),i;r++}return e}};function QK(t,e,n){if(typeof t=="string")return Promise.resolve(t);let r=t,{queryParams:i,fragment:s,routeConfig:o,url:a,outlet:c,params:l,data:u,title:d}=e;return fy(qc(dr(n,()=>r({params:l,data:u,queryParams:i,fragment:s,routeConfig:o,url:a,outlet:c,title:d}))))}var jC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function YK(t,e,n,r,i,s){let o=vk(t,e,n);return o.matched?(r=yK(e,r),zK(r,e,n,i,s).pipe(jt(a=>a===!0?o:H({},jC)))):$e(o)}function vk(t,e,n){if(e.path==="**")return JK(n);if(e.path==="")return e.pathMatch==="full"&&(t.hasChildren()||n.length>0)?H({},jC):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};let i=(e.matcher||$M)(n,t,e);if(!i)return H({},jC);let s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let o=i.consumed.length>0?H(H({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:n.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function JK(t){return{matched:!0,parameters:t.length>0?zM(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function jM(t,e,n,r){return n.length>0&&eW(t,n,r)?{segmentGroup:new at(e,XK(r,new at(n,t.children))),slicedSegments:[]}:n.length===0&&tW(t,n,r)?{segmentGroup:new at(t.segments,ZK(t,n,r,t.children)),slicedSegments:n}:{segmentGroup:new at(t.segments,t.children),slicedSegments:n}}function ZK(t,e,n,r){let i={};for(let s of n)if(Py(t,e,s)&&!r[Gi(s)]){let o=new at([],{});i[Gi(s)]=o}return H(H({},r),i)}function XK(t,e){let n={};n[xe]=e;for(let r of t)if(r.path===""&&Gi(r)!==xe){let i=new at([],{});n[Gi(r)]=i}return n}function eW(t,e,n){return n.some(r=>Py(t,e,r)&&Gi(r)!==xe)}function tW(t,e,n){return n.some(r=>Py(t,e,r))}function Py(t,e,n){return(t.hasChildren()||e.length>0)&&n.pathMatch==="full"?!1:n.path===""}function nW(t,e,n){return e.length===0&&!t.children[n]}var rW=class{};async function iW(t,e,n,r,i,s,o="emptyOnly",a){return new oW(t,e,n,r,i,o,s,a).recognize()}var sW=31,oW=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;abortSignal;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,n,r,i,s,o,a,c){this.injector=e,this.configLoader=n,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.abortSignal=c,this.applyRedirects=new WK(this.urlSerializer,this.urlTree)}noMatchError(e){return new me(4002,`'${e.segmentGroup}'`)}async recognize(){let e=jM(this.urlTree.root,[],[],this.config).segmentGroup,{children:n,rootSnapshot:r}=await this.match(e),i=new Kr(r,n),s=new Ef("",i),o=tk(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),{state:s,tree:o}}async match(e){let n=new Vc([],Object.freeze({}),Object.freeze(H({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),xe,this.rootComponentType,null,{});try{return{children:await this.processSegmentGroup(this.injector,this.config,e,xe,n),rootSnapshot:n}}catch(r){if(r instanceof UC)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Uc?this.noMatchError(r):r}}async processSegmentGroup(e,n,r,i,s){if(r.segments.length===0&&r.hasChildren())return this.processChildren(e,n,r,s);let o=await this.processSegment(e,n,r,r.segments,i,!0,s);return o instanceof Kr?[o]:[]}async processChildren(e,n,r,i){let s=[];for(let c of Object.keys(r.children))c==="primary"?s.unshift(c):s.push(c);let o=[];for(let c of s){let l=r.children[c],u=wK(n,c),d=await this.processSegmentGroup(e,u,l,c,i);o.push(...d)}let a=bk(o);return aW(a),a}async processSegment(e,n,r,i,s,o,a){for(let c of n)try{return await this.processSegmentAgainstRoute(c._injector??e,n,c,r,i,s,o,a)}catch(l){if(l instanceof Uc||fk(l))continue;throw l}if(nW(r,i,s))return new rW;throw new Uc(r)}async processSegmentAgainstRoute(e,n,r,i,s,o,a,c){if(Gi(r)!==o&&(o===xe||!Py(i,s,r)))throw new Uc(i);if(r.redirectTo===void 0)return this.matchSegmentAgainstRoute(e,i,r,s,o,c);if(this.allowRedirects&&a)return this.expandSegmentAgainstRouteUsingRedirect(e,i,n,r,s,o,c);throw new Uc(i)}async expandSegmentAgainstRouteUsingRedirect(e,n,r,i,s,o,a){let{matched:c,parameters:l,consumedSegments:u,positionalParamSegments:d,remainingSegments:h}=vk(n,i,s);if(!c)throw new Uc(n);typeof i.redirectTo=="string"&&i.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>sW&&(this.allowRedirects=!1));let f=new Vc(s,l,Object.freeze(H({},this.urlTree.queryParams)),this.urlTree.fragment,VM(i),Gi(i),i.component??i._loadedComponent??null,i,HM(i)),p=Dy(f,a,this.paramsInheritanceStrategy);if(f.params=Object.freeze(p.params),f.data=Object.freeze(p.data),this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let g=await this.applyRedirects.applyRedirectCommands(u,i.redirectTo,d,f,e),m=await this.applyRedirects.lineralizeSegments(i,g);return this.processSegment(e,r,n,m.concat(h),o,!1,a)}async matchSegmentAgainstRoute(e,n,r,i,s,o){if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let a=await fy(YK(n,r,i,e,this.urlSerializer,this.abortSignal));if(r.path==="**"&&(n.children={}),!a?.matched)throw new Uc(n);e=r._injector??e;let{routes:c}=await this.getChildConfig(e,r,i),l=r._loadedInjector??e,{parameters:u,consumedSegments:d,remainingSegments:h}=a,f=new Vc(d,u,Object.freeze(H({},this.urlTree.queryParams)),this.urlTree.fragment,VM(r),Gi(r),r.component??r._loadedComponent??null,r,HM(r)),p=Dy(f,o,this.paramsInheritanceStrategy);f.params=Object.freeze(p.params),f.data=Object.freeze(p.data);let{segmentGroup:g,slicedSegments:m}=jM(n,d,h,c);if(m.length===0&&g.hasChildren()){let I=await this.processChildren(l,c,g,f);return new Kr(f,I)}if(c.length===0&&m.length===0)return new Kr(f,[]);let y=Gi(r)===s,E=await this.processSegment(l,c,g,m,y?xe:s,!0,f);return new Kr(f,E instanceof Kr?[E]:[])}async getChildConfig(e,n,r){if(n.children)return{routes:n.children,injector:e};if(n.loadChildren){if(n._loadedRoutes!==void 0)return{routes:n._loadedRoutes,injector:n._loadedInjector};if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);if(await fy(qK(e,n,r,this.urlSerializer,this.abortSignal))){let s=await this.configLoader.loadChildren(e,n);return n._loadedRoutes=s.routes,n._loadedInjector=s.injector,s}throw KK(n)}return{routes:[],injector:e}}};function aW(t){t.sort((e,n)=>e.value.outlet===xe?-1:n.value.outlet===xe?1:e.value.outlet.localeCompare(n.value.outlet))}function cW(t){let e=t.value.routeConfig;return e&&e.path===""}function bk(t){let e=[],n=new Set;for(let r of t){if(!cW(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),n.add(i)):e.push(r)}for(let r of n){let i=bk(r.children);e.push(new Kr(r.value,i))}return e.filter(r=>!n.has(r))}function VM(t){return t.data||{}}function HM(t){return t.resolve||{}}var lW=new Ce("",{factory:()=>iW});function uW(t,e,n,r,i,s,o){let a=t.get(lW);return ar(c=>$e(c).pipe(Is(l=>a(t,e,n,r,l.extractedUrl,i,s,o)),jt(({state:l,tree:u})=>fe(H({},c),{targetSnapshot:l,urlAfterRedirects:u}))))}function dW(t,e){return ar(n=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return $e(n);let s=new Set(i.map(c=>c.route)),o=new Set;for(let c of s)if(!o.has(c))for(let l of Ek(c))o.add(l);let a=0;return mn(o).pipe(qg(c=>s.has(c)?hW(c,r,t,e):(c.data=Dy(c,c.parent,t).resolve,$e(void 0))),cr(()=>a++),zg(1),ar(c=>a===o.size?$e(n):Sr))})}function Ek(t){let e=t.children.map(n=>Ek(n)).flat();return[t,...e]}function hW(t,e,n,r){let i=t.routeConfig,s=t._resolve;return i?.title!==void 0&&!ck(i)&&(s[Cf]=i.title),gh(()=>(t.data=Dy(t,t.parent,n).resolve,fW(s,t,e,r).pipe(jt(o=>(t._resolvedData=o,t.data=H(H({},t.data),o),null)))))}function fW(t,e,n,r){let i=xC(t);if(i.length===0)return $e({});let s={};return mn(i).pipe(ar(o=>pW(t[o],e,n,r).pipe(Js(),cr(a=>{if(a instanceof Mu)throw Ny(new ta,a);s[o]=a}))),zg(1),jt(()=>s),mh(o=>fk(o)?Sr:X0(o)))}function pW(t,e,n,r){let i=Lu(e)??r,s=Bu(t,i),o=s.resolve?s.resolve(e,n):dr(i,()=>s(e,n));return qc(o)}function DC(t){return Is(e=>{let n=t(e);return n?mn(n).pipe(jt(()=>e)):$e(e)})}var qC=(()=>{class t{buildTitle(n){let r,i=n.root;for(;i!==void 0;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===xe);return r}getResolvedTitleForRoute(n){return n.data[Cf]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(Ik),providedIn:"root"})}return t})(),Ik=(()=>{class t extends qC{title;constructor(n){super(),this.title=n}updateTitle(n){let r=this.buildTitle(n);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)(ke(MM))};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Tf=new Ce("",{factory:()=>({})}),Df=new Ce(""),Ck=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=re(nC);async loadComponent(n,r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return Promise.resolve(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=(async()=>{try{let s=await GM(dr(n,()=>r.loadComponent())),o=await _k(Sk(s));return this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o,o}finally{this.componentLoaders.delete(r)}})();return this.componentLoaders.set(r,i),i}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Promise.resolve({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=(async()=>{try{let s=await Ak(r,this.compiler,n,this.onLoadEndListener);return r._loadedRoutes=s.routes,r._loadedInjector=s.injector,s}finally{this.childrenLoaders.delete(r)}})();return this.childrenLoaders.set(r,i),i}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();async function Ak(t,e,n,r){let i=await GM(dr(n,()=>t.loadChildren())),s=await _k(Sk(i)),o;s instanceof $m||Array.isArray(s)?o=s:o=await e.compileModuleAsync(s),r&&r(t);let a,c,l=!1;return Array.isArray(o)?(c=o,l=!0):(a=o.create(n).injector,c=a.get(Df,[],{optional:!0,self:!0}).flat()),{routes:c.map($C),injector:a}}function gW(t){return t&&typeof t=="object"&&"default"in t}function Sk(t){return gW(t)?t.default:t}async function _k(t){return t}var My=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(mW),providedIn:"root"})}return t})(),mW=(()=>{class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Tk=new Ce("");var yW=()=>{},Dk=new Ce(""),Nk=(()=>{class t{currentNavigation=pt(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=pt(null);events=new jn;transitionAbortWithErrorSubject=new jn;configLoader=re(Ck);environmentInjector=re(Vn);destroyRef=re(Qo);urlSerializer=re(Af);rootContexts=re(Fu);location=re(Tu);inputBindingEnabled=re(Oy,{optional:!0})!==null;titleStrategy=re(qC);options=re(Tf,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=re(My);createViewTransition=re(Tk,{optional:!0});navigationErrorHandler=re(Dk,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>$e(void 0);rootComponentType=null;destroyed=!1;constructor(){let n=i=>this.events.next(new by(i)),r=i=>this.events.next(new Ey(i));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=n,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(n){let r=++this.navigationId;Ts(()=>{this.transitions?.next(fe(H({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:r}))})}setupNavigations(n){return this.transitions=new Nn(null),this.transitions.pipe(Es(r=>r!==null),Is(r=>{let i=!1,s=new AbortController;return $e(r).pipe(Is(o=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",hr.SupersededByNewNavigation),Sr;this.currentTransition=r;let a=this.lastSuccessfulNavigation();this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:a?fe(H({},a),{previousNavigation:null}):null,abort:()=>s.abort()});let c=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),l=o.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!c&&l!=="reload")return this.events.next(new co(o.id,this.urlSerializer.serialize(o.rawUrl),"",yf.IgnoredSameUrlNavigation)),o.resolve(!1),Sr;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return $e(o).pipe(Is(u=>(this.events.next(new $c(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),u.id!==this.navigationId?Sr:Promise.resolve(u))),uW(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy,s.signal),cr(u=>{r.targetSnapshot=u.targetSnapshot,r.urlAfterRedirects=u.urlAfterRedirects,this.currentNavigation.update(h=>(h.finalUrl=u.urlAfterRedirects,h));let d=new wf(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:u,extractedUrl:d,source:h,restoredState:f,extras:p}=o,g=new $c(u,this.urlSerializer.serialize(d),h,f);this.events.next(g);let m=ok(this.rootComponentType).snapshot;return this.currentTransition=r=fe(H({},o),{targetSnapshot:m,urlAfterRedirects:d,extras:fe(H({},p),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(y=>(y.finalUrl=d,y)),$e(r)}else return this.events.next(new co(o.id,this.urlSerializer.serialize(o.extractedUrl),"",yf.IgnoredByUrlHandlingStrategy)),o.resolve(!1),Sr}),cr(o=>{let a=new my(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),jt(o=>(this.currentTransition=r=fe(H({},o),{guards:SK(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),r)),LK(this.environmentInjector,o=>this.events.next(o)),cr(o=>{if(r.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw Ny(this.urlSerializer,o.guardsResult);let a=new yy(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),Es(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",hr.GuardRejected),!1)),DC(o=>{if(o.guards.canActivateChecks.length!==0)return $e(o).pipe(cr(a=>{let c=new wy(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(c)}),Is(a=>{let c=!1;return $e(a).pipe(dW(this.paramsInheritanceStrategy,this.environmentInjector),cr({next:()=>c=!0,complete:()=>{c||this.cancelNavigationTransition(a,"",hr.NoDataFromResolver)}}))}),cr(a=>{let c=new vy(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(c)}))}),DC(o=>{let a=l=>{let u=[];if(l.routeConfig?._loadedComponent)l.component=l.routeConfig?._loadedComponent;else if(l.routeConfig?.loadComponent){let d=Lu(l)??this.environmentInjector;u.push(this.configLoader.loadComponent(d,l.routeConfig).then(h=>{l.component=h}))}for(let d of l.children)u.push(...a(d));return u},c=a(o.targetSnapshot.root);return c.length===0?$e(o):mn(Promise.all(c).then(()=>o))}),DC(()=>this.afterPreactivation()),Is(()=>{let{currentSnapshot:o,targetSnapshot:a}=r,c=this.createViewTransition?.(this.environmentInjector,o.root,a.root);return c?mn(c).pipe(jt(()=>r)):$e(r)}),jt(o=>{let a=bK(n.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=r=fe(H({},o),{targetRouterState:a}),this.currentNavigation.update(c=>(c.targetRouterState=a,c)),r}),cr(()=>{this.events.next(new vf)}),AK(this.rootContexts,n.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),Ys(1),yh(pk(s.signal).pipe(Es(()=>!i&&!r.targetRouterState),cr(()=>{this.cancelNavigationTransition(r,s.signal.reason+"",hr.Aborted)}))),cr({next:o=>{i=!0,this.currentNavigation.update(a=>(a.abort=yW,a)),this.lastSuccessfulNavigation.set(Ts(this.currentNavigation)),this.events.next(new ao(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{i=!0}}),yh(this.transitionAbortWithErrorSubject.pipe(cr(o=>{throw o}))),nE(()=>{s.abort(),i||this.cancelNavigationTransition(r,"",hr.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),mh(o=>{if(this.destroyed)return r.resolve(!1),Sr;if(i=!0,hk(o))this.events.next(new ks(r.id,this.urlSerializer.serialize(r.extractedUrl),o.message,o.cancellationCode)),CK(o)?this.events.next(new Pu(o.url,o.navigationBehaviorOptions)):r.resolve(!1);else{let a=new Ou(r.id,this.urlSerializer.serialize(r.extractedUrl),o,r.targetSnapshot??void 0);try{let c=dr(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(c instanceof Mu){let{message:l,cancellationCode:u}=Ny(this.urlSerializer,c);this.events.next(new ks(r.id,this.urlSerializer.serialize(r.extractedUrl),l,u)),this.events.next(new Pu(c.redirectTo,c.navigationBehaviorOptions))}else throw this.events.next(a),o}catch(c){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(c)}}return Sr}))}))}cancelNavigationTransition(n,r,i){let s=new ks(n.id,this.urlSerializer.serialize(n.extractedUrl),r,i);this.events.next(s),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=Ts(this.currentNavigation),i=r?.targetBrowserUrl??r?.extractedUrl;return n.toString()!==i?.toString()&&!r?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function wW(t){return t!==pf}var xk=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(vW),providedIn:"root"})}return t})(),Ry=class{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}},vW=(()=>{class t extends Ry{static \u0275fac=(()=>{let n;return function(i){return(n||(n=Mm(t)))(i||t)}})();static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),zC=(()=>{class t{urlSerializer=re(Af);options=re(Tf,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=re(Tu);urlHandlingStrategy=re(My);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ki;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:n,initialUrl:r,targetBrowserUrl:i}){let s=n!==void 0?this.urlHandlingStrategy.merge(n,r):r,o=i??s;return o instanceof Ki?this.urlSerializer.serialize(o):o}commitTransition({targetRouterState:n,finalUrl:r,initialUrl:i}){r&&n?(this.currentUrlTree=r,this.rawUrlTree=this.urlHandlingStrategy.merge(r,i),this.routerState=n):this.rawUrlTree=i}routerState=ok(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:n}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n??this.rawUrlTree)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:()=>re(Rk),providedIn:"root"})}return t})(),Rk=(()=>{class t extends zC{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(r=>{r.type==="popstate"&&setTimeout(()=>{n(r.url,r.state,"popstate")})})}handleRouterEvent(n,r){n instanceof $c?this.updateStateMemento():n instanceof co?this.commitTransition(r):n instanceof wf?this.urlUpdateStrategy==="eager"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(r),r)):n instanceof vf?(this.commitTransition(r),this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(r),r)):n instanceof ks&&n.code!==hr.SupersededByNewNavigation&&n.code!==hr.Redirect?this.restoreHistory(r):n instanceof Ou?this.restoreHistory(r,!0):n instanceof ao&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,{extras:r,id:i}){let{replaceUrl:s,state:o}=r;if(this.location.isCurrentPathEqualTo(n)||s){let a=this.browserPageId,c=H(H({},o),this.generateNgRouterState(i,a));this.location.replaceState(n,"",c)}else{let a=H(H({},o),this.generateNgRouterState(i,this.browserPageId+1));this.location.go(n,"",a)}}restoreHistory(n,r=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,s=this.currentPageId-i;s!==0?this.location.historyGo(s):this.getCurrentUrlTree()===n.finalUrl&&s===0&&(this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}static \u0275fac=(()=>{let n;return function(i){return(n||(n=Mm(t)))(i||t)}})();static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function GC(t,e){t.events.pipe(Es(n=>n instanceof ao||n instanceof ks||n instanceof Ou||n instanceof co),jt(n=>n instanceof ao||n instanceof co?0:(n instanceof ks?n.code===hr.Redirect||n.code===hr.SupersededByNewNavigation:!1)?2:1),Es(n=>n!==2),Ys(1)).subscribe(()=>{e()})}var bW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},EW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ky=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=re(YI);stateManager=re(zC);options=re(Tf,{optional:!0})||{};pendingTasks=re(Yo);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=re(Nk);urlSerializer=re(Af);location=re(Tu);urlHandlingStrategy=re(My);injector=re(Vn);_events=new jn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=re(xk);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=re(Df,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!re(Oy,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Dn;subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(r=>{try{let i=this.navigationTransitions.currentTransition,s=Ts(this.navigationTransitions.currentNavigation);if(i!==null&&s!==null){if(this.stateManager.handleRouterEvent(r,s),r instanceof ks&&r.code!==hr.Redirect&&r.code!==hr.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof ao)this.navigated=!0;else if(r instanceof Pu){let o=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),c=H({browserUrl:i.extras.browserUrl,info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:i.extras.replaceUrl||this.urlUpdateStrategy==="eager"||wW(i.source)},o);this.scheduleNavigation(a,pf,null,c,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}mK(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortWithErrorSubject.next(i)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),pf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,r,i)=>{this.navigateToSyncWithBrowser(n,i,r)})}navigateToSyncWithBrowser(n,r,i){let s={replaceUrl:!0},o=i?.navigationId?i:null;if(i){let c=H({},i);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(s.state=c)}let a=this.parseUrl(n);this.scheduleNavigation(a,r,o,s).catch(c=>{this.disposed||this.injector.get(Bi)(c)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Ts(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map($C),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,r={}){let{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:c}=r,l=c?this.currentUrlTree.fragment:o,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=H(H({},this.currentUrlTree.queryParams),s);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let h=i?i.snapshot:this.routerState.snapshot.root;d=nk(h)}catch{(typeof n[0]!="string"||n[0][0]!=="/")&&(n=[]),d=this.currentUrlTree.root}return rk(d,n,u,l??null,this.urlSerializer)}navigateByUrl(n,r={skipLocationChange:!1}){let i=Ru(n)?n:this.parseUrl(n),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,pf,null,r)}navigate(n,r={skipLocationChange:!1}){return IW(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.console.warn(cu(4018,!1)),this.urlSerializer.parse("/")}}isActive(n,r){let i;if(r===!0?i=H({},bW):r===!1?i=H({},EW):i=r,Ru(n))return kM(this.currentUrlTree,n,i);let s=this.parseUrl(n);return kM(this.currentUrlTree,s,i)}removeEmptyProps(n){return Object.entries(n).reduce((r,[i,s])=>(s!=null&&(r[i]=s),r),{})}scheduleNavigation(n,r,i,s,o){if(this.disposed)return Promise.resolve(!1);let a,c,l;o?(a=o.resolve,c=o.reject,l=o.promise):l=new Promise((d,h)=>{a=d,c=h});let u=this.pendingTasks.add();return GC(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:s,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function IW(t){for(let e=0;e<t.length;e++)if(t[e]==null)throw new me(4008,!1)}var AW=new Ce("");function KC(t,...e){return Ac([{provide:Df,multi:!0,useValue:t},[],{provide:na,useFactory:SW},{provide:Gm,multi:!0,useFactory:_W},e.map(n=>n.\u0275providers)])}function SW(){return re(ky).routerState.root}function _W(){let t=re(Oi);return e=>{let n=t.get(Cu);if(e!==n.components[0])return;let r=t.get(ky),i=t.get(TW);t.get(DW)===1&&r.initialNavigation(),t.get(NW,null,{optional:!0})?.setUpPreloading(),t.get(AW,null,{optional:!0})?.init(),r.resetRootComponentType(n.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var TW=new Ce("",{factory:()=>new jn}),DW=new Ce("",{factory:()=>1});var NW=new Ce("");var Ok=[];var Pk={providers:[eI(),KC(Ok)]};var Mk="6.15.0";function RW(t,e,n){let r=e.split("|").map(s=>s.trim());for(let s=0;s<r.length;s++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof t===e)return}let i=new Error(`invalid value for type ${e}`);throw i.code="INVALID_ARGUMENT",i.argument=`value.${n}`,i.value=t,i}async function Gt(t){let e=Object.keys(t);return(await Promise.all(e.map(r=>Promise.resolve(t[r])))).reduce((r,i,s)=>(r[e[s]]=i,r),{})}function ce(t,e,n){for(let r in e){let i=e[r],s=n?n[r]:null;s&&RW(i,s,r),Object.defineProperty(t,r,{enumerable:!0,value:i,writable:!1})}}function Uu(t,e){if(t==null)return"null";if(e==null&&(e=new Set),typeof t=="object"){if(e.has(t))return"[Circular]";e.add(t)}if(Array.isArray(t))return"[ "+t.map(n=>Uu(n,e)).join(", ")+" ]";if(t instanceof Uint8Array){let n="0123456789abcdef",r="0x";for(let i=0;i<t.length;i++)r+=n[t[i]>>4],r+=n[t[i]&15];return r}if(typeof t=="object"&&typeof t.toJSON=="function")return Uu(t.toJSON(),e);switch(typeof t){case"boolean":case"number":case"symbol":return t.toString();case"bigint":return BigInt(t).toString();case"string":return JSON.stringify(t);case"object":{let n=Object.keys(t);return n.sort(),"{ "+n.map(r=>`${Uu(r,e)}: ${Uu(t[r],e)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Mt(t,e){return t&&t.code===e}function zc(t){return Mt(t,"CALL_EXCEPTION")}function Je(t,e,n){let r=t;{let s=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error(`value will overwrite populated values: ${Uu(n)}`);for(let o in n){if(o==="shortMessage")continue;let a=n[o];s.push(o+"="+Uu(a))}}s.push(`code=${e}`),s.push(`version=${Mk}`),s.length&&(t+=" ("+s.join(", ")+")")}let i;switch(e){case"INVALID_ARGUMENT":i=new TypeError(t);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":i=new RangeError(t);break;default:i=new Error(t)}return ce(i,{code:e}),n&&Object.assign(i,n),i.shortMessage==null&&ce(i,{shortMessage:r}),i}function G(t,e,n,r){if(!t)throw Je(e,n,r)}function D(t,e,n,r){G(t,e,"INVALID_ARGUMENT",{argument:n,value:r})}function ju(t,e,n){n==null&&(n=""),n&&(n=": "+n),G(t>=e,"missing argument"+n,"MISSING_ARGUMENT",{count:t,expectedCount:e}),G(t<=e,"too many arguments"+n,"UNEXPECTED_ARGUMENT",{count:t,expectedCount:e})}var OW=["NFD","NFC","NFKD","NFKC"].reduce((t,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"\xE9".normalize("NFD")!=="e\u0301")throw new Error("broken");t.push(e)}catch{}return t},[]);function Ly(t){G(OW.indexOf(t)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:t}})}function Wi(t,e,n){if(n==null&&(n=""),t!==e){let r=n,i="new";n&&(r+=".",i+=" "+n),G(!1,`private constructor; use ${r}from* methods`,"UNSUPPORTED_OPERATION",{operation:i})}}function Lk(t,e,n){if(t instanceof Uint8Array)return n?new Uint8Array(t):t;if(typeof t=="string"&&t.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){let r=new Uint8Array((t.length-2)/2),i=2;for(let s=0;s<r.length;s++)r[s]=parseInt(t.substring(i,i+2),16),i+=2;return r}D(!1,"invalid BytesLike value",e||"value",t)}function ye(t,e){return Lk(t,e,!1)}function Kt(t,e){return Lk(t,e,!0)}function Ue(t,e){return!(typeof t!="string"||!t.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&t.length!==2+2*e||e===!0&&t.length%2!==0)}function ra(t){return Ue(t,!0)||t instanceof Uint8Array}var kk="0123456789abcdef";function Z(t){let e=ye(t),n="0x";for(let r=0;r<e.length;r++){let i=e[r];n+=kk[(i&240)>>4]+kk[i&15]}return n}function Ze(t){return"0x"+t.map(e=>Z(e).substring(2)).join("")}function Qi(t){return Ue(t,!0)?(t.length-2)/2:ye(t).length}function _t(t,e,n){let r=ye(t);return n!=null&&n>r.length&&G(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n}),Z(r.slice(e??0,n??r.length))}function Fk(t,e,n){let r=ye(t);G(e>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:e,offset:e+1});let i=new Uint8Array(e);return i.fill(0),n?i.set(r,e-r.length):i.set(r,0),Z(i)}function qn(t,e){return Fk(t,e,!0)}function Fy(t,e){return Fk(t,e,!1)}var By=BigInt(0),Yi=BigInt(1),Vu=9007199254740991;function ia(t,e){let n=$u(t,"value"),r=BigInt(ve(e,"width"));if(G(n>>r===By,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:t}),n>>r-Yi){let i=(Yi<<r)-Yi;return-((~n&i)+Yi)}return n}function Hu(t,e){let n=te(t,"value"),r=BigInt(ve(e,"width")),i=Yi<<r-Yi;if(n<By){n=-n,G(n<=i,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t});let s=(Yi<<r)-Yi;return(~n&s)+Yi}else G(n<i,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t});return n}function gi(t,e){let n=$u(t,"value"),r=BigInt(ve(e,"bits"));return n&(Yi<<r)-Yi}function te(t,e){switch(typeof t){case"bigint":return t;case"number":return D(Number.isInteger(t),"underflow",e||"value",t),D(t>=-Vu&&t<=Vu,"overflow",e||"value",t),BigInt(t);case"string":try{if(t==="")throw new Error("empty string");return t[0]==="-"&&t[1]!=="-"?-BigInt(t.substring(1)):BigInt(t)}catch(n){D(!1,`invalid BigNumberish string: ${n.message}`,e||"value",t)}}D(!1,"invalid BigNumberish value",e||"value",t)}function $u(t,e){let n=te(t,e);return G(n>=By,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:t}),n}var Bk="0123456789abcdef";function lo(t){if(t instanceof Uint8Array){let e="0x0";for(let n of t)e+=Bk[n>>4],e+=Bk[n&15];return BigInt(e)}return te(t)}function ve(t,e){switch(typeof t){case"bigint":return D(t>=-Vu&&t<=Vu,"overflow",e||"value",t),Number(t);case"number":return D(Number.isInteger(t),"underflow",e||"value",t),D(t>=-Vu&&t<=Vu,"overflow",e||"value",t),t;case"string":try{if(t==="")throw new Error("empty string");return ve(BigInt(t),e)}catch(n){D(!1,`invalid numeric string: ${n.message}`,e||"value",t)}}D(!1,"invalid numeric value",e||"value",t)}function Uy(t){return ve(lo(t))}function fr(t,e){let r=$u(t,"value").toString(16);if(e==null)r.length%2&&(r="0"+r);else{let i=ve(e,"width");for(G(i*2>=r.length,`value exceeds width (${i} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:t});r.length<i*2;)r="0"+r}return"0x"+r}function Bt(t){let e=$u(t,"value");if(e===By)return new Uint8Array([]);let n=e.toString(16);n.length%2&&(n="0"+n);let r=new Uint8Array(n.length/2);for(let i=0;i<r.length;i++){let s=i*2;r[i]=parseInt(n.substring(s,s+2),16)}return r}function zn(t){let e=Z(ra(t)?t:Bt(t)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}var Uk="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var uMe=BigInt(0),jk=BigInt(58);function jy(t){let e=ye(t),n=lo(e),r="";for(;n;)r=Uk[Number(n%jk)]+r,n/=jk;for(let i=0;i<e.length&&!e[i];i++)r=Uk[0]+r;return r}function WC(t){t=atob(t);let e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return ye(e)}function QC(t){let e=ye(t),n="";for(let r=0;r<e.length;r++)n+=String.fromCharCode(e[r]);return btoa(n)}var sa=class{filter;emitter;#e;constructor(e,n,r){this.#e=n,ce(this,{emitter:e,filter:r})}async removeListener(){this.#e!=null&&await this.emitter.off(this.filter,this.#e)}};function PW(t,e,n,r,i){D(!1,`invalid codepoint at offset ${e}; ${t}`,"bytes",n)}function Vk(t,e,n,r,i){if(t==="BAD_PREFIX"||t==="UNEXPECTED_CONTINUE"){let s=0;for(let o=e+1;o<n.length&&n[o]>>6===2;o++)s++;return s}return t==="OVERRUN"?n.length-e-1:0}function MW(t,e,n,r,i){return t==="OVERLONG"?(D(typeof i=="number","invalid bad code point for replacement","badCodepoint",i),r.push(i),0):(r.push(65533),Vk(t,e,n,r,i))}var YC=Object.freeze({error:PW,ignore:Vk,replace:MW});function kW(t,e){e==null&&(e=YC.error);let n=ye(t,"bytes"),r=[],i=0;for(;i<n.length;){let s=n[i++];if(s>>7===0){r.push(s);continue}let o=null,a=null;if((s&224)===192)o=1,a=127;else if((s&240)===224)o=2,a=2047;else if((s&248)===240)o=3,a=65535;else{(s&192)===128?i+=e("UNEXPECTED_CONTINUE",i-1,n,r):i+=e("BAD_PREFIX",i-1,n,r);continue}if(i-1+o>=n.length){i+=e("OVERRUN",i-1,n,r);continue}let c=s&(1<<8-o-1)-1;for(let l=0;l<o;l++){let u=n[i];if((u&192)!=128){i+=e("MISSING_CONTINUE",i,n,r),c=null;break}c=c<<6|u&63,i++}if(c!==null){if(c>1114111){i+=e("OUT_OF_RANGE",i-1-o,n,r,c);continue}if(c>=55296&&c<=57343){i+=e("UTF16_SURROGATE",i-1-o,n,r,c);continue}if(c<=a){i+=e("OVERLONG",i-1-o,n,r,c);continue}r.push(c)}}return r}function Gn(t,e){D(typeof t=="string","invalid string value","str",t),e!=null&&(Ly(e),t=t.normalize(e));let n=[];for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i<128)n.push(i);else if(i<2048)n.push(i>>6|192),n.push(i&63|128);else if((i&64512)==55296){r++;let s=t.charCodeAt(r);D(r<t.length&&(s&64512)===56320,"invalid surrogate pair","str",t);let o=65536+((i&1023)<<10)+(s&1023);n.push(o>>18|240),n.push(o>>12&63|128),n.push(o>>6&63|128),n.push(o&63|128)}else n.push(i>>12|224),n.push(i>>6&63|128),n.push(i&63|128)}return new Uint8Array(n)}function LW(t){return t.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function uo(t,e){return LW(kW(t,e))}function Vy(t){async function e(n,r){G(r==null||!r.cancelled,"request cancelled before sending","CANCELLED");let i=n.url.split(":")[0].toLowerCase();G(i==="http"||i==="https",`unsupported protocol ${i}`,"UNSUPPORTED_OPERATION",{info:{protocol:i},operation:"request"}),G(i==="https"||!n.credentials||n.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let s=null,o=new AbortController,a=setTimeout(()=>{s=Je("request timeout","TIMEOUT"),o.abort()},n.timeout);r&&r.addListener(()=>{s=Je("request cancelled","CANCELLED"),o.abort()});let c=Object.assign({},t,{method:n.method,headers:new Headers(Array.from(n)),body:n.body||void 0,signal:o.signal}),l;try{l=await fetch(n.url,c)}catch(f){throw clearTimeout(a),s||f}clearTimeout(a);let u={};l.headers.forEach((f,p)=>{u[p.toLowerCase()]=f});let d=await l.arrayBuffer(),h=d==null?null:new Uint8Array(d);return{statusCode:l.status,statusMessage:l.statusText,headers:u,body:h}}return e}var bMe=Vy({});var FW=12,BW=250,Hk=Vy(),UW=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),jW=new RegExp("^ipfs://(ipfs/)?(.*)$","i"),JC=!1;async function qk(t,e){try{let n=t.match(UW);if(!n)throw new Error("invalid data");return new Ls(200,"OK",{"content-type":n[1]||"text/plain"},n[2]?WC(n[3]):VW(n[3]))}catch{return new Ls(599,"BAD REQUEST (invalid data: URI)",{},null,new Or(t))}}function zk(t){async function e(n,r){try{let i=n.match(jW);if(!i)throw new Error("invalid link");return new Or(`${t}${i[2]}`)}catch{return new Ls(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Or(n))}}return e}var Hy={data:qk,ipfs:zk("https://gateway.ipfs.io/ipfs/")},Gk=new WeakMap,Nf=class{#e;#t;constructor(e){this.#e=[],this.#t=!1,Gk.set(e,()=>{if(!this.#t){this.#t=!0;for(let n of this.#e)setTimeout(()=>{n()},0);this.#e=[]}})}addListener(e){G(!this.#t,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#e.push(e)}get cancelled(){return this.#t}checkSignal(){G(!this.cancelled,"cancelled","CANCELLED",{})}};function $y(t){if(t==null)throw new Error("missing signal; should not happen");return t.checkSignal(),t}var Or=class t{#e;#t;#n;#r;#i;#o;#s;#a;#d;#l;#p;#g;#c;#u;#h;get url(){return this.#o}set url(e){this.#o=String(e)}get body(){return this.#s==null?null:new Uint8Array(this.#s)}set body(e){if(e==null)this.#s=void 0,this.#a=void 0;else if(typeof e=="string")this.#s=Gn(e),this.#a="text/plain";else if(e instanceof Uint8Array)this.#s=e,this.#a="application/octet-stream";else if(typeof e=="object")this.#s=Gn(JSON.stringify(e)),this.#a="application/json";else throw new Error("invalid body")}hasBody(){return this.#s!=null}get method(){return this.#r?this.#r:this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),this.#r=String(e).toUpperCase()}get headers(){let e=Object.assign({},this.#n);return this.#d&&(e.authorization=`Basic ${QC(Gn(this.#d))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&this.#a&&(e["content-type"]=this.#a),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,n){this.#n[String(e).toLowerCase()]=String(n)}clearHeaders(){this.#n={}}[Symbol.iterator](){let e=this.headers,n=Object.keys(e),r=0;return{next:()=>{if(r<n.length){let i=n[r++];return{value:[i,e[i]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#d||null}setCredentials(e,n){D(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#d=`${e}:${n}`}get allowGzip(){return this.#t}set allowGzip(e){this.#t=!!e}get allowInsecureAuthentication(){return!!this.#e}set allowInsecureAuthentication(e){this.#e=!!e}get timeout(){return this.#i}set timeout(e){D(e>=0,"timeout must be non-zero","timeout",e),this.#i=e}get preflightFunc(){return this.#l||null}set preflightFunc(e){this.#l=e}get processFunc(){return this.#p||null}set processFunc(e){this.#p=e}get retryFunc(){return this.#g||null}set retryFunc(e){this.#g=e}get getUrlFunc(){return this.#h||Hk}set getUrlFunc(e){this.#h=e}constructor(e){this.#o=String(e),this.#e=!1,this.#t=!0,this.#n={},this.#r="",this.#i=3e5,this.#u={slotInterval:BW,maxAttempts:FW},this.#h=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#s?Z(this.#s):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(this.#u.slotInterval=e.slotInterval),e.maxAttempts!=null&&(this.#u.maxAttempts=e.maxAttempts)}async#f(e,n,r,i,s){if(e>=this.#u.maxAttempts)return s.makeServerError("exceeded maximum retry limit");G($k()<=n,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:i}),r>0&&await HW(r);let o=this.clone(),a=(o.url.split(":")[0]||"").toLowerCase();if(a in Hy){let u=await Hy[a](o.url,$y(i.#c));if(u instanceof Ls){let d=u;if(this.processFunc){$y(i.#c);try{d=await this.processFunc(o,d)}catch(h){(h.throttle==null||typeof h.stall!="number")&&d.makeServerError("error in post-processing function",h).assertOk()}}return d}o=u}this.preflightFunc&&(o=await this.preflightFunc(o));let c=await this.getUrlFunc(o,$y(i.#c)),l=new Ls(c.statusCode,c.statusMessage,c.headers,c.body,i);if(l.statusCode===301||l.statusCode===302){try{let u=l.headers.location||"";return o.redirect(u).#f(e+1,n,0,i,l)}catch{}return l}else if(l.statusCode===429&&(this.retryFunc==null||await this.retryFunc(o,l,e))){let u=l.headers["retry-after"],d=this.#u.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof u=="string"&&u.match(/^[1-9][0-9]*$/)&&(d=parseInt(u)),o.clone().#f(e+1,n,d,i,l)}if(this.processFunc){$y(i.#c);try{l=await this.processFunc(o,l)}catch(u){(u.throttle==null||typeof u.stall!="number")&&l.makeServerError("error in post-processing function",u).assertOk();let d=this.#u.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return u.stall>=0&&(d=u.stall),o.clone().#f(e+1,n,d,i,l)}}return l}send(){return G(this.#c==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#c=new Nf(this),this.#f(0,$k()+this.timeout,0,this,new Ls(0,"",{},null,this))}cancel(){G(this.#c!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});let e=Gk.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){let n=this.url.split(":")[0].toLowerCase(),r=e.split(":")[0].toLowerCase();G(this.method==="GET"&&(n!=="https"||r!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});let i=new t(e);return i.method="GET",i.allowGzip=this.allowGzip,i.timeout=this.timeout,i.#n=Object.assign({},this.#n),this.#s&&(i.#s=new Uint8Array(this.#s)),i.#a=this.#a,i}clone(){let e=new t(this.url);return e.#r=this.#r,this.#s&&(e.#s=this.#s),e.#a=this.#a,e.#n=Object.assign({},this.#n),e.#d=this.#d,this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),e.#l=this.#l,e.#p=this.#p,e.#g=this.#g,e.#u=Object.assign({},this.#u),e.#h=this.#h,e}static lockConfig(){JC=!0}static getGateway(e){return Hy[e.toLowerCase()]||null}static registerGateway(e,n){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(JC)throw new Error("gateways locked");Hy[e]=n}static registerGetUrl(e){if(JC)throw new Error("gateways locked");Hk=e}static createGetUrlFunc(e){return Vy(e)}static createDataGateway(){return qk}static createIpfsGatewayFunc(e){return zk(e)}},Ls=class t{#e;#t;#n;#r;#i;#o;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#r?Z(this.#r):"null"}>`}get statusCode(){return this.#e}get statusMessage(){return this.#t}get headers(){return Object.assign({},this.#n)}get body(){return this.#r==null?null:new Uint8Array(this.#r)}get bodyText(){try{return this.#r==null?"":uo(this.#r)}catch{G(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{G(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){let e=this.headers,n=Object.keys(e),r=0;return{next:()=>{if(r<n.length){let i=n[r++];return{value:[i,e[i]],done:!1}}return{value:void 0,done:!0}}}}constructor(e,n,r,i,s){this.#e=e,this.#t=n,this.#n=Object.keys(r).reduce((o,a)=>(o[a.toLowerCase()]=String(r[a]),o),{}),this.#r=i==null?null:new Uint8Array(i),this.#i=s||null,this.#o={message:""}}makeServerError(e,n){let r;e?r=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,r=`CLIENT ESCALATED SERVER ERROR (${e})`);let i=new t(599,r,this.headers,this.body,this.#i||void 0);return i.#o={message:e,error:n},i}throwThrottleError(e,n){n==null?n=-1:D(Number.isInteger(n)&&n>=0,"invalid stall timeout","stall",n);let r=new Error(e||"throttling requests");throw ce(r,{stall:n,throttle:!0}),r}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return this.#r!=null}get request(){return this.#i}ok(){return this.#o.message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:n}=this.#o;e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let i=null;try{this.#r&&(i=uo(this.#r))}catch{}G(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:n,info:{requestUrl:r,responseBody:i,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};function $k(){return new Date().getTime()}function VW(t){return Gn(t.replace(/%([0-9a-f][0-9a-f])/gi,(e,n)=>String.fromCharCode(parseInt(n,16))))}function HW(t){return new Promise(e=>setTimeout(e,t))}var $W=BigInt(-1),Ji=BigInt(0),zu=BigInt(1),qW=BigInt(5),qu={},Gu="0000";for(;Gu.length<80;)Gu+=Gu;function Gc(t){let e=Gu;for(;e.length<t;)e+=e;return BigInt("1"+e.substring(0,t))}function xf(t,e,n){let r=BigInt(e.width);if(e.signed){let i=zu<<r-zu;G(n==null||t>=-i&&t<i,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:t}),t>Ji?t=ia(gi(t,r),r):t=-ia(gi(-t,r),r)}else{let i=zu<<r;G(n==null||t>=0&&t<i,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:t}),t=(t%i+i)%i&i-zu}return t}function ZC(t){typeof t=="number"&&(t=`fixed128x${t}`);let e=!0,n=128,r=18;if(typeof t=="string"){if(t!=="fixed")if(t==="ufixed")e=!1;else{let s=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);D(s,"invalid fixed format","format",t),e=s[1]!=="u",n=parseInt(s[2]),r=parseInt(s[3])}}else if(t){let s=t,o=(a,c,l)=>s[a]==null?l:(D(typeof s[a]===c,"invalid fixed format ("+a+" not "+c+")","format."+a,s[a]),s[a]);e=o("signed","boolean",e),n=o("width","number",n),r=o("decimals","number",r)}D(n%8===0,"invalid FixedNumber width (not byte aligned)","format.width",n),D(r<=80,"invalid FixedNumber decimals (too large)","format.decimals",r);let i=(e?"":"u")+"fixed"+String(n)+"x"+String(r);return{signed:e,width:n,decimals:r,name:i}}function zW(t,e){let n="";t<Ji&&(n="-",t*=$W);let r=t.toString();if(e===0)return n+r;for(;r.length<=e;)r=Gu+r;let i=r.length-e;for(r=r.substring(0,i)+"."+r.substring(i);r[0]==="0"&&r[1]!==".";)r=r.substring(1);for(;r[r.length-1]==="0"&&r[r.length-2]!==".";)r=r.substring(0,r.length-1);return n+r}var Rf=class t{format;#e;#t;#n;_value;constructor(e,n,r){Wi(e,qu,"FixedNumber"),this.#t=n,this.#e=r;let i=zW(n,r.decimals);ce(this,{format:r.name,_value:i}),this.#n=Gc(r.decimals)}get signed(){return this.#e.signed}get width(){return this.#e.width}get decimals(){return this.#e.decimals}get value(){return this.#t}#r(e){D(this.format===e.format,"incompatible format; use fixedNumber.toFormat","other",e)}#i(e,n){return e=xf(e,this.#e,n),new t(qu,e,this.#e)}#o(e,n){return this.#r(e),this.#i(this.#t+e.#t,n)}addUnsafe(e){return this.#o(e)}add(e){return this.#o(e,"add")}#s(e,n){return this.#r(e),this.#i(this.#t-e.#t,n)}subUnsafe(e){return this.#s(e)}sub(e){return this.#s(e,"sub")}#a(e,n){return this.#r(e),this.#i(this.#t*e.#t/this.#n,n)}mulUnsafe(e){return this.#a(e)}mul(e){return this.#a(e,"mul")}mulSignal(e){this.#r(e);let n=this.#t*e.#t;return G(n%this.#n===Ji,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),this.#i(n/this.#n,"mulSignal")}#d(e,n){return G(e.#t!==Ji,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(e),this.#i(this.#t*this.#n/e.#t,n)}divUnsafe(e){return this.#d(e)}div(e){return this.#d(e,"div")}divSignal(e){G(e.#t!==Ji,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(e);let n=this.#t*this.#n;return G(n%e.#t===Ji,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),this.#i(n/e.#t,"divSignal")}cmp(e){let n=this.value,r=e.value,i=this.decimals-e.decimals;return i>0?r*=Gc(i):i<0&&(n*=Gc(-i)),n<r?-1:n>r?1:0}eq(e){return this.cmp(e)===0}lt(e){return this.cmp(e)<0}lte(e){return this.cmp(e)<=0}gt(e){return this.cmp(e)>0}gte(e){return this.cmp(e)>=0}floor(){let e=this.#t;return this.#t<Ji&&(e-=this.#n-zu),e=this.#t/this.#n*this.#n,this.#i(e,"floor")}ceiling(){let e=this.#t;return this.#t>Ji&&(e+=this.#n-zu),e=this.#t/this.#n*this.#n,this.#i(e,"ceiling")}round(e){if(e==null&&(e=0),e>=this.decimals)return this;let n=this.decimals-e,r=qW*Gc(n-1),i=this.value+r,s=Gc(n);return i=i/s*s,xf(i,this.#e,"round"),new t(qu,i,this.#e)}isZero(){return this.#t===Ji}isNegative(){return this.#t<Ji}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return t.fromString(this.toString(),e)}static fromValue(e,n,r){let i=n==null?0:ve(n),s=ZC(r),o=te(e,"value"),a=i-s.decimals;if(a>0){let c=Gc(a);G(o%c===Ji,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:e}),o/=c}else a<0&&(o*=Gc(-a));return xf(o,s,"fromValue"),new t(qu,o,s)}static fromString(e,n){let r=e.match(/^(-?)([0-9]*)\.?([0-9]*)$/);D(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",e);let i=ZC(n),s=r[2]||"0",o=r[3]||"";for(;o.length<i.decimals;)o+=Gu;G(o.substring(i.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:e}),o=o.substring(0,i.decimals);let a=BigInt(r[1]+s+o);return xf(a,i,"fromString"),new t(qu,a,i)}static fromBytes(e,n){let r=lo(ye(e,"value")),i=ZC(n);return i.signed&&(r=ia(r,i.width)),xf(r,i,"fromBytes"),new t(qu,r,i)}};function GW(t){let e=t.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function Kk(t,e,n){let r=0;for(let i=0;i<n;i++)r=r*256+t[e+i];return r}function Wk(t,e,n,r){let i=[];for(;n<e+1+r;){let s=Qk(t,n);i.push(s.result),n+=s.consumed,G(n<=e+1+r,"child data too short","BUFFER_OVERRUN",{buffer:t,length:r,offset:e})}return{consumed:1+r,result:i}}function Qk(t,e){G(t.length!==0,"data too short","BUFFER_OVERRUN",{buffer:t,length:0,offset:1});let n=r=>{G(r<=t.length,"data short segment too short","BUFFER_OVERRUN",{buffer:t,length:t.length,offset:r})};if(t[e]>=248){let r=t[e]-247;n(e+1+r);let i=Kk(t,e+1,r);return n(e+1+r+i),Wk(t,e,e+1+r,r+i)}else if(t[e]>=192){let r=t[e]-192;return n(e+1+r),Wk(t,e,e+1,r)}else if(t[e]>=184){let r=t[e]-183;n(e+1+r);let i=Kk(t,e+1,r);n(e+1+r+i);let s=Z(t.slice(e+1+r,e+1+r+i));return{consumed:1+r+i,result:s}}else if(t[e]>=128){let r=t[e]-128;n(e+1+r);let i=Z(t.slice(e+1,e+1+r));return{consumed:1+r,result:i}}return{consumed:1,result:GW(t[e])}}function oa(t){let e=ye(t,"data"),n=Qk(e,0);return D(n.consumed===e.length,"unexpected junk after rlp payload","data",t),n.result}function Yk(t){let e=[];for(;t;)e.unshift(t&255),t>>=8;return e}function Zk(t){if(Array.isArray(t)){let r=[];if(t.forEach(function(s){r=r.concat(Zk(s))}),r.length<=55)return r.unshift(192+r.length),r;let i=Yk(r.length);return i.unshift(247+i.length),i.concat(r)}let e=Array.prototype.slice.call(ye(t,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;let n=Yk(e.length);return n.unshift(183+n.length),n.concat(e)}var Jk="0123456789abcdef";function mi(t){let e="0x";for(let n of Zk(t))e+=Jk[n>>4],e+=Jk[n&15];return e}var KW=["wei","kwei","mwei","gwei","szabo","finney","ether"];function Zi(t,e){let n=18;if(typeof e=="string"){let r=KW.indexOf(e);D(r>=0,"invalid unit","unit",e),n=3*r}else e!=null&&(n=ve(e,"unit"));return Rf.fromValue(t,n,{decimals:n,width:512}).toString()}function qy(t){return Zi(t,18)}var xn=32,XC=new Uint8Array(xn),XW=["then"],zy={},t2=new WeakMap;function Kc(t){return t2.get(t)}function Xk(t,e){t2.set(t,e)}function Of(t,e){let n=new Error(`deferred error during ABI decoding triggered accessing ${t}`);throw n.error=e,n}function eA(t,e,n){return t.indexOf(null)>=0?e.map((r,i)=>r instanceof ho?eA(Kc(r),r,n):r):t.reduce((r,i,s)=>{let o=e.getValue(i);return i in r||(n&&o instanceof ho&&(o=eA(Kc(o),o,n)),r[i]=o),r},{})}var ho=class t extends Array{#e;constructor(...e){let n=e[0],r=e[1],i=(e[2]||[]).slice(),s=!0;n!==zy&&(r=e,i=[],s=!1),super(r.length),r.forEach((c,l)=>{this[l]=c});let o=i.reduce((c,l)=>(typeof l=="string"&&c.set(l,(c.get(l)||0)+1),c),new Map);if(Xk(this,Object.freeze(r.map((c,l)=>{let u=i[l];return u!=null&&o.get(u)===1?u:null}))),this.#e=[],this.#e==null&&this.#e,!s)return;Object.freeze(this);let a=new Proxy(this,{get:(c,l,u)=>{if(typeof l=="string"){if(l.match(/^[0-9]+$/)){let h=ve(l,"%index");if(h<0||h>=this.length)throw new RangeError("out of result range");let f=c[h];return f instanceof Error&&Of(`index ${h}`,f),f}if(XW.indexOf(l)>=0)return Reflect.get(c,l,u);let d=c[l];if(d instanceof Function)return function(...h){return d.apply(this===u?c:this,h)};if(!(l in c))return c.getValue.apply(this===u?c:this,[l])}return Reflect.get(c,l,u)}});return Xk(a,Kc(this)),a}toArray(e){let n=[];return this.forEach((r,i)=>{r instanceof Error&&Of(`index ${i}`,r),e&&r instanceof t&&(r=r.toArray(e)),n.push(r)}),n}toObject(e){let n=Kc(this);return n.reduce((r,i,s)=>(G(i!=null,`value at index ${s} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),eA(n,this,e)),{})}slice(e,n){e==null&&(e=0),e<0&&(e+=this.length,e<0&&(e=0)),n==null&&(n=this.length),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length);let r=Kc(this),i=[],s=[];for(let o=e;o<n;o++)i.push(this[o]),s.push(r[o]);return new t(zy,i,s)}filter(e,n){let r=Kc(this),i=[],s=[];for(let o=0;o<this.length;o++){let a=this[o];a instanceof Error&&Of(`index ${o}`,a),e.call(n,a,o,this)&&(i.push(a),s.push(r[o]))}return new t(zy,i,s)}map(e,n){let r=[];for(let i=0;i<this.length;i++){let s=this[i];s instanceof Error&&Of(`index ${i}`,s),r.push(e.call(n,s,i,this))}return r}getValue(e){let n=Kc(this).indexOf(e);if(n===-1)return;let r=this[n];return r instanceof Error&&Of(`property ${JSON.stringify(e)}`,r.error),r}static fromItems(e,n){return new t(zy,e,n)}};function e2(t){let e=Bt(t);return G(e.length<=xn,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:xn,offset:e.length}),e.length!==xn&&(e=Kt(Ze([XC.slice(e.length%xn),e]))),e}var en=class{name;type;localName;dynamic;constructor(e,n,r,i){ce(this,{name:e,type:n,localName:r,dynamic:i},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,n){D(!1,e,this.localName,n)}},Wc=class{#e;#t;constructor(){this.#e=[],this.#t=0}get data(){return Ze(this.#e)}get length(){return this.#t}#n(e){return this.#e.push(e),this.#t+=e.length,e.length}appendWriter(e){return this.#n(Kt(e.data))}writeBytes(e){let n=Kt(e),r=n.length%xn;return r&&(n=Kt(Ze([n,XC.slice(r)]))),this.#n(n)}writeValue(e){return this.#n(e2(e))}writeUpdatableValue(){let e=this.#e.length;return this.#e.push(XC),this.#t+=xn,n=>{this.#e[e]=e2(n)}}},Gy=class t{allowLoose;#e;#t;#n;#r;#i;constructor(e,n,r){ce(this,{allowLoose:!!n}),this.#e=Kt(e),this.#n=0,this.#r=null,this.#i=r??1024,this.#t=0}get data(){return Z(this.#e)}get dataLength(){return this.#e.length}get consumed(){return this.#t}get bytes(){return new Uint8Array(this.#e)}#o(e){if(this.#r)return this.#r.#o(e);this.#n+=e,G(this.#i<1||this.#n<=this.#i*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#i} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Kt(this.#e),offset:this.#t,length:e,info:{bytesRead:this.#n,dataLength:this.dataLength}})}#s(e,n,r){let i=Math.ceil(n/xn)*xn;return this.#t+i>this.#e.length&&(this.allowLoose&&r&&this.#t+n<=this.#e.length?i=n:G(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Kt(this.#e),length:this.#e.length,offset:this.#t+i})),this.#e.slice(this.#t,this.#t+i)}subReader(e){let n=new t(this.#e.slice(this.#t+e),this.allowLoose,this.#i);return n.#r=this,n}readBytes(e,n){let r=this.#s(0,e,!!n);return this.#o(e),this.#t+=r.length,r.slice(0,e)}readValue(){return lo(this.readBytes(xn))}readIndex(){return Uy(this.readBytes(xn))}};function Pf(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Mf(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function n2(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Pf(t.outputLen),Pf(t.blockLen)}function fo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ky(t,e){Mf(t);let n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}var Wy=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var r2=t=>t instanceof Uint8Array;var i2=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Qy=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Xi=(t,e)=>t<<32-e|t>>>e,eQ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!eQ)throw new Error("Non little-endian hardware is not supported");function tQ(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ca(t){if(typeof t=="string"&&(t=tQ(t)),!r2(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function s2(...t){let e=new Uint8Array(t.reduce((r,i)=>r+i.length,0)),n=0;return t.forEach(r=>{if(!r2(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}var aa=class{clone(){return this._cloneInto()}},ake={}.toString;function Ku(t){let e=r=>t().update(ca(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function o2(t){let e=(r,i)=>t(i).update(ca(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function a2(t=32){if(Wy&&typeof Wy.getRandomValues=="function")return Wy.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}var Yy=class extends aa{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,n2(e);let r=ca(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return fo(this),this.iHash.update(e),this}digestInto(e){fo(this),Mf(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},tA=(t,e,n)=>new Yy(t,e).update(n).digest();tA.create=(t,e)=>new Yy(t,e);function nQ(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);let i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}var Wu=class extends aa{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Qy(this.buffer)}update(e){fo(this);let{view:n,buffer:r,blockLen:i}=this;e=ca(e);let s=e.length;for(let o=0;o<s;){let a=Math.min(i-this.pos,s-o);if(a===i){let c=Qy(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fo(this),Ky(e,this),this.finished=!0;let{buffer:n,view:r,blockLen:i,isLE:s}=this,{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;nQ(r,i-8,BigInt(this.length*8),s),this.process(r,0);let a=Qy(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],s)}digest(){let{buffer:e,outputLen:n}=this;this.digestInto(e);let r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};var rQ=(t,e,n)=>t&e^~t&n,iQ=(t,e,n)=>t&e^t&n^e&n,sQ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),la=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ua=new Uint32Array(64),nA=class extends Wu{constructor(){super(64,32,8,!1),this.A=la[0]|0,this.B=la[1]|0,this.C=la[2]|0,this.D=la[3]|0,this.E=la[4]|0,this.F=la[5]|0,this.G=la[6]|0,this.H=la[7]|0}get(){let{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let d=0;d<16;d++,n+=4)ua[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){let h=ua[d-15],f=ua[d-2],p=Xi(h,7)^Xi(h,18)^h>>>3,g=Xi(f,17)^Xi(f,19)^f>>>10;ua[d]=g+ua[d-7]+p+ua[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){let h=Xi(a,6)^Xi(a,11)^Xi(a,25),f=u+h+rQ(a,c,l)+sQ[d]+ua[d]|0,g=(Xi(r,2)^Xi(r,13)^Xi(r,22))+iQ(r,i,s)|0;u=l,l=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){ua.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var Jy=Ku(()=>new nA);var Zy=BigInt(4294967295),rA=BigInt(32);function c2(t,e=!1){return e?{h:Number(t&Zy),l:Number(t>>rA&Zy)}:{h:Number(t>>rA&Zy)|0,l:Number(t&Zy)|0}}function iA(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){let{h:s,l:o}=c2(t[i],e);[n[i],r[i]]=[s,o]}return[n,r]}var oQ=(t,e)=>BigInt(t>>>0)<<rA|BigInt(e>>>0),aQ=(t,e,n)=>t>>>n,cQ=(t,e,n)=>t<<32-n|e>>>n,lQ=(t,e,n)=>t>>>n|e<<32-n,uQ=(t,e,n)=>t<<32-n|e>>>n,dQ=(t,e,n)=>t<<64-n|e>>>n-32,hQ=(t,e,n)=>t>>>n-32|e<<64-n,fQ=(t,e)=>e,pQ=(t,e)=>t,sA=(t,e,n)=>t<<n|e>>>32-n,oA=(t,e,n)=>e<<n|t>>>32-n,aA=(t,e,n)=>e<<n-32|t>>>64-n,cA=(t,e,n)=>t<<n-32|e>>>64-n;function gQ(t,e,n,r){let i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}var mQ=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),yQ=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,wQ=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),vQ=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,bQ=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),EQ=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0;var IQ={fromBig:c2,split:iA,toBig:oQ,shrSH:aQ,shrSL:cQ,rotrSH:lQ,rotrSL:uQ,rotrBH:dQ,rotrBL:hQ,rotr32H:fQ,rotr32L:pQ,rotlSH:sA,rotlSL:oA,rotlBH:aA,rotlBL:cA,add:gQ,add3L:mQ,add3H:yQ,add4L:wQ,add4H:vQ,add5H:EQ,add5L:bQ},Me=IQ;var[CQ,AQ]=Me.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),da=new Uint32Array(80),ha=new Uint32Array(80),lA=class extends Wu{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:f,Gl:p,Hh:g,Hl:m}=this;return[e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m]}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,n){for(let I=0;I<16;I++,n+=4)da[I]=e.getUint32(n),ha[I]=e.getUint32(n+=4);for(let I=16;I<80;I++){let L=da[I-15]|0,k=ha[I-15]|0,N=Me.rotrSH(L,k,1)^Me.rotrSH(L,k,8)^Me.shrSH(L,k,7),B=Me.rotrSL(L,k,1)^Me.rotrSL(L,k,8)^Me.shrSL(L,k,7),U=da[I-2]|0,T=ha[I-2]|0,$=Me.rotrSH(U,T,19)^Me.rotrBH(U,T,61)^Me.shrSH(U,T,6),K=Me.rotrSL(U,T,19)^Me.rotrBL(U,T,61)^Me.shrSL(U,T,6),M=Me.add4L(B,K,ha[I-7],ha[I-16]),v=Me.add4H(M,N,$,da[I-7],da[I-16]);da[I]=v|0,ha[I]=M|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:f,Fl:p,Gh:g,Gl:m,Hh:y,Hl:E}=this;for(let I=0;I<80;I++){let L=Me.rotrSH(d,h,14)^Me.rotrSH(d,h,18)^Me.rotrBH(d,h,41),k=Me.rotrSL(d,h,14)^Me.rotrSL(d,h,18)^Me.rotrBL(d,h,41),N=d&f^~d&g,B=h&p^~h&m,U=Me.add5L(E,k,B,AQ[I],ha[I]),T=Me.add5H(U,y,L,N,CQ[I],da[I]),$=U|0,K=Me.rotrSH(r,i,28)^Me.rotrBH(r,i,34)^Me.rotrBH(r,i,39),M=Me.rotrSL(r,i,28)^Me.rotrBL(r,i,34)^Me.rotrBL(r,i,39),v=r&s^r&a^s&a,b=i&o^i&c^o&c;y=g|0,E=m|0,g=f|0,m=p|0,f=d|0,p=h|0,{h:d,l:h}=Me.add(l|0,u|0,T|0,$|0),l=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;let w=Me.add3L($,M,b);r=Me.add3H(w,T,K,v),i=w|0}({h:r,l:i}=Me.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Me.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Me.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Me.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=Me.add(this.Eh|0,this.El|0,d|0,h|0),{h:f,l:p}=Me.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:m}=Me.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:y,l:E}=Me.add(this.Hh|0,this.Hl|0,y|0,E|0),this.set(r,i,s,o,a,c,l,u,d,h,f,p,g,m,y,E)}roundClean(){da.fill(0),ha.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var l2=Ku(()=>new lA);function SQ(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}var u2=SQ(),_ke=u2.crypto||u2.msCrypto;function uA(t){switch(t){case"sha256":return Jy.create();case"sha512":return l2.create()}D(!1,"invalid hashing algorithm name","algorithm",t)}var[f2,p2,g2]=[[],[],[]],_Q=BigInt(0),kf=BigInt(1),TQ=BigInt(2),DQ=BigInt(7),NQ=BigInt(256),xQ=BigInt(113);for(let t=0,e=kf,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],f2.push(2*(5*r+n)),p2.push((t+1)*(t+2)/2%64);let i=_Q;for(let s=0;s<7;s++)e=(e<<kf^(e>>DQ)*xQ)%NQ,e&TQ&&(i^=kf<<(kf<<BigInt(s))-kf);g2.push(i)}var[RQ,OQ]=iA(g2,!0),d2=(t,e,n)=>n>32?aA(t,e,n):sA(t,e,n),h2=(t,e,n)=>n>32?cA(t,e,n):oA(t,e,n);function PQ(t,e=24){let n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],d=d2(l,u,1)^n[a],h=h2(l,u,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=d,t[o+f+1]^=h}let i=t[2],s=t[3];for(let o=0;o<24;o++){let a=p2[o],c=d2(i,s,a),l=h2(i,s,a),u=f2[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=RQ[r],t[1]^=OQ[r]}n.fill(0)}var Xy=class t extends aa{constructor(e,n,r,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Pf(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=i2(this.state)}keccak(){PQ(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){fo(this);let{blockLen:n,state:r}=this;e=ca(e);let i=e.length;for(let s=0;s<i;){let o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){fo(this,!1),Mf(e),this.finish();let n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();let o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Pf(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ky(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new t(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}},fa=(t,e,n)=>Ku(()=>new Xy(e,t,n)),Rke=fa(6,144,224/8),Oke=fa(6,136,256/8),Pke=fa(6,104,384/8),Mke=fa(6,72,512/8),kke=fa(1,144,224/8),m2=fa(1,136,256/8),Lke=fa(1,104,384/8),Fke=fa(1,72,512/8),y2=(t,e,n)=>o2((r={})=>new Xy(e,t,r.dkLen===void 0?n:r.dkLen,!0)),Bke=y2(31,168,128/8),Uke=y2(31,136,256/8);var w2=!1,v2=function(t){return m2(t)},b2=v2;function gt(t){let e=ye(t,"data");return Z(b2(e))}gt._=v2;gt.lock=function(){w2=!0};gt.register=function(t){if(w2)throw new TypeError("keccak256 is locked");b2=t};Object.freeze(gt);var E2=function(t){return uA("sha256").update(t).digest()},I2=function(t){return uA("sha512").update(t).digest()},C2=E2,A2=I2,S2=!1,_2=!1;function pa(t){let e=ye(t,"data");return Z(C2(e))}pa._=E2;pa.lock=function(){S2=!0};pa.register=function(t){if(S2)throw new Error("sha256 is locked");C2=t};Object.freeze(pa);function ew(t){let e=ye(t,"data");return Z(A2(e))}ew._=I2;ew.lock=function(){_2=!0};ew.register=function(t){if(_2)throw new Error("sha512 is locked");A2=t};Object.freeze(pa);var pA={};ah(pA,{bitGet:()=>jQ,bitLen:()=>UQ,bitMask:()=>Lf,bitSet:()=>VQ,bytesToHex:()=>Qc,bytesToNumberBE:()=>po,bytesToNumberLE:()=>rw,concatBytes:()=>Qu,createHmacDrbg:()=>fA,ensureBytes:()=>Qr,equalBytes:()=>FQ,hexToBytes:()=>Yc,hexToNumber:()=>hA,numberToBytesBE:()=>ga,numberToBytesLE:()=>iw,numberToHexUnpadded:()=>N2,numberToVarBytesBE:()=>LQ,utf8ToBytes:()=>BQ,validateObject:()=>ma});var D2=BigInt(0),tw=BigInt(1),MQ=BigInt(2),nw=t=>t instanceof Uint8Array,kQ=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Qc(t){if(!nw(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=kQ[t[n]];return e}function N2(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function hA(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Yc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);let e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){let i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function po(t){return hA(Qc(t))}function rw(t){if(!nw(t))throw new Error("Uint8Array expected");return hA(Qc(Uint8Array.from(t).reverse()))}function ga(t,e){return Yc(t.toString(16).padStart(e*2,"0"))}function iw(t,e){return ga(t,e).reverse()}function LQ(t){return Yc(N2(t))}function Qr(t,e,n){let r;if(typeof e=="string")try{r=Yc(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(nw(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);let i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Qu(...t){let e=new Uint8Array(t.reduce((r,i)=>r+i.length,0)),n=0;return t.forEach(r=>{if(!nw(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function FQ(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function BQ(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function UQ(t){let e;for(e=0;t>D2;t>>=tw,e+=1);return e}function jQ(t,e){return t>>BigInt(e)&tw}var VQ=(t,e,n)=>t|(n?tw:D2)<<BigInt(e),Lf=t=>(MQ<<BigInt(t-1))-tw,dA=t=>new Uint8Array(t),T2=t=>Uint8Array.from(t);function fA(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=dA(t),i=dA(t),s=0,o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),c=(d=dA())=>{i=a(T2([0]),d),r=a(),d.length!==0&&(i=a(T2([1]),d),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0,h=[];for(;d<e;){r=a();let f=r.slice();h.push(f),d+=r.length}return Qu(...h)};return(d,h)=>{o(),c(d);let f;for(;!(f=h(l()));)c();return o(),f}}var HQ={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ma(t,e,n={}){let r=(i,s,o)=>{let a=HQ[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);let c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error(`Invalid param ${String(i)}=${c} (${typeof c}), expected ${s}`)};for(let[i,s]of Object.entries(e))r(i,s,!1);for(let[i,s]of Object.entries(n))r(i,s,!0);return t}var cn=BigInt(0),Wt=BigInt(1),Jc=BigInt(2),$Q=BigInt(3),gA=BigInt(4),x2=BigInt(5),R2=BigInt(8),qQ=BigInt(9),zQ=BigInt(16);function Kn(t,e){let n=t%e;return n>=cn?n:e+n}function GQ(t,e,n){if(n<=cn||e<cn)throw new Error("Expected power/modulo > 0");if(n===Wt)return cn;let r=Wt;for(;e>cn;)e&Wt&&(r=r*t%n),t=t*t%n,e>>=Wt;return r}function Yr(t,e,n){let r=t;for(;e-- >cn;)r*=r,r%=n;return r}function sw(t,e){if(t===cn||e<=cn)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Kn(t,e),r=e,i=cn,s=Wt,o=Wt,a=cn;for(;n!==cn;){let l=r/n,u=r%n,d=i-o*l,h=s-a*l;r=n,n=u,i=o,s=a,o=d,a=h}if(r!==Wt)throw new Error("invert: does not exist");return Kn(i,e)}function KQ(t){let e=(t-Wt)/Jc,n,r,i;for(n=t-Wt,r=0;n%Jc===cn;n/=Jc,r++);for(i=Jc;i<t&&GQ(i,e,t)!==t-Wt;i++);if(r===1){let o=(t+Wt)/gA;return function(c,l){let u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}let s=(n+Wt)/Jc;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,u=a.pow(a.mul(a.ONE,i),n),d=a.pow(c,s),h=a.pow(c,n);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let f=1;for(let g=a.sqr(h);f<l&&!a.eql(g,a.ONE);f++)g=a.sqr(g);let p=a.pow(u,Wt<<BigInt(l-f-1));u=a.sqr(p),d=a.mul(d,p),h=a.mul(h,u),l=f}return d}}function WQ(t){if(t%gA===$Q){let e=(t+Wt)/gA;return function(r,i){let s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%R2===x2){let e=(t-x2)/R2;return function(r,i){let s=r.mul(i,Jc),o=r.pow(s,e),a=r.mul(i,o),c=r.mul(r.mul(a,Jc),o),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),i))throw new Error("Cannot find square root");return l}}return t%zQ,KQ(t)}var QQ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function mA(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=QQ.reduce((r,i)=>(r[i]="function",r),e);return ma(t,n)}function YQ(t,e,n){if(n<cn)throw new Error("Expected power > 0");if(n===cn)return t.ONE;if(n===Wt)return e;let r=t.ONE,i=e;for(;n>cn;)n&Wt&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Wt;return r}function JQ(t,e){let n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function yA(t,e){let n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function O2(t,e,n=!1,r={}){if(t<=cn)throw new Error(`Expected Field ORDER > 0, got ${t}`);let{nBitLength:i,nByteLength:s}=yA(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=WQ(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:Lf(i),ZERO:cn,ONE:Wt,create:c=>Kn(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return cn<=c&&c<t},is0:c=>c===cn,isOdd:c=>(c&Wt)===Wt,neg:c=>Kn(-c,t),eql:(c,l)=>c===l,sqr:c=>Kn(c*c,t),add:(c,l)=>Kn(c+l,t),sub:(c,l)=>Kn(c-l,t),mul:(c,l)=>Kn(c*l,t),pow:(c,l)=>YQ(a,c,l),div:(c,l)=>Kn(c*sw(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>sw(c,t),sqrt:r.sqrt||(c=>o(a,c)),invertBatch:c=>JQ(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?iw(c,s):ga(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?rw(c):po(c)}});return Object.freeze(a)}function P2(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function wA(t){let e=P2(t);return e+Math.ceil(e/2)}function M2(t,e,n=!1){let r=t.length,i=P2(e),s=wA(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);let o=n?po(t):rw(t),a=Kn(o,e-Wt)+Wt;return n?iw(a,i):ga(a,i)}var XQ=BigInt(0),vA=BigInt(1);function k2(t,e){let n=(i,s)=>{let o=s.negate();return i?o:s},r=i=>{let s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>XQ;)s&vA&&(o=o.add(a)),a=a.double(),s>>=vA;return o},precomputeWindow(i,s){let{windows:o,windowSize:a}=r(s),c=[],l=i,u=l;for(let d=0;d<o;d++){u=l,c.push(u);for(let h=1;h<a;h++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(i,s,o){let{windows:a,windowSize:c}=r(i),l=t.ZERO,u=t.BASE,d=BigInt(2**i-1),h=2**i,f=BigInt(i);for(let p=0;p<a;p++){let g=p*c,m=Number(o&d);o>>=f,m>c&&(m-=h,o+=vA);let y=g,E=g+Math.abs(m)-1,I=p%2!==0,L=m<0;m===0?u=u.add(n(I,s[y])):l=l.add(n(L,s[E]))}return{p:l,f:u}},wNAFCached(i,s,o,a){let c=i._WINDOW_SIZE||1,l=s.get(i);return l||(l=this.precomputeWindow(i,c),c!==1&&s.set(i,a(l))),this.wNAF(c,l,o)}}}function bA(t){return mA(t.Fp),ma(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(fe(H(H({},yA(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}function eY(t){let e=bA(t);ma(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze(H({},e))}var{bytesToNumberBE:tY,hexToBytes:nY}=pA,Zc={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){let{Err:e}=Zc;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");let n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:tY(r),l:t.subarray(n+2)}},toSig(t){let{Err:e}=Zc,n=typeof t=="string"?nY(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");let{d:i,l:s}=Zc._parseInt(n.subarray(2)),{d:o,l:a}=Zc._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){let e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{let u=l.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},go=BigInt(0),yi=BigInt(1),t2e=BigInt(2),L2=BigInt(3),n2e=BigInt(4);function rY(t){let e=eY(t),{Fp:n}=e,r=e.toBytes||((p,g,m)=>{let y=g.toAffine();return Qu(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{let g=p.subarray(1),m=n.fromBytes(g.subarray(0,n.BYTES)),y=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:m,y}});function s(p){let{a:g,b:m}=e,y=n.sqr(p),E=n.mul(y,p);return n.add(n.add(E,n.mul(p,g)),m)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&go<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(p){let{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:y,n:E}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Qc(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let I;try{I=typeof p=="bigint"?p:po(Qr("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return y&&(I=Kn(I,E)),a(I),I}let l=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(g,m,y){if(this.px=g,this.py=m,this.pz=y,g==null||!n.isValid(g))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(g){let{x:m,y}=g||{};if(!g||!n.isValid(m)||!n.isValid(y))throw new Error("invalid affine point");if(g instanceof d)throw new Error("projective point not allowed");let E=I=>n.eql(I,n.ZERO);return E(m)&&E(y)?d.ZERO:new d(m,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){let m=n.invertBatch(g.map(y=>y.pz));return g.map((y,E)=>y.toAffine(m[E])).map(d.fromAffine)}static fromHex(g){let m=d.fromAffine(i(Qr("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return d.BASE.multiply(c(g))}_setWindowSize(g){this._WINDOW_SIZE=g,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:g,y:m}=this.toAffine();if(!n.isValid(g)||!n.isValid(m))throw new Error("bad point: x or y not FE");let y=n.sqr(m),E=s(g);if(!n.eql(y,E))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);let{px:m,py:y,pz:E}=this,{px:I,py:L,pz:k}=g,N=n.eql(n.mul(m,k),n.mul(I,E)),B=n.eql(n.mul(y,k),n.mul(L,E));return N&&B}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){let{a:g,b:m}=e,y=n.mul(m,L2),{px:E,py:I,pz:L}=this,k=n.ZERO,N=n.ZERO,B=n.ZERO,U=n.mul(E,E),T=n.mul(I,I),$=n.mul(L,L),K=n.mul(E,I);return K=n.add(K,K),B=n.mul(E,L),B=n.add(B,B),k=n.mul(g,B),N=n.mul(y,$),N=n.add(k,N),k=n.sub(T,N),N=n.add(T,N),N=n.mul(k,N),k=n.mul(K,k),B=n.mul(y,B),$=n.mul(g,$),K=n.sub(U,$),K=n.mul(g,K),K=n.add(K,B),B=n.add(U,U),U=n.add(B,U),U=n.add(U,$),U=n.mul(U,K),N=n.add(N,U),$=n.mul(I,L),$=n.add($,$),U=n.mul($,K),k=n.sub(k,U),B=n.mul($,T),B=n.add(B,B),B=n.add(B,B),new d(k,N,B)}add(g){u(g);let{px:m,py:y,pz:E}=this,{px:I,py:L,pz:k}=g,N=n.ZERO,B=n.ZERO,U=n.ZERO,T=e.a,$=n.mul(e.b,L2),K=n.mul(m,I),M=n.mul(y,L),v=n.mul(E,k),b=n.add(m,y),w=n.add(I,L);b=n.mul(b,w),w=n.add(K,M),b=n.sub(b,w),w=n.add(m,E);let C=n.add(I,k);return w=n.mul(w,C),C=n.add(K,v),w=n.sub(w,C),C=n.add(y,E),N=n.add(L,k),C=n.mul(C,N),N=n.add(M,v),C=n.sub(C,N),U=n.mul(T,w),N=n.mul($,v),U=n.add(N,U),N=n.sub(M,U),U=n.add(M,U),B=n.mul(N,U),M=n.add(K,K),M=n.add(M,K),v=n.mul(T,v),w=n.mul($,w),M=n.add(M,v),v=n.sub(K,v),v=n.mul(T,v),w=n.add(w,v),K=n.mul(M,w),B=n.add(B,K),K=n.mul(C,w),N=n.mul(b,N),N=n.sub(N,K),K=n.mul(b,M),U=n.mul(C,U),U=n.add(U,K),new d(N,B,U)}subtract(g){return this.add(g.negate())}is0(){return this.equals(d.ZERO)}wNAF(g){return f.wNAFCached(this,l,g,m=>{let y=n.invertBatch(m.map(E=>E.pz));return m.map((E,I)=>E.toAffine(y[I])).map(d.fromAffine)})}multiplyUnsafe(g){let m=d.ZERO;if(g===go)return m;if(a(g),g===yi)return this;let{endo:y}=e;if(!y)return f.unsafeLadder(this,g);let{k1neg:E,k1:I,k2neg:L,k2:k}=y.splitScalar(g),N=m,B=m,U=this;for(;I>go||k>go;)I&yi&&(N=N.add(U)),k&yi&&(B=B.add(U)),U=U.double(),I>>=yi,k>>=yi;return E&&(N=N.negate()),L&&(B=B.negate()),B=new d(n.mul(B.px,y.beta),B.py,B.pz),N.add(B)}multiply(g){a(g);let m=g,y,E,{endo:I}=e;if(I){let{k1neg:L,k1:k,k2neg:N,k2:B}=I.splitScalar(m),{p:U,f:T}=this.wNAF(k),{p:$,f:K}=this.wNAF(B);U=f.constTimeNegate(L,U),$=f.constTimeNegate(N,$),$=new d(n.mul($.px,I.beta),$.py,$.pz),y=U.add($),E=T.add(K)}else{let{p:L,f:k}=this.wNAF(m);y=L,E=k}return d.normalizeZ([y,E])[0]}multiplyAndAddUnsafe(g,m,y){let E=d.BASE,I=(k,N)=>N===go||N===yi||!k.equals(E)?k.multiplyUnsafe(N):k.multiply(N),L=I(this,m).add(I(g,y));return L.is0()?void 0:L}toAffine(g){let{px:m,py:y,pz:E}=this,I=this.is0();g==null&&(g=I?n.ONE:n.inv(E));let L=n.mul(m,g),k=n.mul(y,g),N=n.mul(E,g);if(I)return{x:n.ZERO,y:n.ZERO};if(!n.eql(N,n.ONE))throw new Error("invZ was invalid");return{x:L,y:k}}isTorsionFree(){let{h:g,isTorsionFree:m}=e;if(g===yi)return!0;if(m)return m(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:g,clearCofactor:m}=e;return g===yi?this:m?m(d,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(d,this,g)}toHex(g=!0){return Qc(this.toRawBytes(g))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);let h=e.nBitLength,f=k2(d,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function iY(t){let e=bA(t);return ma(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(H({lowS:!0},e))}function F2(t){let e=iY(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(w){return go<w&&w<n.ORDER}function a(w){return Kn(w,r)}function c(w){return sw(w,r)}let{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:h}=rY(fe(H({},e),{toBytes(w,C,x){let F=C.toAffine(),A=n.toBytes(F.x),P=Qu;return x?P(Uint8Array.from([C.hasEvenY()?2:3]),A):P(Uint8Array.from([4]),A,n.toBytes(F.y))},fromBytes(w){let C=w.length,x=w[0],F=w.subarray(1);if(C===i&&(x===2||x===3)){let A=po(F);if(!o(A))throw new Error("Point is not on curve");let P=d(A),V=n.sqrt(P),j=(V&yi)===yi;return(x&1)===1!==j&&(V=n.neg(V)),{x:A,y:V}}else if(C===s&&x===4){let A=n.fromBytes(F.subarray(0,n.BYTES)),P=n.fromBytes(F.subarray(n.BYTES,2*n.BYTES));return{x:A,y:P}}else throw new Error(`Point of length ${C} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}})),f=w=>Qc(ga(w,e.nByteLength));function p(w){let C=r>>yi;return w>C}function g(w){return p(w)?a(-w):w}let m=(w,C,x)=>po(w.slice(C,x));class y{constructor(C,x,F){this.r=C,this.s=x,this.recovery=F,this.assertValidity()}static fromCompact(C){let x=e.nByteLength;return C=Qr("compactSignature",C,x*2),new y(m(C,0,x),m(C,x,2*x))}static fromDER(C){let{r:x,s:F}=Zc.toSig(Qr("DER",C));return new y(x,F)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(C){return new y(this.r,this.s,C)}recoverPublicKey(C){let{r:x,s:F,recovery:A}=this,P=B(Qr("msgHash",C));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");let V=A===2||A===3?x+e.n:x;if(V>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");let j=(A&1)===0?"02":"03",oe=l.fromHex(j+f(V)),X=c(V),Q=a(-P*X),ae=a(F*X),ee=l.BASE.multiplyAndAddUnsafe(oe,Q,ae);if(!ee)throw new Error("point at infinify");return ee.assertValidity(),ee}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Yc(this.toDERHex())}toDERHex(){return Zc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Yc(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}let E={isValidPrivateKey(w){try{return u(w),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let w=wA(e.n);return M2(e.randomBytes(w),e.n)},precompute(w=8,C=l.BASE){return C._setWindowSize(w),C.multiply(BigInt(3)),C}};function I(w,C=!0){return l.fromPrivateKey(w).toRawBytes(C)}function L(w){let C=w instanceof Uint8Array,x=typeof w=="string",F=(C||x)&&w.length;return C?F===i||F===s:x?F===2*i||F===2*s:w instanceof l}function k(w,C,x=!0){if(L(w))throw new Error("first arg must be private key");if(!L(C))throw new Error("second arg must be public key");return l.fromHex(C).multiply(u(w)).toRawBytes(x)}let N=e.bits2int||function(w){let C=po(w),x=w.length*8-e.nBitLength;return x>0?C>>BigInt(x):C},B=e.bits2int_modN||function(w){return a(N(w))},U=Lf(e.nBitLength);function T(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(go<=w&&w<U))throw new Error(`bigint expected < 2^${e.nBitLength}`);return ga(w,e.nByteLength)}function $(w,C,x=K){if(["recovered","canonical"].some(ne=>ne in x))throw new Error("sign() legacy options not supported");let{hash:F,randomBytes:A}=e,{lowS:P,prehash:V,extraEntropy:j}=x;P==null&&(P=!0),w=Qr("msgHash",w),V&&(w=Qr("prehashed msgHash",F(w)));let oe=B(w),X=u(C),Q=[T(X),T(oe)];if(j!=null){let ne=j===!0?A(n.BYTES):j;Q.push(Qr("extraEntropy",ne))}let ae=Qu(...Q),ee=oe;function we(ne){let be=N(ne);if(!h(be))return;let Ot=c(be),vt=l.BASE.multiply(be).toAffine(),$t=a(vt.x);if($t===go)return;let pn=a(Ot*a(ee+$t*X));if(pn===go)return;let Gl=(vt.x===$t?0:2)|Number(vt.y&yi),RN=pn;return P&&p(pn)&&(RN=g(pn),Gl^=1),new y($t,RN,Gl)}return{seed:ae,k2sig:we}}let K={lowS:e.lowS,prehash:!1},M={lowS:e.lowS,prehash:!1};function v(w,C,x=K){let{seed:F,k2sig:A}=$(w,C,x),P=e;return fA(P.hash.outputLen,P.nByteLength,P.hmac)(F,A)}l.BASE._setWindowSize(8);function b(w,C,x,F=M){let A=w;if(C=Qr("msgHash",C),x=Qr("publicKey",x),"strict"in F)throw new Error("options.strict was renamed to lowS");let{lowS:P,prehash:V}=F,j,oe;try{if(typeof A=="string"||A instanceof Uint8Array)try{j=y.fromDER(A)}catch(vt){if(!(vt instanceof Zc.Err))throw vt;j=y.fromCompact(A)}else if(typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint"){let{r:vt,s:$t}=A;j=new y(vt,$t)}else throw new Error("PARSE");oe=l.fromHex(x)}catch(vt){if(vt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(P&&j.hasHighS())return!1;V&&(C=e.hash(C));let{r:X,s:Q}=j,ae=B(C),ee=c(Q),we=a(ae*ee),ne=a(X*ee),be=l.BASE.multiplyAndAddUnsafe(oe,we,ne)?.toAffine();return be?a(be.x)===X:!1}return{CURVE:e,getPublicKey:I,getSharedSecret:k,sign:v,verify:b,ProjectivePoint:l,Signature:y,utils:E}}function sY(t){return{hash:t,hmac:(e,...n)=>tA(t,e,s2(...n)),randomBytes:a2}}function B2(t,e){let n=r=>F2(H(H({},t),sY(r)));return Object.freeze(fe(H({},n(e)),{create:n}))}var V2=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),U2=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),oY=BigInt(1),EA=BigInt(2),j2=(t,e)=>(t+e/EA)/e;function aY(t){let e=V2,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,d=Yr(u,n,e)*u%e,h=Yr(d,n,e)*u%e,f=Yr(h,EA,e)*l%e,p=Yr(f,i,e)*f%e,g=Yr(p,s,e)*p%e,m=Yr(g,a,e)*g%e,y=Yr(m,c,e)*m%e,E=Yr(y,a,e)*g%e,I=Yr(E,n,e)*u%e,L=Yr(I,o,e)*p%e,k=Yr(L,r,e)*l%e,N=Yr(k,EA,e);if(!IA.eql(IA.sqr(N),t))throw new Error("Cannot find square root");return N}var IA=O2(V2,void 0,void 0,{sqrt:aY}),mo=B2({a:BigInt(0),b:BigInt(7),Fp:IA,n:U2,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=U2,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-oY*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=j2(s*t,e),c=j2(-r*t,e),l=Kn(t-a*n-c*i,e),u=Kn(-a*r-c*s,e),d=l>o,h=u>o;if(d&&(l=e-l),h&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:l,k2neg:h,k2:u}}}},Jy),f2e=BigInt(0);var p2e=mo.ProjectivePoint;var yo="0x0000000000000000000000000000000000000000";var ow="0x0000000000000000000000000000000000000000000000000000000000000000";var H2=BigInt(0),$2=BigInt(1),q2=BigInt(2),z2=BigInt(27),G2=BigInt(28),aw=BigInt(35),Yu={};function K2(t){return qn(Bt(t),32)}var ln=class t{#e;#t;#n;#r;get r(){return this.#e}set r(e){D(Qi(e)===32,"invalid r","value",e),this.#e=Z(e)}get s(){return D(parseInt(this.#t.substring(0,3))<8,"non-canonical s; use ._s","s",this.#t),this.#t}set s(e){D(Qi(e)===32,"invalid s","value",e),this.#t=Z(e)}get _s(){return this.#t}isValid(){return parseInt(this.#t.substring(0,3))<8}get v(){return this.#n}set v(e){let n=ve(e,"value");D(n===27||n===28,"invalid v","v",e),this.#n=n}get networkV(){return this.#r}get legacyChainId(){let e=this.networkV;return e==null?null:t.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){let e=ye(this.s);return this.yParity&&(e[0]|=128),Z(e)}get compactSerialized(){return Ze([this.r,this.yParityAndS])}get serialized(){return Ze([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(e,n,r,i){Wi(e,Yu,"Signature"),this.#e=n,this.#t=r,this.#n=i,this.#r=null}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){let e=new t(Yu,this.r,this._s,this.v);return this.networkV&&(e.#r=this.networkV),e}toJSON(){let e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(e){let n=te(e,"v");return n==z2||n==G2?H2:(D(n>=aw,"invalid EIP-155 v","v",e),(n-aw)/q2)}static getChainIdV(e,n){return te(e)*q2+BigInt(35+n-27)}static getNormalizedV(e){let n=te(e);return n===H2||n===z2?27:n===$2||n===G2?28:(D(n>=aw,"invalid v","v",e),n&$2?27:28)}static from(e){function n(l,u){D(l,u,"signature",e)}if(e==null)return new t(Yu,ow,ow,27);if(typeof e=="string"){let l=ye(e,"signature");if(l.length===64){let u=Z(l.slice(0,32)),d=l.slice(32,64),h=d[0]&128?28:27;return d[0]&=127,new t(Yu,u,Z(d),h)}if(l.length===65){let u=Z(l.slice(0,32)),d=Z(l.slice(32,64)),h=t.getNormalizedV(l[64]);return new t(Yu,u,d,h)}n(!1,"invalid raw signature length")}if(e instanceof t)return e.clone();let r=e.r;n(r!=null,"missing r");let i=K2(r),s=(function(l,u){if(l!=null)return K2(l);if(u!=null){n(Ue(u,32),"invalid yParityAndS");let d=ye(u);return d[0]&=127,Z(d)}n(!1,"missing s")})(e.s,e.yParityAndS),{networkV:o,v:a}=(function(l,u,d){if(l!=null){let h=te(l);return{networkV:h>=aw?h:void 0,v:t.getNormalizedV(h)}}if(u!=null)return n(Ue(u,32),"invalid yParityAndS"),{v:ye(u)[0]&128?28:27};if(d!=null){switch(ve(d,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}n(!1,"invalid yParity")}n(!1,"missing v")})(e.v,e.yParityAndS,e.yParity),c=new t(Yu,i,s,a);return o&&(c.#r=o),n(e.yParity==null||ve(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),n(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}};var ya=class t{#e;constructor(e){D(Qi(e)===32,"invalid private key","privateKey","[REDACTED]"),this.#e=Z(e)}get privateKey(){return this.#e}get publicKey(){return t.computePublicKey(this.#e)}get compressedPublicKey(){return t.computePublicKey(this.#e,!0)}sign(e){D(Qi(e)===32,"invalid digest length","digest",e);let n=mo.sign(Kt(e),Kt(this.#e),{lowS:!0});return ln.from({r:fr(n.r,32),s:fr(n.s,32),v:n.recovery?28:27})}computeSharedSecret(e){let n=t.computePublicKey(e);return Z(mo.getSharedSecret(Kt(this.#e),ye(n),!1))}static computePublicKey(e,n){let r=ye(e,"key");if(r.length===32){let s=mo.getPublicKey(r,!!n);return Z(s)}if(r.length===64){let s=new Uint8Array(65);s[0]=4,s.set(r,1),r=s}let i=mo.ProjectivePoint.fromHex(r);return Z(i.toRawBytes(n))}static recoverPublicKey(e,n){D(Qi(e)===32,"invalid digest length","digest",e);let r=ln.from(n),i=mo.Signature.fromCompact(Kt(Ze([r.r,r.s])));i=i.addRecoveryBit(r.yParity);let s=i.recoverPublicKey(Kt(e));return D(s!=null,"invalid signature for digest","signature",n),"0x"+s.toHex(!1)}static addPoints(e,n,r){let i=mo.ProjectivePoint.fromHex(t.computePublicKey(e).substring(2)),s=mo.ProjectivePoint.fromHex(t.computePublicKey(n).substring(2));return"0x"+i.add(s).toHex(!!r)}};var cY=BigInt(0),lY=BigInt(36);function W2(t){t=t.toLowerCase();let e=t.substring(2).split(""),n=new Uint8Array(40);for(let i=0;i<40;i++)n[i]=e[i].charCodeAt(0);let r=ye(gt(n));for(let i=0;i<40;i+=2)r[i>>1]>>4>=8&&(e[i]=e[i].toUpperCase()),(r[i>>1]&15)>=8&&(e[i+1]=e[i+1].toUpperCase());return"0x"+e.join("")}var CA={};for(let t=0;t<10;t++)CA[String(t)]=String(t);for(let t=0;t<26;t++)CA[String.fromCharCode(65+t)]=String(10+t);var Q2=15;function uY(t){t=t.toUpperCase(),t=t.substring(4)+t.substring(0,2)+"00";let e=t.split("").map(r=>CA[r]).join("");for(;e.length>=Q2;){let r=e.substring(0,Q2);e=parseInt(r,10)%97+e.substring(r.length)}let n=String(98-parseInt(e,10)%97);for(;n.length<2;)n="0"+n;return n}var dY=(function(){let t={};for(let e=0;e<36;e++){let n="0123456789abcdefghijklmnopqrstuvwxyz"[e];t[n]=BigInt(e)}return t})();function hY(t){t=t.toLowerCase();let e=cY;for(let n=0;n<t.length;n++)e=e*lY+dY[t[n]];return e}function Re(t){if(D(typeof t=="string","invalid address","address",t),t.match(/^(0x)?[0-9a-fA-F]{40}$/)){t.startsWith("0x")||(t="0x"+t);let e=W2(t);return D(!t.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===t,"bad address checksum","address",t),e}if(t.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){D(t.substring(2,4)===uY(t),"bad icap checksum","address",t);let e=hY(t.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return W2("0x"+e)}D(!1,"invalid address","address",t)}function AA(t){let e=Re(t.from),r=te(t.nonce,"tx.nonce").toString(16);return r==="0"?r="0x":r.length%2?r="0x0"+r:r="0x"+r,Re(_t(gt(mi([e,r])),12))}function cw(t){return t&&typeof t.getAddress=="function"}async function SA(t,e){let n=await e;return(n==null||n==="0x0000000000000000000000000000000000000000")&&(G(typeof t!="string","unconfigured name","UNCONFIGURED_NAME",{value:t}),D(!1,"invalid AddressLike value; did not resolve to a value address","target",t)),Re(n)}function tn(t,e){if(typeof t=="string")return t.match(/^0x[0-9a-f]{40}$/i)?Re(t):(G(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),SA(t,e.resolveName(t)));if(cw(t))return SA(t,t.getAddress());if(t&&typeof t.then=="function")return SA(t,t);D(!1,"unsupported addressable value","target",t)}var es={};function he(t,e){let n=!1;return e<0&&(n=!0,e*=-1),new kt(es,`${n?"":"u"}int${e}`,t,{signed:n,width:e})}function et(t,e){return new kt(es,`bytes${e||""}`,t,{size:e})}var Y2=Symbol.for("_ethers_typed"),kt=class t{type;value;#e;_typedSymbol;constructor(e,n,r,i){i==null&&(i=null),Wi(es,e,"Typed"),ce(this,{_typedSymbol:Y2,type:n,value:r}),this.#e=i,this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return this.#e}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return this.#e===!0?-1:this.#e===!1?this.value.length:null}static from(e,n){return new t(es,e,n)}static uint8(e){return he(e,8)}static uint16(e){return he(e,16)}static uint24(e){return he(e,24)}static uint32(e){return he(e,32)}static uint40(e){return he(e,40)}static uint48(e){return he(e,48)}static uint56(e){return he(e,56)}static uint64(e){return he(e,64)}static uint72(e){return he(e,72)}static uint80(e){return he(e,80)}static uint88(e){return he(e,88)}static uint96(e){return he(e,96)}static uint104(e){return he(e,104)}static uint112(e){return he(e,112)}static uint120(e){return he(e,120)}static uint128(e){return he(e,128)}static uint136(e){return he(e,136)}static uint144(e){return he(e,144)}static uint152(e){return he(e,152)}static uint160(e){return he(e,160)}static uint168(e){return he(e,168)}static uint176(e){return he(e,176)}static uint184(e){return he(e,184)}static uint192(e){return he(e,192)}static uint200(e){return he(e,200)}static uint208(e){return he(e,208)}static uint216(e){return he(e,216)}static uint224(e){return he(e,224)}static uint232(e){return he(e,232)}static uint240(e){return he(e,240)}static uint248(e){return he(e,248)}static uint256(e){return he(e,256)}static uint(e){return he(e,256)}static int8(e){return he(e,-8)}static int16(e){return he(e,-16)}static int24(e){return he(e,-24)}static int32(e){return he(e,-32)}static int40(e){return he(e,-40)}static int48(e){return he(e,-48)}static int56(e){return he(e,-56)}static int64(e){return he(e,-64)}static int72(e){return he(e,-72)}static int80(e){return he(e,-80)}static int88(e){return he(e,-88)}static int96(e){return he(e,-96)}static int104(e){return he(e,-104)}static int112(e){return he(e,-112)}static int120(e){return he(e,-120)}static int128(e){return he(e,-128)}static int136(e){return he(e,-136)}static int144(e){return he(e,-144)}static int152(e){return he(e,-152)}static int160(e){return he(e,-160)}static int168(e){return he(e,-168)}static int176(e){return he(e,-176)}static int184(e){return he(e,-184)}static int192(e){return he(e,-192)}static int200(e){return he(e,-200)}static int208(e){return he(e,-208)}static int216(e){return he(e,-216)}static int224(e){return he(e,-224)}static int232(e){return he(e,-232)}static int240(e){return he(e,-240)}static int248(e){return he(e,-248)}static int256(e){return he(e,-256)}static int(e){return he(e,-256)}static bytes1(e){return et(e,1)}static bytes2(e){return et(e,2)}static bytes3(e){return et(e,3)}static bytes4(e){return et(e,4)}static bytes5(e){return et(e,5)}static bytes6(e){return et(e,6)}static bytes7(e){return et(e,7)}static bytes8(e){return et(e,8)}static bytes9(e){return et(e,9)}static bytes10(e){return et(e,10)}static bytes11(e){return et(e,11)}static bytes12(e){return et(e,12)}static bytes13(e){return et(e,13)}static bytes14(e){return et(e,14)}static bytes15(e){return et(e,15)}static bytes16(e){return et(e,16)}static bytes17(e){return et(e,17)}static bytes18(e){return et(e,18)}static bytes19(e){return et(e,19)}static bytes20(e){return et(e,20)}static bytes21(e){return et(e,21)}static bytes22(e){return et(e,22)}static bytes23(e){return et(e,23)}static bytes24(e){return et(e,24)}static bytes25(e){return et(e,25)}static bytes26(e){return et(e,26)}static bytes27(e){return et(e,27)}static bytes28(e){return et(e,28)}static bytes29(e){return et(e,29)}static bytes30(e){return et(e,30)}static bytes31(e){return et(e,31)}static bytes32(e){return et(e,32)}static address(e){return new t(es,"address",e)}static bool(e){return new t(es,"bool",!!e)}static bytes(e){return new t(es,"bytes",e)}static string(e){return new t(es,"string",e)}static array(e,n){throw new Error("not implemented yet")}static tuple(e,n){throw new Error("not implemented yet")}static overrides(e){return new t(es,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===Y2}static dereference(e,n){if(t.isTyped(e)){if(e.type!==n)throw new Error(`invalid type: expecetd ${n}, got ${e.type}`);return e.value}return e}};var lw=class extends en{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,n){let r=kt.dereference(n,"string");try{r=Re(r)}catch(i){return this._throwError(i.message,n)}return e.writeValue(r)}decode(e){return Re(fr(e.readValue(),20))}};var uw=class extends en{coder;constructor(e){super(e.name,e.type,"_",e.dynamic),this.coder=e}defaultValue(){return this.coder.defaultValue()}encode(e,n){return this.coder.encode(e,n)}decode(e){return this.coder.decode(e)}};function _A(t,e,n){let r=[];if(Array.isArray(n))r=n;else if(n&&typeof n=="object"){let c={};r=e.map(l=>{let u=l.localName;return G(u,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:n}),G(!c[u],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:n}),c[u]=!0,n[u]})}else D(!1,"invalid tuple value","tuple",n);D(e.length===r.length,"types/value length mismatch","tuple",n);let i=new Wc,s=new Wc,o=[];e.forEach((c,l)=>{let u=r[l];if(c.dynamic){let d=s.length;c.encode(s,u);let h=i.writeUpdatableValue();o.push(f=>{h(f+d)})}else c.encode(i,u)}),o.forEach(c=>{c(i.length)});let a=t.appendWriter(i);return a+=t.appendWriter(s),a}function TA(t,e){let n=[],r=[],i=t.subReader(0);return e.forEach(s=>{let o=null;if(s.dynamic){let a=t.readIndex(),c=i.subReader(a);try{o=s.decode(c)}catch(l){if(Mt(l,"BUFFER_OVERRUN"))throw l;o=l,o.baseType=s.name,o.name=s.localName,o.type=s.type}}else try{o=s.decode(t)}catch(a){if(Mt(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=s.name,o.name=s.localName,o.type=s.type}if(o==null)throw new Error("investigate");n.push(o),r.push(s.localName||null)}),ho.fromItems(n,r)}var dw=class extends en{coder;length;constructor(e,n,r){let i=e.type+"["+(n>=0?n:"")+"]",s=n===-1||e.dynamic;super("array",i,r,s),ce(this,{coder:e,length:n})}defaultValue(){let e=this.coder.defaultValue(),n=[];for(let r=0;r<this.length;r++)n.push(e);return n}encode(e,n){let r=kt.dereference(n,"array");Array.isArray(r)||this._throwError("expected array value",r);let i=this.length;i===-1&&(i=r.length,e.writeValue(r.length)),ju(r.length,i,"coder array"+(this.localName?" "+this.localName:""));let s=[];for(let o=0;o<r.length;o++)s.push(this.coder);return _A(e,s,r)}decode(e){let n=this.length;n===-1&&(n=e.readIndex(),G(n*xn<=e.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:e.bytes,offset:n*xn,length:e.dataLength}));let r=[];for(let i=0;i<n;i++)r.push(new uw(this.coder));return TA(e,r)}};var hw=class extends en{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,n){let r=kt.dereference(n,"bool");return e.writeValue(r?1:0)}decode(e){return!!e.readValue()}};var Ff=class extends en{constructor(e,n){super(e,e,n,!0)}defaultValue(){return"0x"}encode(e,n){n=Kt(n);let r=e.writeValue(n.length);return r+=e.writeBytes(n),r}decode(e){return e.readBytes(e.readIndex(),!0)}},fw=class extends Ff{constructor(e){super("bytes",e)}decode(e){return Z(super.decode(e))}};var pw=class extends en{size;constructor(e,n){let r="bytes"+String(e);super(r,r,n,!1),ce(this,{size:e},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(e,n){let r=Kt(kt.dereference(n,this.type));return r.length!==this.size&&this._throwError("incorrect data length",n),e.writeBytes(r)}decode(e){return Z(e.readBytes(this.size))}};var fY=new Uint8Array([]),gw=class extends en{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,n){return n!=null&&this._throwError("not null",n),e.writeBytes(fY)}decode(e){return e.readBytes(0),null}};var pY=BigInt(0),gY=BigInt(1),mY=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),mw=class extends en{size;signed;constructor(e,n,r){let i=(n?"int":"uint")+e*8;super(i,i,r,!1),ce(this,{size:e,signed:n},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(e,n){let r=te(kt.dereference(n,this.type)),i=gi(mY,xn*8);if(this.signed){let s=gi(i,this.size*8-1);(r>s||r<-(s+gY))&&this._throwError("value out-of-bounds",n),r=Hu(r,8*xn)}else(r<pY||r>gi(i,this.size*8))&&this._throwError("value out-of-bounds",n);return e.writeValue(r)}decode(e){let n=gi(e.readValue(),this.size*8);return this.signed&&(n=ia(n,this.size*8)),n}};var yw=class extends Ff{constructor(e){super("string",e)}defaultValue(){return""}encode(e,n){return super.encode(e,Gn(kt.dereference(n,"string")))}decode(e){return uo(super.decode(e))}};var Xc=class extends en{coders;constructor(e,n){let r=!1,i=[];e.forEach(o=>{o.dynamic&&(r=!0),i.push(o.type)});let s="tuple("+i.join(",")+")";super("tuple",s,n,r),ce(this,{coders:Object.freeze(e.slice())})}defaultValue(){let e=[];this.coders.forEach(r=>{e.push(r.defaultValue())});let n=this.coders.reduce((r,i)=>{let s=i.localName;return s&&(r[s]||(r[s]=0),r[s]++),r},{});return this.coders.forEach((r,i)=>{let s=r.localName;!s||n[s]!==1||(s==="length"&&(s="_length"),e[s]==null&&(e[s]=e[i]))}),Object.freeze(e)}encode(e,n){let r=kt.dereference(n,"tuple");return _A(e,this.coders,r)}decode(e){return TA(e,this.coders)}};function DA(t,e){return{address:Re(t),storageKeys:e.map((n,r)=>(D(Ue(n,32),"invalid slot",`storageKeys[${r}]`,n),n.toLowerCase()))}}function Jr(t){if(Array.isArray(t))return t.map((n,r)=>Array.isArray(n)?(D(n.length===2,"invalid slot set",`value[${r}]`,n),DA(n[0],n[1])):(D(n!=null&&typeof n=="object","invalid address-slot set","value",t),DA(n.address,n.storageKeys)));D(t!=null&&typeof t=="object","invalid access list","value",t);let e=Object.keys(t).map(n=>{let r=t[n].reduce((i,s)=>(i[s]=!0,i),{});return DA(n,Object.keys(r).sort())});return e.sort((n,r)=>n.address.localeCompare(r.address)),e}function Bf(t){return{address:Re(t.address),nonce:te(t.nonce!=null?t.nonce:0),chainId:te(t.chainId!=null?t.chainId:0),signature:ln.from(t.signature)}}function yY(t){let e;return typeof t=="string"?e=ya.computePublicKey(t,!1):e=t.publicKey,Re(gt("0x"+e.substring(4)).substring(26))}function J2(t,e){return yY(ya.recoverPublicKey(t,e))}var En=BigInt(0),wY=BigInt(2),vY=BigInt(27),bY=BigInt(28),EY=BigInt(35),IY=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),NA=4096*32;function CY(t){return{blobToKzgCommitment:r=>{if("computeBlobProof"in t){if("blobToKzgCommitment"in t&&typeof t.blobToKzgCommitment=="function")return ye(t.blobToKzgCommitment(Z(r)))}else if("blobToKzgCommitment"in t&&typeof t.blobToKzgCommitment=="function")return ye(t.blobToKzgCommitment(r));if("blobToKZGCommitment"in t&&typeof t.blobToKZGCommitment=="function")return ye(t.blobToKZGCommitment(Z(r)));D(!1,"unsupported KZG library","kzg",t)},computeBlobKzgProof:(r,i)=>{if("computeBlobProof"in t&&typeof t.computeBlobProof=="function")return ye(t.computeBlobProof(Z(r),Z(i)));if("computeBlobKzgProof"in t&&typeof t.computeBlobKzgProof=="function")return t.computeBlobKzgProof(r,i);if("computeBlobKZGProof"in t&&typeof t.computeBlobKZGProof=="function")return ye(t.computeBlobKZGProof(Z(r),Z(i)));D(!1,"unsupported KZG library","kzg",t)}}}function Z2(t,e){let n=t.toString(16);for(;n.length<2;)n="0"+n;return n+=pa(e).substring(4),"0x"+n}function Ju(t){return t==="0x"?null:Re(t)}function ww(t,e){try{return Jr(t)}catch(n){D(!1,n.message,e,t)}}function AY(t,e){try{if(!Array.isArray(t))throw new Error("authorizationList: invalid array");let n=[];for(let r=0;r<t.length;r++){let i=t[r];if(!Array.isArray(i))throw new Error(`authorization[${r}]: invalid array`);if(i.length!==6)throw new Error(`authorization[${r}]: wrong length`);if(!i[1])throw new Error(`authorization[${r}]: null address`);n.push({address:Ju(i[1]),nonce:Ct(i[2],"nonce"),chainId:Ct(i[0],"chainId"),signature:ln.from({yParity:tl(i[3],"yParity"),r:qn(i[4],32),s:qn(i[5],32)})})}return n}catch(n){D(!1,n.message,e,t)}}function tl(t,e){return t==="0x"?0:ve(t,e)}function Ct(t,e){if(t==="0x")return En;let n=te(t,e);return D(n<=IY,"value exceeds uint size",e,n),n}function qe(t,e){let n=te(t,"value"),r=Bt(n);return D(r.length<=32,"value too large",`tx.${e}`,n),r}function vw(t){return Jr(t).map(e=>[e.address,e.storageKeys])}function SY(t){return t.map(e=>[qe(e.chainId,"chainId"),e.address,qe(e.nonce,"nonce"),qe(e.signature.yParity,"yParity"),Bt(e.signature.r),Bt(e.signature.s)])}function _Y(t,e){D(Array.isArray(t),`invalid ${e}`,"value",t);for(let n=0;n<t.length;n++)D(Ue(t[n],32),"invalid ${ param } hash",`value[${n}]`,t[n]);return t}function TY(t){let e=oa(t);D(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",t);let n={type:0,nonce:tl(e[0],"nonce"),gasPrice:Ct(e[1],"gasPrice"),gasLimit:Ct(e[2],"gasLimit"),to:Ju(e[3]),value:Ct(e[4],"value"),data:Z(e[5]),chainId:En};if(e.length===6)return n;let r=Ct(e[6],"v"),i=Ct(e[7],"r"),s=Ct(e[8],"s");if(i===En&&s===En)n.chainId=r;else{let o=(r-EY)/wY;o<En&&(o=En),n.chainId=o,D(o!==En||r===vY||r===bY,"non-canonical legacy v","v",e[6]),n.signature=ln.from({r:qn(e[7],32),s:qn(e[8],32),v:r})}return n}function DY(t,e){let n=[qe(t.nonce,"nonce"),qe(t.gasPrice||0,"gasPrice"),qe(t.gasLimit,"gasLimit"),t.to||"0x",qe(t.value,"value"),t.data],r=En;if(t.chainId!=En)r=te(t.chainId,"tx.chainId"),D(!e||e.networkV==null||e.legacyChainId===r,"tx.chainId/sig.v mismatch","sig",e);else if(t.signature){let s=t.signature.legacyChainId;s!=null&&(r=s)}if(!e)return r!==En&&(n.push(Bt(r)),n.push("0x"),n.push("0x")),mi(n);let i=BigInt(27+e.yParity);return r!==En?i=ln.getChainIdV(r,e.v):BigInt(e.v)!==i&&D(!1,"tx.chainId/sig.v mismatch","sig",e),n.push(Bt(i)),n.push(Bt(e.r)),n.push(Bt(e.s)),mi(n)}function bw(t,e){let n;try{if(n=tl(e[0],"yParity"),n!==0&&n!==1)throw new Error("bad yParity")}catch{D(!1,"invalid yParity","yParity",e[0])}let r=qn(e[1],32),i=qn(e[2],32),s=ln.from({r,s:i,yParity:n});t.signature=s}function NY(t){let e=oa(ye(t).slice(1));D(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",Z(t));let n={type:2,chainId:Ct(e[0],"chainId"),nonce:tl(e[1],"nonce"),maxPriorityFeePerGas:Ct(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Ct(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Ct(e[4],"gasLimit"),to:Ju(e[5]),value:Ct(e[6],"value"),data:Z(e[7]),accessList:ww(e[8],"accessList")};return e.length===9||bw(n,e.slice(9)),n}function xY(t,e){let n=[qe(t.chainId,"chainId"),qe(t.nonce,"nonce"),qe(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),qe(t.maxFeePerGas||0,"maxFeePerGas"),qe(t.gasLimit,"gasLimit"),t.to||"0x",qe(t.value,"value"),t.data,vw(t.accessList||[])];return e&&(n.push(qe(e.yParity,"yParity")),n.push(Bt(e.r)),n.push(Bt(e.s))),Ze(["0x02",mi(n)])}function RY(t){let e=oa(ye(t).slice(1));D(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",Z(t));let n={type:1,chainId:Ct(e[0],"chainId"),nonce:tl(e[1],"nonce"),gasPrice:Ct(e[2],"gasPrice"),gasLimit:Ct(e[3],"gasLimit"),to:Ju(e[4]),value:Ct(e[5],"value"),data:Z(e[6]),accessList:ww(e[7],"accessList")};return e.length===8||bw(n,e.slice(8)),n}function OY(t,e){let n=[qe(t.chainId,"chainId"),qe(t.nonce,"nonce"),qe(t.gasPrice||0,"gasPrice"),qe(t.gasLimit,"gasLimit"),t.to||"0x",qe(t.value,"value"),t.data,vw(t.accessList||[])];return e&&(n.push(qe(e.yParity,"recoveryParam")),n.push(Bt(e.r)),n.push(Bt(e.s))),Ze(["0x01",mi(n)])}function PY(t){let e=oa(ye(t).slice(1)),n="3",r=null;if(e.length===4&&Array.isArray(e[0])){n="3 (network format)";let s=e[1],o=e[2],a=e[3];D(Array.isArray(s),"invalid network format: blobs not an array","fields[1]",s),D(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),D(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),D(s.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),D(s.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),r=[];for(let c=0;c<e[1].length;c++)r.push({data:s[c],commitment:o[c],proof:a[c]});e=e[0]}D(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${n}`,"data",Z(t));let i={type:3,chainId:Ct(e[0],"chainId"),nonce:tl(e[1],"nonce"),maxPriorityFeePerGas:Ct(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Ct(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Ct(e[4],"gasLimit"),to:Ju(e[5]),value:Ct(e[6],"value"),data:Z(e[7]),accessList:ww(e[8],"accessList"),maxFeePerBlobGas:Ct(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};r&&(i.blobs=r),D(i.to!=null,`invalid address for transaction type: ${n}`,"data",t),D(Array.isArray(i.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",t);for(let s=0;s<i.blobVersionedHashes.length;s++)D(Ue(i.blobVersionedHashes[s],32),`invalid blobVersionedHash at index ${s}: must be length 32`,"data",t);return e.length===11||bw(i,e.slice(11)),i}function MY(t,e,n){let r=[qe(t.chainId,"chainId"),qe(t.nonce,"nonce"),qe(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),qe(t.maxFeePerGas||0,"maxFeePerGas"),qe(t.gasLimit,"gasLimit"),t.to||yo,qe(t.value,"value"),t.data,vw(t.accessList||[]),qe(t.maxFeePerBlobGas||0,"maxFeePerBlobGas"),_Y(t.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(r.push(qe(e.yParity,"yParity")),r.push(Bt(e.r)),r.push(Bt(e.s)),n)?Ze(["0x03",mi([r,n.map(i=>i.data),n.map(i=>i.commitment),n.map(i=>i.proof)])]):Ze(["0x03",mi(r)])}function kY(t){let e=oa(ye(t).slice(1));D(Array.isArray(e)&&(e.length===10||e.length===13),"invalid field count for transaction type: 4","data",Z(t));let n={type:4,chainId:Ct(e[0],"chainId"),nonce:tl(e[1],"nonce"),maxPriorityFeePerGas:Ct(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Ct(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Ct(e[4],"gasLimit"),to:Ju(e[5]),value:Ct(e[6],"value"),data:Z(e[7]),accessList:ww(e[8],"accessList"),authorizationList:AY(e[9],"authorizationList")};return e.length===10||bw(n,e.slice(10)),n}function LY(t,e){let n=[qe(t.chainId,"chainId"),qe(t.nonce,"nonce"),qe(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),qe(t.maxFeePerGas||0,"maxFeePerGas"),qe(t.gasLimit,"gasLimit"),t.to||"0x",qe(t.value,"value"),t.data,vw(t.accessList||[]),SY(t.authorizationList||[])];return e&&(n.push(qe(e.yParity,"yParity")),n.push(Bt(e.r)),n.push(Bt(e.s))),Ze(["0x04",mi(n)])}var el=class t{#e;#t;#n;#r;#i;#o;#s;#a;#d;#l;#p;#g;#c;#u;#h;#f;#y;get type(){return this.#e}set type(e){switch(e){case null:this.#e=null;break;case 0:case"legacy":this.#e=0;break;case 1:case"berlin":case"eip-2930":this.#e=1;break;case 2:case"london":case"eip-1559":this.#e=2;break;case 3:case"cancun":case"eip-4844":this.#e=3;break;case 4:case"pectra":case"eip-7702":this.#e=4;break;default:D(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){let e=this.#t;return e==null&&this.type===3?yo:e}set to(e){this.#t=e==null?null:Re(e)}get nonce(){return this.#r}set nonce(e){this.#r=ve(e,"value")}get gasLimit(){return this.#i}set gasLimit(e){this.#i=te(e)}get gasPrice(){let e=this.#o;return e==null&&(this.type===0||this.type===1)?En:e}set gasPrice(e){this.#o=e==null?null:te(e,"gasPrice")}get maxPriorityFeePerGas(){let e=this.#s;return e??(this.type===2||this.type===3?En:null)}set maxPriorityFeePerGas(e){this.#s=e==null?null:te(e,"maxPriorityFeePerGas")}get maxFeePerGas(){let e=this.#a;return e??(this.type===2||this.type===3?En:null)}set maxFeePerGas(e){this.#a=e==null?null:te(e,"maxFeePerGas")}get data(){return this.#n}set data(e){this.#n=Z(e)}get value(){return this.#d}set value(e){this.#d=te(e,"value")}get chainId(){return this.#l}set chainId(e){this.#l=te(e)}get signature(){return this.#p||null}set signature(e){this.#p=e==null?null:ln.from(e)}get accessList(){let e=this.#g||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){this.#g=e==null?null:Jr(e)}get authorizationList(){let e=this.#y||null;return e==null&&this.type===4?[]:e}set authorizationList(e){this.#y=e==null?null:e.map(n=>Bf(n))}get maxFeePerBlobGas(){let e=this.#c;return e==null&&this.type===3?En:e}set maxFeePerBlobGas(e){this.#c=e==null?null:te(e,"maxFeePerBlobGas")}get blobVersionedHashes(){let e=this.#u;return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){D(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let n=0;n<e.length;n++)D(Ue(e[n],32),"invalid blobVersionedHash",`value[${n}]`,e[n])}this.#u=e}get blobs(){return this.#f==null?null:this.#f.map(e=>Object.assign({},e))}set blobs(e){if(e==null){this.#f=null;return}let n=[],r=[];for(let i=0;i<e.length;i++){let s=e[i];if(ra(s)){G(this.#h,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let o=ye(s);if(D(o.length<=NA,"blob is too large",`blobs[${i}]`,s),o.length!==NA){let l=new Uint8Array(NA);l.set(o),o=l}let a=this.#h.blobToKzgCommitment(o),c=Z(this.#h.computeBlobKzgProof(o,a));n.push({data:Z(o),commitment:Z(a),proof:c}),r.push(Z2(1,a))}else{let o=Z(s.commitment);n.push({data:Z(s.data),commitment:o,proof:Z(s.proof)}),r.push(Z2(1,o))}}this.#f=n,this.#u=r}get kzg(){return this.#h}set kzg(e){e==null?this.#h=null:this.#h=CY(e)}constructor(){this.#e=null,this.#t=null,this.#r=0,this.#i=En,this.#o=null,this.#s=null,this.#a=null,this.#n="0x",this.#d=En,this.#l=En,this.#p=null,this.#g=null,this.#c=null,this.#u=null,this.#h=null,this.#f=null,this.#y=null}get hash(){return this.signature==null?null:gt(this.#m(!0,!1))}get unsignedHash(){return gt(this.unsignedSerialized)}get from(){return this.signature==null?null:J2(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:ya.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}#m(e,n){G(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});let r=e?this.signature:null;switch(this.inferType()){case 0:return DY(this,r);case 1:return OY(this,r);case 2:return xY(this,r);case 3:return MY(this,r,n?this.blobs:null);case 4:return LY(this,r)}G(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#m(!0,!0)}get unsignedSerialized(){return this.#m(!1,!1)}inferType(){let e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){let e=this.gasPrice!=null,n=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,r=this.accessList!=null,i=this.#c!=null||this.#u;this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&G(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),G(!n||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),G(this.type!==0||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});let s=[];return this.type!=null?s.push(this.type):this.authorizationList&&this.authorizationList.length?s.push(4):n?s.push(2):e?(s.push(1),r||s.push(0)):r?(s.push(1),s.push(2)):(i&&this.to||(s.push(0),s.push(1),s.push(2)),s.push(3)),s.sort(),s}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return t.from(this)}toJSON(){let e=n=>n==null?null:n.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new t;if(typeof e=="string"){let r=ye(e);if(r[0]>=127)return t.from(TY(r));switch(r[0]){case 1:return t.from(RY(r));case 2:return t.from(NY(r));case 3:return t.from(PY(r));case 4:return t.from(kY(r))}G(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}let n=new t;return e.type!=null&&(n.type=e.type),e.to!=null&&(n.to=e.to),e.nonce!=null&&(n.nonce=e.nonce),e.gasLimit!=null&&(n.gasLimit=e.gasLimit),e.gasPrice!=null&&(n.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(n.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(n.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(n.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(n.data=e.data),e.value!=null&&(n.value=e.value),e.chainId!=null&&(n.chainId=e.chainId),e.signature!=null&&(n.signature=ln.from(e.signature)),e.accessList!=null&&(n.accessList=e.accessList),e.authorizationList!=null&&(n.authorizationList=e.authorizationList),e.blobVersionedHashes!=null&&(n.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(n.kzg=e.kzg),e.blobs!=null&&(n.blobs=e.blobs),e.hash!=null&&(D(n.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),D(n.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(D(n.isSigned(),"unsigned transaction cannot define '.from'","tx",e),D(n.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),n}};function ts(t){return gt(Gn(t))}var FY="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI",X2=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),eL=4;function BY(t){let e=0;function n(){return t[e++]<<8|t[e++]}let r=n(),i=1,s=[0,1];for(let k=1;k<r;k++)s.push(i+=n());let o=n(),a=e;e+=o;let c=0,l=0;function u(){return c==0&&(l=l<<8|t[e++],c=8),l>>--c&1}let d=31,h=2**d,f=h>>>1,p=f>>1,g=h-1,m=0;for(let k=0;k<d;k++)m=m<<1|u();let y=[],E=0,I=h;for(;;){let k=Math.floor(((m-E+1)*i-1)/I),N=0,B=r;for(;B-N>1;){let $=N+B>>>1;k<s[$]?B=$:N=$}if(N==0)break;y.push(N);let U=E+Math.floor(I*s[N]/i),T=E+Math.floor(I*s[N+1]/i)-1;for(;((U^T)&f)==0;)m=m<<1&g|u(),U=U<<1&g,T=T<<1&g|1;for(;U&~T&p;)m=m&f|m<<1&g>>>1|u(),U=U<<1^f,T=(T^f)<<1|f|1;E=U,I=1+T-U}let L=r-4;return y.map(k=>{switch(k-L){case 3:return L+65792+(t[a++]<<16|t[a++]<<8|t[a++]);case 2:return L+256+(t[a++]<<8|t[a++]);case 1:return L+t[a++];default:return k-1}})}function UY(t){let e=0;return()=>t[e++]}function iL(t){return UY(BY(jY(t)))}function jY(t){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((i,s)=>e[i.charCodeAt(0)]=s);let n=t.length,r=new Uint8Array(6*n>>3);for(let i=0,s=0,o=0,a=0;i<n;i++)a=a<<6|e[t.charCodeAt(i)],o+=6,o>=8&&(r[s++]=a>>(o-=8));return r}function VY(t){return t&1?~t>>1:t>>1}function HY(t,e){let n=Array(t);for(let r=0,i=0;r<t;r++)n[r]=i+=VY(e());return n}function Vf(t,e=0){let n=[];for(;;){let r=t(),i=t();if(!i)break;e+=r;for(let s=0;s<i;s++)n.push(e+s);e+=i+1}return n}function sL(t){return Hf(()=>{let e=Vf(t);if(e.length)return e})}function oL(t){let e=[];for(;;){let n=t();if(n==0)break;e.push($Y(n,t))}for(;;){let n=t()-1;if(n<0)break;e.push(qY(n,t))}return e.flat()}function Hf(t){let e=[];for(;;){let n=t(e.length);if(!n)break;e.push(n)}return e}function aL(t,e,n){let r=Array(t).fill().map(()=>[]);for(let i=0;i<e;i++)HY(t,n).forEach((s,o)=>r[o].push(s));return r}function $Y(t,e){let n=1+e(),r=e(),i=Hf(e);return aL(i.length,1+t,e).flatMap((o,a)=>{let[c,...l]=o;return Array(i[a]).fill().map((u,d)=>{let h=d*r;return[c+d*n,l.map(f=>f+h)]})})}function qY(t,e){let n=1+e();return aL(n,1+t,e).map(i=>[i[0],i.slice(1)])}function zY(t){let e=[],n=Vf(t);return i(r([]),[]),e;function r(s){let o=t(),a=Hf(()=>{let c=Vf(t).map(l=>n[l]);if(c.length)return r(c)});return{S:o,B:a,Q:s}}function i({S:s,B:o},a,c){if(!(s&4&&c===a[a.length-1])){s&2&&(c=a[a.length-1]),s&1&&e.push(a);for(let l of o)for(let u of l.Q)i(l,[...a,u],c)}}}function GY(t){return t.toString(16).toUpperCase().padStart(2,"0")}function cL(t){return`{${GY(t)}}`}function KY(t){let e=[];for(let n=0,r=t.length;n<r;){let i=t.codePointAt(n);n+=i<65536?1:2,e.push(i)}return e}function ed(t){let n=t.length;if(n<4096)return String.fromCodePoint(...t);let r=[];for(let i=0;i<n;)r.push(String.fromCodePoint(...t.slice(i,i+=4096)));return r.join("")}function WY(t,e){let n=t.length,r=n-e.length;for(let i=0;r==0&&i<n;i++)r=t[i]-e[i];return r}var QY="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g",$f=44032,Iw=4352,Cw=4449,Aw=4519,lL=19,uL=21,td=28,Sw=uL*td,YY=lL*Sw,JY=$f+YY,ZY=Iw+lL,XY=Cw+uL,eJ=Aw+td;function Uf(t){return t>>24&255}function dL(t){return t&16777215}var RA,tL,OA,Ew;function tJ(){let t=iL(QY);RA=new Map(sL(t).flatMap((e,n)=>e.map(r=>[r,n+1<<24]))),tL=new Set(Vf(t)),OA=new Map,Ew=new Map;for(let[e,n]of oL(t)){if(!tL.has(e)&&n.length==2){let[r,i]=n,s=Ew.get(r);s||(s=new Map,Ew.set(r,s)),s.set(i,e)}OA.set(e,n.reverse())}}function hL(t){return t>=$f&&t<JY}function nJ(t,e){if(t>=Iw&&t<ZY&&e>=Cw&&e<XY)return $f+(t-Iw)*Sw+(e-Cw)*td;if(hL(t)&&e>Aw&&e<eJ&&(t-$f)%td==0)return t+(e-Aw);{let n=Ew.get(t);return n&&(n=n.get(e),n)?n:-1}}function fL(t){RA||tJ();let e=[],n=[],r=!1;function i(s){let o=RA.get(s);o&&(r=!0,s|=o),e.push(s)}for(let s of t)for(;;){if(s<128)e.push(s);else if(hL(s)){let o=s-$f,a=o/Sw|0,c=o%Sw/td|0,l=o%td;i(Iw+a),i(Cw+c),l>0&&i(Aw+l)}else{let o=OA.get(s);o?n.push(...o):i(s)}if(!n.length)break;s=n.pop()}if(r&&e.length>1){let s=Uf(e[0]);for(let o=1;o<e.length;o++){let a=Uf(e[o]);if(a==0||s<=a){s=a;continue}let c=o-1;for(;;){let l=e[c+1];if(e[c+1]=e[c],e[c]=l,!c||(s=Uf(e[--c]),s<=a))break}s=Uf(e[o])}}return e}function rJ(t){let e=[],n=[],r=-1,i=0;for(let s of t){let o=Uf(s),a=dL(s);if(r==-1)o==0?r=a:e.push(a);else if(i>0&&i>=o)o==0?(e.push(r,...n),n.length=0,r=a):n.push(a),i=o;else{let c=nJ(r,a);c>=0?r=c:i==0&&o==0?(e.push(r),r=a):(n.push(a),i=o)}}return r>=0&&e.push(r,...n),e}function pL(t){return fL(t).map(dL)}function iJ(t){return rJ(fL(t))}var nL=45;var gL=".",mL=65039,yL=1,_w=t=>Array.from(t);function qf(t,e){return t.P.has(e)||t.Q.has(e)}var PA=class extends Array{get is_emoji(){return!0}},MA,wL,rl,kA,vL,sJ,Xu,xA,Zu,nl,rL,LA;function FA(){if(MA)return;let t=iL(FY),e=()=>Vf(t),n=()=>new Set(e()),r=(u,d)=>d.forEach(h=>u.add(h));MA=new Map(oL(t)),wL=n(),rl=e(),kA=new Set(e().map(u=>rl[u])),rl=new Set(rl),vL=n(),sJ=n();let i=sL(t),s=t(),o=()=>{let u=new Set;return e().forEach(d=>r(u,i[d])),r(u,e()),u};Xu=Hf(u=>{let d=Hf(t).map(h=>h+96);if(d.length){let h=u>=s;d[0]-=32,d=ed(d),h&&(d=`Restricted[${d}]`);let f=o(),p=o(),g=!t();return{N:d,P:f,Q:p,M:g,R:h}}}),xA=n(),Zu=new Map;let a=e().concat(_w(xA)).sort((u,d)=>u-d);a.forEach((u,d)=>{let h=t(),f=a[d]=h?a[d-h]:{V:[],M:new Map};f.V.push(u),xA.has(u)||Zu.set(u,f)});for(let{V:u,M:d}of new Set(Zu.values())){let h=[];for(let p of u){let g=Xu.filter(y=>qf(y,p)),m=h.find(({G:y})=>g.some(E=>y.has(E)));m||(m={G:new Set,V:[]},h.push(m)),m.V.push(p),r(m.G,g)}let f=h.flatMap(p=>_w(p.G));for(let{G:p,V:g}of h){let m=new Set(f.filter(y=>!p.has(y)));for(let y of g)d.set(y,m)}}nl=new Set;let c=new Set,l=u=>nl.has(u)?c.add(u):nl.add(u);for(let u of Xu){for(let d of u.P)l(d);for(let d of u.Q)l(d)}for(let u of nl)!Zu.has(u)&&!c.has(u)&&Zu.set(u,yL);r(nl,pL(nl)),rL=zY(t).map(u=>PA.from(u)).sort(WY),LA=new Map;for(let u of rL){let d=[LA];for(let h of u){let f=d.map(p=>{let g=p.get(h);return g||(g=new Map,p.set(h,g)),g});h===mL?d.push(...f):d=f}for(let h of d)h.V=u}}function BA(t){return(bL(t)?"":`${UA(Tw([t]))} `)+cL(t)}function UA(t){return`"${t}"\u200E`}function oJ(t){if(t.length>=4&&t[2]==nL&&t[3]==nL)throw new Error(`invalid label extension: "${ed(t.slice(0,4))}"`)}function aJ(t){for(let n=t.lastIndexOf(95);n>0;)if(t[--n]!==95)throw new Error("underscore allowed only at start")}function cJ(t){let e=t[0],n=X2.get(e);if(n)throw jf(`leading ${n}`);let r=t.length,i=-1;for(let s=1;s<r;s++){e=t[s];let o=X2.get(e);if(o){if(i==s)throw jf(`${n} + ${o}`);i=s+1,n=o}}if(i==r)throw jf(`trailing ${n}`)}function Tw(t,e=1/0,n=cL){let r=[];lJ(t[0])&&r.push("\u25CC"),t.length>e&&(e>>=1,t=[...t.slice(0,e),8230,...t.slice(-e)]);let i=0,s=t.length;for(let o=0;o<s;o++){let a=t[o];bL(a)&&(r.push(ed(t.slice(i,o))),r.push(n(a)),i=o+1)}return r.push(ed(t.slice(i,s))),r.join("")}function lJ(t){return FA(),rl.has(t)}function bL(t){return FA(),vL.has(t)}function EL(t){return fJ(uJ(t,iJ,mJ))}function uJ(t,e,n){if(!t)return[];FA();let r=0;return t.split(gL).map(i=>{let s=KY(i),o={input:s,offset:r};r+=s.length+1;try{let a=o.tokens=gJ(s,e,n),c=a.length,l;if(!c)throw new Error("empty label");let u=o.output=a.flat();if(aJ(u),!(o.emoji=c>1||a[0].is_emoji)&&u.every(h=>h<128))oJ(u),l="ASCII";else{let h=a.flatMap(f=>f.is_emoji?[]:f);if(!h.length)l="Emoji";else{if(rl.has(u[0]))throw jf("leading combining mark");for(let g=1;g<c;g++){let m=a[g];if(!m.is_emoji&&rl.has(m[0]))throw jf(`emoji + combining mark: "${ed(a[g-1])} + ${Tw([m[0]])}"`)}cJ(u);let f=_w(new Set(h)),[p]=hJ(f);pJ(p,h),dJ(p,f),l=p.N}}o.type=l}catch(a){o.error=a}return o})}function dJ(t,e){let n,r=[];for(let i of e){let s=Zu.get(i);if(s===yL)return;if(s){let o=s.M.get(i);if(n=n?n.filter(a=>o.has(a)):_w(o),!n.length)return}else r.push(i)}if(n){for(let i of n)if(r.every(s=>qf(i,s)))throw new Error(`whole-script confusable: ${t.N}/${i.N}`)}}function hJ(t){let e=Xu;for(let n of t){let r=e.filter(i=>qf(i,n));if(!r.length)throw Xu.some(i=>qf(i,n))?CL(e[0],n):IL(n);if(e=r,r.length==1)break}return e}function fJ(t){return t.map(({input:e,error:n,output:r})=>{if(n){let i=n.message;throw new Error(t.length==1?i:`Invalid label ${UA(Tw(e,63))}: ${i}`)}return ed(r)}).join(gL)}function IL(t){return new Error(`disallowed character: ${BA(t)}`)}function CL(t,e){let n=BA(e),r=Xu.find(i=>i.P.has(e));return r&&(n=`${r.N} ${n}`),new Error(`illegal mixture: ${t.N} + ${n}`)}function jf(t){return new Error(`illegal placement: ${t}`)}function pJ(t,e){for(let n of e)if(!qf(t,n))throw CL(t,n);if(t.M){let n=pL(e);for(let r=1,i=n.length;r<i;r++)if(kA.has(n[r])){let s=r+1;for(let o;s<i&&kA.has(o=n[s]);s++)for(let a=r;a<s;a++)if(n[a]==o)throw new Error(`duplicate non-spacing marks: ${BA(o)}`);if(s-r>eL)throw new Error(`excessive non-spacing marks: ${UA(Tw(n.slice(r-1,s)))} (${s-r}/${eL})`);r=s}}}function gJ(t,e,n){let r=[],i=[];for(t=t.slice().reverse();t.length;){let s=yJ(t);if(s)i.length&&(r.push(e(i)),i=[]),r.push(n(s));else{let o=t.pop();if(nl.has(o))i.push(o);else{let a=MA.get(o);if(a)i.push(...a);else if(!wL.has(o))throw IL(o)}}}return i.length&&r.push(e(i)),r}function mJ(t){return t.filter(e=>e!=mL)}function yJ(t,e){let n=LA,r,i=t.length;for(;i&&(n=n.get(t[--i]),!!n);){let{V:s}=n;s&&(r=s,e&&e.push(...t.slice(i).reverse()),t.length=i)}return r}var SL=new Uint8Array(32);SL.fill(0);function AL(t){return D(t.length!==0,"invalid ENS name; empty component","comp",t),t}function _L(t){let e=Gn(TL(t)),n=[];if(t.length===0)return n;let r=0;for(let i=0;i<e.length;i++)e[i]===46&&(n.push(AL(e.slice(r,i))),r=i+1);return D(r<e.length,"invalid ENS name; empty component","name",t),n.push(AL(e.slice(r))),n}function TL(t){try{if(t.length===0)throw new Error("empty label");return EL(t)}catch(e){D(!1,`invalid ENS name (${e.message})`,"name",t)}}function nd(t){D(typeof t=="string","invalid ENS name; not a string","name",t),D(t.length,"invalid ENS name (empty label)","name",t);let e=SL,n=_L(t);for(;n.length;)e=gt(Ze([e,gt(n.pop())]));return Z(e)}function jA(t,e){let n=e??63;return D(n<=255,"DNS encoded label cannot exceed 255","length",n),Z(Ze(_L(t).map(r=>{D(r.length<=n,`label ${JSON.stringify(t)} exceeds ${n} bytes`,"name",t);let i=new Uint8Array(r.length+1);return i.set(r,1),i[0]=i.length-1,i})))+"00"}var RL=new Uint8Array(32);RL.fill(0);var wJ=BigInt(-1),OL=BigInt(0),PL=BigInt(1),vJ=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function bJ(t){let e=ye(t),n=e.length%32;return n?Ze([e,RL.slice(n)]):Z(e)}var EJ=fr(PL,32),IJ=fr(OL,32),DL={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},VA=["name","version","chainId","verifyingContract","salt"];function NL(t){return function(e){return D(typeof e=="string",`invalid domain value for ${JSON.stringify(t)}`,`domain.${t}`,e),e}}var CJ={name:NL("name"),version:NL("version"),chainId:function(t){let e=te(t,"domain.chainId");return D(e>=0,"invalid chain ID","domain.chainId",t),Number.isSafeInteger(e)?Number(e):zn(e)},verifyingContract:function(t){try{return Re(t).toLowerCase()}catch{}D(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",t)},salt:function(t){let e=ye(t,"domain.salt");return D(e.length===32,'invalid domain value "salt"',"domain.salt",t),Z(e)}};function HA(t){{let e=t.match(/^(u?)int(\d+)$/);if(e){let n=e[1]==="",r=parseInt(e[2]);D(r%8===0&&r!==0&&r<=256&&e[2]===String(r),"invalid numeric width","type",t);let i=gi(vJ,n?r-1:r),s=n?(i+PL)*wJ:OL;return function(o){let a=te(o,"value");return D(a>=s&&a<=i,`value out-of-bounds for ${t}`,"value",a),fr(n?Hu(a,256):a,32)}}}{let e=t.match(/^bytes(\d+)$/);if(e){let n=parseInt(e[1]);return D(n!==0&&n<=32&&e[1]===String(n),"invalid bytes width","type",t),function(r){let i=ye(r);return D(i.length===n,`invalid length for ${t}`,"value",r),bJ(r)}}}switch(t){case"address":return function(e){return qn(Re(e),32)};case"bool":return function(e){return e?EJ:IJ};case"bytes":return function(e){return gt(e)};case"string":return function(e){return ts(e)}}return null}function xL(t,e){return`${t}(${e.map(({name:n,type:r})=>r+" "+n).join(",")})`}function Dw(t){let e=t.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:t}}var rd=class t{primaryType;#e;get types(){return JSON.parse(this.#e)}#t;#n;constructor(e){this.#t=new Map,this.#n=new Map;let n=new Map,r=new Map,i=new Map,s={};Object.keys(e).forEach(c=>{s[c]=e[c].map(({name:l,type:u})=>{let{base:d,index:h}=Dw(u);return d==="int"&&!e.int&&(d="int256"),d==="uint"&&!e.uint&&(d="uint256"),{name:l,type:d+(h||"")}}),n.set(c,new Set),r.set(c,[]),i.set(c,new Set)}),this.#e=JSON.stringify(s);for(let c in s){let l=new Set;for(let u of s[c]){D(!l.has(u.name),`duplicate variable name ${JSON.stringify(u.name)} in ${JSON.stringify(c)}`,"types",e),l.add(u.name);let d=Dw(u.type).base;D(d!==c,`circular type reference to ${JSON.stringify(d)}`,"types",e),!HA(d)&&(D(r.has(d),`unknown type ${JSON.stringify(d)}`,"types",e),r.get(d).push(c),n.get(c).add(d))}}let o=Array.from(r.keys()).filter(c=>r.get(c).length===0);D(o.length!==0,"missing primary type","types",e),D(o.length===1,`ambiguous primary types or unused types: ${o.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),ce(this,{primaryType:o[0]});function a(c,l){D(!l.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),l.add(c);for(let u of n.get(c))if(r.has(u)){a(u,l);for(let d of l)i.get(d).add(u)}l.delete(c)}a(this.primaryType,new Set);for(let[c,l]of i){let u=Array.from(l);u.sort(),this.#t.set(c,xL(c,s[c])+u.map(d=>xL(d,s[d])).join(""))}}getEncoder(e){let n=this.#n.get(e);return n||(n=this.#r(e),this.#n.set(e,n)),n}#r(e){{let i=HA(e);if(i)return i}let n=Dw(e).array;if(n){let i=n.prefix,s=this.getEncoder(i);return o=>{D(n.count===-1||n.count===o.length,`array length mismatch; expected length ${n.count}`,"value",o);let a=o.map(s);return this.#t.has(i)&&(a=a.map(gt)),gt(Ze(a))}}let r=this.types[e];if(r){let i=ts(this.#t.get(e));return s=>{let o=r.map(({name:a,type:c})=>{let l=this.getEncoder(c)(s[a]);return this.#t.has(c)?gt(l):l});return o.unshift(i),Ze(o)}}D(!1,`unknown type: ${e}`,"type",e)}encodeType(e){let n=this.#t.get(e);return D(n,`unknown type: ${JSON.stringify(e)}`,"name",e),n}encodeData(e,n){return this.getEncoder(e)(n)}hashStruct(e,n){return gt(this.encodeData(e,n))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,n,r){if(HA(e))return r(e,n);let i=Dw(e).array;if(i)return D(i.count===-1||i.count===n.length,`array length mismatch; expected length ${i.count}`,"value",n),n.map(o=>this._visit(i.prefix,o,r));let s=this.types[e];if(s)return s.reduce((o,{name:a,type:c})=>(o[a]=this._visit(c,n[a],r),o),{});D(!1,`unknown type: ${e}`,"type",e)}visit(e,n){return this._visit(this.primaryType,e,n)}static from(e){return new t(e)}static getPrimaryType(e){return t.from(e).primaryType}static hashStruct(e,n,r){return t.from(n).hashStruct(e,r)}static hashDomain(e){let n=[];for(let r in e){if(e[r]==null)continue;let i=DL[r];D(i,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",e),n.push({name:r,type:i})}return n.sort((r,i)=>VA.indexOf(r.name)-VA.indexOf(i.name)),t.hashStruct("EIP712Domain",{EIP712Domain:n},e)}static encode(e,n,r){return Ze(["0x1901",t.hashDomain(e),t.from(n).hash(r)])}static hash(e,n,r){return gt(t.encode(e,n,r))}static async resolveNames(e,n,r,i){e=Object.assign({},e);for(let a in e)e[a]==null&&delete e[a];let s={};e.verifyingContract&&!Ue(e.verifyingContract,20)&&(s[e.verifyingContract]="0x");let o=t.from(n);o.visit(r,(a,c)=>(a==="address"&&!Ue(c,20)&&(s[c]="0x"),c));for(let a in s)s[a]=await i(a);return e.verifyingContract&&s[e.verifyingContract]&&(e.verifyingContract=s[e.verifyingContract]),r=o.visit(r,(a,c)=>a==="address"&&s[c]?s[c]:c),{domain:e,value:r}}static getPayload(e,n,r){t.hashDomain(e);let i={},s=[];VA.forEach(c=>{let l=e[c];l!=null&&(i[c]=CJ[c](l),s.push({name:c,type:DL[c]}))});let o=t.from(n);n=o.types;let a=Object.assign({},n);return D(a.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",n),a.EIP712Domain=s,o.encode(r),{types:a,domain:i,primaryType:o.primaryType,message:o.visit(r,(c,l)=>{if(c.match(/^bytes(\d*)/))return Z(ye(l));if(c.match(/^u?int/))return te(l).toString();switch(c){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return D(typeof l=="string","invalid string","value",l),l}D(!1,"unsupported type","type",c)})}}};function pr(t){let e=new Set;return t.forEach(n=>e.add(n)),Object.freeze(e)}var AJ="external public payable override",SJ=pr(AJ.split(" ")),$L="constant external internal payable private public pure view override",_J=pr($L.split(" ")),qL="constructor error event fallback function receive struct",zL=pr(qL.split(" ")),GL="calldata memory storage payable indexed",TJ=pr(GL.split(" ")),DJ="tuple returns",NJ=[qL,GL,DJ,$L].join(" "),xJ=pr(NJ.split(" ")),RJ={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},OJ=new RegExp("^(\\s*)"),PJ=new RegExp("^([0-9]+)"),MJ=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),KL=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),WL=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$"),ns=class t{#e;#t;get offset(){return this.#e}get length(){return this.#t.length-this.#e}constructor(e){this.#e=0,this.#t=e.slice()}clone(){return new t(this.#t)}reset(){this.#e=0}#n(e=0,n=0){return new t(this.#t.slice(e,n).map(r=>Object.freeze(Object.assign({},r,{match:r.match-e,linkBack:r.linkBack-e,linkNext:r.linkNext-e}))))}popKeyword(e){let n=this.peek();if(n.type!=="KEYWORD"||!e.has(n.text))throw new Error(`expected keyword ${n.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){let n=this.peek();throw new Error(`expected ${e}; got ${n.type} ${JSON.stringify(n.text)}`)}return this.pop().text}popParen(){let e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");let n=this.#n(this.#e+1,e.match+1);return this.#e=e.match+1,n}popParams(){let e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");let n=[];for(;this.#e<e.match-1;){let r=this.peek().linkNext;n.push(this.#n(this.#e+1,r)),this.#e=r}return this.#e=e.match+1,n}peek(){if(this.#e>=this.#t.length)throw new Error("out-of-bounds");return this.#t[this.#e]}peekKeyword(e){let n=this.peekType("KEYWORD");return n!=null&&e.has(n)?n:null}peekType(e){if(this.length===0)return null;let n=this.peek();return n.type===e?n.text:null}pop(){let e=this.peek();return this.#e++,e}toString(){let e=[];for(let n=this.#e;n<this.#t.length;n++){let r=this.#t[n];e.push(`${r.type}:${r.text}`)}return`<TokenString ${e.join(" ")}>`}};function wa(t){let e=[],n=o=>{let a=s<t.length?JSON.stringify(t[s]):"$EOI";throw new Error(`invalid token ${a} at ${s}: ${o}`)},r=[],i=[],s=0;for(;s<t.length;){let o=t.substring(s),a=o.match(OJ);a&&(s+=a[1].length,o=t.substring(s));let c={depth:r.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:s,value:-1};e.push(c);let l=RJ[o[0]]||"";if(l){if(c.type=l,c.text=o[0],s++,l==="OPEN_PAREN")r.push(e.length-1),i.push(e.length-1);else if(l=="CLOSE_PAREN")r.length===0&&n("no matching open bracket"),c.match=r.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=i.pop(),e[c.linkBack].linkNext=e.length-1;else if(l==="COMMA")c.linkBack=i.pop(),e[c.linkBack].linkNext=e.length-1,i.push(e.length-1);else if(l==="OPEN_BRACKET")c.type="BRACKET";else if(l==="CLOSE_BRACKET"){let u=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){let d=e.pop().text;u=d+u,e[e.length-1].value=ve(d)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=u}continue}if(a=o.match(MJ),a){if(c.text=a[1],s+=c.text.length,xJ.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(WL)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(PJ),a){c.text=a[1],c.type="NUMBER",s+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${s}`)}return new ns(e.map(o=>Object.freeze(o)))}function ML(t,e){let n=[];for(let r in e.keys())t.has(r)&&n.push(r);if(n.length>1)throw new Error(`conflicting types: ${n.join(", ")}`)}function xw(t,e){if(e.peekKeyword(zL)){let n=e.pop().text;if(n!==t)throw new Error(`expected ${t}, got ${n}`)}return e.popType("ID")}function vo(t,e){let n=new Set;for(;;){let r=t.peekType("KEYWORD");if(r==null||e&&!e.has(r))break;if(t.pop(),n.has(r))throw new Error(`duplicate keywords: ${JSON.stringify(r)}`);n.add(r)}return Object.freeze(n)}function QL(t){let e=vo(t,_J);return ML(e,pr("constant payable nonpayable".split(" "))),ML(e,pr("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function wo(t,e){return t.popParams().map(n=>un.from(n,e))}function YL(t){if(t.peekType("AT")){if(t.pop(),t.peekType("NUMBER"))return te(t.pop().text);throw new Error("invalid gas")}return null}function al(t){if(t.length)throw new Error(`unexpected tokens at offset ${t.offset}: ${t.toString()}`)}var kJ=new RegExp(/^(.*)\[([0-9]*)\]$/);function kL(t){let e=t.match(WL);if(D(e,"invalid type","type",t),t==="uint")return"uint256";if(t==="int")return"int256";if(e[2]){let n=parseInt(e[2]);D(n!==0&&n<=32,"invalid bytes length","type",t)}else if(e[3]){let n=parseInt(e[3]);D(n!==0&&n<=256&&n%8===0,"invalid numeric width","type",t)}return t}var Ht={},Pr=Symbol.for("_ethers_internal"),LL="_ParamTypeInternal",FL="_ErrorInternal",BL="_EventInternal",UL="_ConstructorInternal",jL="_FallbackInternal",VL="_FunctionInternal",HL="_StructInternal",un=class t{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(e,n,r,i,s,o,a,c){if(Wi(e,Ht,"ParamType"),Object.defineProperty(this,Pr,{value:LL}),o&&(o=Object.freeze(o.slice())),i==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(i==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");ce(this,{name:n,type:r,baseType:i,indexed:s,components:o,arrayLength:a,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){let r=this.name||"";if(this.isArray()){let s=JSON.parse(this.arrayChildren.format("json"));return s.name=r,s.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(s)}let i={type:this.baseType==="tuple"?"tuple":this.type,name:r};return typeof this.indexed=="boolean"&&(i.indexed=this.indexed),this.isTuple()&&(i.components=this.components.map(s=>JSON.parse(s.format(e)))),JSON.stringify(i)}let n="";return this.isArray()?(n+=this.arrayChildren.format(e),n+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?n+="("+this.components.map(r=>r.format(e)).join(e==="full"?", ":",")+")":n+=this.type,e!=="sighash"&&(this.indexed===!0&&(n+=" indexed"),e==="full"&&this.name&&(n+=" "+this.name)),n}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,n){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");let r=this;return e.map(i=>r.arrayChildren.walk(i,n))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");let r=this;return e.map((i,s)=>r.components[s].walk(i,n))}return n(this.type,e)}#e(e,n,r,i){if(this.isArray()){if(!Array.isArray(n))throw new Error("invalid array value");if(this.arrayLength!==-1&&n.length!==this.arrayLength)throw new Error("array is wrong length");let o=this.arrayChildren,a=n.slice();a.forEach((c,l)=>{o.#e(e,c,r,u=>{a[l]=u})}),i(a);return}if(this.isTuple()){let o=this.components,a;if(Array.isArray(n))a=n.slice();else{if(n==null||typeof n!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in n))throw new Error(`missing value for component ${c.name}`);return n[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,l)=>{o[l].#e(e,c,r,u=>{a[l]=u})}),i(a);return}let s=r(this.type,n);s.then?e.push((async function(){i(await s)})()):i(s)}async walkAsync(e,n){let r=[],i=[e];return this.#e(r,e,n,s=>{i[0]=s}),r.length&&await Promise.all(r),i[0]}static from(e,n){if(t.isParamType(e))return e;if(typeof e=="string")try{return t.from(wa(e),n)}catch{D(!1,"invalid param type","obj",e)}else if(e instanceof ns){let a="",c="",l=null;vo(e,pr(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",l=e.popParams().map(g=>t.from(g)),a=`tuple(${l.map(g=>g.format()).join(",")})`):(a=kL(e.popType("TYPE")),c=a);let u=null,d=null;for(;e.length&&e.peekType("BRACKET");){let g=e.pop();u=new t(Ht,"",a,c,null,l,d,u),d=g.value,a+=g.text,c="array",l=null}let h=null;if(vo(e,TJ).has("indexed")){if(!n)throw new Error("");h=!0}let p=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new t(Ht,p,a,c,h,l,d,u)}let r=e.name;D(!r||typeof r=="string"&&r.match(KL),"invalid name","obj.name",r);let i=e.indexed;i!=null&&(D(n,"parameter cannot be indexed","obj.indexed",e.indexed),i=!!i);let s=e.type,o=s.match(kJ);if(o){let a=parseInt(o[2]||"-1"),c=t.from({type:o[1],components:e.components});return new t(Ht,r||"",s,"array",i,null,a,c)}if(s==="tuple"||s.startsWith("tuple(")||s.startsWith("(")){let a=e.components!=null?e.components.map(l=>t.from(l)):null;return new t(Ht,r||"",s,"tuple",i,a,null,null)}return s=kL(e.type),new t(Ht,r||"",s,s,i,null,null,null)}static isParamType(e){return e&&e[Pr]===LL}},cl=class t{type;inputs;constructor(e,n,r){Wi(e,Ht,"Fragment"),r=Object.freeze(r.slice()),ce(this,{type:n,inputs:r})}static from(e){if(typeof e=="string"){try{t.from(JSON.parse(e))}catch{}return t.from(wa(e))}if(e instanceof ns)switch(e.peekKeyword(zL)){case"constructor":return sl.from(e);case"error":return wi.from(e);case"event":return il.from(e);case"fallback":case"receive":return Nw.from(e);case"function":return ol.from(e);case"struct":return zf.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return sl.from(e);case"error":return wi.from(e);case"event":return il.from(e);case"fallback":case"receive":return Nw.from(e);case"function":return ol.from(e);case"struct":return zf.from(e)}G(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}D(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return sl.isFragment(e)}static isError(e){return wi.isFragment(e)}static isEvent(e){return il.isFragment(e)}static isFunction(e){return ol.isFragment(e)}static isStruct(e){return zf.isFragment(e)}},id=class extends cl{name;constructor(e,n,r,i){super(e,n,i),D(typeof r=="string"&&r.match(KL),"invalid identifier","name",r),i=Object.freeze(i.slice()),ce(this,{name:r})}};function Gf(t,e){return"("+e.map(n=>n.format(t)).join(t==="full"?", ":",")+")"}var wi=class t extends id{constructor(e,n,r){super(e,"error",n,r),Object.defineProperty(this,Pr,{value:FL})}get selector(){return ts(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(e)))});let n=[];return e!=="sighash"&&n.push("error"),n.push(this.name+Gf(e,this.inputs)),n.join(" ")}static from(e){if(t.isFragment(e))return e;if(typeof e=="string")return t.from(wa(e));if(e instanceof ns){let n=xw("error",e),r=wo(e);return al(e),new t(Ht,n,r)}return new t(Ht,e.name,e.inputs?e.inputs.map(un.from):[])}static isFragment(e){return e&&e[Pr]===FL}},il=class t extends id{anonymous;constructor(e,n,r,i){super(e,"event",n,r),Object.defineProperty(this,Pr,{value:BL}),ce(this,{anonymous:i})}get topicHash(){return ts(this.format("sighash"))}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(r=>JSON.parse(r.format(e)))});let n=[];return e!=="sighash"&&n.push("event"),n.push(this.name+Gf(e,this.inputs)),e!=="sighash"&&this.anonymous&&n.push("anonymous"),n.join(" ")}static getTopicHash(e,n){return n=(n||[]).map(i=>un.from(i)),new t(Ht,e,n,!1).topicHash}static from(e){if(t.isFragment(e))return e;if(typeof e=="string")try{return t.from(wa(e))}catch{D(!1,"invalid event fragment","obj",e)}else if(e instanceof ns){let n=xw("event",e),r=wo(e,!0),i=!!vo(e,pr(["anonymous"])).has("anonymous");return al(e),new t(Ht,n,r,i)}return new t(Ht,e.name,e.inputs?e.inputs.map(n=>un.from(n,!0)):[],!!e.anonymous)}static isFragment(e){return e&&e[Pr]===BL}},sl=class t extends cl{payable;gas;constructor(e,n,r,i,s){super(e,n,r),Object.defineProperty(this,Pr,{value:UL}),ce(this,{payable:i,gas:s})}format(e){if(G(e!=null&&e!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),e==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(r=>JSON.parse(r.format(e)))});let n=[`constructor${Gf(e,this.inputs)}`];return this.payable&&n.push("payable"),this.gas!=null&&n.push(`@${this.gas.toString()}`),n.join(" ")}static from(e){if(t.isFragment(e))return e;if(typeof e=="string")try{return t.from(wa(e))}catch{D(!1,"invalid constuctor fragment","obj",e)}else if(e instanceof ns){vo(e,pr(["constructor"]));let n=wo(e),r=!!vo(e,SJ).has("payable"),i=YL(e);return al(e),new t(Ht,"constructor",n,r,i)}return new t(Ht,"constructor",e.inputs?e.inputs.map(un.from):[],!!e.payable,e.gas!=null?e.gas:null)}static isFragment(e){return e&&e[Pr]===UL}},Nw=class t extends cl{payable;constructor(e,n,r){super(e,"fallback",n),Object.defineProperty(this,Pr,{value:jL}),ce(this,{payable:r})}format(e){let n=this.inputs.length===0?"receive":"fallback";if(e==="json"){let r=this.payable?"payable":"nonpayable";return JSON.stringify({type:n,stateMutability:r})}return`${n}()${this.payable?" payable":""}`}static from(e){if(t.isFragment(e))return e;if(typeof e=="string")try{return t.from(wa(e))}catch{D(!1,"invalid fallback fragment","obj",e)}else if(e instanceof ns){let n=e.toString(),r=e.peekKeyword(pr(["fallback","receive"]));if(D(r,"type must be fallback or receive","obj",n),e.popKeyword(pr(["fallback","receive"]))==="receive"){let a=wo(e);return D(a.length===0,"receive cannot have arguments","obj.inputs",a),vo(e,pr(["payable"])),al(e),new t(Ht,[],!0)}let s=wo(e);s.length?D(s.length===1&&s[0].type==="bytes","invalid fallback inputs","obj.inputs",s.map(a=>a.format("minimal")).join(", ")):s=[un.from("bytes")];let o=QL(e);if(D(o==="nonpayable"||o==="payable","fallback cannot be constants","obj.stateMutability",o),vo(e,pr(["returns"])).has("returns")){let a=wo(e);D(a.length===1&&a[0].type==="bytes","invalid fallback outputs","obj.outputs",a.map(c=>c.format("minimal")).join(", "))}return al(e),new t(Ht,s,o==="payable")}if(e.type==="receive")return new t(Ht,[],!0);if(e.type==="fallback"){let n=[un.from("bytes")],r=e.stateMutability==="payable";return new t(Ht,n,r)}D(!1,"invalid fallback description","obj",e)}static isFragment(e){return e&&e[Pr]===jL}},ol=class t extends id{constant;outputs;stateMutability;payable;gas;constructor(e,n,r,i,s,o){super(e,"function",n,i),Object.defineProperty(this,Pr,{value:VL}),s=Object.freeze(s.slice()),ce(this,{constant:r==="view"||r==="pure",gas:o,outputs:s,payable:r==="payable",stateMutability:r})}get selector(){return ts(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(r=>JSON.parse(r.format(e))),outputs:this.outputs.map(r=>JSON.parse(r.format(e)))});let n=[];return e!=="sighash"&&n.push("function"),n.push(this.name+Gf(e,this.inputs)),e!=="sighash"&&(this.stateMutability!=="nonpayable"&&n.push(this.stateMutability),this.outputs&&this.outputs.length&&(n.push("returns"),n.push(Gf(e,this.outputs))),this.gas!=null&&n.push(`@${this.gas.toString()}`)),n.join(" ")}static getSelector(e,n){return n=(n||[]).map(i=>un.from(i)),new t(Ht,e,"view",n,[],null).selector}static from(e){if(t.isFragment(e))return e;if(typeof e=="string")try{return t.from(wa(e))}catch{D(!1,"invalid function fragment","obj",e)}else if(e instanceof ns){let r=xw("function",e),i=wo(e),s=QL(e),o=[];vo(e,pr(["returns"])).has("returns")&&(o=wo(e));let a=YL(e);return al(e),new t(Ht,r,s,i,o,a)}let n=e.stateMutability;return n==null&&(n="payable",typeof e.constant=="boolean"?(n="view",e.constant||(n="payable",typeof e.payable=="boolean"&&!e.payable&&(n="nonpayable"))):typeof e.payable=="boolean"&&!e.payable&&(n="nonpayable")),new t(Ht,e.name,n,e.inputs?e.inputs.map(un.from):[],e.outputs?e.outputs.map(un.from):[],e.gas!=null?e.gas:null)}static isFragment(e){return e&&e[Pr]===VL}},zf=class t extends id{constructor(e,n,r){super(e,"struct",n,r),Object.defineProperty(this,Pr,{value:HL})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return t.from(wa(e))}catch{D(!1,"invalid struct fragment","obj",e)}else if(e instanceof ns){let n=xw("struct",e),r=wo(e);return al(e),new t(Ht,n,r)}return new t(Ht,e.name,e.inputs?e.inputs.map(un.from):[])}static isFragment(e){return e&&e[Pr]===HL}};var rs=new Map;rs.set(0,"GENERIC_PANIC");rs.set(1,"ASSERT_FALSE");rs.set(17,"OVERFLOW");rs.set(18,"DIVIDE_BY_ZERO");rs.set(33,"ENUM_RANGE_ERROR");rs.set(34,"BAD_STORAGE_DATA");rs.set(49,"STACK_UNDERFLOW");rs.set(50,"ARRAY_RANGE_ERROR");rs.set(65,"OUT_OF_MEMORY");rs.set(81,"UNINITIALIZED_FUNCTION_CALL");var LJ=new RegExp(/^bytes([0-9]*)$/),FJ=new RegExp(/^(u?int)([0-9]*)$/),$A=null,JL=1024;function BJ(t,e,n,r){let i="missing revert data",s=null,o=null,a=null;if(n){i="execution reverted";let l=ye(n);if(n=Z(n),l.length===0)i+=" (no data present; likely require(false) occurred",s="require(false)";else if(l.length%32!==4)i+=" (could not decode reason; invalid data length)";else if(Z(l.slice(0,4))==="0x08c379a0")try{s=r.decode(["string"],l.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[s]},i+=`: ${JSON.stringify(s)}`}catch{i+=" (could not decode reason; invalid string data)"}else if(Z(l.slice(0,4))==="0x4e487b71")try{let u=Number(r.decode(["uint256"],l.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[u]},s=`Panic due to ${rs.get(u)||"UNKNOWN"}(${u})`,i+=`: ${s}`}catch{i+=" (could not decode panic code)"}else i+=" (unknown custom error)"}let c={to:e.to?Re(e.to):null,data:e.data||"0x"};return e.from&&(c.from=Re(e.from)),Je(i,"CALL_EXCEPTION",{action:t,data:n,reason:s,transaction:c,invocation:o,revert:a})}var va=class t{#e(e){if(e.isArray())return new dw(this.#e(e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new Xc(e.components.map(r=>this.#e(r)),e.name);switch(e.baseType){case"address":return new lw(e.name);case"bool":return new hw(e.name);case"string":return new yw(e.name);case"bytes":return new fw(e.name);case"":return new gw(e.name)}let n=e.type.match(FJ);if(n){let r=parseInt(n[2]||"256");return D(r!==0&&r<=256&&r%8===0,"invalid "+n[1]+" bit length","param",e),new mw(r/8,n[1]==="int",e.name)}if(n=e.type.match(LJ),n){let r=parseInt(n[1]);return D(r!==0&&r<=32,"invalid bytes length","param",e),new pw(r,e.name)}D(!1,"invalid type","type",e.type)}getDefaultValue(e){let n=e.map(i=>this.#e(un.from(i)));return new Xc(n,"_").defaultValue()}encode(e,n){ju(n.length,e.length,"types/values length mismatch");let r=e.map(o=>this.#e(un.from(o))),i=new Xc(r,"_"),s=new Wc;return i.encode(s,n),s.data}decode(e,n,r){let i=e.map(o=>this.#e(un.from(o)));return new Xc(i,"_").decode(new Gy(n,r,JL))}static _setDefaultMaxInflation(e){D(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),JL=e}static defaultAbiCoder(){return $A==null&&($A=new t),$A}static getBuiltinCallException(e,n,r){return BJ(e,n,r,t.defaultAbiCoder())}};var Rw=class{fragment;name;signature;topic;args;constructor(e,n,r){let i=e.name,s=e.format();ce(this,{fragment:e,name:i,signature:s,topic:n,args:r})}},Ow=class{fragment;name;args;signature;selector;value;constructor(e,n,r,i){let s=e.name,o=e.format();ce(this,{fragment:e,name:s,args:r,signature:o,selector:n,value:i})}},Pw=class{fragment;name;args;signature;selector;constructor(e,n,r){let i=e.name,s=e.format();ce(this,{fragment:e,name:i,args:r,signature:s,selector:n})}},Kf=class{hash;_isIndexed;static isIndexed(e){return!!(e&&e._isIndexed)}constructor(e){ce(this,{hash:e,_isIndexed:!0})}},ZL={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},XL={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:t=>`reverted with reason string ${JSON.stringify(t)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:t=>{let e="unknown panic code";return t>=0&&t<=255&&ZL[t.toString()]&&(e=ZL[t.toString()]),`reverted with panic code 0x${t.toString(16)} (${e})`}}},Wf=class t{fragments;deploy;fallback;receive;#e;#t;#n;#r;constructor(e){let n=[];typeof e=="string"?n=JSON.parse(e):n=e,this.#n=new Map,this.#e=new Map,this.#t=new Map;let r=[];for(let o of n)try{r.push(cl.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}ce(this,{fragments:Object.freeze(r)});let i=null,s=!1;this.#r=this.getAbiCoder(),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}ce(this,{deploy:o});return;case"fallback":o.inputs.length===0?s=!0:(D(!i||o.payable!==i.payable,"conflicting fallback fragments",`fragments[${a}]`,o),i=o,s=i.payable);return;case"function":c=this.#n;break;case"event":c=this.#t;break;case"error":c=this.#e;break;default:return}let l=o.format();c.has(l)||c.set(l,o)}),this.deploy||ce(this,{deploy:sl.from("constructor()")}),ce(this,{fallback:i,receive:s})}format(e){let n=e?"minimal":"full";return this.fragments.map(i=>i.format(n))}formatJson(){let e=this.fragments.map(n=>n.format("json"));return JSON.stringify(e.map(n=>JSON.parse(n)))}getAbiCoder(){return va.defaultAbiCoder()}#i(e,n,r){if(Ue(e)){let s=e.toLowerCase();for(let o of this.#n.values())if(s===o.selector)return o;return null}if(e.indexOf("(")===-1){let s=[];for(let[o,a]of this.#n)o.split("(")[0]===e&&s.push(a);if(n){let o=n.length>0?n[n.length-1]:null,a=n.length,c=!0;kt.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let l=s.length-1;l>=0;l--){let u=s[l].inputs.length;u!==a&&(!c||u!==a-1)&&s.splice(l,1)}for(let l=s.length-1;l>=0;l--){let u=s[l].inputs;for(let d=0;d<n.length;d++)if(kt.isTyped(n[d])){if(d>=u.length){if(n[d].type==="overrides")continue;s.splice(l,1);break}if(n[d].type!==u[d].baseType){s.splice(l,1);break}}}}if(s.length===1&&n&&n.length!==s[0].inputs.length){let o=n[n.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&s.splice(0,1)}if(s.length===0)return null;if(s.length>1&&r){let o=s.map(a=>JSON.stringify(a.format())).join(", ");D(!1,`ambiguous function description (i.e. matches ${o})`,"key",e)}return s[0]}let i=this.#n.get(ol.from(e).format());return i||null}getFunctionName(e){let n=this.#i(e,null,!1);return D(n,"no matching function","key",e),n.name}hasFunction(e){return!!this.#i(e,null,!1)}getFunction(e,n){return this.#i(e,n||null,!0)}forEachFunction(e){let n=Array.from(this.#n.keys());n.sort((r,i)=>r.localeCompare(i));for(let r=0;r<n.length;r++){let i=n[r];e(this.#n.get(i),r)}}#o(e,n,r){if(Ue(e)){let s=e.toLowerCase();for(let o of this.#t.values())if(s===o.topicHash)return o;return null}if(e.indexOf("(")===-1){let s=[];for(let[o,a]of this.#t)o.split("(")[0]===e&&s.push(a);if(n){for(let o=s.length-1;o>=0;o--)s[o].inputs.length<n.length&&s.splice(o,1);for(let o=s.length-1;o>=0;o--){let a=s[o].inputs;for(let c=0;c<n.length;c++)if(kt.isTyped(n[c])&&n[c].type!==a[c].baseType){s.splice(o,1);break}}}if(s.length===0)return null;if(s.length>1&&r){let o=s.map(a=>JSON.stringify(a.format())).join(", ");D(!1,`ambiguous event description (i.e. matches ${o})`,"key",e)}return s[0]}let i=this.#t.get(il.from(e).format());return i||null}getEventName(e){let n=this.#o(e,null,!1);return D(n,"no matching event","key",e),n.name}hasEvent(e){return!!this.#o(e,null,!1)}getEvent(e,n){return this.#o(e,n||null,!0)}forEachEvent(e){let n=Array.from(this.#t.keys());n.sort((r,i)=>r.localeCompare(i));for(let r=0;r<n.length;r++){let i=n[r];e(this.#t.get(i),r)}}getError(e,n){if(Ue(e)){let i=e.toLowerCase();if(XL[i])return wi.from(XL[i].signature);for(let s of this.#e.values())if(i===s.selector)return s;return null}if(e.indexOf("(")===-1){let i=[];for(let[s,o]of this.#e)s.split("(")[0]===e&&i.push(o);if(i.length===0)return e==="Error"?wi.from("error Error(string)"):e==="Panic"?wi.from("error Panic(uint256)"):null;if(i.length>1){let s=i.map(o=>JSON.stringify(o.format())).join(", ");D(!1,`ambiguous error description (i.e. ${s})`,"name",e)}return i[0]}if(e=wi.from(e).format(),e==="Error(string)")return wi.from("error Error(string)");if(e==="Panic(uint256)")return wi.from("error Panic(uint256)");let r=this.#e.get(e);return r||null}forEachError(e){let n=Array.from(this.#e.keys());n.sort((r,i)=>r.localeCompare(i));for(let r=0;r<n.length;r++){let i=n[r];e(this.#e.get(i),r)}}_decodeParams(e,n){return this.#r.decode(e,n)}_encodeParams(e,n){return this.#r.encode(e,n)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,n){if(typeof e=="string"){let r=this.getError(e);D(r,"unknown error","fragment",e),e=r}return D(_t(n,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",n),this._decodeParams(e.inputs,_t(n,4))}encodeErrorResult(e,n){if(typeof e=="string"){let r=this.getError(e);D(r,"unknown error","fragment",e),e=r}return Ze([e.selector,this._encodeParams(e.inputs,n||[])])}decodeFunctionData(e,n){if(typeof e=="string"){let r=this.getFunction(e);D(r,"unknown function","fragment",e),e=r}return D(_t(n,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",n),this._decodeParams(e.inputs,_t(n,4))}encodeFunctionData(e,n){if(typeof e=="string"){let r=this.getFunction(e);D(r,"unknown function","fragment",e),e=r}return Ze([e.selector,this._encodeParams(e.inputs,n||[])])}decodeFunctionResult(e,n){if(typeof e=="string"){let s=this.getFunction(e);D(s,"unknown function","fragment",e),e=s}let r="invalid length for result data",i=Kt(n);if(i.length%32===0)try{return this.#r.decode(e.outputs,i)}catch{r="could not decode result data"}G(!1,r,"BAD_DATA",{value:Z(i),info:{method:e.name,signature:e.format()}})}makeError(e,n){let r=ye(e,"data"),i=va.getBuiltinCallException("call",n,r);if(i.message.startsWith("execution reverted (unknown custom error)")){let a=Z(r.slice(0,4)),c=this.getError(a);if(c)try{let l=this.#r.decode(c.inputs,r.slice(4));i.revert={name:c.name,signature:c.format(),args:l},i.reason=i.revert.signature,i.message=`execution reverted: ${i.reason}`}catch{i.message="execution reverted (coult not decode custom error)"}}let o=this.parseTransaction(n);return o&&(i.invocation={method:o.name,signature:o.signature,args:o.args}),i}encodeFunctionResult(e,n){if(typeof e=="string"){let r=this.getFunction(e);D(r,"unknown function","fragment",e),e=r}return Z(this.#r.encode(e.outputs,n||[]))}encodeFilterTopics(e,n){if(typeof e=="string"){let s=this.getEvent(e);D(s,"unknown event","eventFragment",e),e=s}G(n.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:n.length,expectedCount:e.inputs.length});let r=[];e.anonymous||r.push(e.topicHash);let i=(s,o)=>s.type==="string"?ts(o):s.type==="bytes"?gt(Z(o)):(s.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":s.type.match(/^u?int/)?o=fr(o):s.type.match(/^bytes/)?o=Fy(o,32):s.type==="address"&&this.#r.encode(["address"],[o]),qn(Z(o),32));for(n.forEach((s,o)=>{let a=e.inputs[o];if(!a.indexed){D(s==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,s);return}s==null?r.push(null):a.baseType==="array"||a.baseType==="tuple"?D(!1,"filtering with tuples or arrays not supported","contract."+a.name,s):Array.isArray(s)?r.push(s.map(c=>i(a,c))):r.push(i(a,s))});r.length&&r[r.length-1]===null;)r.pop();return r}encodeEventLog(e,n){if(typeof e=="string"){let o=this.getEvent(e);D(o,"unknown event","eventFragment",e),e=o}let r=[],i=[],s=[];return e.anonymous||r.push(e.topicHash),D(n.length===e.inputs.length,"event arguments/values mismatch","values",n),e.inputs.forEach((o,a)=>{let c=n[a];if(o.indexed)if(o.type==="string")r.push(ts(c));else if(o.type==="bytes")r.push(gt(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");r.push(this.#r.encode([o.type],[c]))}else i.push(o),s.push(c)}),{data:this.#r.encode(i,s),topics:r}}decodeEventLog(e,n,r){if(typeof e=="string"){let f=this.getEvent(e);D(f,"unknown event","eventFragment",e),e=f}if(r!=null&&!e.anonymous){let f=e.topicHash;D(Ue(r[0],32)&&r[0].toLowerCase()===f,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}let i=[],s=[],o=[];e.inputs.forEach((f,p)=>{f.indexed?f.type==="string"||f.type==="bytes"||f.baseType==="tuple"||f.baseType==="array"?(i.push(un.from({type:"bytes32",name:f.name})),o.push(!0)):(i.push(f),o.push(!1)):(s.push(f),o.push(!1))});let a=r!=null?this.#r.decode(i,Ze(r)):null,c=this.#r.decode(s,n,!0),l=[],u=[],d=0,h=0;return e.inputs.forEach((f,p)=>{let g=null;if(f.indexed)if(a==null)g=new Kf(null);else if(o[p])g=new Kf(a[h++]);else try{g=a[h++]}catch(m){g=m}else try{g=c[d++]}catch(m){g=m}l.push(g),u.push(f.name||null)}),ho.fromItems(l,u)}parseTransaction(e){let n=ye(e.data,"tx.data"),r=te(e.value!=null?e.value:0,"tx.value"),i=this.getFunction(Z(n.slice(0,4)));if(!i)return null;let s=this.#r.decode(i.inputs,n.slice(4));return new Ow(i,i.selector,s,r)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){let n=this.getEvent(e.topics[0]);return!n||n.anonymous?null:new Rw(n,n.topicHash,this.decodeEventLog(n,e.data,e.topics))}parseError(e){let n=Z(e),r=this.getError(_t(n,0,4));if(!r)return null;let i=this.#r.decode(r.inputs,_t(n,4));return new Pw(r,r.selector,i)}static from(e){return e instanceof t?e:typeof e=="string"?new t(JSON.parse(e)):typeof e.formatJson=="function"?new t(e.formatJson()):typeof e.format=="function"?new t(e.format("json")):new t(e)}};var eF=BigInt(0);function sd(t){return t??null}function Zt(t){return t==null?null:t.toString()}var od=class{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(e,n,r){ce(this,{gasPrice:sd(e),maxFeePerGas:sd(n),maxPriorityFeePerGas:sd(r)})}toJSON(){let{gasPrice:e,maxFeePerGas:n,maxPriorityFeePerGas:r}=this;return{_type:"FeeData",gasPrice:Zt(e),maxFeePerGas:Zt(n),maxPriorityFeePerGas:Zt(r)}}};function Ea(t){let e={};t.to&&(e.to=t.to),t.from&&(e.from=t.from),t.data&&(e.data=Z(t.data));let n="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(let i of n)!(i in t)||t[i]==null||(e[i]=te(t[i],`request.${i}`));let r="type,nonce".split(/,/);for(let i of r)!(i in t)||t[i]==null||(e[i]=ve(t[i],`request.${i}`));return t.accessList&&(e.accessList=Jr(t.accessList)),t.authorizationList&&(e.authorizationList=t.authorizationList.slice()),"blockTag"in t&&(e.blockTag=t.blockTag),"enableCcipRead"in t&&(e.enableCcipRead=!!t.enableCcipRead),"customData"in t&&(e.customData=t.customData),"blobVersionedHashes"in t&&t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes.slice()),"kzg"in t&&(e.kzg=t.kzg),"blobs"in t&&t.blobs&&(e.blobs=t.blobs.map(i=>ra(i)?Z(i):Object.assign({},i))),e}var Qf=class{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;prevRandao;extraData;baseFeePerGas;#e;constructor(e,n){this.#e=e.transactions.map(r=>typeof r!="string"?new ba(r,n):r),ce(this,{provider:n,hash:sd(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:sd(e.prevRandao),extraData:e.extraData,baseFeePerGas:sd(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return this.#e.map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){let e=this.#e.slice();return e.length===0?[]:(G(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){let{baseFeePerGas:e,difficulty:n,extraData:r,gasLimit:i,gasUsed:s,hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:d,parentBeaconBlockRoot:h,stateRoot:f,receiptsRoot:p,timestamp:g,transactions:m}=this;return{_type:"Block",baseFeePerGas:Zt(e),difficulty:Zt(n),extraData:r,gasLimit:Zt(i),gasUsed:Zt(s),blobGasUsed:Zt(this.blobGasUsed),excessBlobGas:Zt(this.excessBlobGas),hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:d,timestamp:g,parentBeaconBlockRoot:h,stateRoot:f,receiptsRoot:p,transactions:m}}[Symbol.iterator](){let e=0,n=this.transactions;return{next:()=>e<this.length?{value:n[e++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#e.length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let n;if(typeof e=="number")n=this.#e[e];else{let r=e.toLowerCase();for(let i of this.#e)if(typeof i=="string"){if(i!==r)continue;n=i;break}else{if(i.hash!==r)continue;n=i;break}}if(n==null)throw new Error("no such tx");return typeof n=="string"?await this.provider.getTransaction(n):n}getPrefetchedTransaction(e){let n=this.prefetchedTransactions;if(typeof e=="number")return n[e];e=e.toLowerCase();for(let r of n)if(r.hash===e)return r;D(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return jJ(this)}},is=class{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(e,n){this.provider=n;let r=Object.freeze(e.topics.slice());ce(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:r,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){let{address:e,blockHash:n,blockNumber:r,data:i,index:s,removed:o,topics:a,transactionHash:c,transactionIndex:l}=this;return{_type:"log",address:e,blockHash:n,blockNumber:r,data:i,index:s,removed:o,topics:a,transactionHash:c,transactionIndex:l}}async getBlock(){let e=await this.provider.getBlock(this.blockHash);return G(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){let e=await this.provider.getTransaction(this.transactionHash);return G(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){let e=await this.provider.getTransactionReceipt(this.transactionHash);return G(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return VJ(this)}},ll=class{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#e;constructor(e,n){this.#e=Object.freeze(e.logs.map(i=>new is(i,n)));let r=eF;e.effectiveGasPrice!=null?r=e.effectiveGasPrice:e.gasPrice!=null&&(r=e.gasPrice),ce(this,{provider:n,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:r,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return this.#e}toJSON(){let{to:e,from:n,contractAddress:r,hash:i,index:s,blockHash:o,blockNumber:a,logsBloom:c,logs:l,status:u,root:d}=this;return{_type:"TransactionReceipt",blockHash:o,blockNumber:a,contractAddress:r,cumulativeGasUsed:Zt(this.cumulativeGasUsed),from:n,gasPrice:Zt(this.gasPrice),blobGasUsed:Zt(this.blobGasUsed),blobGasPrice:Zt(this.blobGasPrice),gasUsed:Zt(this.gasUsed),hash:i,index:s,logs:l,logsBloom:c,root:d,status:u,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){let e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){let e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return nF(this)}reorderedEvent(e){return G(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),tF(this,e)}},ba=class t{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;authorizationList;#e;constructor(e,n){this.provider=n,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,this.authorizationList=e.authorizationList!=null?e.authorizationList:null,this.#e=-1}toJSON(){let{blockNumber:e,blockHash:n,index:r,hash:i,type:s,to:o,from:a,nonce:c,data:l,signature:u,accessList:d,blobVersionedHashes:h}=this;return{_type:"TransactionResponse",accessList:d,blockNumber:e,blockHash:n,blobVersionedHashes:h,chainId:Zt(this.chainId),data:l,from:a,gasLimit:Zt(this.gasLimit),gasPrice:Zt(this.gasPrice),hash:i,maxFeePerGas:Zt(this.maxFeePerGas),maxPriorityFeePerGas:Zt(this.maxPriorityFeePerGas),maxFeePerBlobGas:Zt(this.maxFeePerBlobGas),nonce:c,signature:u,to:o,index:r,type:s,value:Zt(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){let r=await this.getTransaction();r&&(e=r.blockNumber)}if(e==null)return null;let n=this.provider.getBlock(e);if(n==null)throw new Error("TODO");return n}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){let{tx:n,blockNumber:r}=await Gt({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return n==null||n.blockNumber==null?0:r-n.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,n){let r=e??1,i=n??0,s=this.#e,o=-1,a=s===-1,c=async()=>{if(a)return null;let{blockNumber:h,nonce:f}=await Gt({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(f<this.nonce){s=h;return}if(a)return null;let p=await this.getTransaction();if(!(p&&p.blockNumber!=null))for(o===-1&&(o=s-3,o<this.#e&&(o=this.#e));o<=h;){if(a)return null;let g=await this.provider.getBlock(o,!0);if(g==null)return;for(let m of g)if(m===this.hash)return;for(let m=0;m<g.length;m++){let y=await g.getTransaction(m);if(y.from===this.from&&y.nonce===this.nonce){if(a)return null;let E=await this.provider.getTransactionReceipt(y.hash);if(E==null||h-E.blockNumber+1<r)return;let I="replaced";y.data===this.data&&y.to===this.to&&y.value===this.value?I="repriced":y.data==="0x"&&y.from===y.to&&y.value===eF&&(I="cancelled"),G(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:I==="replaced"||I==="cancelled",reason:I,replacement:y.replaceableTransaction(s),hash:y.hash,receipt:E})}}o++}},l=h=>{if(h==null||h.status!==0)return h;G(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:h.to,from:h.from,data:""},receipt:h})},u=await this.provider.getTransactionReceipt(this.hash);if(r===0)return l(u);if(u){if(r===1||await u.confirmations()>=r)return l(u)}else if(await c(),r===0)return null;return await new Promise((h,f)=>{let p=[],g=()=>{p.forEach(y=>y())};if(p.push(()=>{a=!0}),i>0){let y=setTimeout(()=>{g(),f(Je("wait for transaction timeout","TIMEOUT"))},i);p.push(()=>{clearTimeout(y)})}let m=async y=>{if(await y.confirmations()>=r){g();try{h(l(y))}catch(E){f(E)}}};if(p.push(()=>{this.provider.off(this.hash,m)}),this.provider.on(this.hash,m),s>=0){let y=async()=>{try{await c()}catch(E){if(Mt(E,"TRANSACTION_REPLACED")){g(),f(E);return}}a||this.provider.once("block",y)};p.push(()=>{this.provider.off("block",y)}),this.provider.once("block",y)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return G(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),nF(this)}reorderedEvent(e){return G(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),G(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),tF(this,e)}replaceableTransaction(e){D(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);let n=new t(this,this.provider);return n.#e=e,n}};function jJ(t){return{orphan:"drop-block",hash:t.hash,number:t.number}}function tF(t,e){return{orphan:"reorder-transaction",tx:t,other:e}}function nF(t){return{orphan:"drop-transaction",tx:t}}function VJ(t){return{orphan:"drop-log",log:{transactionHash:t.transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,address:t.address,data:t.data,topics:Object.freeze(t.topics.slice()),index:t.index}}}var ul=class extends is{interface;fragment;args;constructor(e,n,r){super(e,e.provider);let i=n.decodeEventLog(r,e.data,e.topics);ce(this,{args:i,fragment:r,interface:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}},ad=class extends is{error;constructor(e,n){super(e,e.provider),ce(this,{error:n})}},Mw=class extends ll{#e;constructor(e,n,r){super(r,n),this.#e=e}get logs(){return super.logs.map(e=>{let n=e.topics.length?this.#e.getEvent(e.topics[0]):null;if(n)try{return new ul(e,this.#e,n)}catch(r){return new ad(e,r)}return e})}},dl=class extends ba{#e;constructor(e,n,r){super(r,n),this.#e=e}async wait(e,n){let r=await super.wait(e,n);return r==null?null:new Mw(this.#e,this.provider,r)}},cd=class extends sa{log;constructor(e,n,r,i){super(e,n,r),ce(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}},Yf=class extends cd{constructor(e,n,r,i,s){super(e,n,r,new ul(s,e.interface,i));let o=e.interface.decodeEventLog(i,this.log.data,this.log.topics);ce(this,{args:o,fragment:i})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}};var rF=BigInt(0);function sF(t){return t&&typeof t.call=="function"}function oF(t){return t&&typeof t.estimateGas=="function"}function Fw(t){return t&&typeof t.resolveName=="function"}function aF(t){return t&&typeof t.sendTransaction=="function"}function cF(t){if(t!=null){if(Fw(t))return t;if(t.provider)return t.provider}}var qA=class{#e;fragment;constructor(e,n,r){if(ce(this,{fragment:n}),n.inputs.length<r.length)throw new Error("too many arguments");let i=fl(e.runner,"resolveName"),s=Fw(i)?i:null;this.#e=(async function(){let o=await Promise.all(n.inputs.map((a,c)=>r[c]==null?null:a.walkAsync(r[c],(u,d)=>u==="address"?Array.isArray(d)?Promise.all(d.map(h=>tn(h,s))):tn(d,s):d)));return e.interface.encodeFilterTopics(n,o)})()}getTopicFilter(){return this.#e}};function fl(t,e){return t==null?null:typeof t[e]=="function"?t:t.provider&&typeof t.provider[e]=="function"?t.provider:null}function hl(t){return t==null?null:t.provider||null}async function lF(t,e){let n=kt.dereference(t,"overrides");D(typeof n=="object","invalid overrides parameter","overrides",t);let r=Ea(n);return D(r.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",r.to),D(r.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",r.data),r.from&&(r.from=r.from),r}async function HJ(t,e,n){let r=fl(t,"resolveName"),i=Fw(r)?r:null;return await Promise.all(e.map((s,o)=>s.walkAsync(n[o],(a,c)=>(c=kt.dereference(c,a),a==="address"?tn(c,i):c))))}function $J(t){let e=async function(o){let a=await lF(o,["data"]);a.to=await t.getAddress(),a.from&&(a.from=await tn(a.from,cF(t.runner)));let c=t.interface,l=te(a.value||rF,"overrides.value")===rF,u=(a.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!u&&!l&&D(!1,"cannot send data to receive or send value to non-payable fallback","overrides",o),D(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data);let d=c.receive||c.fallback&&c.fallback.payable;return D(d||l,"cannot send value to non-payable fallback","overrides.value",a.value),D(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data),a},n=async function(o){let a=fl(t.runner,"call");G(sF(a),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});let c=await e(o);try{return await a.call(c)}catch(l){throw zc(l)&&l.data?t.interface.makeError(l.data,c):l}},r=async function(o){let a=t.runner;G(aF(a),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});let c=await a.sendTransaction(await e(o)),l=hl(t.runner);return new dl(t.interface,l,c)},i=async function(o){let a=fl(t.runner,"estimateGas");return G(oF(a),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await a.estimateGas(await e(o))},s=async o=>await r(o);return ce(s,{_contract:t,estimateGas:i,populateTransaction:e,send:r,staticCall:n}),s}function qJ(t,e){let n=function(...l){let u=t.interface.getFunction(e,l);return G(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:l}}),u},r=async function(...l){let u=n(...l),d={};if(u.inputs.length+1===l.length&&(d=await lF(l.pop()),d.from&&(d.from=await tn(d.from,cF(t.runner)))),u.inputs.length!==l.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");let h=await HJ(t.runner,u.inputs,l);return Object.assign({},d,await Gt({to:t.getAddress(),data:t.interface.encodeFunctionData(u,h)}))},i=async function(...l){let u=await a(...l);return u.length===1?u[0]:u},s=async function(...l){let u=t.runner;G(aF(u),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});let d=await u.sendTransaction(await r(...l)),h=hl(t.runner);return new dl(t.interface,h,d)},o=async function(...l){let u=fl(t.runner,"estimateGas");return G(oF(u),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await u.estimateGas(await r(...l))},a=async function(...l){let u=fl(t.runner,"call");G(sF(u),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});let d=await r(...l),h="0x";try{h=await u.call(d)}catch(p){throw zc(p)&&p.data?t.interface.makeError(p.data,d):p}let f=n(...l);return t.interface.decodeFunctionResult(f,h)},c=async(...l)=>n(...l).constant?await i(...l):await s(...l);return ce(c,{name:t.interface.getFunctionName(e),_contract:t,_key:e,getFragment:n,estimateGas:o,populateTransaction:r,send:s,staticCall:i,staticCallResult:a}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{let l=t.interface.getFunction(e);return G(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),l}}),c}function zJ(t,e){let n=function(...i){let s=t.interface.getEvent(e,i);return G(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:i}}),s},r=function(...i){return new qA(t,n(...i),i)};return ce(r,{name:t.interface.getEventName(e),_contract:t,_key:e,getFragment:n}),Object.defineProperty(r,"fragment",{configurable:!1,enumerable:!0,get:()=>{let i=t.interface.getEvent(e);return G(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),i}}),r}var Lw=Symbol.for("_ethersInternal_contract"),uF=new WeakMap;function GJ(t,e){uF.set(t[Lw],e)}function Zr(t){return uF.get(t[Lw])}function KJ(t){return t&&typeof t=="object"&&"getTopicFilter"in t&&typeof t.getTopicFilter=="function"&&t.fragment}async function KA(t,e){let n,r=null;if(Array.isArray(e)){let s=function(o){if(Ue(o,32))return o;let a=t.interface.getEvent(o);return D(a,"unknown fragment","name",o),a.topicHash};n=e.map(o=>o==null?null:Array.isArray(o)?o.map(s):s(o))}else e==="*"?n=[null]:typeof e=="string"?Ue(e,32)?n=[e]:(r=t.interface.getEvent(e),D(r,"unknown fragment","event",e),n=[r.topicHash]):KJ(e)?n=await e.getTopicFilter():"fragment"in e?(r=e.fragment,n=[r.topicHash]):D(!1,"unknown event name","event",e);n=n.map(s=>{if(s==null)return null;if(Array.isArray(s)){let o=Array.from(new Set(s.map(a=>a.toLowerCase())).values());return o.length===1?o[0]:(o.sort(),o)}return s.toLowerCase()});let i=n.map(s=>s==null?"null":Array.isArray(s)?s.join("|"):s).join("&");return{fragment:r,tag:i,topics:n}}async function Jf(t,e){let{subs:n}=Zr(t);return n.get((await KA(t,e)).tag)||null}async function iF(t,e,n){let r=hl(t.runner);G(r,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});let{fragment:i,tag:s,topics:o}=await KA(t,n),{addr:a,subs:c}=Zr(t),l=c.get(s);if(!l){let d={address:a||t,topics:o},h=m=>{let y=i;if(y==null)try{y=t.interface.getEvent(m.topics[0])}catch{}if(y){let E=y,I=i?t.interface.decodeEventLog(i,m.data,m.topics):[];GA(t,n,I,L=>new Yf(t,L,n,E,m))}else GA(t,n,[],E=>new cd(t,E,n,m))},f=[];l={tag:s,listeners:[],start:()=>{f.length||f.push(r.on(d,h))},stop:async()=>{if(f.length==0)return;let m=f;f=[],await Promise.all(m),r.off(d,h)}},c.set(s,l)}return l}var zA=Promise.resolve();async function WJ(t,e,n,r){await zA;let i=await Jf(t,e);if(!i)return!1;let s=i.listeners.length;return i.listeners=i.listeners.filter(({listener:o,once:a})=>{let c=Array.from(n);r&&c.push(r(a?null:o));try{o.call(t,...c)}catch{}return!a}),i.listeners.length===0&&(i.stop(),Zr(t).subs.delete(i.tag)),s>0}async function GA(t,e,n,r){try{await zA}catch{}let i=WJ(t,e,n,r);return zA=i,await i}var kw=["then"],Zf=class t{target;interface;runner;filters;[Lw];fallback;constructor(e,n,r,i){D(typeof e=="string"||cw(e),"invalid value for Contract target","target",e),r==null&&(r=null);let s=Wf.from(n);ce(this,{target:e,runner:r,interface:s}),Object.defineProperty(this,Lw,{value:{}});let o,a=null,c=null;if(i){let d=hl(r);c=new dl(this.interface,d,i)}let l=new Map;if(typeof e=="string")if(Ue(e))a=e,o=Promise.resolve(e);else{let d=fl(r,"resolveName");if(!Fw(d))throw Je("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});o=d.resolveName(e).then(h=>{if(h==null)throw Je("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return Zr(this).addr=h,h})}else o=e.getAddress().then(d=>{if(d==null)throw new Error("TODO");return Zr(this).addr=d,d});GJ(this,{addrPromise:o,addr:a,deployTx:c,subs:l});let u=new Proxy({},{get:(d,h,f)=>{if(typeof h=="symbol"||kw.indexOf(h)>=0)return Reflect.get(d,h,f);try{return this.getEvent(h)}catch(p){if(!Mt(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(d,h)=>kw.indexOf(h)>=0?Reflect.has(d,h):Reflect.has(d,h)||this.interface.hasEvent(String(h))});return ce(this,{filters:u}),ce(this,{fallback:s.receive||s.fallback?$J(this):null}),new Proxy(this,{get:(d,h,f)=>{if(typeof h=="symbol"||h in d||kw.indexOf(h)>=0)return Reflect.get(d,h,f);try{return d.getFunction(h)}catch(p){if(!Mt(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(d,h)=>typeof h=="symbol"||h in d||kw.indexOf(h)>=0?Reflect.has(d,h):d.interface.hasFunction(h)})}connect(e){return new t(this.target,this.interface,e)}attach(e){return new t(e,this.interface,this.runner)}async getAddress(){return await Zr(this).addrPromise}async getDeployedCode(){let e=hl(this.runner);G(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});let n=await e.getCode(await this.getAddress());return n==="0x"?null:n}async waitForDeployment(){let e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;let r=hl(this.runner);return G(r!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((i,s)=>{let o=async()=>{try{if(await this.getDeployedCode()!=null)return i(this);r.once("block",o)}catch(a){s(a)}};o()})}deploymentTransaction(){return Zr(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),qJ(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),zJ(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,n,r){n==null&&(n=0),r==null&&(r="latest");let{addr:i,addrPromise:s}=Zr(this),o=i||await s,{fragment:a,topics:c}=await KA(this,e),l={address:o,topics:c,fromBlock:n,toBlock:r},u=hl(this.runner);return G(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(l)).map(d=>{let h=a;if(h==null)try{h=this.interface.getEvent(d.topics[0])}catch{}if(h)try{return new ul(d,this.interface,h)}catch(f){return new ad(d,f)}return new is(d,u)})}async on(e,n){let r=await iF(this,"on",e);return r.listeners.push({listener:n,once:!1}),r.start(),this}async once(e,n){let r=await iF(this,"once",e);return r.listeners.push({listener:n,once:!0}),r.start(),this}async emit(e,...n){return await GA(this,e,n,null)}async listenerCount(e){if(e){let i=await Jf(this,e);return i?i.listeners.length:0}let{subs:n}=Zr(this),r=0;for(let{listeners:i}of n.values())r+=i.length;return r}async listeners(e){if(e){let i=await Jf(this,e);return i?i.listeners.map(({listener:s})=>s):[]}let{subs:n}=Zr(this),r=[];for(let{listeners:i}of n.values())r=r.concat(i.map(({listener:s})=>s));return r}async off(e,n){let r=await Jf(this,e);if(!r)return this;if(n){let i=r.listeners.map(({listener:s})=>s).indexOf(n);i>=0&&r.listeners.splice(i,1)}return(n==null||r.listeners.length===0)&&(r.stop(),Zr(this).subs.delete(r.tag)),this}async removeAllListeners(e){if(e){let n=await Jf(this,e);if(!n)return this;n.stop(),Zr(this).subs.delete(n.tag)}else{let{subs:n}=Zr(this);for(let{tag:r,stop:i}of n.values())i(),n.delete(r)}return this}async addListener(e,n){return await this.on(e,n)}async removeListener(e,n){return await this.off(e,n)}static buildClass(e){class n extends t{constructor(i,s=null){super(i,e,s)}}return n}static from(e,n,r){return r==null&&(r=null),new this(e,n,r)}};function QJ(){return Zf}var dn=class extends QJ(){};function WA(t){return t.match(/^ipfs:\/\/ipfs\//i)?t=t.substring(12):t.match(/^ipfs:\/\//i)?t=t.substring(7):D(!1,"unsupported IPFS format","link",t),`https://gateway.ipfs.io/ipfs/${t}`}var Bw=class{name;constructor(e){ce(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,n){throw new Error("unsupported coin")}async decodeAddress(e,n){throw new Error("unsupported coin")}};var hF=new RegExp("^(ipfs)://(.*)$","i"),dF=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),hF,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")],ld=class t{provider;address;name;#e;#t;constructor(e,n,r){ce(this,{provider:e,address:n,name:r}),this.#e=null,this.#t=new dn(n,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e)}async supportsWildcard(){return this.#e==null&&(this.#e=(async()=>{try{return await this.#t.supportsInterface("0x9061b923")}catch(e){if(Mt(e,"CALL_EXCEPTION"))return!1;throw this.#e=null,e}})()),await this.#e}async#n(e,n){n=(n||[]).slice();let r=this.#t.interface;n.unshift(nd(this.name));let i=null;await this.supportsWildcard()&&(i=r.getFunction(e),G(i,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),n=[jA(this.name,255),r.encodeFunctionData(i,n)],e="resolve(bytes,bytes)"),n.push({enableCcipRead:!0});try{let s=await this.#t[e](...n);return i?r.decodeFunctionResult(i,s)[0]:s}catch(s){if(!Mt(s,"CALL_EXCEPTION"))throw s}return null}async getAddress(e){if(e==null&&(e=60),e===60)try{let s=await this.#n("addr(bytes32)");return s==null||s===yo?null:s}catch(s){if(Mt(s,"CALL_EXCEPTION"))return null;throw s}if(e>=0&&e<2147483648){let s=e+2147483648,o=await this.#n("addr(bytes32,uint)",[s]);if(Ue(o,20))return Re(o)}let n=null;for(let s of this.provider.plugins)if(s instanceof Bw&&s.supportsCoinType(e)){n=s;break}if(n==null)return null;let r=await this.#n("addr(bytes32,uint)",[e]);if(r==null||r==="0x")return null;let i=await n.decodeAddress(e,r);if(i!=null)return i;G(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:r}})}async getText(e){let n=await this.#n("text(bytes32,string)",[e]);return n==null||n==="0x"?null:n}async getContentHash(){let e=await this.#n("contenthash(bytes32)");if(e==null||e==="0x")return null;let n=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(n){let i=n[1]==="e3010170"?"ipfs":"ipns",s=parseInt(n[4],16);if(n[5].length===s*2)return`${i}://${jy("0x"+n[2])}`}let r=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&r[1].length===64)return`bzz://${r[1]}`;G(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){let e=[{type:"name",value:this.name}];try{let n=await this.getText("avatar");if(n==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:n});for(let r=0;r<dF.length;r++){let i=n.match(dF[r]);if(i==null)continue;let s=i[1].toLowerCase();switch(s){case"https":case"data":return e.push({type:"url",value:n}),{linkage:e,url:n};case"ipfs":{let o=WA(n);return e.push({type:"ipfs",value:n}),e.push({type:"url",value:o}),{linkage:e,url:o}}case"erc721":case"erc1155":{let o=s==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:s,value:n});let a=await this.getAddress();if(a==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};let c=(i[2]||"").split("/");if(c.length!==2)return e.push({type:`!${s}caip`,value:i[2]||""}),{url:null,linkage:e};let l=c[1],u=new dn(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(s==="erc721"){let g=await u.ownerOf(l);if(a!==g)return e.push({type:"!owner",value:g}),{url:null,linkage:e};e.push({type:"owner",value:g})}else if(s==="erc1155"){let g=await u.balanceOf(a,l);if(!g)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:g.toString()})}let d=await u[o](l);if(d==null||d==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:d}),s==="erc1155"&&(d=d.replace("{id}",fr(l,32).substring(2)),e.push({type:"metadata-url-expanded",value:d})),d.match(/^ipfs:/i)&&(d=WA(d)),e.push({type:"metadata-url",value:d});let h={},f=await new Or(d).send();f.assertOk();try{h=f.bodyJson}catch{try{e.push({type:"!metadata",value:f.bodyText})}catch{let y=f.body;return y&&e.push({type:"!metadata",value:Z(y)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!h)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(h)});let p=h.image;if(typeof p!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!p.match(/^(https:\/\/|data:)/i)){if(p.match(hF)==null)return e.push({type:"!imageUrl-ipfs",value:p}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:p}),p=WA(p)}return e.push({type:"url",value:p}),{linkage:e,url:p}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){let n=await e.getNetwork(),r=n.getPlugin("org.ethers.plugins.network.Ens");return G(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:n}}),r.address}static async#r(e,n){let r=await t.getEnsAddress(e);try{let s=await new dn(r,["function resolver(bytes32) view returns (address)"],e).resolver(nd(n),{enableCcipRead:!0});return s===yo?null:s}catch(i){throw i}return null}static async fromName(e,n){let r=n;for(;;){if(r===""||r==="."||n!=="eth"&&r==="eth")return null;let i=await t.#r(e,r);if(i!=null){let s=new t(e,i,n);return r!==n&&!await s.supportsWildcard()?null:s}r=r.split(".").slice(1).join(".")}}};var fF=BigInt(0);function ze(t,e){return function(n){return n==null?e:t(n)}}function Xf(t,e){return n=>{if(e&&n==null)return null;if(!Array.isArray(n))throw new Error("not an array");return n.map(r=>t(r))}}function ep(t,e){return n=>{let r={};for(let i in t){let s=i;if(e&&i in e&&!(s in n)){for(let o of e[i])if(o in n){s=o;break}}try{let o=t[i](n[s]);o!==void 0&&(r[i]=o)}catch(o){let a=o instanceof Error?o.message:"not-an-error";G(!1,`invalid value for value.${i} (${a})`,"BAD_DATA",{value:n})}}return r}}function YJ(t){switch(t){case!0:case"true":return!0;case!1:case"false":return!1}D(!1,`invalid boolean; ${JSON.stringify(t)}`,"value",t)}function ud(t){return D(Ue(t,!0),"invalid data","value",t),t}function Rn(t){return D(Ue(t,32),"invalid hash","value",t),t}var JJ=ep({address:Re,blockHash:Rn,blockNumber:ve,data:ud,index:ve,removed:ze(YJ,!1),topics:Xf(Rn),transactionHash:Rn,transactionIndex:ve},{index:["logIndex"]});function pF(t){return JJ(t)}var ZJ=ep({hash:ze(Rn),parentHash:Rn,parentBeaconBlockRoot:ze(Rn,null),number:ve,timestamp:ve,nonce:ze(ud),difficulty:te,gasLimit:te,gasUsed:te,stateRoot:ze(Rn,null),receiptsRoot:ze(Rn,null),blobGasUsed:ze(te,null),excessBlobGas:ze(te,null),miner:ze(Re),prevRandao:ze(Rn,null),extraData:ud,baseFeePerGas:ze(te)},{prevRandao:["mixHash"]});function gF(t){let e=ZJ(t);return e.transactions=t.transactions.map(n=>typeof n=="string"?n:QA(n)),e}var XJ=ep({transactionIndex:ve,blockNumber:ve,transactionHash:Rn,address:Re,topics:Xf(Rn),data:ud,index:ve,blockHash:Rn},{index:["logIndex"]});function eZ(t){return XJ(t)}var tZ=ep({to:ze(Re,null),from:ze(Re,null),contractAddress:ze(Re,null),index:ve,root:ze(Z),gasUsed:te,blobGasUsed:ze(te,null),logsBloom:ze(ud),blockHash:Rn,hash:Rn,logs:Xf(eZ),blockNumber:ve,cumulativeGasUsed:te,effectiveGasPrice:ze(te),blobGasPrice:ze(te,null),status:ze(ve),type:ze(ve,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function mF(t){return tZ(t)}function QA(t){t.to&&te(t.to)===fF&&(t.to="0x0000000000000000000000000000000000000000");let e=ep({hash:Rn,index:ze(ve,void 0),type:n=>n==="0x"||n==null?0:ve(n),accessList:ze(Jr,null),blobVersionedHashes:ze(Xf(Rn,!0),null),authorizationList:ze(Xf(n=>{let r;if(n.signature)r=n.signature;else{let i=n.yParity;i==="0x1b"?i=0:i==="0x1c"&&(i=1),r=Object.assign({},n,{yParity:i})}return{address:Re(n.address),chainId:te(n.chainId),nonce:te(n.nonce),signature:ln.from(r)}},!1),null),blockHash:ze(Rn,null),blockNumber:ze(ve,null),transactionIndex:ze(ve,null),from:Re,gasPrice:ze(te),maxPriorityFeePerGas:ze(te),maxFeePerGas:ze(te),maxFeePerBlobGas:ze(te,null),gasLimit:te,to:ze(Re,null),value:te,nonce:ve,data:ud,creates:ze(Re,null),chainId:ze(te,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(t);if(e.to==null&&e.creates==null&&(e.creates=AA(e)),(t.type===1||t.type===2)&&t.accessList==null&&(e.accessList=[]),t.signature?e.signature=ln.from(t.signature):e.signature=ln.from(t),e.chainId==null){let n=e.signature.legacyChainId;n!=null&&(e.chainId=n)}return e.blockHash&&te(e.blockHash)===fF&&(e.blockHash=null),e}var nZ="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",dd=class t{name;constructor(e){ce(this,{name:e})}clone(){return new t(this.name)}},hd=class t extends dd{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(e,n){e==null&&(e=0),super(`org.ethers.network.plugins.GasCost#${e||0}`);let r={effectiveBlock:e};function i(s,o){let a=(n||{})[s];a==null&&(a=o),D(typeof a=="number",`invalud value for ${s}`,"costs",n),r[s]=a}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),ce(this,r)}clone(){return new t(this.effectiveBlock,this)}},fd=class t extends dd{address;targetNetwork;constructor(e,n){super("org.ethers.plugins.network.Ens"),ce(this,{address:e||nZ,targetNetwork:n??1})}clone(){return new t(this.address,this.targetNetwork)}};var tp=class extends dd{#e;#t;get url(){return this.#e}get processFunc(){return this.#t}constructor(e,n){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#e=e,this.#t=n}clone(){return this}};var YA=new Map,Xr=class t{#e;#t;#n;constructor(e,n){this.#e=e,this.#t=te(n),this.#n=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#e}set name(e){this.#e=e}get chainId(){return this.#t}set chainId(e){this.#t=te(e,"chainId")}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===te(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===te(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===te(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(this.#n.values())}attachPlugin(e){if(this.#n.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#n.set(e.name,e.clone()),this}getPlugin(e){return this.#n.get(e)||null}getPlugins(e){return this.plugins.filter(n=>n.name.split("#")[0]===e)}clone(){let e=new t(this.name,this.chainId);return this.plugins.forEach(n=>{e.attachPlugin(n.clone())}),e}computeIntrinsicGas(e){let n=this.getPlugin("org.ethers.plugins.network.GasCost")||new hd,r=n.txBase;if(e.to==null&&(r+=n.txCreate),e.data)for(let i=2;i<e.data.length;i+=2)e.data.substring(i,i+2)==="00"?r+=n.txDataZero:r+=n.txDataNonzero;if(e.accessList){let i=Jr(e.accessList);for(let s in i)r+=n.txAccessListAddress+n.txAccessListStorageKey*i[s].storageKeys.length}return r}static from(e){if(rZ(),e==null)return t.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){let n=YA.get(e);if(n)return n();if(typeof e=="bigint")return new t("unknown",e);D(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){D(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);let n=new t(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&n.attachPlugin(new fd(e.ensAddress,e.ensNetwork)),n}D(!1,"invalid network","network",e)}static register(e,n){typeof e=="number"&&(e=BigInt(e));let r=YA.get(e);r&&D(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",e),YA.set(e,n)}};function yF(t,e){let n=String(t);if(!n.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${t}`);let r=n.split(".");if(r.length===1&&r.push(""),r.length!==2)throw new Error(`invalid gwei value: ${t}`);for(;r[1].length<e;)r[1]+="0";if(r[1].length>9){let i=BigInt(r[1].substring(0,9));r[1].substring(9).match(/^0+$/)||i++,r[1]=i.toString()}return BigInt(r[0]+r[1])}function wF(t){return new tp(t,async(e,n,r)=>{r.setHeader("User-Agent","ethers");let i;try{let[s,o]=await Promise.all([r.send(),e()]);i=s;let a=i.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:yF(a.maxFee,9),maxPriorityFeePerGas:yF(a.maxPriorityFee,9)}}catch(s){G(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:i,error:s})}})}var vF=!1;function rZ(){if(vF)return;vF=!0;function t(e,n,r){let i=function(){let s=new Xr(e,n);return r.ensNetwork!=null&&s.attachPlugin(new fd(null,r.ensNetwork)),s.attachPlugin(new hd),(r.plugins||[]).forEach(o=>{s.attachPlugin(o)}),s};Xr.register(e,i),Xr.register(n,i),r.altNames&&r.altNames.forEach(s=>{Xr.register(s,i)})}t("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),t("ropsten",3,{ensNetwork:3}),t("rinkeby",4,{ensNetwork:4}),t("goerli",5,{ensNetwork:5}),t("kovan",42,{ensNetwork:42}),t("sepolia",11155111,{ensNetwork:11155111}),t("holesky",17e3,{ensNetwork:17e3}),t("classic",61,{}),t("classicKotti",6,{}),t("arbitrum",42161,{ensNetwork:1}),t("arbitrum-goerli",421613,{}),t("arbitrum-sepolia",421614,{}),t("base",8453,{ensNetwork:1}),t("base-goerli",84531,{}),t("base-sepolia",84532,{}),t("bnb",56,{ensNetwork:1}),t("bnbt",97,{}),t("linea",59144,{ensNetwork:1}),t("linea-goerli",59140,{}),t("linea-sepolia",59141,{}),t("matic",137,{ensNetwork:1,plugins:[wF("https://gasstation.polygon.technology/v2")]}),t("matic-amoy",80002,{}),t("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[wF("https://gasstation-testnet.polygon.technology/v2")]}),t("optimism",10,{ensNetwork:1,plugins:[]}),t("optimism-goerli",420,{}),t("optimism-sepolia",11155420,{}),t("xdai",100,{ensNetwork:1})}function JA(t){return JSON.parse(JSON.stringify(t))}var Uw=class{#e;#t;#n;#r;constructor(e){this.#e=e,this.#t=null,this.#n=4e3,this.#r=-2}get pollingInterval(){return this.#n}set pollingInterval(e){this.#n=e}async#i(){try{let e=await this.#e.getBlockNumber();if(this.#r===-2){this.#r=e;return}if(e!==this.#r){for(let n=this.#r+1;n<=e;n++){if(this.#t==null)return;await this.#e.emit("block",n)}this.#r=e}}catch{}this.#t!=null&&(this.#t=this.#e._setTimeout(this.#i.bind(this),this.#n))}start(){this.#t||(this.#t=this.#e._setTimeout(this.#i.bind(this),this.#n),this.#i())}stop(){this.#t&&(this.#e._clearTimeout(this.#t),this.#t=null)}pause(e){this.stop(),e&&(this.#r=-2)}resume(){this.start()}},np=class{#e;#t;#n;constructor(e){this.#e=e,this.#n=!1,this.#t=n=>{this._poll(n,this.#e)}}async _poll(e,n){throw new Error("sub-classes must override this")}start(){this.#n||(this.#n=!0,this.#t(-2),this.#e.on("block",this.#t))}stop(){this.#n&&(this.#n=!1,this.#e.off("block",this.#t))}pause(e){this.stop()}resume(){this.start()}},jw=class extends np{#e;#t;constructor(e,n){super(e),this.#e=n,this.#t=-2}pause(e){e&&(this.#t=-2),super.pause(e)}async _poll(e,n){let r=await n.getBlock(this.#e);r!=null&&(this.#t===-2?this.#t=r.number:r.number>this.#t&&(n.emit(this.#e,r.number),this.#t=r.number))}},Vw=class extends np{#e;constructor(e,n){super(e),this.#e=JA(n)}async _poll(e,n){throw new Error("@TODO")}},Hw=class extends np{#e;constructor(e,n){super(e),this.#e=n}async _poll(e,n){let r=await n.getTransactionReceipt(this.#e);r&&n.emit(this.#e,r)}},Ia=class{#e;#t;#n;#r;#i;constructor(e,n){this.#e=e,this.#t=JA(n),this.#n=this.#o.bind(this),this.#r=!1,this.#i=-2}async#o(e){if(this.#i===-2)return;let n=JA(this.#t);n.fromBlock=this.#i+1,n.toBlock=e;let r=await this.#e.getLogs(n);if(r.length===0){this.#i<e-60&&(this.#i=e-60);return}for(let i of r)this.#e.emit(this.#t,i),this.#i=i.blockNumber}start(){this.#r||(this.#r=!0,this.#i===-2&&this.#e.getBlockNumber().then(e=>{this.#i=e}),this.#e.on("block",this.#n))}stop(){this.#r&&(this.#r=!1,this.#e.off("block",this.#n))}pause(e){this.stop(),e&&(this.#i=-2)}resume(){this.start()}};var iZ=BigInt(2),sZ=10;function $w(t){return t&&typeof t.then=="function"}function qw(t,e){return t+":"+JSON.stringify(e,(n,r)=>{if(r==null)return"null";if(typeof r=="bigint")return`bigint:${r.toString()}`;if(typeof r=="string")return r.toLowerCase();if(typeof r=="object"&&!Array.isArray(r)){let i=Object.keys(r);return i.sort(),i.reduce((s,o)=>(s[o]=r[o],s),{})}return r})}var pd=class{name;constructor(e){ce(this,{name:e})}start(){}stop(){}pause(e){}resume(){}};function oZ(t){return JSON.parse(JSON.stringify(t))}function eS(t){return t=Array.from(new Set(t).values()),t.sort(),t}async function ZA(t,e){if(t==null)throw new Error("invalid event");if(Array.isArray(t)&&(t={topics:t}),typeof t=="string")switch(t){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:t,tag:t}}if(Ue(t,32)){let n=t.toLowerCase();return{type:"transaction",tag:qw("tx",{hash:n}),hash:n}}if(t.orphan){let n=t;return{type:"orphan",tag:qw("orphan",n),filter:oZ(n)}}if(t.address||t.topics){let n=t,r={topics:(n.topics||[]).map(i=>i==null?null:Array.isArray(i)?eS(i.map(s=>s.toLowerCase())):i.toLowerCase())};if(n.address){let i=[],s=[],o=a=>{Ue(a)?i.push(a):s.push((async()=>{i.push(await tn(a,e))})())};Array.isArray(n.address)?n.address.forEach(o):o(n.address),s.length&&await Promise.all(s),r.address=eS(i.map(a=>a.toLowerCase()))}return{filter:r,tag:qw("event",r),type:"event"}}D(!1,"unknown ProviderEvent","event",t)}function XA(){return new Date().getTime()}var aZ={cacheTimeout:250,pollingInterval:4e3},rp=class{#e;#t;#n;#r;#i;#o;#s;#a;#d;#l;#p;#g;constructor(e,n){if(this.#g=Object.assign({},aZ,n||{}),e==="any")this.#o=!0,this.#i=null;else if(e){let r=Xr.from(e);this.#o=!1,this.#i=Promise.resolve(r),setTimeout(()=>{this.emit("network",r,null)},0)}else this.#o=!1,this.#i=null;this.#a=-1,this.#s=new Map,this.#e=new Map,this.#t=new Map,this.#n=null,this.#r=!1,this.#d=1,this.#l=new Map,this.#p=!1}get pollingInterval(){return this.#g.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#t.values())}attachPlugin(e){if(this.#t.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#t.set(e.name,e.connect(this)),this}getPlugin(e){return this.#t.get(e)||null}get disableCcipRead(){return this.#p}set disableCcipRead(e){this.#p=!!e}async#c(e){let n=this.#g.cacheTimeout;if(n<0)return await this._perform(e);let r=qw(e.method,e),i=this.#s.get(r);return i||(i=this._perform(e),this.#s.set(r,i),setTimeout(()=>{this.#s.get(r)===i&&this.#s.delete(r)},n)),await i}async ccipReadFetch(e,n,r){if(this.disableCcipRead||r.length===0||e.to==null)return null;let i=e.to.toLowerCase(),s=n.toLowerCase(),o=[];for(let a=0;a<r.length;a++){let c=r[a],l=c.replace("{sender}",i).replace("{data}",s),u=new Or(l);c.indexOf("{data}")===-1&&(u.body={data:s,sender:i}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:a,urls:r});let d="unknown error",h;try{h=await u.send()}catch(f){o.push(f.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:f}});continue}try{let f=h.bodyJson;if(f.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:f}),f.data;f.message&&(d=f.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:f})}catch{}G(h.statusCode<400||h.statusCode>=500,`response not found during CCIP fetch: ${d}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:d}}),o.push(d)}G(!1,`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:r,errorMessages:o}})}_wrapBlock(e,n){return new Qf(gF(e),this)}_wrapLog(e,n){return new is(pF(e),this)}_wrapTransactionReceipt(e,n){return new ll(mF(e),this)}_wrapTransactionResponse(e,n){return new ba(QA(e),this)}_detectNetwork(){G(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){G(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){let e=ve(await this.#c({method:"getBlockNumber"}),"%response");return this.#a>=0&&(this.#a=e),e}_getAddress(e){return tn(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if(Ue(e))return Ue(e,32)?e:zn(e);if(typeof e=="bigint"&&(e=ve(e,"blockTag")),typeof e=="number")return e>=0?zn(e):this.#a>=0?zn(this.#a+e):this.getBlockNumber().then(n=>zn(n+e));D(!1,"invalid blockTag","blockTag",e)}_getFilter(e){let n=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?eS(c.map(l=>l.toLowerCase())):c.toLowerCase()),r="blockHash"in e?e.blockHash:void 0,i=(c,l,u)=>{let d;switch(c.length){case 0:break;case 1:d=c[0];break;default:c.sort(),d=c}if(r&&(l!=null||u!=null))throw new Error("invalid filter");let h={};return d&&(h.address=d),n.length&&(h.topics=n),l&&(h.fromBlock=l),u&&(h.toBlock=u),r&&(h.blockHash=r),h},s=[];if(e.address)if(Array.isArray(e.address))for(let c of e.address)s.push(this._getAddress(c));else s.push(this._getAddress(e.address));let o;"fromBlock"in e&&(o=this._getBlockTag(e.fromBlock));let a;return"toBlock"in e&&(a=this._getBlockTag(e.toBlock)),s.filter(c=>typeof c!="string").length||o!=null&&typeof o!="string"||a!=null&&typeof a!="string"?Promise.all([Promise.all(s),o,a]).then(c=>i(c[0],c[1],c[2])):i(s,o,a)}_getTransactionRequest(e){let n=Ea(e),r=[];if(["to","from"].forEach(i=>{if(n[i]==null)return;let s=tn(n[i],this);$w(s)?r.push((async function(){n[i]=await s})()):n[i]=s}),n.blockTag!=null){let i=this._getBlockTag(n.blockTag);$w(i)?r.push((async function(){n.blockTag=await i})()):n.blockTag=i}return r.length?(async function(){return await Promise.all(r),n})():n}async getNetwork(){if(this.#i==null){let i=(async()=>{try{let s=await this._detectNetwork();return this.emit("network",s,null),s}catch(s){throw this.#i===i&&(this.#i=null),s}})();return this.#i=i,(await i).clone()}let e=this.#i,[n,r]=await Promise.all([e,this._detectNetwork()]);return n.chainId!==r.chainId&&(this.#o?(this.emit("network",r,n),this.#i===e&&(this.#i=Promise.resolve(r))):G(!1,`network changed: ${n.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),n.clone()}async getFeeData(){let e=await this.getNetwork(),n=async()=>{let{_block:i,gasPrice:s,priorityFee:o}=await Gt({_block:this.#y("latest",!1),gasPrice:(async()=>{try{let u=await this.#c({method:"getGasPrice"});return te(u,"%response")}catch{}return null})(),priorityFee:(async()=>{try{let u=await this.#c({method:"getPriorityFee"});return te(u,"%response")}catch{}return null})()}),a=null,c=null,l=this._wrapBlock(i,e);return l&&l.baseFeePerGas&&(c=o??BigInt("1000000000"),a=l.baseFeePerGas*iZ+c),new od(s,a,c)},r=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){let i=new Or(r.url),s=await r.processFunc(n,this,i);return new od(s.gasPrice,s.maxFeePerGas,s.maxPriorityFeePerGas)}return await n()}async estimateGas(e){let n=this._getTransactionRequest(e);return $w(n)&&(n=await n),te(await this.#c({method:"estimateGas",transaction:n}),"%response")}async#u(e,n,r){G(r<sZ,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:n,enableCcipRead:!0})});let i=Ea(e);try{return Z(await this._perform({method:"call",transaction:i,blockTag:n}))}catch(s){if(!this.disableCcipRead&&zc(s)&&s.data&&r>=0&&n==="latest"&&i.to!=null&&_t(s.data,0,4)==="0x556f1830"){let o=s.data,a=await tn(i.to,this),c;try{c=hZ(_t(s.data,4))}catch(d){G(!1,d.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:i,info:{data:o}})}G(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:o,reason:"OffchainLookup",transaction:i,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});let l=await this.ccipReadFetch(i,c.calldata,c.urls);G(l!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:i,info:{data:s.data,errorArgs:c.errorArgs}});let u={to:a,data:Ze([c.selector,dZ([l,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{let d=await this.#u(u,n,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:d}),d}catch(d){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:d}),d}}throw s}}async#h(e){let{value:n}=await Gt({network:this.getNetwork(),value:e});return n}async call(e){let{tx:n,blockTag:r}=await Gt({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await this.#h(this.#u(n,r,e.enableCcipRead?0:-1))}async#f(e,n,r){let i=this._getAddress(n),s=this._getBlockTag(r);return(typeof i!="string"||typeof s!="string")&&([i,s]=await Promise.all([i,s])),await this.#h(this.#c(Object.assign(e,{address:i,blockTag:s})))}async getBalance(e,n){return te(await this.#f({method:"getBalance"},e,n),"%response")}async getTransactionCount(e,n){return ve(await this.#f({method:"getTransactionCount"},e,n),"%response")}async getCode(e,n){return Z(await this.#f({method:"getCode"},e,n))}async getStorage(e,n,r){let i=te(n,"position");return Z(await this.#f({method:"getStorage",position:i},e,r))}async broadcastTransaction(e){let{blockNumber:n,hash:r,network:i}=await Gt({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),s=el.from(e);if(s.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(s,i).replaceableTransaction(n)}async#y(e,n){if(Ue(e,32))return await this.#c({method:"getBlock",blockHash:e,includeTransactions:n});let r=this._getBlockTag(e);return typeof r!="string"&&(r=await r),await this.#c({method:"getBlock",blockTag:r,includeTransactions:n})}async getBlock(e,n){let{network:r,params:i}=await Gt({network:this.getNetwork(),params:this.#y(e,!!n)});return i==null?null:this._wrapBlock(i,r)}async getTransaction(e){let{network:n,params:r}=await Gt({network:this.getNetwork(),params:this.#c({method:"getTransaction",hash:e})});return r==null?null:this._wrapTransactionResponse(r,n)}async getTransactionReceipt(e){let{network:n,params:r}=await Gt({network:this.getNetwork(),params:this.#c({method:"getTransactionReceipt",hash:e})});if(r==null)return null;if(r.gasPrice==null&&r.effectiveGasPrice==null){let i=await this.#c({method:"getTransaction",hash:e});if(i==null)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=i.gasPrice}return this._wrapTransactionReceipt(r,n)}async getTransactionResult(e){let{result:n}=await Gt({network:this.getNetwork(),result:this.#c({method:"getTransactionResult",hash:e})});return n==null?null:Z(n)}async getLogs(e){let n=this._getFilter(e);$w(n)&&(n=await n);let{network:r,params:i}=await Gt({network:this.getNetwork(),params:this.#c({method:"getLogs",filter:n})});return i.map(s=>this._wrapLog(s,r))}_getProvider(e){G(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await ld.fromName(this,e)}async getAvatar(e){let n=await this.getResolver(e);return n?await n.getAvatar():null}async resolveName(e){let n=await this.getResolver(e);return n?await n.getAddress():null}async lookupAddress(e){e=Re(e);let n=nd(e.substring(2).toLowerCase()+".addr.reverse");try{let r=await ld.getEnsAddress(this),s=await new dn(r,["function resolver(bytes32) view returns (address)"],this).resolver(n);if(s==null||s===yo)return null;let a=await new dn(s,["function name(bytes32) view returns (string)"],this).name(n);return await this.resolveName(a)!==e?null:a}catch(r){if(Mt(r,"BAD_DATA")&&r.value==="0x"||Mt(r,"CALL_EXCEPTION"))return null;throw r}return null}async waitForTransaction(e,n,r){let i=n??1;return i===0?this.getTransactionReceipt(e):new Promise(async(s,o)=>{let a=null,c=async l=>{try{let u=await this.getTransactionReceipt(e);if(u!=null&&l-u.blockNumber+1>=i){s(u),a&&(clearTimeout(a),a=null);return}}catch(u){console.log("EEE",u)}this.once("block",c)};r!=null&&(a=setTimeout(()=>{a!=null&&(a=null,this.off("block",c),o(Je("timeout","TIMEOUT",{reason:"timeout"})))},r)),c(await this.getBlockNumber())})}async waitForBlock(e){G(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){let n=this.#l.get(e);n&&(n.timer&&clearTimeout(n.timer),this.#l.delete(e))}_setTimeout(e,n){n==null&&(n=0);let r=this.#d++,i=()=>{this.#l.delete(r),e()};if(this.paused)this.#l.set(r,{timer:null,func:i,time:n});else{let s=setTimeout(i,n);this.#l.set(r,{timer:s,func:i,time:XA()})}return r}_forEachSubscriber(e){for(let n of this.#e.values())e(n.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new pd(e.type);case"block":{let n=new Uw(this);return n.pollingInterval=this.pollingInterval,n}case"safe":case"finalized":return new jw(this,e.type);case"event":return new Ia(this,e.filter);case"transaction":return new Hw(this,e.hash);case"orphan":return new Vw(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,n){for(let r of this.#e.values())if(r.subscriber===e){r.started&&r.subscriber.stop(),r.subscriber=n,r.started&&n.start(),this.#n!=null&&n.pause(this.#n);break}}async#m(e,n){let r=await ZA(e,this);return r.type==="event"&&n&&n.length>0&&n[0].removed===!0&&(r=await ZA({orphan:"drop-log",log:n[0]},this)),this.#e.get(r.tag)||null}async#w(e){let n=await ZA(e,this),r=n.tag,i=this.#e.get(r);return i||(i={subscriber:this._getSubscriber(n),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#e.set(r,i)),i}async on(e,n){let r=await this.#w(e);return r.listeners.push({listener:n,once:!1}),r.started||(r.subscriber.start(),r.started=!0,this.#n!=null&&r.subscriber.pause(this.#n)),this}async once(e,n){let r=await this.#w(e);return r.listeners.push({listener:n,once:!0}),r.started||(r.subscriber.start(),r.started=!0,this.#n!=null&&r.subscriber.pause(this.#n)),this}async emit(e,...n){let r=await this.#m(e,n);if(!r||r.listeners.length===0)return!1;let i=r.listeners.length;return r.listeners=r.listeners.filter(({listener:s,once:o})=>{let a=new sa(this,o?null:s,e);try{s.call(this,...n,a)}catch{}return!o}),r.listeners.length===0&&(r.started&&r.subscriber.stop(),this.#e.delete(r.tag)),i>0}async listenerCount(e){if(e){let r=await this.#m(e);return r?r.listeners.length:0}let n=0;for(let{listeners:r}of this.#e.values())n+=r.length;return n}async listeners(e){if(e){let r=await this.#m(e);return r?r.listeners.map(({listener:i})=>i):[]}let n=[];for(let{listeners:r}of this.#e.values())n=n.concat(r.map(({listener:i})=>i));return n}async off(e,n){let r=await this.#m(e);if(!r)return this;if(n){let i=r.listeners.map(({listener:s})=>s).indexOf(n);i>=0&&r.listeners.splice(i,1)}return(!n||r.listeners.length===0)&&(r.started&&r.subscriber.stop(),this.#e.delete(r.tag)),this}async removeAllListeners(e){if(e){let{tag:n,started:r,subscriber:i}=await this.#w(e);r&&i.stop(),this.#e.delete(n)}else for(let[n,{started:r,subscriber:i}]of this.#e)r&&i.stop(),this.#e.delete(n);return this}async addListener(e,n){return await this.on(e,n)}async removeListener(e,n){return this.off(e,n)}get destroyed(){return this.#r}destroy(){this.removeAllListeners();for(let e of this.#l.keys())this._clearTimeout(e);this.#r=!0}get paused(){return this.#n!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(this.#a=-1,this.#n!=null){if(this.#n==!!e)return;G(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(n=>n.pause(e)),this.#n=!!e;for(let n of this.#l.values())n.timer&&clearTimeout(n.timer),n.time=XA()-n.time}resume(){if(this.#n!=null){this._forEachSubscriber(e=>e.resume()),this.#n=null;for(let e of this.#l.values()){let n=e.time;n<0&&(n=0),e.time=XA(),setTimeout(e.func,n)}}}};function cZ(t,e){try{let n=tS(t,e);if(n)return uo(n)}catch{}return null}function tS(t,e){if(t==="0x")return null;try{let n=ve(_t(t,e,e+32)),r=ve(_t(t,n,n+32));return _t(t,n+32,n+32+r)}catch{}return null}function bF(t){let e=Bt(t);if(e.length>32)throw new Error("internal; should not happen");let n=new Uint8Array(32);return n.set(e,32-e.length),n}function lZ(t){if(t.length%32===0)return t;let e=new Uint8Array(Math.ceil(t.length/32)*32);return e.set(t),e}var uZ=new Uint8Array([]);function dZ(t){let e=[],n=0;for(let r=0;r<t.length;r++)e.push(uZ),n+=32;for(let r=0;r<t.length;r++){let i=ye(t[r]);e[r]=bF(n),e.push(bF(i.length)),e.push(lZ(i)),n+=32+Math.ceil(i.length/32)*32}return Ze(e)}var EF="0x0000000000000000000000000000000000000000000000000000000000000000";function hZ(t){let e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};G(Qi(t)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});let n=_t(t,0,32);G(_t(n,0,12)===_t(EF,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=_t(n,12);try{let r=[],i=ve(_t(t,32,64)),s=ve(_t(t,i,i+32)),o=_t(t,i+32);for(let a=0;a<s;a++){let c=cZ(o,a*32);if(c==null)throw new Error("abort");r.push(c)}e.urls=r}catch{G(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{let r=tS(t,64);if(r==null)throw new Error("abort");e.calldata=r}catch{G(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}G(_t(t,100,128)===_t(EF,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=_t(t,96,100);try{let r=tS(t,128);if(r==null)throw new Error("abort");e.extraData=r}catch{G(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(r=>e[r]),e}function pl(t,e){if(t.provider)return t.provider;G(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function IF(t,e){let n=Ea(e);if(n.to!=null&&(n.to=tn(n.to,t)),n.from!=null){let r=n.from;n.from=Promise.all([t.getAddress(),tn(r,t)]).then(([i,s])=>(D(i.toLowerCase()===s.toLowerCase(),"transaction from mismatch","tx.from",s),i))}else n.from=t.getAddress();return await Gt(n)}var ip=class{provider;constructor(e){ce(this,{provider:e||null})}async getNonce(e){return pl(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await IF(this,e)}async populateTransaction(e){let n=pl(this,"populateTransaction"),r=await IF(this,e);r.nonce==null&&(r.nonce=await this.getNonce("pending")),r.gasLimit==null&&(r.gasLimit=await this.estimateGas(r));let i=await this.provider.getNetwork();if(r.chainId!=null){let o=te(r.chainId);D(o===i.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else r.chainId=i.chainId;let s=r.maxFeePerGas!=null||r.maxPriorityFeePerGas!=null;if(r.gasPrice!=null&&(r.type===2||s)?D(!1,"eip-1559 transaction do not support gasPrice","tx",e):(r.type===0||r.type===1)&&s&&D(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(r.type===2||r.type==null)&&r.maxFeePerGas!=null&&r.maxPriorityFeePerGas!=null)r.type=2;else if(r.type===0||r.type===1){let o=await n.getFeeData();G(o.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),r.gasPrice==null&&(r.gasPrice=o.gasPrice)}else{let o=await n.getFeeData();if(r.type==null)if(o.maxFeePerGas!=null&&o.maxPriorityFeePerGas!=null)if(r.authorizationList&&r.authorizationList.length?r.type=4:r.type=2,r.gasPrice!=null){let a=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=a,r.maxPriorityFeePerGas=a}else r.maxFeePerGas==null&&(r.maxFeePerGas=o.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=o.maxPriorityFeePerGas);else o.gasPrice!=null?(G(!s,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),r.gasPrice==null&&(r.gasPrice=o.gasPrice),r.type=0):G(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(r.type===2||r.type===3||r.type===4)&&(r.maxFeePerGas==null&&(r.maxFeePerGas=o.maxFeePerGas),r.maxPriorityFeePerGas==null&&(r.maxPriorityFeePerGas=o.maxPriorityFeePerGas))}return await Gt(r)}async populateAuthorization(e){let n=Object.assign({},e);return n.chainId==null&&(n.chainId=(await pl(this,"getNetwork").getNetwork()).chainId),n.nonce==null&&(n.nonce=await this.getNonce()),n}async estimateGas(e){return pl(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return pl(this,"call").call(await this.populateCall(e))}async resolveName(e){return await pl(this,"resolveName").resolveName(e)}async sendTransaction(e){let n=pl(this,"sendTransaction"),r=await this.populateTransaction(e);delete r.from;let i=el.from(r);return await n.broadcastTransaction(await this.signTransaction(i))}authorize(e){G(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}};function fZ(t){return JSON.parse(JSON.stringify(t))}var zw=class{#e;#t;#n;#r;#i;#o;constructor(e){this.#e=e,this.#t=null,this.#n=this.#s.bind(this),this.#r=!1,this.#i=null,this.#o=!1}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,n){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}async#s(e){try{this.#t==null&&(this.#t=this._subscribe(this.#e));let n=null;try{n=await this.#t}catch(s){if(!Mt(s,"UNSUPPORTED_OPERATION")||s.operation!=="eth_newFilter")throw s}if(n==null){this.#t=null,this.#e._recoverSubscriber(this,this._recover(this.#e));return}let r=await this.#e.getNetwork();if(this.#i||(this.#i=r),this.#i.chainId!==r.chainId)throw new Error("chaid changed");if(this.#o)return;let i=await this.#e.send("eth_getFilterChanges",[n]);await this._emitResults(this.#e,i)}catch(n){console.log("@TODO",n)}this.#e.once("block",this.#n)}#a(){let e=this.#t;e&&(this.#t=null,e.then(n=>{this.#e.destroyed||this.#e.send("eth_uninstallFilter",[n])}))}start(){this.#r||(this.#r=!0,this.#s(-2))}stop(){this.#r&&(this.#r=!1,this.#o=!0,this.#a(),this.#e.off("block",this.#n))}pause(e){e&&this.#a(),this.#e.off("block",this.#n)}resume(){this.start()}},Gw=class extends zw{#e;constructor(e,n){super(e),this.#e=fZ(n)}_recover(e){return new Ia(e,this.#e)}async _subscribe(e){return await e.send("eth_newFilter",[this.#e])}async _emitResults(e,n){for(let r of n)e.emit(this.#e,e._wrapLog(r,e._network))}},Kw=class extends zw{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,n){for(let r of n)e.emit("pending",r)}};var pZ="bigint,boolean,function,number,string,symbol".split(/,/g);function Ww(t){if(t==null||pZ.indexOf(typeof t)>=0||typeof t.getAddress=="function")return t;if(Array.isArray(t))return t.map(Ww);if(typeof t=="object")return Object.keys(t).reduce((e,n)=>(e[n]=t[n],e),{});throw new Error(`should not happen: ${t} (${typeof t})`)}function gZ(t){return new Promise(e=>{setTimeout(e,t)})}function gd(t){return t&&t.toLowerCase()}function CF(t){return t&&typeof t.pollingInterval=="number"}var AF={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3},gl=class extends ip{address;constructor(e,n){super(e),n=Re(n),ce(this,{address:n})}connect(e){G(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(e){return await this.populateCall(e)}async sendUncheckedTransaction(e){let n=Ww(e),r=[];if(n.from){let s=n.from;r.push((async()=>{let o=await tn(s,this.provider);D(o!=null&&o.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),n.from=o})())}else n.from=this.address;if(n.gasLimit==null&&r.push((async()=>{n.gasLimit=await this.provider.estimateGas(fe(H({},n),{from:this.address}))})()),n.to!=null){let s=n.to;r.push((async()=>{n.to=await tn(s,this.provider)})())}r.length&&await Promise.all(r);let i=this.provider.getRpcTransaction(n);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(e){let n=await this.provider.getBlockNumber(),r=await this.sendUncheckedTransaction(e);return await new Promise((i,s)=>{let o=[1e3,100],a=0,c=async()=>{try{let l=await this.provider.getTransaction(r);if(l!=null){i(l.replaceableTransaction(n));return}}catch(l){if(Mt(l,"CANCELLED")||Mt(l,"BAD_DATA")||Mt(l,"NETWORK_ERROR")||Mt(l,"UNSUPPORTED_OPERATION")){l.info==null&&(l.info={}),l.info.sendTransactionHash=r,s(l);return}if(Mt(l,"INVALID_ARGUMENT")&&(a++,l.info==null&&(l.info={}),l.info.sendTransactionHash=r,a>10)){s(l);return}this.provider.emit("error",Je("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:l}))}this.provider._setTimeout(()=>{c()},o.pop()||4e3)};c()})}async signTransaction(e){let n=Ww(e);if(n.from){let i=await tn(n.from,this.provider);D(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),n.from=i}else n.from=this.address;let r=this.provider.getRpcTransaction(n);return await this.provider.send("eth_signTransaction",[r])}async signMessage(e){let n=typeof e=="string"?Gn(e):e;return await this.provider.send("personal_sign",[Z(n),this.address.toLowerCase()])}async signTypedData(e,n,r){let i=Ww(r),s=await rd.resolveNames(e,n,i,async o=>{let a=await tn(o);return D(a!=null,"TypedData does not support null address","value",o),a});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(rd.getPayload(s.domain,n,s.value))])}async unlock(e){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),e,null])}async _legacySignMessage(e){let n=typeof e=="string"?Gn(e):e;return await this.provider.send("eth_sign",[this.address.toLowerCase(),Z(n)])}},sp=class extends rp{#e;#t;#n;#r;#i;#o;#s;#a(){if(this.#r)return;let e=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");this.#r=setTimeout(()=>{this.#r=null;let n=this.#n;for(this.#n=[];n.length;){let r=[n.shift()];for(;n.length&&r.length!==this.#e.batchMaxCount;)if(r.push(n.shift()),JSON.stringify(r.map(s=>s.payload)).length>this.#e.batchMaxSize){n.unshift(r.pop());break}(async()=>{let i=r.length===1?r[0].payload:r.map(s=>s.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{let s=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:s});for(let{resolve:o,reject:a,payload:c}of r){if(this.destroyed){a(Je("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:c.method}));continue}let l=s.filter(u=>u.id===c.id)[0];if(l==null){let u=Je("missing response for request","BAD_DATA",{value:s,info:{payload:c}});this.emit("error",u),a(u);continue}if("error"in l){a(this.getRpcError(c,l));continue}o(l.result)}}catch(s){this.emit("debug",{action:"receiveRpcError",error:s});for(let{reject:o}of r)o(s)}})()}},e)}constructor(e,n){super(e,n),this.#t=1,this.#e=Object.assign({},AF,n||{}),this.#n=[],this.#r=null,this.#o=null,this.#s=null;{let i=null,s=new Promise(o=>{i=o});this.#i={promise:s,resolve:i}}let r=this._getOption("staticNetwork");typeof r=="boolean"?(D(!r||e!=="any","staticNetwork cannot be used on special network 'any'","options",n),r&&e!=null&&(this.#o=Xr.from(e))):r&&(D(e==null||r.matches(e),"staticNetwork MUST match network object","options",n),this.#o=r)}_getOption(e){return this.#e[e]}get _network(){return G(this.#o,"network is not available yet","NETWORK_ERROR"),this.#o}async _perform(e){if(e.method==="call"||e.method==="estimateGas"){let r=e.transaction;if(r&&r.type!=null&&te(r.type)&&r.maxFeePerGas==null&&r.maxPriorityFeePerGas==null){let i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(e=Object.assign({},e,{transaction:Object.assign({},r,{type:void 0})}))}}let n=this.getRpcRequest(e);return n!=null?await this.send(n.method,n.args):super._perform(e)}async _detectNetwork(){let e=this._getOption("staticNetwork");if(e)if(e===!0){if(this.#o)return this.#o}else return e;return this.#s?await this.#s:this.ready?(this.#s=(async()=>{try{let n=Xr.from(te(await this.send("eth_chainId",[])));return this.#s=null,n}catch(n){throw this.#s=null,n}})(),await this.#s):(this.#s=(async()=>{let n={id:this.#t++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:n});let r;try{r=(await this._send(n))[0],this.#s=null}catch(i){throw this.#s=null,this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:r}),"result"in r)return Xr.from(te(r.result));throw this.getRpcError(n,r)})(),await this.#s)}_start(){this.#i==null||this.#i.resolve==null||(this.#i.resolve(),this.#i=null,(async()=>{for(;this.#o==null&&!this.destroyed;)try{this.#o=await this._detectNetwork()}catch(e){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Je("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:e}})),await gZ(1e3)}this.#a()})())}async _waitUntilReady(){if(this.#i!=null)return await this.#i.promise}_getSubscriber(e){return e.type==="pending"?new Kw(this):e.type==="event"?this._getOption("polling")?new Ia(this,e.filter):new Gw(this,e.filter):e.type==="orphan"&&e.filter.orphan==="drop-log"?new pd("orphan"):super._getSubscriber(e)}get ready(){return this.#i==null}getRpcTransaction(e){let n={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(r=>{if(e[r]==null)return;let i=r;r==="gasLimit"&&(i="gas"),n[i]=zn(te(e[r],`tx.${r}`))}),["from","to","data"].forEach(r=>{e[r]!=null&&(n[r]=Z(e[r]))}),e.accessList&&(n.accessList=Jr(e.accessList)),e.blobVersionedHashes&&(n.blobVersionedHashes=e.blobVersionedHashes.map(r=>r.toLowerCase())),e.authorizationList&&(n.authorizationList=e.authorizationList.map(r=>{let i=Bf(r);return{address:i.address,nonce:zn(i.nonce),chainId:zn(i.chainId),yParity:zn(i.signature.yParity),r:zn(i.signature.r),s:zn(i.signature.s)}})),n}getRpcRequest(e){switch(e.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[gd(e.address),e.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[gd(e.address),e.blockTag]};case"getCode":return{method:"eth_getCode",args:[gd(e.address),e.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[gd(e.address),"0x"+e.position.toString(16),e.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[e.signedTransaction]};case"getBlock":if("blockTag"in e)return{method:"eth_getBlockByNumber",args:[e.blockTag,!!e.includeTransactions]};if("blockHash"in e)return{method:"eth_getBlockByHash",args:[e.blockHash,!!e.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[e.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[e.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(e.transaction),e.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(e.transaction)]};case"getLogs":return e.filter&&e.filter.address!=null&&(Array.isArray(e.filter.address)?e.filter.address=e.filter.address.map(gd):e.filter.address=gd(e.filter.address)),{method:"eth_getLogs",args:[e.filter]}}return null}getRpcError(e,n){let{method:r}=e,{error:i}=n;if(r==="eth_estimateGas"&&i.message){let a=i.message;if(!a.match(/revert/i)&&a.match(/insufficient funds/i))return Je("insufficient funds","INSUFFICIENT_FUNDS",{transaction:e.params[0],info:{payload:e,error:i}});if(a.match(/nonce/i)&&a.match(/too low/i))return Je("nonce has already been used","NONCE_EXPIRED",{transaction:e.params[0],info:{payload:e,error:i}})}if(r==="eth_call"||r==="eth_estimateGas"){let a=nS(i),c=va.getBuiltinCallException(r==="eth_call"?"call":"estimateGas",e.params[0],a?a.data:null);return c.info={error:i,payload:e},c}let s=JSON.stringify(mZ(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return Je("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[r]||"unknown",reason:"rejected",info:{payload:e,error:i}});if(r==="eth_sendRawTransaction"||r==="eth_sendTransaction"){let a=e.params[0];if(s.match(/insufficient funds|base fee exceeds gas limit/i))return Je("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:a,info:{error:i}});if(s.match(/nonce/i)&&s.match(/too low/i))return Je("nonce has already been used","NONCE_EXPIRED",{transaction:a,info:{error:i}});if(s.match(/replacement transaction/i)&&s.match(/underpriced/i))return Je("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:a,info:{error:i}});if(s.match(/only replay-protected/i))return Je("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:r,info:{transaction:a,info:{error:i}}})}let o=!!s.match(/the method .* does not exist/i);return o||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(o=!0),o?Je("unsupported operation","UNSUPPORTED_OPERATION",{operation:e.method,info:{error:i,payload:e}}):Je("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:e})}send(e,n){if(this.destroyed)return Promise.reject(Je("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e}));let r=this.#t++,i=new Promise((s,o)=>{this.#n.push({resolve:s,reject:o,payload:{method:e,params:n,id:r,jsonrpc:"2.0"}})});return this.#a(),i}async getSigner(e){e==null&&(e=0);let n=this.send("eth_accounts",[]);if(typeof e=="number"){let i=await n;if(e>=i.length)throw new Error("no such account");return new gl(this,i[e])}let{accounts:r}=await Gt({network:this.getNetwork(),accounts:n});e=Re(e);for(let i of r)if(Re(i)===e)return new gl(this,e);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(n=>new gl(this,n))}destroy(){this.#r&&(clearTimeout(this.#r),this.#r=null);for(let{payload:e,reject:n}of this.#n)n(Je("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e.method}));this.#n=[],super.destroy()}},op=class extends sp{#e;constructor(e,n){super(e,n);let r=this._getOption("pollingInterval");r==null&&(r=AF.pollingInterval),this.#e=r}_getSubscriber(e){let n=super._getSubscriber(e);return CF(n)&&(n.pollingInterval=this.#e),n}get pollingInterval(){return this.#e}set pollingInterval(e){if(!Number.isInteger(e)||e<0)throw new Error("invalid interval");this.#e=e,this._forEachSubscriber(n=>{CF(n)&&(n.pollingInterval=this.#e)})}},Fs=class extends op{#e;constructor(e,n,r){e==null&&(e="http://localhost:8545"),super(n,r),typeof e=="string"?this.#e=new Or(e):this.#e=e.clone()}_getConnection(){return this.#e.clone()}async send(e,n){return await this._start(),await super.send(e,n)}async _send(e){let n=this._getConnection();n.body=JSON.stringify(e),n.setHeader("content-type","application/json");let r=await n.send();r.assertOk();let i=r.bodyJson;return Array.isArray(i)||(i=[i]),i}};function nS(t){if(t==null)return null;if(typeof t.message=="string"&&t.message.match(/revert/i)&&Ue(t.data))return{message:t.message,data:t.data};if(typeof t=="object"){for(let e in t){let n=nS(t[e]);if(n)return n}return null}if(typeof t=="string")try{return nS(JSON.parse(t))}catch{}return null}function rS(t,e){if(t!=null){if(typeof t.message=="string"&&e.push(t.message),typeof t=="object")for(let n in t)rS(t[n],e);if(typeof t=="string")try{return rS(JSON.parse(t),e)}catch{}}}function mZ(t){let e=[];return rS(t,e),e}var Ca=class t extends op{#e;#t;constructor(e,n,r){let i=Object.assign({},r??{},{batchMaxCount:1});D(e&&e.request,"invalid EIP-1193 provider","ethereum",e),super(n,i),this.#t=null,r&&r.providerInfo&&(this.#t=r.providerInfo),this.#e=async(s,o)=>{let a={method:s,params:o};this.emit("debug",{action:"sendEip1193Request",payload:a});try{let c=await e.request(a);return this.emit("debug",{action:"receiveEip1193Result",result:c}),c}catch(c){let l=new Error(c.message);throw l.code=c.code,l.data=c.data,l.payload=a,this.emit("debug",{action:"receiveEip1193Error",error:l}),l}}}get providerInfo(){return this.#t}async send(e,n){return await this._start(),await super.send(e,n)}async _send(e){D(!Array.isArray(e),"EIP-1193 does not support batch request","payload",e);try{let n=await this.#e(e.method,e.params||[]);return[{id:e.id,result:n}]}catch(n){return[{id:e.id,error:{code:n.code,data:n.data,message:n.message}}]}}getRpcError(e,n){switch(n=JSON.parse(JSON.stringify(n)),n.error.code||-1){case 4001:n.error.message=`ethers-user-denied: ${n.error.message}`;break;case 4200:n.error.message=`ethers-unsupported: ${n.error.message}`;break}return super.getRpcError(e,n)}async hasSigner(e){e==null&&(e=0);let n=await this.send("eth_accounts",[]);return typeof e=="number"?n.length>e:(e=e.toLowerCase(),n.filter(r=>r.toLowerCase()===e).length!==0)}async getSigner(e){if(e==null&&(e=0),!await this.hasSigner(e))try{await this.#e("eth_requestAccounts",[])}catch(n){let r=n.payload;throw this.getRpcError(r,{id:r.id,error:n})}return await super.getSigner(e)}static async discover(e){if(e==null&&(e={}),e.provider)return new t(e.provider);let n=e.window?e.window:typeof window<"u"?window:null;if(n==null)return null;let r=e.anyProvider;if(r&&n.ethereum)return new t(n.ethereum);if(!("addEventListener"in n&&"dispatchEvent"in n&&"removeEventListener"in n))return null;let i=e.timeout?e.timeout:300;return i===0?null:await new Promise((s,o)=>{let a=[],c=d=>{a.push(d.detail),r&&l()},l=()=>{if(clearTimeout(u),a.length)if(e&&e.filter){let d=e.filter(a.map(h=>Object.assign({},h.info)));if(d==null)s(null);else if(d instanceof t)s(d);else{let h=null;if(d.uuid&&(h=a.filter(p=>d.uuid===p.info.uuid)[0]),h){let{provider:f,info:p}=h;s(new t(f,void 0,{providerInfo:p}))}else o(Je("filter returned unknown info","UNSUPPORTED_OPERATION",{value:d}))}}else{let{provider:d,info:h}=a[0];s(new t(d,void 0,{providerInfo:h}))}else s(null);n.removeEventListener("eip6963:announceProvider",c)},u=setTimeout(()=>{l()},i);n.addEventListener("eip6963:announceProvider",c),n.dispatchEvent(new Event("eip6963:requestProvider"))})}};var s$=Kl(i$());var Rt={production:!1,vestingContractAddress:"0x6089cdFC15A0F71Bcbb1c54FA9F0D8d3FEe235fB",coinAddress:"0x9ad49fC9Cb2a998ed2De48CFb6DE81bf9Ce1ea3C",supabaseRestUrl:"https://uvqnyufffifclezqkmzh.supabase.co/functions/v1/proof-by-address",walletConnectProjectId:"051e4ff495bf3f36a63792e87bf4ba7e",networkDetails:{chainId:"0x3E6",chainName:"Hyperliquid TestNet",nativeCurrency:{name:"HYPE",symbol:"HYPE",decimals:18},rpcUrls:["https://rpc.hyperliquid-testnet.xyz/evm"],blockExplorerUrls:["https://testnet.purrsec.com/"]}};var tve=["function balanceOf(address owner) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)"],oh=class t{currentAccount=pt(null);accounts=pt([]);isConnecting=pt(!1);error=pt(null);hypeBalance=pt(null);qoneBalance=pt(null);activeProviderType=pt(null);walletConnectProvider=null;metaMaskProvider=null;ACTIVE_PROVIDER_KEY="active_provider";rpcProvider=new Fs(Rt.networkDetails.rpcUrls[0]);balancesInFlight=new Map;isMetaMaskListenerSet=!1;wcConnectInFlight=null;log(...e){console.log(`[WalletService ${new Date().toISOString()}]`,...e)}warn(...e){console.warn(`[WalletService ${new Date().toISOString()}]`,...e)}err(...e){console.error(`[WalletService ${new Date().toISOString()}]`,...e)}constructor(){let e=localStorage.getItem(this.ACTIVE_PROVIDER_KEY);this.log("Constructor: savedProvider =",e),e&&(this.activeProviderType.set(e),e==="metamask"?this.rehydrateMetaMask():e==="walletconnect"&&this.initWalletConnect())}getMetaMaskProvider(){if(typeof window>"u")return null;if(this.metaMaskProvider)return this.log("getMetaMaskProvider: using cached MetaMask provider"),this.metaMaskProvider;let e=window.ethereum;if(!e)return this.warn("getMetaMaskProvider: window.ethereum not found"),this.tryEip6963Discovery(),null;if(e.providers?.length){let n=e.providers.find(r=>r.isMetaMask);if(n)return this.metaMaskProvider=n,this.log("getMetaMaskProvider: found MetaMask in ethereum.providers[]"),n}return e.isMetaMask?(this.metaMaskProvider=e,this.log("getMetaMaskProvider: window.ethereum is MetaMask"),e):(this.warn("getMetaMaskProvider: MetaMask not detected via legacy paths; trying EIP-6963"),this.tryEip6963Discovery(),null)}tryEip6963Discovery(){if(typeof window>"u")return;let e=n=>{let r=n.detail;this.log("EIP-6963 announceProvider:",r?.info?.rdns,r?.info?.name),r?.info?.rdns==="io.metamask"&&(this.metaMaskProvider=r.provider,this.log("EIP-6963: cached MetaMask provider from announcement"))};window.addEventListener("eip6963:announceProvider",e),window.dispatchEvent(new Event("eip6963:requestProvider")),setTimeout(()=>{window.removeEventListener("eip6963:announceProvider",e),this.log("EIP-6963: discovery listener removed")},1500)}getActiveEip1193Provider(){let e=this.activeProviderType();return this.log("getActiveEip1193Provider: activeProviderType =",e),e==="walletconnect"?this.walletConnectProvider:e==="metamask"?this.getMetaMaskProvider():this.getMetaMaskProvider()}getBrowserProvider(){let e=this.getActiveEip1193Provider();return e?new Ca(e):null}async getSigner(e){let n=this.getBrowserProvider();if(!n)throw new Error("No provider available");let r=e||this.currentAccount();return this.log("getSigner: target =",r),await this.validateAndSwitchNetwork(),r?n.getSigner(r):n.getSigner()}async validateAndSwitchNetwork(){this.log("validateAndSwitchNetwork: begin");let e=this.getActiveEip1193Provider(),n=this.activeProviderType();if(!e||!n)throw this.warn("validateAndSwitchNetwork: no active provider"),new Error("No wallet connected");try{let r=Number(Rt.networkDetails.chainId),i=Number(e?.chainId??await e?.request?.({method:"eth_chainId"}));if(this.log("validateAndSwitchNetwork: chain check",{current:i,expected:r}),i!==r){if(this.log("validateAndSwitchNetwork: wrong network, attempting to switch..."),await this.addOrSwitchNetwork(e),Number(e?.chainId??await e?.request?.({method:"eth_chainId"}))!==r)throw new Error(`Please switch to ${Rt.networkDetails.chainName} in your wallet`);this.log("validateAndSwitchNetwork: successfully switched to correct network")}else this.log("validateAndSwitchNetwork: already on correct network")}catch(r){throw this.err("validateAndSwitchNetwork: error:",r),new Error(r?.message||`Please switch to ${Rt.networkDetails.chainName}`)}}async initWalletConnect(){this.log("initWalletConnect: begin"),this.walletConnectProvider?this.log("initWalletConnect: provider already exists"):(this.log("initWalletConnect: creating EthereumProvider.init(...)"),this.walletConnectProvider=await s$.EthereumProvider.init({projectId:Rt.walletConnectProjectId,chains:[Number(Rt.networkDetails.chainId)],showQrModal:!0,qrModalOptions:{themeMode:"dark"},rpcMap:{[Number(Rt.networkDetails.chainId)]:Rt.networkDetails.rpcUrls[0]}}),this.walletConnectProvider.on("display_uri",r=>{this.log("WalletConnect display_uri:",r)}),this.walletConnectProvider.on("connect",r=>{this.log("WalletConnect connect event:",r),this.log("WalletConnect session now:",this.walletConnectProvider?.session),this.log("WalletConnect accounts now:",this.walletConnectProvider?.accounts),this.validateChainOrSetError(this.walletConnectProvider,"WalletConnect")}),this.walletConnectProvider.on("accountsChanged",r=>{this.log("WalletConnect accountsChanged:",r),r?.length>0&&this.closeWcModal("accountsChanged"),this.handleAccountsChanged(r)}),this.walletConnectProvider.on("chainChanged",r=>{this.log("WalletConnect chainChanged:",r)}),this.walletConnectProvider.on("disconnect",r=>{this.warn("WalletConnect disconnect event:",r),this.handleAccountsChanged([])}),this.log("initWalletConnect: listeners attached"));let e=this.walletConnectProvider.accounts??[],n=!!this.walletConnectProvider?.session;return this.log("initWalletConnect: restored",{hasSession:n,accounts:e}),e.length>0?(await this.setActiveSession("walletconnect",e),await this.validateChainOrSetError(this.walletConnectProvider,"WalletConnect"),!0):!1}async connectWalletConnect(){return this.log("connectWalletConnect: begin"),this.wcConnectInFlight?(this.warn("connectWalletConnect: already in flight, returning existing promise"),this.wcConnectInFlight):(this.wcConnectInFlight=(async()=>{this.walletConnectProvider||(this.log("connectWalletConnect: provider missing, calling initWalletConnect()"),await this.initWalletConnect());let e=!!this.walletConnectProvider?.session,n=this.walletConnectProvider?.accounts??[];if(this.log("connectWalletConnect: pre-check",{hasSession:e,accounts:n}),e||n.length>0){this.log("connectWalletConnect: already connected/restored, skipping connect()"),n.length>0&&await this.setActiveSession("walletconnect",n),this.closeWcModal("pre-check");return}try{this.log("connectWalletConnect: calling provider.connect() => QR may appear"),await this.walletConnectProvider.connect();let r=this.walletConnectProvider?.accounts??[];this.log("connectWalletConnect: post-connect accounts =",r),r.length>0?(await this.setActiveSession("walletconnect",r),this.closeWcModal("post-connect")):this.warn("connectWalletConnect: connect() finished but accounts still empty")}catch(r){this.err("connectWalletConnect: error:",r);let i=String(r?.message??"");if(r?.code===4001||/reset/i.test(i)||/rejected/i.test(i)||/closed/i.test(i)||/canceled|cancelled/i.test(i)){this.warn("connectWalletConnect: cancelled/reset/closed => not retrying");return}throw r}})().finally(()=>{this.wcConnectInFlight=null,this.log("connectWalletConnect: end (inFlight cleared)")}),this.wcConnectInFlight)}async getWalletConnectProvider(){return this.walletConnectProvider||await this.initWalletConnect(),this.walletConnectProvider}async rehydrateMetaMask(){this.log("rehydrateMetaMask: begin");let e=this.getMetaMaskProvider();if(!e){this.warn("rehydrateMetaMask: MetaMask provider not found");return}this.listenForMetaMaskAccountChanges();try{let i=(await new Ca(e).listAccounts()).map(s=>s.address);this.log("rehydrateMetaMask: listAccounts =",i),i.length>0?(await this.setActiveSession("metamask",i),await this.validateChainOrSetError(e,"MetaMask")):this.log("rehydrateMetaMask: no connected accounts")}catch(n){this.err("rehydrateMetaMask: error:",n)}}listenForMetaMaskAccountChanges(){if(this.isMetaMaskListenerSet){this.log("listenForMetaMaskAccountChanges: already set");return}let e=this.getMetaMaskProvider();if(!e){this.warn("listenForMetaMaskAccountChanges: provider missing");return}e.on("accountsChanged",n=>{this.log("MetaMask accountsChanged:",n),this.handleAccountsChanged(n)}),e.on("chainChanged",n=>{this.log("MetaMask chainChanged:",n)}),this.isMetaMaskListenerSet=!0,this.log("listenForMetaMaskAccountChanges: listener attached")}async connectWallet(e){this.log("connectWallet:",{type:e}),this.isConnecting.set(!0),this.error.set(null);try{if(e==="metamask"){let n=this.getMetaMaskProvider();if(!n)throw new Error("MetaMask is not installed or not detected");this.listenForMetaMaskAccountChanges(),this.log("MetaMask: wallet_requestPermissions..."),await n.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}),this.log("MetaMask: addOrSwitchNetwork..."),await this.addOrSwitchNetwork(n);let r=new Ca(n);this.log("MetaMask: eth_requestAccounts...");let i=await r.send("eth_requestAccounts",[]);this.log("MetaMask: connected accounts:",i),await this.setActiveSession("metamask",i),await this.validateChainOrSetError(n,"MetaMask")}e==="walletconnect"&&await this.connectWalletConnect()}catch(n){this.err("connectWallet: error:",n),n?.code===4001?this.error.set("User rejected the connection request"):this.error.set(n?.message||`Failed to connect ${e}`),localStorage.removeItem(this.ACTIVE_PROVIDER_KEY),this.activeProviderType.set(null)}finally{this.isConnecting.set(!1),this.log("connectWallet: done, isConnecting=false")}}async setActiveSession(e,n){this.log("setActiveSession:",{type:e,accounts:n}),n?.length>0?(this.activeProviderType.set(e),localStorage.setItem(this.ACTIVE_PROVIDER_KEY,e),await this.handleAccountsChanged(n)):this.warn("setActiveSession: empty accounts; not setting session")}async handleAccountsChanged(e){if(this.log("handleAccountsChanged:",e),this.accounts.set(e),e.length>0){let n=this.currentAccount();!n||!e.includes(n)?(this.log("handleAccountsChanged: selecting primary account:",e[0]),this.currentAccount.set(e[0]),await this.fetchBalances(e[0])):(this.log("handleAccountsChanged: keeping current account:",n),await this.fetchBalances(n));return}this.warn("handleAccountsChanged: disconnected (0 accounts)"),this.activeProviderType.set(null),localStorage.removeItem(this.ACTIVE_PROVIDER_KEY),this.currentAccount.set(null),this.resetBalances()}async addOrSwitchNetwork(e){this.log("addOrSwitchNetwork: target chainId =",Rt.networkDetails.chainId);try{await e.request({method:"wallet_switchEthereumChain",params:[{chainId:Rt.networkDetails.chainId}]}),this.log("addOrSwitchNetwork: switched OK")}catch(n){if(this.warn("addOrSwitchNetwork: switch failed:",n),n?.code===4902){this.log("addOrSwitchNetwork: chain missing, adding..."),await e.request({method:"wallet_addEthereumChain",params:[Rt.networkDetails]}),this.log("addOrSwitchNetwork: added OK");return}throw new Error(n?.message||"Failed to switch network")}}async fetchBalances(e){let n=e.toLowerCase(),r=this.balancesInFlight.get(n);if(r)return this.log("fetchBalances: already in flight for",n),r;let i=(async()=>{this.log("fetchBalances:",e),await Promise.all([this.fetchHypeBalance(e),this.fetchQoneBalance(e)])})().finally(()=>this.balancesInFlight.delete(n));return this.balancesInFlight.set(n,i),i}async fetchHypeBalance(e){this.log("fetchHypeBalance: begin");try{let n=await this.rpcProvider.getBalance(e),r=qy(n);this.log("fetchHypeBalance: value =",r),this.hypeBalance.set(r)}catch(n){this.err("fetchHypeBalance: error:",n),this.hypeBalance.set(null)}}async fetchQoneBalance(e){this.log("fetchQoneBalance: begin");try{let n=new dn(Rt.coinAddress,tve,this.rpcProvider),[r,i]=await Promise.all([n.balanceOf(e),n.decimals()]),s=Zi(r,i);this.log("fetchQoneBalance: value =",s),this.qoneBalance.set(s)}catch(n){this.err("fetchQoneBalance: error:",n),this.qoneBalance.set(null)}}async addTokenToMetaMask(){this.log("addTokenToMetaMask: begin");let e=this.getMetaMaskProvider();if(!e){this.warn("addTokenToMetaMask: MetaMask provider not found"),this.error.set("MetaMask is not installed");return}try{await e.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:Rt.coinAddress,symbol:"QLABS",decimals:18}}}),this.log("addTokenToMetaMask: request sent")}catch(n){this.err("addTokenToMetaMask: error:",n),this.error.set("Failed to add token to MetaMask")}}async disconnectWallet(){if(this.log("disconnectWallet: begin"),localStorage.removeItem(this.ACTIVE_PROVIDER_KEY),this.walletConnectProvider)try{this.log("disconnectWallet: disconnecting WalletConnect session..."),await this.walletConnectProvider.disconnect(),this.log("disconnectWallet: WalletConnect disconnected")}catch(e){this.err("disconnectWallet: WalletConnect disconnect error:",e)}finally{this.walletConnectProvider=null}this.activeProviderType.set(null),this.currentAccount.set(null),this.accounts.set([]),this.resetBalances(),this.log("disconnectWallet: done")}switchAccount(e){this.log("switchAccount:",e),this.accounts().includes(e)?(this.currentAccount.set(e),this.fetchBalances(e)):this.warn("switchAccount: unknown account:",e)}async refreshBalances(){let e=this.currentAccount();this.log("refreshBalances:",e),e&&await this.fetchBalances(e)}resetBalances(){this.log("resetBalances"),this.hypeBalance.set(null),this.qoneBalance.set(null)}async validateChainOrSetError(e,n){try{let r=Number(Rt.networkDetails.chainId),i=Number(e?.chainId??await e?.request?.({method:"eth_chainId"}));return this.log(`${n}: chain check`,{current:i,expected:r}),i!==r?(this.error.set(`Wrong network. Please switch to ${Rt.networkDetails.chainName}.`),!1):!0}catch(r){return this.err(`${n}: chain check failed`,r),!0}}closeWcModal(e){let n=this.walletConnectProvider?.modal;n?.closeModal&&(this.log(`WalletConnect modal: closing (${e})`),n.closeModal())}static \u0275fac=function(n){return new(n||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})};var dg=["function getClaimableAmount(address beneficiary, uint8 category) public view returns (uint256)","function claim(uint8 category) external","function initializeMyAllocation(uint256 totalAmount, uint8 category, bytes32[] calldata proof) external","function getAllocation(address beneficiary, uint8 category) external view returns (tuple(uint256 totalAmount, uint256 claimedAmount, bool initialized))","function tgeTimestamp() external view returns (uint256)","function totalAllocated() external view returns (uint256)","function totalClaimed() external view returns (uint256)"],C0=class t{walletService=re(oh);claimableAmount=pt(null);claimableCategories=pt([]);isClaiming=pt(!1);isInitializing=pt(!1);initializingCategoryName=pt(null);uninitializedAllocations=pt([]);initializationNeeded=pt(!1);error=pt(null);userAllocations=pt([]);tgeDate=pt(null);totalAllocated=pt(null);totalClaimed=pt(null);categoryNames={0:"Token Sale Tier 1",1:"Token Sale Tier 2",2:"Token Sale Tier 3",3:"Team & Advisors",4:"Liquidity/Treasury",5:"Community Airdrops"};constructor(){this.fetchGlobalStats()}async fetchGlobalStats(){console.log("VestingService: Fetching global stats...");try{let e=new Fs(Rt.networkDetails.rpcUrls[0]),n=new dn(Rt.vestingContractAddress,dg,e),[r,i,s]=await Promise.all([n.tgeTimestamp(),n.totalAllocated(),n.totalClaimed()]);console.log("VestingService: Global stats fetched:",{tgeTs:r,totalAlloc:i,totalClm:s}),this.tgeDate.set(new Date(Number(r)*1e3)),this.totalAllocated.set(Zi(i,18)),this.totalClaimed.set(Zi(s,18))}catch(e){console.error("Error fetching global vesting stats:",e)}}async fetchClaimableAmount(e){console.log(`VestingService: Fetching claimable amount for ${e}`);try{this.checkInitializationNeeded(e);let n=new Fs(Rt.networkDetails.rpcUrls[0]),r=new dn(Rt.vestingContractAddress,dg,n),i=0n,s=[];for(let o=0;o<=5;o++){let a=await r.getClaimableAmount(e,o);a>0n&&(console.log(`VestingService: Found claimable amount for category ${o}: ${a}`),i+=a,s.push({category:o,name:this.categoryNames[o],amount:Zi(a,18)}))}console.log(`VestingService: Total claimable for ${e}: ${i}`),this.claimableAmount.set(Zi(i,18)),this.claimableCategories.set(s)}catch(n){console.error("Error fetching claimable amount:",n),this.claimableAmount.set(null),this.claimableCategories.set([])}}async claim(e){console.log(`VestingService: Attempting to claim category ${e}`),this.isClaiming.set(!0),this.error.set(null);try{let n=this.walletService.currentAccount();console.log("VestingService: Getting signer for account:",n);let r=await this.walletService.getSigner(n||void 0),s=await new dn(Rt.vestingContractAddress,dg,r).claim(e);console.log("VestingService: Claim transaction sent:",s.hash),await s.wait(),console.log("VestingService: Claim transaction confirmed");let o=await r.getAddress();await this.fetchClaimableAmount(o),await this.fetchGlobalStats()}catch(n){console.error("Error claiming tokens:",n),this.error.set(n.message||"Failed to claim tokens")}finally{this.isClaiming.set(!1)}}async checkInitializationNeeded(e){console.log(`VestingService: Checking initialization needed for ${e}`);try{let n=new Fs(Rt.networkDetails.rpcUrls[0]),r=new dn(Rt.vestingContractAddress,dg,n),i=await fetch(`${Rt.supabaseRestUrl}?address=${e}`);if(!i.ok){console.error("VestingService: Failed to fetch Supabase data");return}let o=(await i.json()).data||[];console.log(`VestingService: Found ${o.length} allocations in DB for ${e}`);let a=[],c=[],l=!1;for(let u of o){let d=u.category,h=BigInt(u.amount_wei),f={category:d,name:this.categoryNames[d],amount:Zi(h,18)};a.push(f),(await r.getAllocation(e,d))[2]?console.log(`VestingService: Allocation for category ${d} already initialized`):(console.log(`VestingService: Allocation for category ${d} needs initialization`),l=!0,c.push(f))}this.userAllocations.set(a),this.initializationNeeded.set(l),this.uninitializedAllocations.set(c)}catch(n){console.error("Error checking initialization:",n),this.userAllocations.set([]),this.uninitializedAllocations.set([])}}async initializeAllocations(e){console.log(`VestingService: initializeAllocations called for ${e}`),this.isInitializing.set(!0),this.error.set(null);try{let n=await fetch(`${Rt.supabaseRestUrl}?address=${e}`);if(!n.ok)throw new Error("Failed to fetch allocation data");let i=(await n.json()).data||[];console.log("VestingService: Allocations to process:",i);try{console.log("VestingService: Getting signer for address:",e);let s=await this.walletService.getSigner(e),o=new dn(Rt.vestingContractAddress,dg,s);for(let a of i){let{category:c,amount_wei:l,proof:u}=a;if((await o.getAllocation(e,c))[2])console.log(`VestingService: Skipping category ${c}, already initialized`);else{let h;h=BigInt(l),console.log(`VestingService: Initializing category ${c} with amount ${h}, proof: ${u}`),this.initializingCategoryName.set(this.categoryNames[c]);let f=await o.initializeMyAllocation(h,c,u);console.log("VestingService: Initialization tx sent:",f.hash),await f.wait(),console.log("VestingService: Initialization tx confirmed"),this.initializingCategoryName.set(null)}}this.initializationNeeded.set(!1),await this.fetchClaimableAmount(e),await this.fetchGlobalStats()}catch(s){throw s}}catch(n){console.error("Error initializing allocations:",n),this.error.set(n.message||"Failed to initialize allocations")}finally{this.isInitializing.set(!1),this.initializingCategoryName.set(null)}}static \u0275fac=function(n){return new(n||t)};static \u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"})};var xN=(t,e)=>e.category;function nve(t,e){t&1&&(Ee(0,"div",14)(1,"h3"),Ye(2,"HYPE Balance"),Te(),Ee(3,"p"),Ye(4),$i(5,"number"),Te()()),t&2&&(je(4),Nr("",qi(5,1,e,"1.0-6")," HYPE"))}function rve(t,e){if(t&1&&(Ee(0,"option",20),Ye(1),Te()),t&2){let n=e.$implicit;ro("value",n),je(),Os(n)}}function ive(t,e){if(t&1&&(Ee(0,"div",31)(1,"span"),Ye(2),Te(),Ee(3,"span"),Ye(4),$i(5,"number"),Te()()),t&2){let n=e.$implicit;je(2),Nr("",n.name,":"),je(2),Nr("",qi(5,2,n.amount,"1.0-6")," qONE")}}function sve(t,e){if(t&1&&(Ee(0,"div",24)(1,"p"),Ye(2,"Allocations:"),Te(),Ee(3,"div",30),Au(4,ive,6,5,"div",31,xN),Te()()),t&2){let n=an(2);je(4),Su(n.vestingService.userAllocations())}}function ove(t,e){if(t&1){let n=Bc();Ee(0,"div",24)(1,"div",32)(2,"code",33)(3,"div",31)(4,"span"),Ye(5,"qONE Balance:"),Te(),Ee(6,"span"),Ye(7),$i(8,"number"),Te()()(),Ee(9,"button",34),Hi("click",function(){Li(n);let i=an(2);return Fi(i.walletService.addTokenToMetaMask())}),mu(),Ee(10,"svg",35),Vi(11,"path",36),Te()()()()}t&2&&(je(7),Nr("",qi(8,1,e,"1.0-2")," qONE"))}function ave(t,e){if(t&1&&(Ee(0,"li",39)(1,"span"),Ye(2),Te(),Ee(3,"span"),Ye(4),$i(5,"number"),Te()()),t&2){let n=e.$implicit;je(2),Os(n.name),je(2),Nr("",qi(5,2,n.amount,"1.0-6")," qONE")}}function cve(t,e){if(t&1){let n=Bc();Ee(0,"div",26)(1,"p",37),Ye(2,"You have pending vesting allocations to initialize:"),Te(),Ee(3,"ul",38),Au(4,ave,6,5,"li",39,xN),Te(),Ee(6,"button",40),Hi("click",function(){Li(n);let i=an(),s=an();return Fi(s.vestingService.initializeAllocations(i))}),Ye(7),Te()()}if(t&2){let n=an(2);je(4),Su(n.vestingService.uninitializedAllocations()),je(2),ro("disabled",n.vestingService.isInitializing()),je(),Nr(" ",n.vestingService.isInitializing()?"Initializing "+(n.vestingService.initializingCategoryName()||"")+"...":"Initialize "+(n.vestingService.uninitializedAllocations().length===1?n.vestingService.uninitializedAllocations()[0].name:"Allocations ("+n.vestingService.uninitializedAllocations().length+")")," ")}}function lve(t,e){if(t&1){let n=Bc();Ee(0,"div",43)(1,"p"),Ye(2),$i(3,"number"),Te(),Ee(4,"button",45),Hi("click",function(){let i=Li(n).$implicit,s=an(3);return Fi(s.vestingService.claim(i.category))}),Ye(5),Te()()}if(t&2){let n=e.$implicit,r=an(3);je(2),Km("",n.name,": ",qi(3,4,n.amount,"1.0-6")," qONE"),je(2),ro("disabled",r.vestingService.isClaiming()),je(),Nr(" ",r.vestingService.isClaiming()?"Claiming...":"Claim"," ")}}function uve(t,e){if(t&1&&(Ee(0,"p",44),Ye(1),Te()),t&2){let n=an(3);je(),Os(n.vestingService.error())}}function dve(t,e){if(t&1&&(Ee(0,"div",27)(1,"div",24)(2,"p"),Ye(3,"Total Claimable Vested Tokens:"),Te(),Ee(4,"code",41),Ye(5),$i(6,"number"),Te()(),Ee(7,"div",42),Au(8,lve,6,7,"div",43,xN),xs(10,uve,2,1,"p",44),Te()()),t&2){let n=an(2);je(5),Nr("",qi(6,2,e,"1.0-6")," qONE"),je(3),Su(n.vestingService.claimableCategories()),je(2),Rs(n.vestingService.error()?10:-1)}}function hve(t,e){if(t&1){let n=Bc();Ee(0,"div",16)(1,"p"),Ye(2,"Connected Address:"),Te(),Ee(3,"div",18)(4,"select",19),Hi("change",function(i){Li(n);let s=an();return Fi(s.walletService.switchAccount(i.target.value))}),Au(5,rve,2,2,"option",20,tC),Te(),Ee(7,"button",21),Hi("click",function(){Li(n);let i=an();return Fi(i.refresh())}),mu(),Ee(8,"svg",22),Vi(9,"path",23),Te()()(),xs(10,sve,6,0,"div",24),Lh(),Ee(11,"div",25),xs(12,ove,12,4,"div",24),Te(),xs(13,cve,8,2,"div",26),xs(14,dve,11,5,"div",27),Ee(15,"p",28),Ye(16," Heads up! After claiming qONE, it can take 10\u201330 seconds for the blockchain to update your balance. If you still see the old amount, just tap Refresh. "),Te(),Ee(17,"button",29),Hi("click",function(){Li(n);let i=an();return Fi(i.walletService.disconnectWallet())}),Ye(18," Disconnect "),Te()()}if(t&2){let n,r,i=an();je(4),ro("value",e),je(),Su(i.walletService.accounts()),je(5),Rs(i.vestingService.userAllocations().length>0?10:-1),je(2),Rs((n=i.walletService.qoneBalance())?12:-1,n),je(),Rs(i.vestingService.initializationNeeded()?13:-1),je(),Rs((r=i.vestingService.claimableAmount())?14:-1,r)}}function fve(t,e){if(t&1&&(Ee(0,"p",44),Ye(1),Te()),t&2){let n=an(2);je(),Os(n.walletService.error())}}function pve(t,e){if(t&1){let n=Bc();Ee(0,"div",17)(1,"button",46),Hi("click",function(){Li(n);let i=an();return Fi(i.walletService.connectWallet("metamask"))}),Vi(2,"img",47),Ee(3,"span"),Ye(4),Te()(),Ee(5,"button",46),Hi("click",function(){Li(n);let i=an();return Fi(i.walletService.connectWallet("walletconnect"))}),Vi(6,"img",48),Ee(7,"span"),Ye(8),Te()(),xs(9,fve,2,1,"p",44),Te()}if(t&2){let n=an();je(),ro("disabled",n.walletService.isConnecting()),je(3),Os(n.walletService.isConnecting()?"Connecting...":"Connect to MetaMask"),je(),ro("disabled",n.walletService.isConnecting()),je(3),Os(n.walletService.isConnecting()?"Connecting...":"WalletConnect"),je(),Rs(n.walletService.error()?9:-1)}}var A0=class t{title=pt("qlabs-vesting");walletService=re(oh);vestingService=re(C0);constructor(){nI(()=>{let e=this.walletService.currentAccount();e?this.vestingService.fetchClaimableAmount(e):this.vestingService.claimableAmount.set(null)})}async refresh(){await this.walletService.refreshBalances();let e=this.walletService.currentAccount();e&&await this.vestingService.fetchClaimableAmount(e)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=Jh({type:t,selectors:[["app-root"]],decls:41,vars:14,consts:[["href","https://qlabs.tech/","target","_blank",1,"top-announcement-bar"],[1,"announcement-content"],[1,"content-left"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"icon"],["d","M4.9 19.1C1 15.2 1 8.8 4.9 4.9"],["d","M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"],["cx","12","cy","12","r","2"],["d","M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"],["d","M19.1 4.9C23 8.8 23 15.1 19.1 19.1"],[1,"message"],[1,"read-more"],[1,"main-container"],[1,"content-grid"],[1,"stats-section"],[1,"stat-card"],[1,"wallet-section"],[1,"connected-view"],[1,"connect-view"],[1,"address-selector"],[1,"account-select",3,"change","value"],[3,"value"],["title","Refresh Balances",1,"btn-icon","refresh-btn",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"],[1,"balance-item"],[1,"balances-container"],[1,"init-section"],[1,"vesting-section"],[1,"info-text"],[1,"btn","btn-disconnect",3,"click"],[1,"balance-value","allocations-list"],[1,"allocation-row"],[1,"balance-value-row"],[1,"balance-value","text-left","flex-grow"],["title","Add QLABS to MetaMask",1,"btn-icon",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M12 5v14M5 12h14"],[1,"warning-text"],[1,"pending-list"],[1,"pending-item"],[1,"btn","btn-init",3,"click","disabled"],[1,"balance-value","claimable"],[1,"claim-actions"],[1,"claim-item"],[1,"error-message"],[1,"btn","btn-claim",3,"click","disabled"],[1,"btn","btn-connect",3,"click","disabled"],["src","metamask.png","alt","MetaMask",1,"wallet-icon"],["src","walletconnect.svg","alt","WalletConnect",1,"wallet-icon"]],template:function(n,r){if(n&1&&(Ee(0,"a",0)(1,"div",1)(2,"div",2),mu(),Ee(3,"svg",3),Vi(4,"path",4)(5,"path",5)(6,"circle",6)(7,"path",7)(8,"path",8),Te(),Lh(),Ee(9,"span",9),Ye(10,"qLABS to Launch Quantum-Sig Wallet to Protect Crypto From Quantum Attacks"),Te()(),Ee(11,"span",10),Ye(12,"Read more >"),Te()()(),Ee(13,"main",11)(14,"h1"),Ye(15,"qONE Vesting"),Te(),Ee(16,"div",12)(17,"div",13)(18,"div",14)(19,"h3"),Ye(20,"TGE Date"),Te(),Ee(21,"p"),Ye(22),$i(23,"date"),Te()(),Ee(24,"div",14)(25,"h3"),Ye(26,"Global Allocated"),Te(),Ee(27,"p"),Ye(28),$i(29,"number"),Te()(),Ee(30,"div",14)(31,"h3"),Ye(32,"Global Claimed"),Te(),Ee(33,"p"),Ye(34),$i(35,"number"),Te()(),xs(36,nve,6,4,"div",14),Te(),Ee(37,"div",15),xs(38,hve,19,5,"div",16)(39,pve,10,5,"div",17),Te()()(),Vi(40,"router-outlet")),n&2){let i,s;je(22),Os(qi(23,5,r.vestingService.tgeDate(),"mediumDate")),je(6),Nr("",qi(29,8,r.vestingService.totalAllocated(),"1.0-0")," qONE"),je(6),Nr("",qi(35,11,r.vestingService.totalClaimed(),"1.0-0")," qONE"),je(2),Rs((i=r.walletService.hypeBalance())?36:-1,i),je(2),Rs((s=r.walletService.currentAccount())?38:39,s)}},dependencies:[Sf,pC,gC],styles:['@charset "UTF-8";.top-announcement-bar[_ngcontent-%COMP%]{display:block;background-color:#a3ff12;color:#000;text-decoration:none;font-family:Inter,sans-serif;width:100%;position:relative;z-index:10}.announcement-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;max-width:1200px;margin:0 auto;font-weight:600;font-size:.95rem}.content-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.icon[_ngcontent-%COMP%]{flex-shrink:0;width:20px;height:20px}.message[_ngcontent-%COMP%]{text-align:left}.read-more[_ngcontent-%COMP%]{white-space:nowrap;font-weight:700;margin-left:1rem}.top-announcement-bar[_ngcontent-%COMP%]:hover{background-color:#8ce60e}@media(max-width:768px){.announcement-content[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center;gap:.5rem}.content-left[_ngcontent-%COMP%]{justify-content:center;text-align:center;flex-wrap:wrap;gap:.5rem}.message[_ngcontent-%COMP%]{text-align:center}.read-more[_ngcontent-%COMP%]{display:block;width:100%;text-align:center;margin-left:0;margin-top:.25rem}}.main-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80vh;font-family:Inter,sans-serif;padding:1rem;background-color:#000;color:#fff;position:relative;overflow:hidden}h1[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:2rem;color:#a3ff12;text-transform:uppercase;z-index:1}.content-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;width:100%;max-width:1000px;z-index:1}.stats-section[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center}.user-stats[_ngcontent-%COMP%]{margin-bottom:0;padding-bottom:2rem;border-bottom:1px solid #333}.stat-card[_ngcontent-%COMP%]{background:#111;padding:1rem;border-radius:12px;box-shadow:0 2px 4px #00000080;min-width:180px;text-align:center;border:1px solid #333;flex:1;word-break:break-all}.stat-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9rem;color:#a3ff12;text-transform:uppercase;letter-spacing:.5px}.stat-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:#fff}.wallet-section[_ngcontent-%COMP%]{padding:1.5rem;border-radius:12px;background:#111;box-shadow:0 4px 6px #00000080;min-width:300px;text-align:center;border:1px solid #333}@media(min-width:768px){.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:300px 1fr;align-items:start;gap:3rem}.stats-section[_ngcontent-%COMP%]{flex-direction:column;margin-bottom:0}.stat-card[_ngcontent-%COMP%]{width:100%;min-width:auto}}.address-display[_ngcontent-%COMP%], .balance-value[_ngcontent-%COMP%]{display:block;background:#222;padding:.5rem 1rem;border-radius:6px;margin:1rem 0;font-family:monospace;word-break:break-all;color:#a3ff12;border:1px solid #333}.address-selector[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin:1rem 0}.account-select[_ngcontent-%COMP%]{flex-grow:1;background:#222;color:#a3ff12;border:1px solid #333;padding:.5rem;border-radius:6px;font-family:monospace;outline:none;width:100%}.account-select[_ngcontent-%COMP%]:focus{border-color:#a3ff12}.balances-container[_ngcontent-%COMP%]{margin:1.5rem 0;display:flex;flex-direction:column;gap:1rem}.allocations-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;text-align:left}.allocation-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;font-size:.9rem}.balance-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#fff;font-weight:500;text-align:left}.balance-value[_ngcontent-%COMP%]{background:#222;color:#a3ff12;font-weight:700;margin:0;border:1px solid #a3ff12;text-align:center}.balance-value.text-left[_ngcontent-%COMP%]{text-align:left}.balance-value.claimable[_ngcontent-%COMP%]{background:#222;color:#a3ff12;border:1px solid #a3ff12}.balance-value-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:stretch}.balance-value.flex-grow[_ngcontent-%COMP%]{flex-grow:1;margin:0}.vesting-section[_ngcontent-%COMP%]{margin:1.5rem 0;padding-top:1.5rem;border-top:1px solid #333}.uninitialized-section[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid #333}.uninitialized-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:.5rem;color:#a3ff12}.info-text[_ngcontent-%COMP%]{font-size:.85rem;color:#888;margin-bottom:1rem;font-style:italic}.claim-actions[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-direction:column;gap:1rem}.claim-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;background:#222;padding:1rem;border-radius:8px;border:1px solid #333}.claim-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;font-size:.9rem;color:#fff}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;font-size:1rem}.btn-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:0 1rem;background:transparent;border:1px solid #a3ff12;color:#a3ff12;border-radius:6px;cursor:pointer;transition:all .2s}.btn-icon.refresh-btn[_ngcontent-%COMP%]{padding:0;width:40px;height:40px}.btn-icon.refresh-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.btn-icon[_ngcontent-%COMP%]:hover{background:#a3ff12;color:#000}.connect-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.btn-connect[_ngcontent-%COMP%]{background-color:#a3ff12;color:#000;width:100%;display:flex;align-items:center;justify-content:center;gap:.75rem}.btn-connect[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#8ce60e}.btn-connect[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.wallet-icon[_ngcontent-%COMP%]{width:24px;height:24px;object-fit:contain}.btn-disconnect[_ngcontent-%COMP%]{background-color:#ff4d4d;color:#fff}.btn-disconnect[_ngcontent-%COMP%]:hover{background-color:#e60000}.btn-claim[_ngcontent-%COMP%]{background-color:#a3ff12;color:#000;width:100%;padding:.5rem 1rem;font-size:.9rem}.btn-claim[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#8ce60e}.btn-claim[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background-color:#333;color:#888;width:100%;padding:.5rem 1rem;font-size:.9rem;cursor:default;opacity:.8;border:1px solid #444}.btn-outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #a3ff12;color:#a3ff12;padding:.25rem .5rem;font-size:.8rem;margin-top:.5rem;width:100%}.btn-outline[_ngcontent-%COMP%]:hover{background:#a3ff12;color:#000}.error-message[_ngcontent-%COMP%]{color:#ff4d4d;margin-top:1rem;font-size:.9rem}.init-section[_ngcontent-%COMP%]{margin:1.5rem 0;padding:1rem;border:1px solid #a3ff12;border-radius:8px;background:#a3ff121a}.warning-text[_ngcontent-%COMP%]{color:#a3ff12;font-weight:600;margin-bottom:1rem;margin-top:0}.btn-init[_ngcontent-%COMP%]{background-color:#a3ff12;color:#000;width:100%;padding:.5rem 1rem;font-size:.9rem}.btn-init[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#8ce60e}.btn-init[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.pending-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 1rem;text-align:left}.pending-item[_ngcontent-%COMP%]{color:#a3ff12;font-size:.9rem;padding:.25rem 0 .25rem 1rem;position:relative;display:flex;justify-content:space-between;align-items:center}.pending-item[_ngcontent-%COMP%]:before{content:"\\2022";position:absolute;left:0;color:#a3ff12}']})};AC(A0,Pk).catch(t=>console.error(t));
